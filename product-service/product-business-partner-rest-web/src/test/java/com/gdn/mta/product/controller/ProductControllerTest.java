package com.gdn.mta.product.controller;

import java.io.File;
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;
import java.nio.charset.StandardCharsets;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import java.util.TreeMap;
import java.util.UUID;

import com.gda.mta.product.dto.AppealProductConfigResponse;
import com.gda.mta.product.dto.AppealProductRequest;
import com.gda.mta.product.dto.AppealProductResponse;
import com.gda.mta.product.dto.AutoApprovalTypeRequest;
import com.gda.mta.product.dto.B2bDetailsDTO;
import com.gda.mta.product.dto.CategoryAndCnDetailDto;
import com.gda.mta.product.dto.EditProductResponse;
import com.gda.mta.product.dto.GenericStringListRequest;
import com.gda.mta.product.dto.NeedRevisionProductsRequest;
import com.gda.mta.product.dto.PickupPointCreateRequest;
import com.gda.mta.product.dto.ProductAndL5MigrationRequest;
import com.gda.mta.product.dto.ProductBrandUpdateRequest;
import com.gda.mta.product.dto.ProductVariantUpdateRequest;
import com.gda.mta.product.dto.RetryNeedRevisionRequest;
import com.gda.mta.product.dto.ValidateDuplicateProductRequest;
import com.gda.mta.product.dto.ValidateDuplicateProductResponse;
import com.gda.mta.product.dto.response.AutoApprovalTypeResponse;
import com.gda.mta.product.dto.response.HalalProductHistoryResponse;
import com.gda.mta.product.dto.response.InProgressProductResponsePageResponse;
import com.gda.mta.product.dto.response.ProductAndBrandResponse;
import com.gda.mta.product.dto.response.ProductCodeAndNameDetails;
import com.gda.mta.product.dto.response.ProductCreationFailureResponse;
import com.gda.mta.product.dto.response.RetryAutoNeedRevisionResponse;
import com.gdn.mta.product.entity.ProductLevel3;
import com.gdn.mta.product.enums.ApiErrorCode;
import com.gdn.mta.product.enums.AutoApprovalType;
import com.gdn.mta.product.service.HalalHistoryUpdateService;
import com.gdn.mta.product.service.ProductAppealService;
import com.gdn.mta.product.service.ProductLevel3V2Wrapper;
import com.gdn.mta.product.service.config.PreOrderConfig;
import com.gdn.mta.product.util.ProductCreationValidation;
import com.gdn.mta.product.service.DistributionInfoServiceBean;
import com.gda.mta.product.dto.response.OmniChannelSkuResponse;
import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.verify;
import com.gdn.x.product.enums.ProductType;
import org.apache.commons.io.FilenameUtils;
import org.apache.commons.lang3.RandomStringUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.http.client.utils.URIBuilder;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.mockito.Captor;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.MockitoAnnotations;
import org.mockito.verification.VerificationMode;
import org.slf4j.MDC;
import com.gdn.mta.product.util.BeanUtils;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.http.MediaType;
import org.springframework.http.converter.ByteArrayHttpMessageConverter;
import org.springframework.http.converter.FormHttpMessageConverter;
import org.springframework.http.converter.ResourceHttpMessageConverter;
import org.springframework.http.converter.StringHttpMessageConverter;
import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;
import org.springframework.test.util.ReflectionTestUtils;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;

import com.fasterxml.jackson.core.JsonFactory;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.gda.mta.product.dto.AttributeReqModelListRequest;
import com.gda.mta.product.dto.BulkDeleteProductWipRequest;
import com.gda.mta.product.dto.BulkMasterProductUpdateRequest;
import com.gda.mta.product.dto.BulkMasterProductUpdateResponse;
import com.gda.mta.product.dto.CreateProductRequest;
import com.gda.mta.product.dto.DalamProductListRequest;
import com.gda.mta.product.dto.DeleteProductRequest;
import com.gda.mta.product.dto.NeedRevisionSubmitRequest;
import com.gda.mta.product.dto.PreOrderRequest;
import com.gda.mta.product.dto.ProductCodesResponse;
import com.gda.mta.product.dto.ProductCollectionRequest;
import com.gda.mta.product.dto.ProductCollectionResponse;
import com.gda.mta.product.dto.ProductDetailCompleteResponse;
import com.gda.mta.product.dto.ProductCreationRequest;
import com.gda.mta.product.dto.ProductDetailMtaResponse;
import com.gda.mta.product.dto.ProductFilterRequest;
import com.gda.mta.product.dto.ProductHistoryRequest;
import com.gda.mta.product.dto.ProductHistoryResponse;
import com.gda.mta.product.dto.ProductItemCreationRequest;
import com.gda.mta.product.dto.ProductItemWholesalePriceRequest;
import com.gda.mta.product.dto.ProductMtaResponse;
import com.gda.mta.product.dto.ScreeningProductBulkActionsRequest;
import com.gda.mta.product.dto.StringListRequest;
import com.gda.mta.product.dto.VendorNotesRequest;
import com.gda.mta.product.dto.generator.ProductWfStateResponse;
import com.gda.mta.product.dto.generator.StuckProductResponse;
import com.gda.mta.product.dto.response.PreOrderResponse;
import com.gda.mta.product.dto.response.ProductSkuResponseList;
import com.gdn.common.enums.ErrorCategory;
import com.gdn.common.exception.ApplicationRuntimeException;
import com.gdn.mta.product.util.GdnMandatoryRequestParameterUtil;
import com.gdn.common.web.wrapper.response.GdnBaseRestResponse;
import com.gdn.common.web.wrapper.response.GdnRestListResponse;
import com.gdn.common.web.wrapper.response.GdnRestSingleResponse;
import com.gdn.common.web.wrapper.response.PageMetaData;
import com.gdn.mta.product.entity.ProductBusinessPartnerAttribute;
import com.gdn.mta.product.entity.ProductCollection;
import com.gdn.mta.product.entity.ProductHistory;
import com.gdn.mta.product.entity.ProductSystemParameter;
import com.gdn.mta.product.entity.ProductWorkflow;
import com.gdn.mta.product.enums.BulkActionType;
import com.gdn.mta.product.enums.ProductCreationType;
import com.gdn.mta.product.service.ErrorMessages;
import com.gdn.mta.product.service.ProductBusinessPartnerService;
import com.gdn.mta.product.service.ProductMigrationWrapperService;
import com.gdn.mta.product.service.ProductService;
import com.gdn.mta.product.service.ProductServiceWrapper;
import com.gdn.mta.product.service.ProductSystemParameterService;
import com.gdn.mta.product.service.ProductWorkflowServiceWrapper;
import com.gdn.mta.product.service.TrackerService;
import com.gdn.mta.product.service.domainevent.publisher.ProductStatusPublisherService;
import com.gdn.mta.product.service.exception.ApiDataNotFoundException;
import com.gdn.mta.product.service.util.WholesaleValidationUtil;
import com.gdn.mta.product.util.BarcodeGenerator;
import com.gdn.mta.product.util.GdnBaseLookup;
import com.gdn.mta.product.util.GdnRestSimpleResponse;
import com.gdn.mta.product.valueobject.BulkMasterProductUpdateRequestDTO;
import com.gdn.mta.product.valueobject.ProductEmailSentResponse;
import com.gdn.mta.product.valueobject.SolrProductCollectionDTO;
import com.gdn.mta.product.web.model.ProductControllerErrorMessage;
import com.gdn.mta.product.web.model.ProductControllerPath;
import com.gdn.partners.pbp.commons.constants.Constants;
import com.gdn.partners.pbp.commons.constants.EditedReviewTypeConstants;
import com.gdn.partners.pbp.commons.constants.SystemParameterConstants;
import com.gdn.partners.pbp.dto.productcategory.CategoryHierarchyProductCountResponse;
import com.gdn.partners.pbp.dto.productlevel1.ProductSearchRequest;
import com.gdn.partners.pbp.dto.productlevel3.PostLiveProductCountResponse;
import com.gdn.partners.pbp.dto.productlevel3.ProductCollectionCountRestResponse;
import com.gdn.partners.pbp.entity.workflow.product.ProductWorkflowStatus;
import com.gdn.partners.pbp.model.productlevel3.ProductCollectionCountRequest;
import com.gdn.partners.pbp.model.productlevel3.ProductCollectionCountResponse;
import com.gdn.partners.pbp.outbound.product.ProductOutbound;
import com.gdn.partners.pbp.service.notification.ProductNotificationService;
import com.gdn.partners.pbp.service.productlevel1.ProductLevel1CollectionService;
import com.gdn.partners.pbp.workflow.product.ProductWfService;
import com.gdn.x.businesspartner.dto.CompanyDTO;
import com.gdn.x.businesspartner.dto.PickupPointDTO;
import com.gdn.x.businesspartner.dto.ProfileResponse;
import com.gdn.x.productcategorybase.AttributeType;
import com.gdn.x.productcategorybase.CatalogType;
import com.gdn.x.productcategorybase.dto.ActivateImageRequest;
import com.gdn.x.productcategorybase.dto.ActivateImageResponse;
import com.gdn.x.productcategorybase.dto.DescriptiveAttributeValueType;
import com.gdn.x.productcategorybase.dto.Image;
import com.gdn.x.productcategorybase.dto.request.AllowedAttributeValueRequest;
import com.gdn.x.productcategorybase.dto.request.AttributeRequest;
import com.gdn.x.productcategorybase.dto.request.CatalogRequest;
import com.gdn.x.productcategorybase.dto.request.CategoryRequest;
import com.gdn.x.productcategorybase.dto.request.OmniChannelSkuRequest;
import com.gdn.x.productcategorybase.dto.request.PredefinedAllowedAttributeValueRequest;
import com.gdn.x.productcategorybase.dto.request.ProductAttributeRequest;
import com.gdn.x.productcategorybase.dto.request.ProductAttributeValueRequest;
import com.gdn.x.productcategorybase.dto.request.ProductCategoryRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemAttributeValueRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemRequest;
import com.gdn.x.productcategorybase.dto.request.ProductRequest;
import com.gdn.x.productcategorybase.dto.request.SimpleMasterProductUpdateRequest;
import com.gdn.x.productcategorybase.dto.request.solr.AttributeReqModel;
import com.gdn.x.productcategorybase.dto.response.AttributeResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryHierarchyResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryResponse;
import com.gdn.x.productcategorybase.dto.response.ProductAttributeResponse;
import com.gdn.x.productcategorybase.dto.response.ProductAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.response.ProductCategoryResponse;
import com.gdn.x.productcategorybase.dto.response.ProductCodeResponse;
import com.gdn.x.productcategorybase.dto.response.ProductDetailResponse;
import com.gdn.x.productcategorybase.dto.response.ProductItemAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.response.ProductItemDetailResponse;
import com.gdn.x.productcategorybase.dto.response.ProductItemResponse;
import com.gdn.x.productcategorybase.dto.response.ProductResponse;
import com.gdn.x.productcategorybase.dto.response.SimpleMasterProductUpdateResponse;
import com.gdn.x.productcategorybase.entity.AllowedAttributeValue;
import com.gdn.x.productcategorybase.entity.Attribute;
import com.gdn.x.productcategorybase.entity.Catalog;
import com.gdn.x.productcategorybase.entity.Category;
import com.gdn.x.productcategorybase.entity.Product;
import com.gdn.x.productcategorybase.entity.ProductAttribute;
import com.gdn.x.productcategorybase.entity.ProductAttributeValue;
import com.gdn.x.productcategorybase.entity.ProductCategory;
import com.gdn.x.productcategorybase.entity.ProductImage;
import com.gdn.x.productcategorybase.entity.ProductItem;
import com.gdn.x.productcategorybase.entity.ProductItemImage;
import static com.gdn.x.productcategorybase.dto.AttributeType.DEFINING_ATTRIBUTE;
import static com.gdn.x.productcategorybase.dto.AttributeType.DESCRIPTIVE_ATTRIBUTE;
import static com.gdn.x.productcategorybase.dto.AttributeType.PREDEFINED_ATTRIBUTE;
import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.CoreMatchers.nullValue;
import static org.hamcrest.collection.IsCollectionWithSize.hasSize;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertNotNull;

import static org.junit.jupiter.api.Assertions.assertNull;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.doReturn;
import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verifyNoMoreInteractions;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

import jakarta.servlet.ServletException;

public class ProductControllerTest {

  private static final String DEFAULT_STORE_ID = "10001";
  private static final String DEFAULT_CHANNEL_ID = "channel-1";
  private static final String DEFAULT_CLIENT_ID = "client-1";
  private static final String PCU_EXTERNAL_APP = "pcu-external-app";
  private static final String MTA_APP = "MTAApp";
  private static final String MTA_API = "mta-api";
  private static final String DEFAULT_USERNAME = "com.gdn.mta.developer";
  private static final Integer DEFAULT_PAGE = 0;
  private static final String ATTRIBUTE_CODE = "attribute_code";
  private static final Integer DEFAULT_SIZE = 10;
  private static final VerificationMode AT_LEAST_ONE = Mockito.times(1);
  private static final VerificationMode AT_LEAST_NONE = Mockito.times(0);
  private static final String DEFAULT_PRODUCT_ID = "44fa4b52-7920-45a0-8ef9-3cbe63bd3594";
  private static final String DEFAULT_PRODUCT_CODE = "MTA-" + UUID.randomUUID().toString();
  private static final String DEFAULT_PRODUCT_NAME = "Produk";
  private static final String DEFAULT_PRODUCT_UPC = "Upc";
  private static final String DEFAULT_PRODUCT_CATEGORY = "Category";
  private static final byte[] DEFAULT_PRODUCT_DESC = "Deskripsi".getBytes();
  private static final byte[] DEFAULT_PRODUCT_LONG_DESC = "Deskripsi Panjang".getBytes();
  private static final String DEFAULT_PRODUCT_BRAND = "Brand";
  private static final String DEFAULT_REQUEST_ID = UUID.randomUUID().toString();
  private static final VerificationMode NEVER_CALLED = Mockito.times(0);
  private static final String DEFAULT_HASH_CODE = "default hash code";
  private static final String DEFAULT_FILENAME = "default filename";
  private static final String RESULT = "result";
  private static final String CATEGORY_1 = "category-1";
  private static final String DEFAULT_BP_CODE = "bp-code";
  private static final String DEFAULT_NOTE = "permanent delete";
  private static final String RESIZE_IMAGE = "resizeImage";
  private static final String ROOT = "/";
  private static final String LONG_STRING =
      "qwertioplkjhgfdswertyuiolkjhgfdqwertyuilkjhgfdsertyuihgfdghgfdfghfdfghfdfghfdfghgfdfhgfdredfghredfqwertioplkjhgfdswertyuiolkjhgfdqwertyuilkjhgfdsertyuihgfdghgfdfghfdfghfdfghfdfghgfdfhgfdredfghredfqwertioplkjhgfdswertyuiolkjhgfdqwertyuilkjhgfdsertyuihgfdghgfdfghfdfghfdfghfdfghgfdfhgfdredfghredf";
  private static final String SOURCE_DIRECTORY = "/tmp";
  private static final String REVIEW_PENDING = "true";
  private final String CATEGORY_ID = "1234";
  private static final String NOTES = "notes";
  private static final String VALUE = "Value";
  private static long COUNT_TODAY = 123l;
  private static final Long TIMESTAMP = System.currentTimeMillis();
  private static final String DEFAULT_CATEGORY_CODE = "CA-1234";
  private static final String PRODUCT_CODE = "productCode";
  private static final String MERCHANT_CODE = "merchantCode";
  private static final String PRODUCT_NAME = "productName";
  private static final String BRAND = "brand";
  private static final Double LENGTH = 1.0;
  private static final Double WIDTH = 1.0;
  private static final Double HEIGHT = 1.0;
  private static final Double WEIGHT = 1.0;
  private static final Integer DANGEROUS_GOODS_LEVEL = 1;
  private static int RETRY_BATCH_SIZE_COUNT = 5;
  private static final String STATE = "IN_VENDOR";
  private static final Integer TOTAL_STUCK_PRODUCTS = 10;
  private static final String BRAND_CODE = "brandCode";
  private static final String BRAND_APPROVAL_STATUS = "APPROVED";
  private static final String BUSINESS_PARTNER_CODE = "MERCHANT-CODE";
  private static final String BUSINESS_PARTNER_NAME = "MERCHANT-NAME";
  private static final String FILEPATH = "filePath";
  private static final String INVALID_DG_LEVEL_ERROR = "Can not process invalid input data :invalid DG level found";
  private static final int PAGE = 0;
  private static final int SIZE = 100;
  private static final String SIZE_CHART = "sizeChart";
  private static final String DEFAULT_SORT_TYPE = "desc";
  private static final String YOUTUBE_URL = "https://www.youtube.com/watch?v=P1xAhgKTqDA";
  private static final String YOUTUBE_INVALID_URL = "https://www.youtube.com/watch?v";
  private static final String API_KEY = "apiKey";
  public static final String BULK_CLIENT_ID = "x-bulk";
  public static final String FLOW_1 = "FLOW1";
  public static final String FLOW_2 = "FLOW2";
  private static final String WHOLESALE_SETTING_MORE_THAN_6 =
      "Wholesale total setting can't be more than 5, the current total setting is 6";
  private static final String USP_WITH_MORE_THAN_400_CHARACTERS =
      "Case Premium Bagian Belakang Dove Transparan , Kelebihan :~Bagian belakang dove.\n"
          + "~Ada crack / Anti jatuh.\n" + "~Bagian belakang transparan tampil elegant\n"
          + "~Anti Pecah / Sobek karena pakai bahan lentur.\n" + "~Penuh warna glosy di List sekelilingnya\n"
          + "~Slim dan pas di gengam di tangan\n" + "~Anti lecet karena menggunakan Kualitas bahan terbaik\n"
          + "~Lepas pasang sangat mudah , tidak keras / kasar. Lepas pasang sangat mudah , tidak keras / kasar2.";

  private static final String USP_WITH_SPECIAL_CHARACTERS_AND_SPACES =
      "• Susu formula\n"
          + "• Susu bernutrisi yang     dapat memenuhi kebutuhan nutrisi anak usia 1 - 3 tahun sebesar 190 kalori setiap saji\n"
          + "• Mengandung campuran lemak nabati sebanyak 33% dari kandungan total energi\n"
          + "• Dengan alfa-laktalbumin, oligofruktosa, kalsium, kolin, fosfor, selenium, vitamin C, E, dan D, serta 52 jenis makro mikro nutrien yang penting untuk pertumbuhan anak\n"
          + "• Rasa : Vanila, Netto : 1600 gr\n" + "• Rasa : Vanilad";
  private final String PRODUCT_SKU = "productSku";
  private static final String DESCRIPTION_WITH_PARAGRAPH_TAGS =
      "<!DOCTYPE html>\n" + "<html>\n" + "<head>\n" + "</head>\n" + "<body>\n"
          + "<p>Character Counter is a 100% free online character count calculator that's simple to use. Sometimes users prefer simplicity over all of the detailed writing information Word Counter provides, and this is exactly what this tool offers. It displays character count and word count which is often the only information a person needs to know about their writing. Best of all, you receive the needed information at a lightning fast speed.</p>\n"
          + "<p>To find out the word and character count of your writing, simply copy and paste text into the tool or write directly into the text area. Once done, the free online tool will display both counts for the text that's been inserted. This can be useful in many instances, but it can be especially helpful when you are writing for something that has a character minimum or limit.</p>\n"
          + "<p>Character and word limits are quite common these days on the Internet. The one that most people are likely aware of is the 140 character limit for tweets on Twitter, but character limits aren't restricted to Twitter. There are limits for text messages (SMS), Yelp reviews, Facebook posts, Pinterest pins, Reddit titles and comments, eBay titles and descriptions as well as many others. Knowing these limits, as well as being able to see as you approach them, will enable you to better express yourself within the imposed limits.</p>\n"
          + "<p>For students, there are usually limits or minimums for homework assignments. The same is often true for college applications. Abiding by these can have a major impact on how this writing is graded and reviewed, and it shows whether or not you're able to follow basic directions. Character counter can make sure you don't accidentally go over limits or fail to meet minimums that can be detrimental to these assignments.</p>\n"
          + "<p>This information can also be quite helpful for writers. Knowing the number of words and characters can help writers better understand the length of their writing, and work to display the pages of their writing in a specific way. For those who write for magazines and newspapers where there is limited space, knowing these counts can help the writer get the most information into that limited space.</p>\n"
          + "<p>For job seekers, knowing the number of characters of your resume can be essential to get all the information you want onto a single page. You can fool around with different fonts, their sizes and spacing to adjust the number of characters you can fit on a single page, but it's important to know the number you're attempting to fit on the page.</p>\n"
          + "<p>Character Counter isn't only for English. The tool can be helpful for those writing in non-English languages where character count is important. This can be the case for languages Japanese, Korean, Chinese and many others where characters are the basis of the written language. Even for those who aren't writing in English, knowing the character count of the writing is often beneficial to the writing.</p>\n"
          + "<p>&nbsp;</p>\n"
          + "<p><br />Character Counter isn't only for English. The tool can be helpful for those writing in non-English languages where character count is important. This can be the case for languages Japanese, Korean, Chinese and many others where characters are the basis of the written language. Even for those who aren't writing in English, knowing the character count of the writing is often beneficial to the writing.</p>\n"
          + "<p>Character Counter isn't only for English. The tool can be helpful for those writing in non-English languages where character count is important. This can be the case for languages Japanese, Korean, Chinese and many others where characters are the basis of the written language. Even for those who aren't writing in English, knowing the character count of the writing is often beneficial to the writing.</p>\n"
          + "<p>Character Counter isn't only for English. The tool can be helpful for those writing in non-English languages where character count is important. This can be the case for languages Japanese, Korean, Chinese and many others where characters are the basis of the written language. Even for those who aren't writing in English, knowing the character count of the writing is often beneficial to the writing.</p>\n"
          + "<p>Character Counter isn't only for English. The tool can be helpful for those writing in non-English languages where character count is important. This can be the case for languages Japanese, Korean, Chinese and many others where characters are the basis of the written language. Even for those who aren't writing in English, knowing the character count of the writing is often beneficial to the writing.This information can also be quite helpful for writers. Knowing the number of words and characters can help writers better understand the length of their writing, and work to display the pages of their writing in a specific way. For those who write for magazines and newspapers where there is limited space, knowing these 1234cou including paragraphs</p>\n"
          + "</body>\n" + "</html>";
  private static final String PREORDER_DAYS_TYPE = "DAYS";
  private static final String PREORDER_WEEK_TYPE = "WEEK";
  private static final String PREORDER_DATE_TYPE = "DATE";
  private static final Integer PREORDER_VALUE = 10;
  private static final SimpleDateFormat PREORDER_DATE_FORMAT = new SimpleDateFormat("dd/MM/yyyy");
  private static final String DAYS_MORE_THAN_LIMIT_ERROR = "Maximum 90 days are allowed";
  private static final String SELLER_SKU_LIMIT_ERROR = "Maksimal Seller Sku 255";
  private static final String ITEM_VALUE_INVALID = "Item attribute value invalid";
  private static final String ZERO_DAYS_ERROR = "Number of days should be more than 0";
  private static final String MAXIMUM_WEEK_ERROR = "Maximum 13 weeks are allowed";
  private static final String ZERO_WEEK_ERROR = "Number of week should be more than 0";
  private static final String DATE_ERROR = "PreOrder date must be greater than available date";
  private static final String WRONG_PREORDER_TYPE = "PreOrder type must be DAYS, WEEK or DATE";
  private static final String PREORDER_DATE_EXCEEDED_LIMIT = "PreOrder date is exceeded 90 days";
  private static final String INVALID_EXTENSION = "source/file.28";
  private static final String ITEM_CODE = "itemCode";
  private static final String PICKUP_POINT_CODE = "ppCode";
  private static final String PICKUP_POINT_CODE_1 = "pickup-point-2";
  private static final String PICKUP_POINT_CODE_2 = "pickup-point";
  private static final String B2C_SELLER_CHANNEL = "BLIBLI";
  private static final String B2B_SELLER_CHANNEL = "BLIBLI FOR BUSINESS";
  private static final String ACTIVITY = "activity";
  private static final String PREVIOUS_VALUE = "previousValue";
  private static final String CURRENT_VALUE = "currentValue";
  private static final String CREATED_BY = "createdBy";
  private static final String STORE_ID = "10001";
  private static final String REQUEST_ID = "REQ-001";
  List<String> productSkus = new ArrayList<>();
  private GdnRestListResponse<ProductDetailResponse> gdnRestListResponse;

  private MockMvc mockMvc;
  private String requestId;
  private ObjectMapper objectMapper;
  private ProductRequest productRequest;
  private AttributeReqModelListRequest attributeReqModelListRequest;
  private StringListRequest productCodeList = new StringListRequest();

  private ProductControllerErrorMessage productControllerErrorMessage = new ProductControllerErrorMessage();

  private ProductSystemParameter productSystemParameter;
  private PreOrderRequest preOrderRequest;
  private ProductDetailCompleteResponse productDetailCompleteResponse = new ProductDetailCompleteResponse();
  private PreOrderResponse preOrderResponse;
  private ProductVariantUpdateRequest productVariantUpdateRequest = new ProductVariantUpdateRequest();
  private ProductLevel3 productLevel3 = new ProductLevel3();
  private ProfileResponse profileResponse = new ProfileResponse();
  private ValidateDuplicateProductRequest validateDuplicateProductRequest = new ValidateDuplicateProductRequest();
  private ValidateDuplicateProductResponse validateDuplicateProductResponse = new ValidateDuplicateProductResponse();
  private static final PageRequest pageRequest = PageRequest.of(0, 10);
  private static HalalProductHistoryResponse halalProductHistoryResponse;
  private AppealProductRequest appealProductRequest = new AppealProductRequest();

  @Mock
  private ProductWfService productWorkflowService;

  @Mock
  private ProductLevel1CollectionService productLevel1CollectionService;

  @InjectMocks
  private ProductController productController;

  @Mock
  private ProductService productService;

  @Mock
  private ProductServiceWrapper productServiceWrapper;

  @Mock
  private ProductLevel3V2Wrapper productLevel3V2Wrapper;

  @Mock
  private ProductWorkflowServiceWrapper productWorkflowServiceWrapper;

  @Mock
  private ProductBusinessPartnerService mockProductBusinessPartnerService;

  @Mock
  private ProductBusinessPartnerService productBusinessPartnerService;

  @Mock
  private ProductStatusPublisherService productStatusPublisherService;

  @Mock
  private ProductMigrationWrapperService productMigrationWrapperService;

  @Captor
  private ArgumentCaptor<BulkMasterProductUpdateRequestDTO> bulkMasterProductUpdateRequestDTOArgumentCaptor;

  @Captor
  private ArgumentCaptor<Product> productArgumentCaptor;

  @Captor
  private ArgumentCaptor<ProductCreationRequest> productCreationRequestArgumentCaptor;

  @Mock
  private ProductNotificationService productNotificationService;

  @Mock
  private ProductSystemParameterService productSystemParameterService;

  @Captor
  private ArgumentCaptor<ProductRequest> productRequestArgumentCaptor;

  @Mock
  private WholesaleValidationUtil wholesaleValidationUtil;

  @Mock
  private TrackerService trackerService;

  @Mock
  private ProductOutbound productOutbound;

  @Mock
  private ProductCreationValidation productCreationValidation;

  @Mock
  private HalalHistoryUpdateService halalHistoryUpdateService;

  @Mock
  private ProductAppealService productAppealService;

  @Mock
  private PreOrderConfig preOrderConfig;

  @Mock
  private ObjectMapper mapper;

  @Captor
  private ArgumentCaptor<List<ProductItemCreationRequest>> productItemsCaptor;
  private boolean aBoolean;

  private void convertProductCollectionRequestToProduct(
      ProductCollectionRequest productCollectionRequest, Product product) {
    BeanUtils.copyProperties(productCollectionRequest, product, "productCategories",
        "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : productCollectionRequest
        .getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory, "category");
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : productCollectionRequest
        .getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute, "attribute");
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
  }

  public ProductDetailMtaResponse createDummyProductDetailMtaResponse() {
    ProductDetailMtaResponse productDetailMtaResponse = new ProductDetailMtaResponse(
        new ProductResponse.Builder().productCode(ProductControllerTest.DEFAULT_PRODUCT_CODE)
            .name(ProductControllerTest.DEFAULT_PRODUCT_NAME).length(1.0).width(1.0).weight(1.0)
            .height(1.0).shippingWeight(1.0).description(ProductControllerTest.DEFAULT_PRODUCT_DESC)
            .brand(ProductControllerTest.DEFAULT_PRODUCT_BRAND).uniqueSellingPoint(null).uom(null)
            .activated(false).viewable(true).productStory(null).productType(null).url(null)
            .images(null).specificationDetail(null).build());
    productDetailMtaResponse.setId(ProductControllerTest.DEFAULT_PRODUCT_ID);
    ProductAttributeResponse productAttributeResponse_ = new ProductAttributeResponse();
    productAttributeResponse_.setAttribute(new AttributeResponse(null, null,
        AttributeType.DESCRIPTIVE_ATTRIBUTE.toString(), false));
    productDetailMtaResponse.setProductItemResponses(new HashSet<ProductItemResponse>());
    productDetailMtaResponse.setProductCategoryResponses(new ArrayList<ProductCategoryResponse>());
    productDetailMtaResponse
        .setProductAttributeResponses(new ArrayList<ProductAttributeResponse>());
    productDetailMtaResponse.getProductItemResponses().add(
        new ProductItemResponse("Produk 1 - Produk Item 1", null, null, null, null, null, UUID
            .randomUUID().toString(), null, true, false, null, null));
    productDetailMtaResponse.getProductCategoryResponses()
        .add(
            new ProductCategoryResponse(new CategoryResponse(),
                ProductControllerTest.DEFAULT_STORE_ID));
    productDetailMtaResponse.getProductAttributeResponses().add(productAttributeResponse_);
    return productDetailMtaResponse;
  }

  public List<ProductHistoryResponse> createDummyProductHistoryResponseList(String productId) {
    List<ProductHistoryResponse> productHistories = new ArrayList<ProductHistoryResponse>();
    productHistories.add(new ProductHistoryResponse(UUID.randomUUID().toString(),
        ProductControllerTest.DEFAULT_STORE_ID, Calendar.getInstance().getTime(), "SYSADM",
        Calendar.getInstance().getTime(), "SYSADM", productId, 0, "Draft", null));
    productHistories.add(new ProductHistoryResponse(UUID.randomUUID().toString(),
        ProductControllerTest.DEFAULT_STORE_ID, Calendar.getInstance().getTime(), "SYSADM",
        Calendar.getInstance().getTime(), "SYSADM", productId, 1, "Review Konten", null));
    productHistories.add(new ProductHistoryResponse(UUID.randomUUID().toString(),
        ProductControllerTest.DEFAULT_STORE_ID, Calendar.getInstance().getTime(), "SYSADM",
        Calendar.getInstance().getTime(), "SYSADM", productId, 2, "Review Gambar", null));
    return productHistories;
  }

  public ProductMtaResponse createDummyProductMtaResponse() {
    return new ProductMtaResponse.Builder().storeId(ProductControllerTest.DEFAULT_STORE_ID)
        .id(ProductControllerTest.DEFAULT_PRODUCT_ID)
        .productCode(ProductControllerTest.DEFAULT_PRODUCT_CODE)
        .name(ProductControllerTest.DEFAULT_PRODUCT_NAME).length(1.0).weight(1.0).width(1.0)
        .height(1.0).shippingWeight(1.0).description(ProductControllerTest.DEFAULT_PRODUCT_DESC)
        .brand(ProductControllerTest.DEFAULT_PRODUCT_BRAND).build();
  }

  @AfterEach
  public void finalizeTest() throws Exception {
    this.productRequest =null;
    verifyNoMoreInteractions(productStatusPublisherService,
        productLevel1CollectionService,
        productWorkflowService,
        productServiceWrapper,
        wholesaleValidationUtil);
    verifyNoMoreInteractions(trackerService);
    verifyNoMoreInteractions(halalHistoryUpdateService);
    verifyNoMoreInteractions(productAppealService);
    verifyNoMoreInteractions(productLevel3V2Wrapper);
    verifyNoMoreInteractions(mapper);
  }

  private ProductCollectionRequest generateProductCollectionRequest() {
    ProductCollectionRequest request = new ProductCollectionRequest();
    request.setProductCode("MTA-" + UUID.randomUUID().toString());
    request.setName("Produk 1");
    request.setLength(1.0);
    request.setWidth(1.0);
    request.setHeight(1.0);
    request.setWeight(1.0);
    request.setShippingWeight(1.0);
    request.setDescription("Deskripsi 1".getBytes());
    request.setLongDescription("Deskripsi 1".getBytes());
    request.setBrand("Testing");
    request.setUniqueSellingPoint("USP");
    request.setProductCategories(new ArrayList<ProductCategoryRequest>());
    request.setProductAttributes(new ArrayList<ProductAttributeRequest>());
    request.setProductItems(new ArrayList<ProductItemRequest>());
    request.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    request.setCreatedDate(Calendar.getInstance().getTime());
    request.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    request.setUpdatedDate(Calendar.getInstance().getTime());
    request.setSpecificationDetail("Specification Detail");
    request.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    request.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    return request;
  }

  private CreateProductRequest generateCreateProductRequest() throws Exception {
    CreateProductRequest request = new CreateProductRequest();
    request.setName(ProductControllerTest.DEFAULT_PRODUCT_NAME);
    request.setDescription("Description".getBytes());
    request.setLongDescription("Long Description".getBytes());
    request.setSpecificationDetail("Specification Detail");
    request.setUniqueSellingPoint("Unique Selling Point");
    request.setLength(1.0);
    request.setWidth(1.0);
    request.setHeight(1.0);
    request.setWeight(1.0);
    request.setShippingWeight(1.0);
    request.setProductCategories(new ArrayList<ProductCategoryRequest>());
    request.setProductAttributes(new ArrayList<ProductAttributeRequest>());
    request.setProductItems(new ArrayList<ProductItemRequest>());
    request.getProductCategories().add(new ProductCategoryRequest());
    request.getProductAttributes().add(new ProductAttributeRequest());
    request.setProductCreationType(ProductCreationType.UNIFIED_BULK_UPLOAD);
    List<ProductCategoryRequest> prodCatReqList = new ArrayList<>();
    ProductCategoryRequest prodCatReq = new ProductCategoryRequest();
    CategoryRequest cat = new CategoryRequest();
    cat.setId(this.CATEGORY_ID);
    prodCatReq.setCategory(cat);
    prodCatReqList.add(prodCatReq);

    request.setProductCategories(prodCatReqList);
    return request;
  }

  public MockMvc getMockMvc() {
    return this.mockMvc;
  }

  public ObjectMapper getObjectMapper() {
    return this.objectMapper;
  }

  public ProductController getProductController() {
    return this.productController;
  }

  public ProductService getProductService() {
    return this.productService;
  }

  public String getRequestId() {
    return this.requestId;
  }

  private ProductWorkflowStatus generateProductWorkflowStatus() throws Exception {
    ProductWorkflowStatus productWorkflowStatus = new ProductWorkflowStatus();
    productWorkflowStatus.getStates().add("PROCESS_IMAGE");
    return productWorkflowStatus;
  }

  @BeforeEach
  public void initializeTest() throws Exception {
    MockitoAnnotations.initMocks(this);
    ReflectionTestUtils.setField(productController, "maximumCharactersInDescription", 5000);
    ReflectionTestUtils.setField(productController, "maximumCharactersWithoutFormattingDescription", 5000);
    ReflectionTestUtils.setField(productController, "checkOnlyNewImagesForExtension", false);
    this.productCodeList.add(DEFAULT_PRODUCT_CODE);
    setMockMvc(MockMvcBuilders
        .standaloneSetup(getProductController())
        .setMessageConverters(new ByteArrayHttpMessageConverter(),
            new StringHttpMessageConverter(), new ResourceHttpMessageConverter(),
            new FormHttpMessageConverter(), new MappingJackson2HttpMessageConverter()).build());
    setRequestId(UUID.randomUUID().toString());
    productLevel3.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    setObjectMapper(new ObjectMapper(new JsonFactory()));
    ProductWorkflowStatus productWorkflowStatus = generateProductWorkflowStatus();
    Mockito.doNothing().when(this.productService)
        .processImage(any(), any(), Mockito.anyBoolean());
    Mockito.doNothing().when(this.productService)
        .rejectProcessImage(any(), any());
    Mockito.when(this.productService.approveImage(any(), any(), Mockito.anyBoolean()))
        .thenReturn(true);
    Mockito.doNothing().when(this.productService).approveDraft(any(), any());
    Mockito.when(productService.getMinimumPrice(DEFAULT_STORE_ID)).thenReturn(1);
    this.productRequest =
        new ProductRequest.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 1").length(1.0).width(1.0).height(1.0).weight(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes()).longDescription("Deskripsi 1".getBytes())
            .brand("Brand 1").brandCode(BRAND_CODE).uniqueSellingPoint("Unique Selling Point").uom(null).storeId(null)
            .promoSKU(false).productCategories(new ArrayList<ProductCategoryRequest>())
            .productAttributes(new ArrayList<ProductAttributeRequest>())
            .productItems(new ArrayList<ProductItemRequest>()).storeId(DEFAULT_STORE_ID).build();
    this.gdnRestListResponse = new GdnRestListResponse<>();
    this.gdnRestListResponse.setSuccess(true);
    Mockito.when(this.productWorkflowService.create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            any())).thenReturn(null);
    Mockito.when(this.productWorkflowService.status(any())).thenReturn(productWorkflowStatus);
    ReflectionTestUtils.setField(productController, "cronJobStuckProductBatchSize", RETRY_BATCH_SIZE_COUNT);
    ReflectionTestUtils.setField(productController, "familyColourValidationSwitch", false);
    ReflectionTestUtils.setField(productController, "youTubeDataApiKey", API_KEY);
    ReflectionTestUtils.setField(productController, "validateBrandCode", false);
    productSystemParameter = new ProductSystemParameter();
    productSystemParameter.setValue("false");
    Mockito.when(productSystemParameterService
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(productSystemParameter);
    Mockito.when(productSystemParameterService
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION))
        .thenReturn(new ProductSystemParameter(SystemParameterConstants.VALID_IMAGE_EXTENSION, ".jpg,.png,.jpeg",SystemParameterConstants.VALID_IMAGE_EXTENSION, Boolean.FALSE));
    Mockito.when(productService.checkBpBopisEligibility(Mockito.anyInt(), any())).thenReturn(null);
    ReflectionTestUtils.setField(productController, "maxWholesalePriceRequests", 1000);
    productSkus.add(PRODUCT_SKU);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);

    preOrderRequest =
        PreOrderRequest.builder().isPreOrder(true).preOrderType(PREORDER_DAYS_TYPE).preOrderValue(PREORDER_VALUE).build();
    ReflectionTestUtils.setField(productController, "preOrderMaximumDays", 90);
    ReflectionTestUtils.setField(productController, "preOrderMaximumWeek", 13);

    preOrderResponse =
        PreOrderResponse.builder().isPreOrder(true).preOrderType(PREORDER_DAYS_TYPE).preOrderValue(PREORDER_VALUE)
            .preOrderDate(new Date()).build();

    PickupPointDTO pickupPointDTO = new PickupPointDTO();
    pickupPointDTO.setCode(PICKUP_POINT_CODE);

    PickupPointDTO pickupPointDTO1 = new PickupPointDTO();
    pickupPointDTO1.setCode(PICKUP_POINT_CODE_1);

    PickupPointDTO pickupPointDTO2 = new PickupPointDTO();
    pickupPointDTO2.setCode(PICKUP_POINT_CODE_2);

    profileResponse.setPickupPoints(Arrays.asList(pickupPointDTO, pickupPointDTO1, pickupPointDTO2));
    profileResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);

    Mockito.when(productService.getProfileResponse(BUSINESS_PARTNER_CODE)).thenReturn(profileResponse);

    validateDuplicateProductRequest.setKeyword(PRODUCT_NAME);
    validateDuplicateProductRequest.setByProductName(true);
    validateDuplicateProductRequest.setBySellerSku(true);

    validateDuplicateProductResponse.setProductSku(PRODUCT_SKU);
    validateDuplicateProductResponse.setProductName(PRODUCT_NAME);
    validateDuplicateProductResponse.setStatus(STATE);

    halalProductHistoryResponse = new HalalProductHistoryResponse();
    halalProductHistoryResponse.setActivity(ACTIVITY);
    halalProductHistoryResponse.setPreviousValue(PREVIOUS_VALUE);
    halalProductHistoryResponse.setCurrentValue(CURRENT_VALUE);
    halalProductHistoryResponse.setCreatedBy(CREATED_BY);
  }

  public void setMockMvc(MockMvc mockMvc) {
    this.mockMvc = mockMvc;
  }

  public void setObjectMapper(ObjectMapper objectMapper) {
    this.objectMapper = objectMapper;
  }

  public void setProductController(ProductController productController) {
    this.productController = productController;
  }

  public void setProductService(ProductService productService) {
    this.productService = productService;
  }

  public void setRequestId(String requestId) {
    this.requestId = requestId;
  }

  @Test
  public void testApprovedContent() throws Exception {
    ProductRequest productRequest = getProductRequestValue();
    Product product = getProductRequest(productRequest);
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).approvedContent(
        ProductControllerTest.DEFAULT_STORE_ID, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testApprovedContentInvalidImageExtension() throws Exception {
    ProductRequest productRequest = getProductRequestValue();
    Product product = getProductRequest(productRequest);
    Image image = new Image();
    image.setLocationPath(INVALID_EXTENSION);
    image.setMarkForDelete(true);
    productRequest.setImages(Collections.singletonList(image));
    productRequest.setProductItems(Collections.singletonList(new ProductItemRequest()));
    productRequest.getProductItems().get(0).setImages(Collections.singletonList(image));
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).approvedContent(
        ProductControllerTest.DEFAULT_STORE_ID, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  private ProductRequest getProductRequestValue() {
    return new ProductRequest.Builder().productCode("MTA-" + UUID.randomUUID().toString())
        .name("Produk 1").length(1.0).width(1.0).height(1.0).weight(1.0).shippingWeight(1.0)
        .description("Deskripsi 1".getBytes()).longDescription("Deskripsi 1".getBytes())
        .brand("Brand 1").uniqueSellingPoint("Unique Selling Point").uom(null).storeId(null)
        .promoSKU(false).productCategories(new ArrayList<>())
        .productAttributes(new ArrayList<>())
        .productItems(new ArrayList<>()).build();
  }

  private Product getProductRequest(ProductRequest productRequest) {
    productRequest.setId(UUID.randomUUID().toString());
    productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    productRequest.setCreatedDate(Calendar.getInstance().getTime());
    productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    productRequest.setSpecificationDetail("Spesifikasi Detail");
    productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    return product;
  }

  @Test
  public void testApprovedContentWithInvalidDescription() throws Exception {
    ProductRequest productRequest = getProductRequestValue();
    Product product = getProductRequest(productRequest);
    when(getProductService().findById(productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidHeight() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidLength() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidLongDescription() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LONG_DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidName() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.NAME_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidProductAttributes() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedContentWithInvalidProductCategories() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedContentWithInvalidShippingWeight() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage()
          .contains(ProductControllerErrorMessage.SHIPPING_WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidSpecificationDetail() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedContentWithNullUniqueSellingPoint() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUniqueSellingPoint(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
         .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
         .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
         .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
         .addParameter("requestId", getRequestId())
         .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
         .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
         .contentType(MediaType.APPLICATION_JSON)
         .content(getObjectMapper().writeValueAsString(productRequest)))
         .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
         .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
         productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).approvedContent(
         ProductControllerTest.DEFAULT_STORE_ID, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testApprovedContentWithInvalidUpdatedBy() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedContentWithInvalidUpdatedDate() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedContentWithInvalidWeight() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedContentWithInvalidWidth() throws Exception {
    Product product = getProductRequest(this.productRequest);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .approvedContent(ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedImage() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      productImageRequest.setLocationPath(".jpeg");
      product.getProductImages().add(productImage);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).approvedImage(
        ProductControllerTest.DEFAULT_STORE_ID, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testApprovedImageWithInvalidHeight() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService).findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedImageWithInvalidProductAttributes() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedImageWithInvalidProductCategories() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedImageWithInvalidProductImages() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.PRODUCT_IMAGES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testApprovedImageWithInvalidSpecificationDetail() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedImageWithNullUniqueSellingPoint() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUniqueSellingPoint(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      productImageRequest.setLocationPath(".jpg");
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
             .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
             .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
             .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
             .addParameter("requestId", getRequestId())
             .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
             .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
              .perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
              .contentType(MediaType.APPLICATION_JSON)
              .content(getObjectMapper().writeValueAsString(this.productRequest)))
              .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).approvedImage(
        ProductControllerTest.DEFAULT_STORE_ID, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testApprovedImageWithInvalidUpdatedBy() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedImageWithInvalidUpdatedDate() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testApprovedImageWithInvalidWeight() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getImages().add(new Image());
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes",
        "images");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (Image productImageRequest : this.productRequest.getImages()) {
      ProductImage productImage = new ProductImage();
      BeanUtils.copyProperties(productImageRequest, productImage);
      product.getProductImages().add(productImage);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .approvedImage(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVED_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).approvedImage(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testDeleteProduct() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper).delete(DEFAULT_STORE_ID, product.getId(), product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(productServiceWrapper, ProductControllerTest.AT_LEAST_ONE).delete(DEFAULT_STORE_ID,
        product.getId(), product.getProductCode());
  }

  @Test
  public void testDeleteProductCollection() throws Exception {
    DeleteProductRequest request = new DeleteProductRequest(DEFAULT_PRODUCT_CODE, DEFAULT_NOTE);
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, this.requestId);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("needEmailNotification", Boolean.TRUE.toString())
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(request)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    Mockito.verify(this.productWorkflowServiceWrapper)
        .deleteProductCollection(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE, DEFAULT_NOTE, Boolean.TRUE, Boolean.FALSE);
  }

  @Test
  public void testDeleteProductCollectionWithInvalidNotes() throws Exception {
    DeleteProductRequest request = new DeleteProductRequest("MTA-0000001", null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("needEmailNotification", Boolean.TRUE.toString())
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
      Mockito.verify(this.productWorkflowServiceWrapper, ProductControllerTest.NEVER_CALLED)
          .deleteProductCollection(DEFAULT_STORE_ID, "MTA-0000001", DEFAULT_NOTE, Boolean.FALSE, Boolean.FALSE);
  }

  @Test
  public void testDeleteProductCollectionWithInvalidProductCode() throws Exception {
    DeleteProductRequest request = new DeleteProductRequest(null, "TEST");
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("needEmailNotification", Boolean.TRUE.toString())
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowServiceWrapper, ProductControllerTest.NEVER_CALLED)
          .deleteProductCollection(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE, DEFAULT_NOTE, Boolean.FALSE, Boolean.FALSE);
    }
  }

  @Test
  public void testFilterProductCollectionSummaryByKeywordWithActivatedTrueAndViewableTrue()
      throws Exception {
    ProductWorkflowStatus productWorkflowStatus = generateProductWorkflowStatus();
    productWorkflowStatus.getStates().clear();
    productWorkflowStatus.getStates().add("CONTENT_APPROVED");
    productWorkflowStatus.getStates().add("IMAGE_APPROVED");
    productWorkflowStatus.setProductCode("MTA-0000001");
    Mockito.when(this.productWorkflowService.status(any()))
        .thenReturn(productWorkflowStatus);
    List<ProductCollection> productCollections = new ArrayList<ProductCollection>();
    Date createdDate = Calendar.getInstance().getTime();
    String productId = UUID.randomUUID().toString();
    productCollections.add(new ProductCollection(productId,
        "MTA-0000001",
        "Produk 1",
        "Testing",
        "CAT-0000001",
        "Kategori 1",
        "BLT-00001",
        "Blibli Testing",
        true,
        true,
        null,
        ProductControllerTest.DEFAULT_USERNAME,
        createdDate,
        DEFAULT_STORE_ID));
    Page<ProductCollection> productCollectionPage =
        new PageImpl<ProductCollection>(productCollections);
    SolrProductCollectionDTO solrProductCollectionDTO =
        new SolrProductCollectionDTO.Builder().setProductCode("MTA-0000001")
            .setProductId(productId)
            .setBrand("Testing")
            .setBusinessPartnerCode("BLT-00001")
            .setBusinessPartnerName("Blibli Testing")
            .setCategoryCode("CAT-0000001")
            .setCategoryName("Kategori 1")
            .setProductName("Produk 1")
            .setCreatedBy(DEFAULT_USERNAME)
            .setCreatedDate(createdDate)
            .setStoreId(DEFAULT_STORE_ID)
            .build();
    Page<SolrProductCollectionDTO> solrProductCollectionDTOPage =
        new PageImpl<>(Arrays.asList(solrProductCollectionDTO));
    List<ProductWorkflow> productWorkflows = new ArrayList<ProductWorkflow>();
    List<ProductCollectionResponse> productCollectionResponses =
        new ArrayList<ProductCollectionResponse>();
    productCollectionResponses.add(new ProductCollectionResponse(null,
        ProductControllerTest.DEFAULT_STORE_ID,
        productCollections.get(0).getCreatedDate(),
        productCollections.get(0).getCreatedBy(),
        productCollections.get(0).getUpdatedDate(),
        productCollections.get(0).getUpdatedBy(),
        productCollections.get(0).getProductId(),
        productCollections.get(0).getProductCode(),
        productCollections.get(0).getProductName(),
        productCollections.get(0).getBrand(),
        productCollections.get(0).getCategoryCode(),
        productCollections.get(0).getCategoryName(),
        productCollections.get(0).getBusinessPartnerCode(),
        productCollections.get(0).getBusinessPartnerName(),
        productCollections.get(0).isActivated(),
        productCollections.get(0).isViewable(),
        productCollections.get(0).getState(),
        true,
        true));
    Pageable pageable = PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
        ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductCollectionResponse> response =
        new GdnRestListResponse<ProductCollectionResponse>(null,
            null,
            true,
            productCollectionResponses,
            new PageMetaData(pageable.getPageSize(),
                pageable.getPageNumber(),
                productCollectionPage.getTotalElements()),
            this.requestId);
    doReturn(productWorkflows).when(getProductService())
        .findProductWorkflows(eq(ProductControllerTest.DEFAULT_STORE_ID),
            any());
    doReturn(Arrays.asList(productWorkflowStatus)).when(productWorkflowService)
        .getProductWorkFlowByProductCodes(any(List.class));
    Mockito.doReturn(solrProductCollectionDTOPage)
        .when(this.productService)
        .getActiveProductCollectionFromSolr(DEFAULT_STORE_ID,
            "product1",
            DEFAULT_CATEGORY_CODE, null, DEFAULT_SORT_TYPE,
            PageRequest.of(0, 10));
    Mockito.doReturn(productCollectionResponses)
        .when(productService)
        .getProductsByProductCodesInAndActivatedTrueAndViewableTrue(eq(DEFAULT_STORE_ID),
            Mockito.anyList());
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.COLLECTION_FILTER_KEYWORD)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .addParameter("businessPartnerCode", null)
        .addParameter("categoryCode", DEFAULT_CATEGORY_CODE)
        .addParameter("keyword", "product1")
        .addParameter("activated", String.valueOf(true))
        .addParameter("viewable", String.valueOf(true))
        .addParameter("currentState", "DRAFT")
        .build();
    MvcResult result = getMockMvc().perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response),
        result.getResponse().getContentAsString());
    Mockito.verify(this.productService)
        .getActiveProductCollectionFromSolr(eq(DEFAULT_STORE_ID),
            eq("product1"),
            eq(DEFAULT_CATEGORY_CODE), eq(null), eq(DEFAULT_SORT_TYPE),
            any(Pageable.class));
    Mockito.verify(this.productService)
        .getProductsByProductCodesInAndActivatedTrueAndViewableTrue(eq(DEFAULT_STORE_ID),
            Mockito.anyList());
  }


    @Test
    public void testFilterProductCodesByKeywordWithActivatedTrueAndViewableTrue() throws Exception {
      ProductCodesResponse productCodesResponse = new ProductCodesResponse();
      List<String> productCodes = new ArrayList<>();
      productCodesResponse.setProductCodes(productCodes);
      Pageable pageable = PageRequest.of(ProductControllerTest.DEFAULT_PAGE, Integer.MAX_VALUE);
      GdnRestSingleResponse<ProductCodesResponse> response =
          new GdnRestSingleResponse<>(null, null, true, productCodesResponse, this.requestId);
      Mockito.when(this.productService
          .getActiveProductCodesFromSolr(DEFAULT_STORE_ID, "apple", DEFAULT_CATEGORY_CODE, true, DEFAULT_SORT_TYPE,
              pageable)).thenReturn(productCodes);
      URI uri = new URIBuilder()
          .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.COLLECTION_FILTER_KEYWORD_FOR_BULK_DOWNLOAD)
          .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
          .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
          .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
          .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
          .addParameter("categoryCode", DEFAULT_CATEGORY_CODE).addParameter("keyword", "apple")
          .addParameter("reviewPending", "true").addParameter("sortBy", "desc")
          .addParameter("activated", String.valueOf(true)).addParameter("viewable", String.valueOf(true)).build();
      MvcResult result = getMockMvc().perform(
          MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
      assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
      Mockito.verify(this.productService)
          .getActiveProductCodesFromSolr(DEFAULT_STORE_ID, "apple", DEFAULT_CATEGORY_CODE, true, DEFAULT_SORT_TYPE,
              pageable);
    }

    @Test
    public void testFilterProductCodesByKeywordWithActivatedTrueAndViewableTrueWithException() throws Exception {
      ProductCodesResponse productCodesResponse = new ProductCodesResponse();
      List<String> productCodes = new ArrayList<>();
      productCodesResponse.setProductCodes(productCodes);
      Pageable pageable = PageRequest.of(ProductControllerTest.DEFAULT_PAGE, Integer.MAX_VALUE);
      GdnRestSingleResponse<ProductCodesResponse> response =
          new GdnRestSingleResponse<>(null, null, true, productCodesResponse, this.requestId);
      Mockito.when(this.productService
          .getActiveProductCodesFromSolr(DEFAULT_STORE_ID, "apple", DEFAULT_CATEGORY_CODE, false, DEFAULT_SORT_TYPE,
              pageable)).thenThrow(RuntimeException.class);
      URI uri = new URIBuilder()
          .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.COLLECTION_FILTER_KEYWORD_FOR_BULK_DOWNLOAD)
          .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
          .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
          .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
          .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
          .addParameter("categoryCode", DEFAULT_CATEGORY_CODE).addParameter("keyword", "apple")
          .addParameter("reviewPending", "false").addParameter("sortBy", "desc")
          .addParameter("activated", String.valueOf(true)).addParameter("viewable", String.valueOf(true)).build();
      Assertions.assertThrows(Exception.class, () -> {
        MvcResult result = getMockMvc().perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
      });
      Mockito.verify(this.productService)
          .getActiveProductCodesFromSolr(DEFAULT_STORE_ID, "apple", DEFAULT_CATEGORY_CODE, false, DEFAULT_SORT_TYPE,
              pageable);
    }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_isViewable_NotActivated() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setViewable(true);
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(null,productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_NotViewable_isActivated() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(true);
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_isViewable_isActivated() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(true);
    productDetailResponse.setViewable(true);
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_isFalse() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(true);
    productDetailResponse.getProductAttributeResponses().get(0).getAttribute().setSkuValue(false);
    productDetailResponse.setViewable(true);
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_NotViewable_NotActivated() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(false);
    productDetailResponse.setViewable(false);
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_NotViewable_NotActivated_SINGLE_Responce() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(false);
    productDetailResponse.setViewable(false);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute =
        new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    for(ProductAttributeResponse productAttributeResponse :productDetailResponse.getProductAttributeResponses()){
      for(ProductAttributeValueResponse productAttributeValueResponse : productAttributeResponse.getProductAttributeValues()){
        productAttributeValueResponse.setDescriptiveAttributeValueType(DescriptiveAttributeValueType.SINGLE);
      }
    }
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNotNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_NotViewable_NotActivated_PREDEFINED_Responce() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(false);
    productDetailResponse.setViewable(false);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute =
        new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    for(ProductAttributeResponse productAttributeResponse :productDetailResponse.getProductAttributeResponses()){
      for(ProductAttributeValueResponse productAttributeValueResponse : productAttributeResponse.getProductAttributeValues()){
        productAttributeValueResponse.setDescriptiveAttributeValueType(DescriptiveAttributeValueType.PREDEFINED);
      }
    }
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getAllowedAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
  }

  @Test
  public void assignAttributeValueToSKuTrueAttributesTest_NotViewable_NotActivated_NONE_Responce() throws Exception{
    ProductDetailResponse productDetailResponse = getProductDetailResponse();
    productDetailResponse.setActivated(false);
    productDetailResponse.setViewable(false);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute =
        new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    for(ProductAttributeResponse productAttributeResponse :productDetailResponse.getProductAttributeResponses()){
      for(ProductAttributeValueResponse productAttributeValueResponse : productAttributeResponse.getProductAttributeValues()){
        productAttributeValueResponse.setDescriptiveAttributeValueType(DescriptiveAttributeValueType.NONE);
      }
    }
    BeanUtils.copyProperties(productDetailResponse, productDetailCompleteResponse);
    this.productController.assignAttributeValueToSKuTrueAttributes(productDetailCompleteResponse);
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getDescriptiveAttributeValue());
    assertNull(productDetailResponse.getProductAttributeResponses().get(0).getProductAttributeValues().get(0).getPredefinedAllowedAttributeValue());
  }

  @Test
  public void testFilterProductDetailByProductCode() throws Exception {
    ProductDetailResponse savedProduct = getProductDetailResponse();
    savedProduct.setPostLive(true);
    BeanUtils.copyProperties(savedProduct, productDetailCompleteResponse);
    GdnRestSingleResponse<ProductDetailResponse> response =
        new GdnRestSingleResponse<ProductDetailResponse>(null, null, true, productDetailCompleteResponse,
            this.requestId);
    when(getProductService()
        .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE))
        .thenReturn(productDetailCompleteResponse);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute =
        new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.DETAIL_FILTER_PRODUCT_CODE.replaceAll("\\{productCode\\}",
                    savedProduct.getProductCode()))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("businessPartnerCode", BUSINESS_PARTNER_CODE).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    assertTrue(response.getValue().isPostLive());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE);
  }

  @Test
  public void testProductBasicDetailByProductCode() throws Exception {
    ProductResponse savedProduct = getProductResponse();
    GdnRestSingleResponse<ProductResponse> response =
        new GdnRestSingleResponse<ProductResponse>(StringUtils.EMPTY, StringUtils.EMPTY, Boolean.TRUE, savedProduct,
            this.requestId);
    when(
        getProductService().findProductBasicDetailByProductCode(savedProduct.getProductCode()))
        .thenReturn(savedProduct);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.BASIC_DETAIL_PRODUCT_CODE.replaceAll("\\{productCode\\}",
                    savedProduct.getProductCode()))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findProductBasicDetailByProductCode(savedProduct.getProductCode());
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
  }


  private ProductDetailResponse getProductDetailResponse() {
    ProductDetailResponse savedProduct = new ProductDetailResponse(new ProductResponse());
    savedProduct.setProductCode("MTA-" + UUID.randomUUID().toString());
    savedProduct.setId(UUID.randomUUID().toString());
    savedProduct.setStoreId(ProductControllerTest.DEFAULT_STORE_ID);
    savedProduct.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    savedProduct.setCreatedDate(Calendar.getInstance().getTime());
    savedProduct.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    savedProduct.setUpdatedDate(Calendar.getInstance().getTime());
    savedProduct.setProductCategoryResponses(new ArrayList<ProductCategoryResponse>());
    savedProduct.getProductCategoryResponses()
        .add(
            new ProductCategoryResponse(new CategoryResponse(),
                ProductControllerTest.DEFAULT_STORE_ID));
    List<ProductAttributeResponse> productAttributeResponseList = new ArrayList<>();
    ProductAttributeResponse productAttributeResponse = new ProductAttributeResponse();
    AttributeResponse attributeResponse = new AttributeResponse();
    attributeResponse.setSkuValue(true);
    attributeResponse.setId("ID");
    productAttributeResponse.setAttribute(attributeResponse);
    List<ProductAttributeValueResponse> productAttributeValueResponseList = new ArrayList<>();
    productAttributeValueResponseList.add(new ProductAttributeValueResponse());
    productAttributeResponse.setProductAttributeValues(productAttributeValueResponseList);
    productAttributeResponseList.add(productAttributeResponse);
    savedProduct.setProductAttributeResponses(productAttributeResponseList);
    savedProduct.setBrand(BRAND);
    return savedProduct;
  }

  private ProductResponse getProductResponse() {
    ProductResponse savedProduct = new ProductResponse();
    savedProduct.setProductCode("MTA-" + UUID.randomUUID().toString());
    savedProduct.setId(UUID.randomUUID().toString());
    savedProduct.setStoreId(ProductControllerTest.DEFAULT_STORE_ID);
    savedProduct.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    savedProduct.setCreatedDate(Calendar.getInstance().getTime());
    savedProduct.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    savedProduct.setUpdatedDate(Calendar.getInstance().getTime());
    return savedProduct;
  }

  @Test
  public void testFilterProductItemSummaryByKeywordAndViewable() throws Exception {
    ProductItemResponse productItemResponse =
        new ProductItemResponse("Produk 1 Item 1", null, null, null, null, null, "0123456789012",
            UUID.randomUUID().toString(), true, false, null, new ArrayList<Image>());
    Image imageResponse = new Image();
    imageResponse.setMainImages(true);
    productItemResponse.setViewable(true);
    productItemResponse.getImages().add(imageResponse);
    List<ProductItemResponse> productItemResponses = new ArrayList<ProductItemResponse>();
    productItemResponses.add(productItemResponse);
    List<ProductItem> productItems = new ArrayList<ProductItem>();
    for (ProductItemResponse productItemResponse2 : productItemResponses) {
      ProductItem productItem = new ProductItem();
      ProductItemImage productItemImage = new ProductItemImage();
      BeanUtils.copyProperties(productItemResponse2, productItem);
      BeanUtils.copyProperties(productItemResponse2.getImages().get(0), productItemImage);
      productItem.setProductItemImages(new ArrayList<ProductItemImage>());
      productItem.getProductItemImages().add(productItemImage);
      productItems.add(productItem);
    }
    Page<ProductItem> page = new PageImpl<ProductItem>(productItems);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductItemResponse> response =
        new GdnRestListResponse<ProductItemResponse>(null, null, true, productItemResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByKeywordAndViewable(ProductControllerTest.DEFAULT_STORE_ID,
        		ProductControllerTest.DEFAULT_PRODUCT_NAME, true, true, pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.ITEM_FILTER_KEYWORD_VIEWABLE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
    		.addParameter("keyword", ProductControllerTest.DEFAULT_PRODUCT_NAME)
    		.addParameter("viewable", String.valueOf(true)).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByKeywordAndViewable(ProductControllerTest.DEFAULT_STORE_ID, ProductControllerTest.DEFAULT_PRODUCT_NAME, true,
            true, pageable);
  }

  @Test
  public void testFilterProductItemSummaryByUpcCode() throws Exception {
    List<ProductItemResponse> productItemResponses = new ArrayList<ProductItemResponse>();
    productItemResponses.add(new ProductItemResponse("Produk 1 Item 1", null, null, null, null,
        null, "0123456789012", UUID.randomUUID().toString(), true, false, null,
        new ArrayList<Image>()));
    List<ProductItem> productItems = new ArrayList<ProductItem>();
    for (ProductItemResponse productItemResponse : productItemResponses) {
      ProductItem productItem = new ProductItem();
      BeanUtils.copyProperties(productItemResponse, productItem);
      productItems.add(productItem);
    }
    Page<ProductItem> page = new PageImpl<ProductItem>(productItems);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductItemResponse> response =
        new GdnRestListResponse<ProductItemResponse>(null, null, true, productItemResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByUpcCode(ProductControllerTest.DEFAULT_STORE_ID,
            "0123456789012", pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.ITEM_FILTER_UPC_CODE.replaceAll("\\{upcCode\\}",
                        "0123456789012"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByUpcCode(
        ProductControllerTest.DEFAULT_STORE_ID, "0123456789012", pageable);
  }

  @Test
  public void testFilterProductSummaryByName() throws Exception {
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    productResponses.add(new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString()).name("Produk 1").length(1.0)
        .width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
        .description("Deskripsi 1".getBytes())
        .brand("Brand 1").activated(true).viewable(true).build());
    productResponses.add(new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString()).name("Produk 2").length(1.0)
        .width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
        .description("Deskripsi 2".getBytes())
        .brand("Brand 1").activated(true).viewable(true).build());
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByName(ProductControllerTest.DEFAULT_STORE_ID, "Produk",
            pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_NAME.replaceAll("\\{name\\}", "Produk"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByName(
        ProductControllerTest.DEFAULT_STORE_ID, "Produk", pageable);
  }

  @Test
  public void testFilterProductItemSummaryByNameAndUpcCode() throws Exception {
	this.attributeReqModelListRequest = new AttributeReqModelListRequest();
	AttributeReqModel attributeReqModel = new AttributeReqModel("Brand","123");
	this.attributeReqModelListRequest.add(attributeReqModel);
    List<ProductCodeResponse> productCodeResponses = new ArrayList<ProductCodeResponse>();
    productCodeResponses.add(new ProductCodeResponse(DEFAULT_PRODUCT_CODE, DEFAULT_PRODUCT_NAME));
    Page<ProductCodeResponse> page = new PageImpl<ProductCodeResponse>(productCodeResponses);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductCodeResponse> response =
        new GdnRestListResponse<ProductCodeResponse>(null, null, true, productCodeResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
            		page.getTotalElements()), getRequestId());
    when(
        getProductService().findByNameOrUpcCode(any(), any(), any(),
        		any(), Mockito.anyList(), any())).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.ITEM_FILTER_NAME_UPC_CODE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
            .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("productName", ProductControllerTest.DEFAULT_PRODUCT_NAME)
            .addParameter("upcCode", ProductControllerTest.DEFAULT_PRODUCT_UPC)
            .addParameter("finalCategoryId", ProductControllerTest.DEFAULT_PRODUCT_CATEGORY)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.attributeReqModelListRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByNameOrUpcCode(any(), any(), any(),
            any(), Mockito.anyList(), any());
  }

  @Test
  public void testFilterProductSummaryByNameAndViewableAndActivated() throws Exception {
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 1").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 2").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 2".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse : productResponses) {
      productResponse.setViewable(true);
      productResponse.setActivated(true);
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByNameAndViewableAndActivated(
            ProductControllerTest.DEFAULT_STORE_ID, "Produk", true, true, pageable)).thenReturn(
        page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_NAME_VIEWABLE_ACTIVATED
                        .replaceAll("\\{name\\}", "Produk").replaceAll("\\{viewable\\}", "true")
                        .replaceAll("\\{activated\\}", "true"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByNameAndViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID, "Produk", true,
            true, pageable);
  }

  @Test
  public void testFilterProductSummaryByProductCode() throws Exception {
    String productCode = "MTA-" + UUID.randomUUID().toString();
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 4").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 4".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByProductCode(ProductControllerTest.DEFAULT_STORE_ID,
            productCode, pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_PRODUCT_CODE.replaceAll("\\{productCode\\}",
                        productCode))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByProductCode(
        ProductControllerTest.DEFAULT_STORE_ID, productCode, pageable);
  }

  @Test
  public void testFilterProductSummaryByViewable() throws Exception {
    String productCode = "MTA-" + UUID.randomUUID().toString();
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    ProductResponse productResponse =
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 1").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build();
    productResponse.setViewable(true);
    productResponses.add(productResponse);
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse2 : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse2, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByViewable(ProductControllerTest.DEFAULT_STORE_ID, true,
            pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_VIEWABLE.replaceAll("\\{viewable\\}", "true"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByViewable(
        ProductControllerTest.DEFAULT_STORE_ID, true, pageable);
  }

  @Test
  public void testFilterProductSummaryByViewableAndActivated() throws Exception {
    String productCode = "MTA-" + UUID.randomUUID().toString();
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    ProductResponse productResponse =
        new ProductResponse.Builder().productCode(productCode).name("Produk 1").length(1.0)
            .width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build();
    productResponses.add(productResponse);
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse2 : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse2, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID,
            true, true, pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_VIEWABLE_ACTIVATED.replaceAll("\\{viewable\\}",
                        "true").replaceAll("\\{activated\\}", "true"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID, true, true, pageable);
  }

  @Test
  public void testFilterProductSummaryWithReviewStatusByName() throws Exception {
    List<ProductMtaResponse> productResponses = new ArrayList<ProductMtaResponse>();
    ProductMtaResponse dummyResponse = createDummyProductMtaResponse();
    productResponses.add(dummyResponse);
    List<Product> products = new ArrayList<Product>();
    for (ProductMtaResponse productResponse : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      when(
          getProductService().findProductWorkflows(product.getStoreId(), product.getId()))
          .thenReturn(new ArrayList<ProductWorkflow>());
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductMtaResponse> response =
        new GdnRestListResponse<ProductMtaResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByName(ProductControllerTest.DEFAULT_STORE_ID, "Produk",
            pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_NAME_WITH_REVIEW_STATUS.replaceAll("\\{name\\}",
                        "Produk"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByName(
        ProductControllerTest.DEFAULT_STORE_ID, "Produk", pageable);
    verify(getProductService()).findProductWorkflows(
        ProductControllerTest.DEFAULT_STORE_ID, ProductControllerTest.DEFAULT_PRODUCT_ID);
  }

  @Test
  public void testFilterProductSummaryWithReviewStatusByNameAndViewableAndActivated()
      throws Exception {
    List<ProductMtaResponse> productResponses = new ArrayList<ProductMtaResponse>();
    ProductMtaResponse dummyResponse = createDummyProductMtaResponse();
    productResponses.add(dummyResponse);
    List<Product> products = new ArrayList<Product>();
    for (ProductMtaResponse productResponse : productResponses) {
      productResponse.setViewable(true);
      productResponse.setActivated(true);
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      when(
          getProductService().findProductWorkflows(product.getStoreId(), product.getId()))
          .thenReturn(new ArrayList<ProductWorkflow>());
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductMtaResponse> response =
        new GdnRestListResponse<ProductMtaResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByNameAndViewableAndActivated(
            ProductControllerTest.DEFAULT_STORE_ID, "Produk", true, true, pageable)).thenReturn(
        page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_NAME_VIEWABLE_ACTIVATED_WITH_REVIEW_STATUS
                        .replaceAll("\\{name\\}", "Produk").replaceAll("\\{viewable\\}", "true")
                        .replaceAll("\\{activated\\}", "true"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByNameAndViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID, "Produk", true,
            true, pageable);
    verify(getProductService()).findProductWorkflows(
        ProductControllerTest.DEFAULT_STORE_ID, ProductControllerTest.DEFAULT_PRODUCT_ID);
  }

  @Test
  public void testFilterProductSummaryWithReviewStatusByViewableAndActivated() throws Exception {
    List<ProductMtaResponse> productResponses = new ArrayList<ProductMtaResponse>();
    ProductMtaResponse dummyResponse = createDummyProductMtaResponse();
    dummyResponse.setViewable(true);
    dummyResponse.setActivated(true);
    productResponses.add(dummyResponse);
    List<Product> products = new ArrayList<Product>();
    for (ProductMtaResponse productResponse : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      when(
          getProductService().findProductWorkflows(product.getStoreId(), product.getId()))
          .thenReturn(new ArrayList<ProductWorkflow>());
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductMtaResponse> response =
        new GdnRestListResponse<ProductMtaResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID,
            true, true, pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_VIEWABLE_ACTIVATED_WITH_REVIEW_STATUS.replaceAll(
                        "\\{viewable\\}", "true").replaceAll("\\{activated\\}", "true"))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findByViewableAndActivated(ProductControllerTest.DEFAULT_STORE_ID, true, true, pageable);
    verify(getProductService()).findProductWorkflows(
        ProductControllerTest.DEFAULT_STORE_ID, ProductControllerTest.DEFAULT_PRODUCT_ID);
  }

  @Test
  public void testGenerateBarcode() throws Exception {
    String barcode = BarcodeGenerator.generateUPCCode();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_BARCODE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    ObjectMapper mapper = new ObjectMapper();
    GdnRestSimpleResponse<String> resultObject =
        mapper.readValue(result.getResponse().getContentAsString(), GdnRestSimpleResponse.class);
    assertTrue(resultObject.isSuccess());
  }

  @Test
  public void testGenerateShippingWeight() throws Exception {

    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(new CatalogRequest("Catalog 1", null,
            GdnBaseLookup.MASTER_CATALOG, ProductControllerTest.DEFAULT_STORE_ID), null, null,
            null, 0, null, null, null, null, false, 0, false, false, false, false, null, null,
            ProductControllerTest.DEFAULT_STORE_ID), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      Catalog catalog = new Catalog();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      BeanUtils.copyProperties(productCategoryRequest.getCategory().getCatalog(), catalog);
      catalog.setCatalogType(CatalogType.valueOf(productCategoryRequest.getCategory().getCatalog()
          .getCatalogType()));
      category.setCatalog(catalog);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    GdnRestSimpleResponse<Double> response =
        new GdnRestSimpleResponse<Double>(null, null, true, getRequestId(), 1.0);
    when(getProductService().generateShippingWeight(product)).thenReturn(1.0);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .generateShippingWeight(product);
  }

  @Test
  public void testGenerateShippingWeightWithInvalidHeight() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().generateShippingWeight(product)).thenReturn(1.0);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .generateShippingWeight(product);
    }
  }

  @Test
  public void testGenerateShippingWeightWithNullLength() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    productRequest.setLength(null);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(ServletException.class, () -> {
      getMockMvc().perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    });
  }

  @Test
  public void testGenerateShippingWeightWithNullWidth() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    productRequest.setWidth(null);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(ServletException.class, () -> {
      getMockMvc().perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    });
  }

  @Test
  public void testGenerateShippingWeightWithNullHeight() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    productRequest.setHeight(null);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(ServletException.class, () -> {
      getMockMvc().perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    });
  }

  @Test
  public void testGenerateShippingWeightWithNullWeight() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    productRequest.setWeight(null);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(ServletException.class, () -> {
      getMockMvc().perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    });
  }

  @Test
  public void testGenerateShippingWeightWithInvalidLength() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().generateShippingWeight(product)).thenReturn(1.0);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .generateShippingWeight(product);
    }
  }

  @Test
  public void testGenerateShippingWeightWithInvalidWeight() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().generateShippingWeight(product)).thenReturn(1.0);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .generateShippingWeight(product);
    }
  }

  @Test
  public void testGenerateShippingWeightWithInvalidWidth() throws Exception {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().generateShippingWeight(product)).thenReturn(1.0);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_SHIPPING_WEIGHT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .generateShippingWeight(product);
    }
  }

  @Test
  public void testGetProduct() throws Exception {
    ProductResponse productResponse =
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 1").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes()).longDescription("Deskripsi 1".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build();
    ProductDetailResponse productDetailResponse = new ProductDetailResponse(productResponse);
    ProductAttributeResponse productAttributeResponse_ = new ProductAttributeResponse();
    productAttributeResponse_.setAttribute(new AttributeResponse(null, null,
        AttributeType.DESCRIPTIVE_ATTRIBUTE.toString(), false));
    productDetailResponse.setId("b7753666-ef7f-489d-97ae-f747252a6c5c");
    productDetailResponse.setProductItemResponses(new HashSet<ProductItemResponse>());
    productDetailResponse.setProductCategoryResponses(new ArrayList<ProductCategoryResponse>());
    productDetailResponse.setProductAttributeResponses(new ArrayList<ProductAttributeResponse>());
    productDetailResponse.getProductItemResponses().add(
        new ProductItemResponse("Produk 1 - Produk Item 1", null, null, null, null, null, UUID
            .randomUUID().toString(), null, true, false, null, null));
    productDetailResponse.getProductCategoryResponses()
        .add(
            new ProductCategoryResponse(new CategoryResponse(),
                ProductControllerTest.DEFAULT_STORE_ID));
    productDetailResponse.getProductAttributeResponses().add(productAttributeResponse_);
    GdnRestSingleResponse<ProductDetailResponse> response =
        new GdnRestSingleResponse<ProductDetailResponse>(null, null, true, productDetailResponse,
            getRequestId());
    when(getProductService().findDetailById(productDetailResponse.getId())).thenReturn(
        productDetailResponse);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.DETAIL.replaceAll("\\{id\\}",
                        productDetailResponse.getId()))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService()).findDetailById(productDetailResponse.getId());
  }

  @Test
  public void testGetProductHistorySummary() throws Exception {
    List<ProductHistoryResponse> productHistoryResponses =
        createDummyProductHistoryResponseList(ProductControllerTest.DEFAULT_PRODUCT_ID);
    List<ProductHistory> productHistories = new ArrayList<ProductHistory>();
    for (ProductHistoryResponse productHistoryResponse : productHistoryResponses) {
      ProductHistory productHistory = new ProductHistory();
      BeanUtils.copyProperties(productHistoryResponse, productHistory);
      productHistories.add(productHistory);
    }
    Page<ProductHistory> productHistoryPage = new PageImpl<ProductHistory>(productHistories);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductHistoryResponse> response =
        new GdnRestListResponse<ProductHistoryResponse>(null, null, true, productHistoryResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                productHistoryPage.getTotalElements()), getRequestId());
    when(
        getProductService().findProductHistoryByStoreIdAndProductId(
            ProductControllerTest.DEFAULT_STORE_ID, ProductControllerTest.DEFAULT_PRODUCT_ID,
            pageable)).thenReturn(productHistoryPage);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.HISTORY.replaceAll("\\{id\\}",
                        ProductControllerTest.DEFAULT_PRODUCT_ID) )
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findProductHistoryByStoreIdAndProductId(ProductControllerTest.DEFAULT_STORE_ID,
            ProductControllerTest.DEFAULT_PRODUCT_ID, pageable);
  }

  @Test
  public void testGetProductSummary() throws Exception {
    List<ProductResponse> productResponses = new ArrayList<ProductResponse>();
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 1").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 2").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 2".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 3").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 3".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    productResponses.add(
        new ProductResponse.Builder().productCode("MTA-" + UUID.randomUUID().toString())
            .name("Produk 4").length(1.0).width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 4".getBytes())
            .brand("Brand 1").activated(true).viewable(true).build());
    List<Product> products = new ArrayList<Product>();
    for (ProductResponse productResponse : productResponses) {
      Product product = new Product();
      BeanUtils.copyProperties(productResponse, product);
      products.add(product);
    }
    Page<Product> page = new PageImpl<Product>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<ProductResponse>(null, null, true, productResponses,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByStoreId(ProductControllerTest.DEFAULT_STORE_ID, pageable))
        .thenReturn(page);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.ROOT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findByStoreId(
        ProductControllerTest.DEFAULT_STORE_ID, pageable);
  }

  @Test
  public void submitHistoryTest() throws Exception {
    ProductHistoryRequest productHistoryRequest = new ProductHistoryRequest();
    productHistoryRequest.setStoreId(DEFAULT_STORE_ID);
    productHistoryRequest.setUpdatedBy(DEFAULT_USERNAME);
    productHistoryRequest.setUpdatedDate(new Date());
    productHistoryRequest.setProductCode(DEFAULT_PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.SUBMIT_HISTORY)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(productHistoryRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).saveProductHistory(eq(DEFAULT_PRODUCT_CODE),
        any(ProductHistory.class));
  }

  @Test
  public void testGetProductWithReviewStatus() throws Exception {
    ProductDetailMtaResponse productDetailResponse = createDummyProductDetailMtaResponse();
    productDetailResponse.setStoreId(ProductControllerTest.DEFAULT_STORE_ID);
    Product product = new Product();
    BeanUtils.copyProperties(productDetailResponse, product);
    for (ProductItemResponse productItemResponse : productDetailResponse.getProductItemResponses()) {
      ProductItem productItem = new ProductItem();
      BeanUtils.copyProperties(productItemResponse, productItem);
      product.getProductItems().add(productItem);
    }
    for (ProductAttributeResponse productAttributeResponse : productDetailResponse
        .getProductAttributeResponses()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeResponse, productAttribute);
      BeanUtils.copyProperties(productAttributeResponse.getAttribute(), attribute);
      attribute.setAttributeType(AttributeType.valueOf(productAttributeResponse.getAttribute()
          .getAttributeType()));
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    for (ProductCategoryResponse productCategoryResponse : productDetailResponse
        .getProductCategoryResponses()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryResponse, productCategory);
      BeanUtils.copyProperties(productCategoryResponse.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    GdnRestSingleResponse<ProductDetailMtaResponse> response =
        new GdnRestSingleResponse<ProductDetailMtaResponse>(null, null, true,
            productDetailResponse, getRequestId());
    when(getProductService().findById(productDetailResponse.getId())).thenReturn(
        product);
    when(getProductService().checkProductWorkflowsAlreadyExist(product)).thenReturn(
        new ArrayList<ProductWorkflow>());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.DETAIL_WITH_REVIEW_STATUS.replaceAll("\\{id\\}",
                        productDetailResponse.getId()))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        productDetailResponse.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .checkProductWorkflowsAlreadyExist(product);
  }

  @Test
  public void testSaveProduct() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnRestSimpleResponse<String> response =
        new GdnRestSimpleResponse<String>(null, null, true, getRequestId(),
            product.getProductCode());
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).save(product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testSaveProductCollection() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    GdnRestSimpleResponse<String> response =
        new GdnRestSimpleResponse<String>(null, null, true, this.requestId,
            product.getProductCode());
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(request)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .saveProductCollection(null, null, product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testSaveProductCollectionWithInvalidCreatedBy() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setCreatedBy(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidCreatedDate() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setCreatedDate(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidDescription() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setDescription(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidHeight() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setHeight(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidLength() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setLength(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidLongDescription() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setLongDescription(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LONG_DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidName() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setName(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.NAME_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidProductAttributes() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.getProductAttributes().clear();
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidProductCategories() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.getProductCategories().clear();
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidSpecificationDetail() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setSpecificationDetail(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithNullUniqueSellingPoint() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setUniqueSellingPoint(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidWeight() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setWeight(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductCollectionWithInvalidWidth() throws Exception {
    ProductCollectionRequest request = generateProductCollectionRequest();
    request.setWidth(null);
    Product product = new Product();
    convertProductCollectionRequestToProduct(request, product);
    when(getProductService().saveProductCollection(null, null, product)).thenReturn(
        product.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT_COLLECTION)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE)
          .saveProductCollection(null, null, product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalse() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnRestSimpleResponse<String> response =
        new GdnRestSimpleResponse<String>(null, null, true, getRequestId(),
            product.getProductCode());
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).save(product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidCreatedBy() throws Exception {
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidCreatedDate() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidDescription() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidHeight() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidLength() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidLongDescription() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LONG_DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidName() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.NAME_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidProductAttributes() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidProductCategories() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidShippingWeight() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage()
          .contains(ProductControllerErrorMessage.SHIPPING_WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidSpecificationDetail() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndNullUniqueSellingPoint() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUniqueSellingPoint(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnRestSimpleResponse<String> response =
        new GdnRestSimpleResponse<String>(null, null, true, getRequestId(),
             product.getProductCode());
    when(getProductService().save(product)).thenReturn("");
    URI uri =
         new URIBuilder()
              .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
              .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
              .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
              .addParameter("requestId", getRequestId())
              .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
              .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
         getMockMvc()
               .perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
               .contentType(MediaType.APPLICATION_JSON)
               .content(getObjectMapper().writeValueAsString(this.productRequest)))
               .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
         .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).save(product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidWeight() throws Exception {
    this.productRequest.setCreatedBy(DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithActivatedFalseAndInvalidWidth() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_ACTIVATED_FALSE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidCreatedBy() throws Exception {
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithInvalidCreatedDate() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_SAVE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithInvalidDescription() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidHeight() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidLength() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidLongDescription() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LONG_DESCRIPTION_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
    finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidName() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.NAME_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidProductAttributes() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithInvalidProductCategories() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithInvalidShippingWeight() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage()
          .contains(ProductControllerErrorMessage.SHIPPING_WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }

  }

  @Test
  public void testSaveProductWithInvalidSpecificationDetail() throws Exception {
    this.productRequest.setCreatedBy(DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    }
  }

  @Test
  public void testSaveProductWithNullUniqueSellingPoint() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUniqueSellingPoint(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnRestSimpleResponse<String> response =
        new GdnRestSimpleResponse<String>(null, null, true, getRequestId(),
             product.getProductCode());
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
             .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
             .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
             .addParameter("requestId", getRequestId())
             .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
             .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
             .perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
             .contentType(MediaType.APPLICATION_JSON)
             .content(getObjectMapper().writeValueAsString(this.productRequest)))
             .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
            .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).save(product);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testSaveProductWithInvalidWeight() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSaveProductWithInvalidWidth() throws Exception {
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().save(product)).thenReturn("");
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).save(product);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testSubmitProduct() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .submit(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.SUBMIT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).submit(
        ProductControllerTest.DEFAULT_STORE_ID, product);
  }

  @Test
  public void testSubmitProductWithInvalidUpdatedBy() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .submit(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.SUBMIT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).submit(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testSubmitProductWithInvalidUpdatedDate() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product);
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService())
        .submit(ProductControllerTest.DEFAULT_STORE_ID, product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.SUBMIT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).submit(
          ProductControllerTest.DEFAULT_STORE_ID, product);
    }
  }

  @Test
  public void testUpdateProduct() throws Exception {
    ReflectionTestUtils.setField(productController, "youtubeRegex",
        "(?<=watch\\?v=|/videos/|embed\\/|youtu"
            + ".be\\/|\\/v\\/|\\/e\\/|watch\\?v%3D|watch\\?feature=player_embedded&v=|%2Fvideos%2F"
            + "|embed%\u200C\u200B2F|youtu.be%2F|%2Fv%2F|shorts\\/)[^#\\&\\?\\n]*");
    ProductItemRequest productItemRequest = new ProductItemRequest();
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    AttributeRequest attributeRequest = new AttributeRequest();

    attributeRequest.setName(DEFAULT_PRODUCT_NAME);
    attributeRequest.setVariantCreatingUI(Boolean.TRUE);
    attributeRequest.setScreeningMandatory(Boolean.TRUE);
    attributeRequest.setAttributeCode(DEFAULT_BP_CODE);
    List<Image> images = new ArrayList<>();
    images.add(new Image());
    productItemRequest.setImages(images);
    productItemAttributeValueRequest.setValue("Default");
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequestList = new ArrayList<>();
    productItemAttributeValueRequestList.add(productItemAttributeValueRequest);

    productItemRequest.setProductItemAttributeValues(productItemAttributeValueRequestList);
    productItemRequest.setDangerousGoodsLevel(0);
    productItemRequest.setActivated(true);
    productItemRequest.setViewable(true);
    List<ProductItemRequest> productItemRequestList = new ArrayList<>();
    productItemRequestList.add(productItemRequest);

    this.productRequest.setProductItems(productItemRequestList);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setDescription(StringUtils.EMPTY.getBytes());
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setNotes(NOTES);
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.setUrl(YOUTUBE_URL);
    //setProductItemRequest(productRequest);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes", "productItems");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(this.productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    productRequest.setProductCode(PRODUCT_CODE);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(this.productServiceWrapper, ProductControllerTest.AT_LEAST_ONE)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithException() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setNotes(NOTES);
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doThrow(RuntimeException.class).when(this.productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    verify(this.productServiceWrapper, ProductControllerTest.AT_LEAST_ONE)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithInvalidUrl() throws Exception {
    productSystemParameter.setValue("true");
    Mockito.when(productSystemParameterService
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(productSystemParameter);
    ProductRequest productRequest = getProductRequest();
    Product product = getProduct(productRequest);
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Exception exception = null;
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc().perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
      });
    } finally {
      Mockito.verify(productSystemParameterService).findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void testUpdateProductAndPublishProductToPDT() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_PRODUCT_TO_PDT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    Mockito.verify(getProductService()).publishToPDTByProductCode(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE);
  }

  @Test
  public void testUpdateProductAndPublishToPDT() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setNotes(NOTES);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_AND_PUBLISH_TO_PDT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON)
                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
        this.productRequest.getId());
    Mockito.verify(this.productWorkflowService)
        .updateAndPublish(any(Product.class), eq(NOTES), eq(BRAND_CODE), eq(BRAND_APPROVAL_STATUS));
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductAndPublishToPDTWithInvalidUrl() throws Exception {
    productSystemParameter.setValue("true");
    Mockito.when(productSystemParameterService
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(productSystemParameter);
    ProductRequest productRequest = getProductRequest();
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, DEFAULT_CLIENT_ID);
    Product product = getProduct(productRequest);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_AND_PUBLISH_TO_PDT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    GdnBaseRestResponse response =
        new GdnBaseRestResponse(ErrorCategory.VALIDATION.getMessage() + ErrorMessages.INVALID_URL,
            ErrorCategory.VALIDATION.getCode(), false, requestId);
    MvcResult result = getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductAndPublishToPDTWithInvalidUrlApplicationRuntimeExceptionTest() throws Exception {
    productSystemParameter.setValue("true");
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(DEFAULT_STORE_ID,
        Constants.YOUTUBE_URL_VALIDATION_SWITCH)).thenThrow(new NullPointerException());
    ProductRequest productRequest = getProductRequest();
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, DEFAULT_CLIENT_ID);
    Product product = getProduct(productRequest);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_AND_PUBLISH_TO_PDT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    GdnBaseRestResponse response =
        new GdnBaseRestResponse(new NullPointerException().getMessage(), ErrorCategory.UNSPECIFIED.getCode(), false,
            requestId);
    MvcResult result = getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithDGLevel() throws Exception {
    ProductItemRequest productItemRequest = new ProductItemRequest();
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    AttributeRequest attributeRequest = new AttributeRequest();

    attributeRequest.setName(DEFAULT_PRODUCT_NAME);
    attributeRequest.setVariantCreatingUI(Boolean.TRUE);
    attributeRequest.setScreeningMandatory(Boolean.TRUE);
    attributeRequest.setAttributeCode(DEFAULT_BP_CODE);

    productItemAttributeValueRequest.setValue("Default");
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequestList = new ArrayList<>();
    productItemAttributeValueRequestList.add(productItemAttributeValueRequest);

    Image image = new Image();
    image.setActive(true);
    image.setMainImages(true);
    image.setMarkForDelete(false);
    image.setStoreId(DEFAULT_STORE_ID);

    productItemRequest.setProductItemAttributeValues(productItemAttributeValueRequestList);
    productItemRequest.setDangerousGoodsLevel(1);
    productItemRequest.setActivated(true);
    productItemRequest.setViewable(true);
    productItemRequest.setImages(Arrays.asList(image));
    List<ProductItemRequest> productItemRequestList = new ArrayList<>();
    productItemRequestList.add(productItemRequest);

    this.productRequest.setProductItems(productItemRequestList);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setNotes(NOTES);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.setPostLive(true);
    this.productRequest.setReviewPending(true);
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes", "productItems");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(this.productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(this.productRequest.getId());
    verify(this.productServiceWrapper, ProductControllerTest.AT_LEAST_ONE)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, true, null, BRAND_APPROVAL_STATUS, false);
    assertEquals(true, product.getProductItems().get(0).isInternalUpdate());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithInvalidDGLevel() throws Exception {
    ProductItemRequest productItemRequest = new ProductItemRequest();
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    AttributeRequest attributeRequest = new AttributeRequest();

    attributeRequest.setName(DEFAULT_PRODUCT_NAME);
    attributeRequest.setVariantCreatingUI(Boolean.TRUE);
    attributeRequest.setScreeningMandatory(Boolean.TRUE);
    attributeRequest.setAttributeCode(DEFAULT_BP_CODE);

    productItemAttributeValueRequest.setValue("Default");
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequestList = new ArrayList<>();
    productItemAttributeValueRequestList.add(productItemAttributeValueRequest);

    Image image = new Image();
    image.setActive(true);
    image.setMainImages(true);
    image.setMarkForDelete(false);
    image.setStoreId(DEFAULT_STORE_ID);

    productItemRequest.setProductItemAttributeValues(productItemAttributeValueRequestList);
    productItemRequest.setDangerousGoodsLevel(3);
    productItemRequest.setActivated(true);
    productItemRequest.setViewable(true);
    productItemRequest.setImages(Arrays.asList(image));
    List<ProductItemRequest> productItemRequestList = new ArrayList<>();
    productItemRequestList.add(productItemRequest);

    this.productRequest.setProductItems(productItemRequestList);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setNotes(NOTES);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.setPostLive(true);
    this.productRequest.setReviewPending(true);
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes", "productItems");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    List<String> alpha = Arrays.asList(result.getResponse().getContentAsString().split(","));
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(this.productRequest.getId());
    assertEquals(false, product.getProductItems().get(0).isInternalUpdate());
    assertTrue(result.getResponse().getContentAsString().contains(INVALID_DG_LEVEL_ERROR));
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithNullDGLevel() throws Exception {
    ProductItemRequest productItemRequest = new ProductItemRequest();
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    AttributeRequest attributeRequest = new AttributeRequest();

    attributeRequest.setName(DEFAULT_PRODUCT_NAME);
    attributeRequest.setVariantCreatingUI(Boolean.TRUE);
    attributeRequest.setScreeningMandatory(Boolean.TRUE);
    attributeRequest.setAttributeCode(DEFAULT_BP_CODE);

    productItemAttributeValueRequest.setValue("Default");
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequestList = new ArrayList<>();
    productItemAttributeValueRequestList.add(productItemAttributeValueRequest);

    Image image = new Image();
    image.setActive(true);
    image.setMainImages(true);
    image.setMarkForDelete(false);
    image.setStoreId(DEFAULT_STORE_ID);

    productItemRequest.setProductItemAttributeValues(productItemAttributeValueRequestList);
    productItemRequest.setDangerousGoodsLevel(null);
    productItemRequest.setActivated(true);
    productItemRequest.setViewable(true);
    productItemRequest.setImages(Arrays.asList(image));
    List<ProductItemRequest> productItemRequestList = new ArrayList<>();
    productItemRequestList.add(productItemRequest);

    this.productRequest.setProductItems(productItemRequestList);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setNotes(NOTES);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.setPostLive(true);
    this.productRequest.setReviewPending(true);
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes", "productItems");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    ProductItem productItem = new ProductItem();
    productItem.setDangerousGoodsLevel(0);
    productItem.setViewable(true);
    productItem.setActivated(true);
    productItem.setInternalUpdate(false);
    product.setProductItems(new ArrayList(Arrays.asList(productItem)));
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(this.productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(this.productRequest.getId());
    verify(this.productServiceWrapper, ProductControllerTest.AT_LEAST_ONE)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, true, null, BRAND_APPROVAL_STATUS, false);
    assertEquals(false, product.getProductItems().get(0).isInternalUpdate());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testUpdateProductWithInvalidDescription() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setDescription(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(getProductService()).update(product, NOTES, BRAND_CODE, BRAND_APPROVAL_STATUS);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidHeight() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setHeight(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidLength() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setProductCode(PRODUCT_CODE);
    this.productRequest.setLength(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(this.productRequest.getId());
  }

  @Test
  public void testUpdateProductWithInvalidLongDescription() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(DEFAULT_USERNAME);
    this.productRequest.setLongDescription(null);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidName() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setName(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidProductAttributes() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(productServiceWrapper, AT_LEAST_NONE)
          .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS,
            false);
    }
  }

  @Test
  public void testUpdateProductWithInvalidProductCategories() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(productServiceWrapper, AT_LEAST_NONE)
          .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS,
            false);
    }
  }

  @Test
  public void testUpdateProductWithInvalidShippingWeight() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setShippingWeight(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidSpecificationDetail() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(productServiceWrapper).update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY,
        BRAND_APPROVAL_STATUS, false);
    }
  }

  @Test
  public void testUpdateProductWithInvalidUpdatedBy() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ServletException e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.ENTITY_REQUIRED_VALIDATION_FOR_UPDATE_MESSAGE));
      verify(getProductService(), ProductControllerTest.AT_LEAST_NONE).findById(
          this.productRequest.getId());
      verify(productServiceWrapper, AT_LEAST_NONE)
          .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS,
            false);
    }
  }

  @Test
  public void testUpdateProductWithInvalidUpdatedDate() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUpdatedDate(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest))).andExpect(MockMvcResultMatchers
        .status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidWeight() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setWeight(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidWeightExceptionTest() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setWeight(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithInvalidWidth() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setWidth(null);
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
        .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS, false);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)
                  .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
  }

  @Test
  public void testUpdateProductWithUniqueSellingPointAsNull() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setUniqueSellingPoint(null);
    this.productRequest.setNotes(NOTES);
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.setProductCode(PRODUCT_CODE);
    this.productRequest.getProductCategories().add(
            new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
            new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
                    ProductControllerTest.DEFAULT_STORE_ID));
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    when(getProductService().findById(this.productRequest.getId())).thenReturn(product);
    Mockito.doNothing().when(productServiceWrapper)
            .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, StringUtils.EMPTY, BRAND_APPROVAL_STATUS,
              false);
    URI uri =
            new URIBuilder()
                    .setPath(
                            ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE)
                    .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
                    .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
                    .addParameter("requestId", getRequestId())
                    .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
                    .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
            getMockMvc()
                    .perform(
                            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                                    .contentType(MediaType.APPLICATION_JSON)
                                    .content(getObjectMapper().writeValueAsString(this.productRequest)))
                    .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
            .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).findById(
            this.productRequest.getId());
    verify(this.productServiceWrapper, ProductControllerTest.AT_LEAST_ONE)
            .update(DEFAULT_STORE_ID, product, NOTES, false, BRAND_CODE, false, null, BRAND_APPROVAL_STATUS, false);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void testValidateBarcode() throws Exception {
    String barcode = UUID.randomUUID().toString();
    GdnRestSimpleResponse<Boolean> response =
        new GdnRestSimpleResponse<Boolean>(null, null, true, getRequestId(), true);
    when(
        getProductService().validateBarcode(ProductControllerTest.DEFAULT_STORE_ID, barcode))
        .thenReturn(true);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.VALIDATE_BARCODE.replaceAll("\\{barcode\\}", barcode))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE).validateBarcode(
        ProductControllerTest.DEFAULT_STORE_ID, barcode);
  }

  @Test
  public void mergeProduct_productNotFound_returnWithFailureStatus() throws Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockDuplicateProduct.setBrand("duplicate1");
    mockDuplicateProduct.setId("duplicate1");
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertFalse(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(getProductService(), times(2)).findById(any());
  }

  @Test
  public void mergeProduct_skuValueTrueAttribute_DontValidateWhileMerging() throws Exception {
    Product mockMasterProduct = getMockProduct(true);
    Product mockDuplicateProduct = getMockProduct(true);
    mockMasterProduct.setId("id1");
    mockMasterProduct.setId("id2");
    mockDuplicateProduct.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue("something else");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    doNothing().when(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
  }

  @Test
  public void mergeProduct_ForceUpdateAttribute_DontValidateWhileMerging_success() throws Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockMasterProduct.setId("id1");
    mockMasterProduct.setId("id2");
    mockDuplicateProduct.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue("something else");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId())
            .addParameter("forceMerge",String.valueOf(true)).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
  }

  @Test
  public void mergeProduct_productsFound_mergeValid_returnWithSuccessStatus() throws Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockDuplicateProduct.setBrand("duplicate1");
    mockDuplicateProduct.setId("duplicate1");
    mockDuplicateProduct.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue("duplicate one");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(getProductService(), times(2)).findById(any());
    verify(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
  }

  @Test
  public void mergeProduct_productsFound_No_diff_variants_NoUpdateMasterData_returnSuccess()
      throws Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockDuplicateProduct.setId("duplicate1");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(getProductService(), times(2)).findById(any());
    verify(getProductService(), times(2)).findProductItemByProductId(any());
    verify(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
  }

  @Test
  public void mergeProduct_productsFound_No_diff_variants_NoUpdateMasterData_diff_predefined_returnFail()
      throws Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockDuplicateProduct.setId("duplicate1");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    List<ProductItemResponse> masterItems = new ArrayList<>();
    List<ProductItemResponse> duplicateItems = new ArrayList<>();
    ProductItemAttributeValueResponse valueResponse = new ProductItemAttributeValueResponse(new AttributeResponse
        ("attributeName", "code", "type", false), "value");
    ProductItemResponse itemResponse = new ProductItemResponse();
    itemResponse.setProductItemAttributeValueResponses(Arrays.asList(valueResponse));
    duplicateItems.add(itemResponse);
    when(getProductService().findProductItemByProductId(mockMasterProduct.getId())).thenReturn(masterItems);
    when(getProductService().findProductItemByProductId(mockDuplicateProduct.getId())).thenReturn(duplicateItems);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertFalse(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(getProductService(), times(2)).findById(any());
    verify(getProductService(), times(2)).findProductItemByProductId(any());
  }

  @Test
  public void mergeProduct_productsFound_diffVariants_UpdateMasterData_returnSuccess() throws
      Exception {
    Product mockMasterProduct = getMockProduct(false);
    Product mockDuplicateProduct = getMockProduct(false);
    mockDuplicateProduct.setId("duplicate1");
    addNewVariant(mockDuplicateProduct);
    addNewVariant(mockMasterProduct);
    mockDuplicateProduct.getProductAttributes().get(1).getProductAttributeValues().get(0)
        .getAllowedAttributeValue().setValue("duplicate");
    when(getProductService().findById(mockMasterProduct.getId())).thenReturn
        (mockMasterProduct);
    when(getProductService().findById(mockDuplicateProduct.getId())).thenReturn
        (mockDuplicateProduct);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MERGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("masterProductId", mockMasterProduct.getId())
            .addParameter("duplicateProductId", mockDuplicateProduct.getId()).build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    GdnBaseRestResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnBaseRestResponse.class);
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getRequestId(), getRequestId());
    verify(getProductService(), times(2)).findById(mockMasterProduct.getId());
    verify(getProductService()).findById(mockDuplicateProduct.getId());
    verify(getProductService(), times(2)).findProductItemByProductId(any());
    verify(getProductService()).update(any(Product.class), anyBoolean(), eq(null), any(), any());
    verify(getProductService()).updateForMerge(any(Product.class));
    verify(this.productServiceWrapper).delete(DEFAULT_STORE_ID, mockDuplicateProduct.getId(), mockDuplicateProduct.getProductCode());
  }


  @Test
  public void testFilterProductSummaryByProductCodeExactMatch() throws Exception {
    String productCode = "MTA-" + UUID.randomUUID().toString();
    List<ProductResponse> productResponseList = new ArrayList<>();
    productResponseList.add(
        new ProductResponse.Builder().productCode(productCode).name("Produk 1").length(1.0)
            .width(1.0).weight(1.0).height(1.0).shippingWeight(1.0)
            .description("Deskripsi 1".getBytes())
            .brand("Brand 1").uniqueSellingPoint(null).uom(null).activated(false).viewable(true)
            .productStory(null).productType(null).url(null).images(null).specificationDetail(null)
            .build());
    List<Product> products = new ArrayList<>();
    Product product = new Product();
    BeanUtils.copyProperties(productResponseList.get(0), product);
    products.add(product);
    Page<Product> page = new PageImpl<>(products);
    Pageable pageable =
        PageRequest.of(ProductControllerTest.DEFAULT_PAGE,
            ProductControllerTest.DEFAULT_SIZE);
    GdnRestListResponse<ProductResponse> response =
        new GdnRestListResponse<>(null, null, true, productResponseList,
            new PageMetaData(pageable.getPageSize(), pageable.getPageNumber(),
                page.getTotalElements()), getRequestId());
    when(
        getProductService().findByProductCodeExactMatch(ProductControllerTest.DEFAULT_STORE_ID,
            productCode, pageable)).thenReturn(page);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.FILTER_PRODUCT_CODE_EXACT.replaceAll(
                        "\\{productCode\\}", productCode))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result =
        getMockMvc().perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse()
        .getContentAsString());
    verify(getProductService()).findByProductCodeExactMatch(
        ProductControllerTest.DEFAULT_STORE_ID, productCode, pageable);
  }

  private void addNewVariant(Product mockDuplicateProduct) {
    Attribute attribute = new Attribute();
    attribute.setAttributeType(AttributeType.DEFINING_ATTRIBUTE);
    attribute.setId("attr2");
    ProductAttributeValue productAttributeValue = new ProductAttributeValue();
    AllowedAttributeValue allowedAttributeValue = new AllowedAttributeValue();
    allowedAttributeValue.setValue("test12");
    productAttributeValue.setAllowedAttributeValue(allowedAttributeValue);
    ProductAttribute attribute1 = new ProductAttribute();
    attribute1.setAttribute(attribute);
    attribute1.setProductAttributeValues(new ArrayList<ProductAttributeValue>());
    attribute1.getProductAttributeValues().add(productAttributeValue);
    mockDuplicateProduct.getProductAttributes().add(attribute1);
  }

  private Product getMockProduct(boolean skuValue) {
    Product product = new Product();
    product.setBrand("test-brand");
    product.setId("123");
    product.setProductAttributes(new ArrayList<ProductAttribute>());
    Attribute attribute = new Attribute();
    attribute.setName("test");
    attribute.setAttributeType(AttributeType.DESCRIPTIVE_ATTRIBUTE);
    attribute.setSkuValue(skuValue);
    ProductAttributeValue value = new ProductAttributeValue();
    value.setDescriptiveAttributeValueType(com.gdn.x.productcategorybase
        .DescriptiveAttributeValueType.SINGLE);
    value.setDescriptiveAttributeValue("test");
    ProductAttribute productAttribute = new ProductAttribute();
    productAttribute.setAttribute(attribute);
    productAttribute.setProductAttributeValues(new ArrayList<ProductAttributeValue>());
    productAttribute.getProductAttributeValues().add(value);
    product.getProductAttributes().add(productAttribute);
    value.setProductAttribute(productAttribute);
    return product;
  }

  @Test
  public void processImageTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PROCESS_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService).processImage(any());
  }

  @Test
  public void processImageWithInvalidProductCodeTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PROCESS_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED).processImage(
          any());
    }
  }

  @Test
  public void rejectProcessImageTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.REJECT_PROCESS_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService).rejectImage(any());
  }

  @Test
  public void rejectProcessImageWithInvalidProductCodeTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.REJECT_PROCESS_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED).rejectImage(
          any());
    }
  }

  @Test
  public void approveImageTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService).approveImage(any());
  }

  @Test
  public void approveImageWithInvalidProductCodeTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED).approveImage(
          any());
    }
  }

  @Test
  public void updateProductImageNameTest() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, DEFAULT_HASH_CODE, DEFAULT_FILENAME);
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_NAME)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.when(
        getProductService().updateProductImageName(any(ActivateImageRequest.class)))
        .thenReturn(response);
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(getProductService())
        .updateProductImageName(any(ActivateImageRequest.class));
  }

  @Test
  public void activateAndUpdateImageNameTest() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, DEFAULT_HASH_CODE, DEFAULT_FILENAME);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_TO_ACTIVE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doNothing().when(
        getProductService()).activateAndUpdateImageName(any(ActivateImageRequest.class));
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(getProductService())
        .activateAndUpdateImageName(any(ActivateImageRequest.class));
  }

  @Test
  public void updateProductImageNameTestWithEmptyProductCode() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(null, DEFAULT_HASH_CODE, DEFAULT_FILENAME);
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_NAME)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.when(
        getProductService().updateProductImageName(any(ActivateImageRequest.class)))
        .thenReturn(response);
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED)
          .updateProductImageName(any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void activateAndUpdateImageNameTestWithEmptyProductCode() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(null, DEFAULT_HASH_CODE, DEFAULT_FILENAME);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_TO_ACTIVE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doNothing().when(
        getProductService()).activateAndUpdateImageName(any(ActivateImageRequest.class));
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED).activateAndUpdateImageName(
          any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void updateProductImageNameTestWithEmptyHashCode() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, null, DEFAULT_FILENAME);
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_NAME)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.when(
        getProductService().updateProductImageName(any(ActivateImageRequest.class)))
        .thenReturn(response);
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.HASH_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED)
          .updateProductImageName(any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void activateAndUpdateImageNameTestWithEmptyHashCode() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, null, DEFAULT_FILENAME);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_TO_ACTIVE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doNothing().when(
        getProductService()).activateAndUpdateImageName(any(ActivateImageRequest.class));
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.HASH_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED).activateAndUpdateImageName(
          any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void updateProductImageNameTestWithEmptyFilename() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, DEFAULT_HASH_CODE, null);
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_NAME)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.when(
        getProductService().updateProductImageName(any(ActivateImageRequest.class)))
        .thenReturn(response);
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.FILENAME_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED)
          .updateProductImageName(any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void activateAndUpdateImageNameTestWithEmptyFilename() throws Exception {
    ActivateImageRequest request =
        new ActivateImageRequest(DEFAULT_PRODUCT_CODE, DEFAULT_HASH_CODE, null);
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE_TO_ACTIVE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doNothing().when(
        getProductService()).activateAndUpdateImageName(any(ActivateImageRequest.class));
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.FILENAME_MUST_NOT_BE_BLANK));
      Mockito.verify(getProductService(), NEVER_CALLED).activateAndUpdateImageName(
          any(ActivateImageRequest.class));
      throw e;
    }
  }

  @Test
  public void approveQCTest() throws Exception {
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_QC)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService).approveQC(any());
  }

  @Test
  public void isProductImagesActivatedTest() throws Exception {
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    Mockito.when(this.productService.isProductImagesActivated(DEFAULT_PRODUCT_CODE)).thenReturn(response);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.IS_PRODUCT_IMAGES_ACTIVATED)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).isProductImagesActivated(any());
  }

  @Test
  public void isProductImagesActivatedTestWithoutProductCode() throws Exception {
    ActivateImageResponse response =
        new ActivateImageResponse(DEFAULT_PRODUCT_CODE, true, new ArrayList<String>());
    Mockito.when(this.productService.isProductImagesActivated(DEFAULT_PRODUCT_CODE)).thenReturn(response);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.IS_PRODUCT_IMAGES_ACTIVATED)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      Assertions.assertThrows(Exception.class, () -> {
        getMockMvc()
            .perform(
                MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                    .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
      });
    } catch (Exception e) {
      Mockito.verify(this.productService,Mockito.times(0)).isProductImagesActivated(any());
      throw e;
    }
  }

  @Test
  public void getProductCountsByViewableTest() throws Exception {
    Mockito.when(this.productService.getProductCountByViewable(DEFAULT_STORE_ID, true)).thenReturn(1);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + "/count/viewable/true")
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).getProductCountByViewable(DEFAULT_STORE_ID, true);
  }

  @Test
  public void approveQCWithProductCodeExceptionTest() throws Exception {
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_QC)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON)).andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED).approveQC(
          any());
    }
  }

  @Test
  public void approveContentTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService).approveContent(any());
  }

  @Test
  public void approveContentWithInvalidProductCodeTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED).approveContent(
          any());
    }
  }

  @Test
  public void createTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            any(ProductRequest.class));
    Mockito.verify(this.productWorkflowService).createDirect(any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createTestWithCategoryValidation() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    Mockito.doNothing().when(this.productService).validateCategory(any(), any(),
        any(), any());
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("validateCategory", "true")
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            any(ProductRequest.class));
    Mockito.verify(this.productWorkflowService).createDirect(any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createWithInvalidProductNameTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setName(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.NAME_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithTooLongProductNameTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setName(RandomStringUtils.random(151));
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.NAME_LENGTH_MUST_NOT_EXCEED_MAX_ALLOWED));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidDescriptionTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setDescription(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidLongDescriptionTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setLongDescription(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LONG_DESCRIPTION_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidSpecificationDetailTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setSpecificationDetail(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidLengthTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setLength(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.LENGTH_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidWidthTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setWidth(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.WIDTH_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidHeightTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setHeight(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.HEIGHT_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidWeightTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setWeight(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.WEIGHT_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidShippingWeightTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setShippingWeight(null);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.SHIPPING_WEIGHT_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidProductCategoriesTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.getProductCategories().clear();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CATEGORIES_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidProductAttributesTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.getProductAttributes().clear();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.PRODUCT_ATTRIBUTES_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
    }
  }

  @Test
  public void createWithInvalidUrlTest() throws Exception {
    productSystemParameter.setValue("true");
    Mockito.when(productSystemParameterService
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(productSystemParameter);
    CreateProductRequest request = generateCreateProductRequest();
    request.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    request.setBusinessPartnerName(BUSINESS_PARTNER_NAME);
    request.setUrl(YOUTUBE_INVALID_URL);
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, BULK_CLIENT_ID);
    productRequest.setUrl(YOUTUBE_INVALID_URL);
    Mockito.when(this.productWorkflowService.create(BUSINESS_PARTNER_CODE, BUSINESS_PARTNER_NAME, ProductCreationType.UNIFIED_BULK_UPLOAD, productRequest))
        .thenReturn(PRODUCT_CODE);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(eq(BUSINESS_PARTNER_CODE), eq(BUSINESS_PARTNER_NAME), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            productRequestArgumentCaptor.capture());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    assertEquals(StringUtils.EMPTY, productRequestArgumentCaptor.getValue().getUrl());
  }

  @Test
  public void createWithInvalidUrlTestWhenSwitchIsOff() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    request.setBusinessPartnerName(BUSINESS_PARTNER_NAME);
    request.setUrl(YOUTUBE_INVALID_URL);
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, BULK_CLIENT_ID);
    productRequest.setUrl(YOUTUBE_INVALID_URL);
    Mockito.when(this.productWorkflowService
        .create(BUSINESS_PARTNER_CODE, BUSINESS_PARTNER_NAME, ProductCreationType.UNIFIED_BULK_UPLOAD, productRequest))
        .thenReturn(PRODUCT_CODE);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(eq(BUSINESS_PARTNER_CODE), eq(BUSINESS_PARTNER_NAME),
            eq(ProductCreationType.UNIFIED_BULK_UPLOAD), productRequestArgumentCaptor.capture());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void approveDraftTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_DRAFT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowServiceWrapper).approveDraft(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE);
  }

  @Test
  public void createWithUniqueSellingPointAsNullTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setUniqueSellingPoint(null);
    URI uri =
            new URIBuilder()
                    .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
                    .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
                    .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
                    .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
                    .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
                    .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
            .perform(
                    MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                            .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            any(ProductRequest.class));
    Mockito.verify(this.productWorkflowService).createDirect(any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void approveDraftWithInvalidProductCodeTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_DRAFT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", "").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                  .contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.PRODUCT_CODE_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowServiceWrapper, ProductControllerTest.NEVER_CALLED).approveDraft(
          DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE);
    }
  }

  @Test
  public void approveDraftExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productWorkflowServiceWrapper).approveDraft(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.APPROVE_DRAFT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowServiceWrapper).approveDraft(DEFAULT_STORE_ID, DEFAULT_PRODUCT_CODE);
  }

  @Test
  @SuppressWarnings("rawtypes")
  public void notifyMerchantOfRecentApprovedProductsTestSuccess() throws Exception {
    ProductEmailSentResponse productEmailSentResponse = new ProductEmailSentResponse();
    productEmailSentResponse.setEmailSentFailedCount(0);
    Mockito.doNothing().when(getProductService())
        .notifyMerchantOfRecentApprovedProducts(any(Date.class), any(Date.class));
    URI uri =
        new URIBuilder()
            .setPath(
                ProductControllerPath.BASE_PATH
                    + ProductControllerPath.COLLECTION_NOTIFY_AGE_BETWEEN)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("interval", "11").build();
    MvcResult result = getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    GdnRestSimpleResponse restResponse = getObjectMapper().readValue(result.getResponse()
        .getContentAsByteArray(), GdnRestSimpleResponse.class);
    assertTrue(restResponse.isSuccess());

    Mockito.verify(this.productService, ProductControllerTest.AT_LEAST_ONE)
        .notifyMerchantOfRecentApprovedProducts(any(Date.class), any(Date.class));
  }

  private ProductRequest generateProductRequest() throws Exception {
    Product product = getProductRequest(this.productRequest);
    return this.productRequest;
  }

  @Test
  public void updateProductContentTest() throws Exception {
    ProductRequest request = generateProductRequest();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_CONTENT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).updateProductContent(any(ProductRequest.class));
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void updateProductImageTest() throws Exception {
    ProductRequest request = generateProductRequest();
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_IMAGE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).updateProductImage(any(ProductRequest.class));
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void getProductDetailsByProductCodesTest() throws Exception {
    Mockito.when(
        this.productService.getProductDetailsByProductCodes(any(), any(),
            Mockito.anyList())).thenReturn(this.gdnRestListResponse);
    GdnRestListResponse<ProductDetailResponse> response = this.productController
        .getProductDetailsByProductCodes(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, this.productCodeList);
    Mockito.verify(this.productService)
        .getProductDetailsByProductCodes(any(), any(),
            Mockito.anyList());
    assertTrue(response.isSuccess());
  }

  @Test
  public void getProductDetailsByProductCodesTest_Exception() throws Exception {
    GdnRestListResponse<ProductDetailResponse> response = this.productController
        .getProductDetailsByProductCodes(null, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, this.productCodeList);
    assertTrue(!response.isSuccess());
  }

  @Test
  public void approveContentActiveProductTest() throws Exception {
	Mockito.doNothing().when(this.productService)
    	.approveContent(any(), any(), Mockito.anyBoolean(), Mockito.anyBoolean());
    this.productController.approveContentActiveProduct(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, this.productCodeList);
    Mockito.verify(this.productService)
        .approveContent(any(), any(), Mockito.anyBoolean(), Mockito.anyBoolean());
  }

  @Test
  public void approveContentActiveProductExceptionTest() throws Exception {
    Mockito
        .doThrow(RuntimeException.class)
        .when(this.productService)
        .approveContent(any(), any(), Mockito.anyBoolean(), Mockito.anyBoolean());
    this.productController.approveContentActiveProduct(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, this.productCodeList);
    Mockito.verify(this.productService)
        .approveContent(any(), any(), Mockito.anyBoolean(), Mockito.anyBoolean());
  }

  @Test
  public void approveContentActiveProductException2Test() throws Exception {
    this.productController.approveContentActiveProduct(null, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, this.productCodeList);
  }

  @Test
  public void filterProductItemSummaryByProductItemNameAndCategoryIdTest() throws Exception {
    Page<ProductItem> page = generateProductItemPage();
    Mockito.when(
      this.productService.findByProductItemNameAndCategoryId(any(), any(),
        any(), any())).thenReturn(page);
    URI uri =
      new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.FILTER_ITEM_NAME_AND_CATEGORY_ID)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .addParameter("productItemName", ProductControllerTest.DEFAULT_PRODUCT_NAME)
        .addParameter("categoryId", DEFAULT_PRODUCT_CATEGORY).build();
    getMockMvc()
      .perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
          .contentType(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    page.getContent().get(0).getProductItemImages().clear();
    getMockMvc()
      .perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
          .contentType(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    Mockito.verify(this.productService, Mockito.times(2)).findByProductItemNameAndCategoryId(any(),
      any(), any(), any());
  }

  private Page<ProductItem> generateProductItemPage() throws Exception {
    ProductItemResponse productItemResponse =
        new ProductItemResponse("Produk 1 Item 1", null, null, null, null, null, "0123456789012",
            UUID.randomUUID().toString(), true, false, null, new ArrayList<Image>());
    Image imageResponse = new Image();
    imageResponse.setMainImages(true);
    productItemResponse.setViewable(true);
    productItemResponse.getImages().add(imageResponse);
    List<ProductItemResponse> productItemResponses = new ArrayList<ProductItemResponse>();
    productItemResponses.add(productItemResponse);
    List<ProductItem> productItems = new ArrayList<ProductItem>();
    for (ProductItemResponse productItemResponse2 : productItemResponses) {
      ProductItem productItem = new ProductItem();
      ProductItemImage productItemImage = new ProductItemImage();
      BeanUtils.copyProperties(productItemResponse2, productItem);
      BeanUtils.copyProperties(productItemResponse2.getImages().get(0), productItemImage);
      productItem.setProductItemImages(new ArrayList<ProductItemImage>());
      productItem.getProductItemImages().add(productItemImage);
      productItems.add(productItem);
    }
    Page<ProductItem> page = new PageImpl<ProductItem>(productItems);
    return page;
  }

  @Test
  public void getProductItemByProductNameAndCategoryCodeTest() throws Exception {
    List<ProductItemResponse> responseList = new ArrayList<>();
    ProductItemResponse itemResponse = new ProductItemResponse();
    responseList.add(itemResponse);
    Page<ProductItemResponse> page = new PageImpl<>(responseList);
    Mockito.when(this.productService
        .getProductItemByKeywordAndCategoryCode(any(), any(),
            any(), Mockito.anyBoolean())).thenReturn(page);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH
        + ProductControllerPath.ITEM_FILTER_LIST_PRODUCT_NAME_AND_CATEGORY_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .addParameter("productName", ProductControllerTest.DEFAULT_PRODUCT_NAME)
        .addParameter("categoryCode", DEFAULT_PRODUCT_CATEGORY).build();
    getMockMvc().perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)).andExpect(MockMvcResultMatchers.status().isOk())
        .andReturn();
    Mockito.verify(this.productService)
        .getProductItemByKeywordAndCategoryCode(any(), any(),
            any(), Mockito.anyBoolean());
  }

  @Test
  public void getProductItemDetailByProductNameAndCategoryCodeTest() throws Exception {
    List<ProductItemDetailResponse> responseList = new ArrayList<>();
    ProductItemDetailResponse itemResponse = new ProductItemDetailResponse();
    responseList.add(itemResponse);
    Page<ProductItemDetailResponse> page = new PageImpl<>(responseList);
    Mockito.when(this.productService
        .getProductItemDetailByKeywordAndCategoryCodes(any(), any(),
            any(), any())).thenReturn(page);

    ProductSearchRequest prdRequest = new ProductSearchRequest();
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH
        + ProductControllerPath.ITEM_DETAIL_FILTER_BY_PRODUCT_NAME_AND_CATEGORY_CODES)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .build();

    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(prdRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    Mockito.verify(this.productService)
        .getProductItemDetailByKeywordAndCategoryCodes(any(), any(), any(), any());
  }

  @Test
  public void getProductItemDetailByProductNameAndCategoryCodeWhenError() throws Exception {
    List<ProductItemDetailResponse> responseList = new ArrayList<>();
    ProductItemDetailResponse itemResponse = new ProductItemDetailResponse();
    responseList.add(itemResponse);
    Page<ProductItemDetailResponse> page = new PageImpl<>(responseList);
    Mockito.when(this.productService
        .getProductItemDetailByKeywordAndCategoryCodes(any(), any(),
            any(), any())).thenThrow(RuntimeException.class);

    ProductSearchRequest prdRequest = new ProductSearchRequest();
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH
        + ProductControllerPath.ITEM_DETAIL_FILTER_BY_PRODUCT_NAME_AND_CATEGORY_CODES)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .build();

    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(prdRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    Mockito.verify(this.productService)
        .getProductItemDetailByKeywordAndCategoryCodes(any(), any(),
            any(), any());
  }

  @Test
  public void getProductItemByProductNameAndCategoryCodeTest_Exception() throws Exception {
    List<ProductItemResponse> responseList = new ArrayList<>();
    ProductItemResponse itemResponse = new ProductItemResponse();
    responseList.add(itemResponse);
    Page<ProductItemResponse> page = new PageImpl<>(responseList);
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .getProductItemByKeywordAndCategoryCode(any(), any(),
            any(), Mockito.anyBoolean());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH
        + ProductControllerPath.ITEM_FILTER_LIST_PRODUCT_NAME_AND_CATEGORY_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("size", String.valueOf(ProductControllerTest.DEFAULT_SIZE))
        .addParameter("productName", ProductControllerTest.DEFAULT_PRODUCT_NAME)
        .addParameter("categoryCode", DEFAULT_PRODUCT_CATEGORY).build();
    getMockMvc().perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)).andExpect(MockMvcResultMatchers.status().isOk())
        .andReturn();
    Mockito.verify(this.productService)
        .getProductItemByKeywordAndCategoryCode(any(), any(),
            any(), Mockito.anyBoolean());
  }

  @Test
  public void getCategoryHierarchyByKeywordTestException() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
    this.productController.getCategoryHierarchyByKeyword(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
        DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test");
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  private Map<String, Object> generateCategoryHierarchyResponse() {
    Map<String, Object> map = new HashMap<>();
    List<CategoryHierarchyProductCountResponse> list = new ArrayList<>();
    CategoryHierarchyProductCountResponse category = new CategoryHierarchyProductCountResponse();
    category.setCategoryHierarchy(new ArrayList<>());
    category.getCategoryHierarchy().add(new CategoryResponse());
    category.setCategoryCode(CATEGORY_1);
    list.add(category);
    map.put(RESULT, list);
    map.put(CATEGORY_1, 5L);
    return map;
  }

  @Test
  public void getCategoryHierarchyByKeywordTest() throws Exception {
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull())).thenReturn(generateCategoryHierarchyResponse());
    this.productController
        .getCategoryHierarchyByKeyword(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test");
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  @Test
  public void getCategoryHierarchyByKeywordTest_withNullResponse() throws Exception {
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(eq(DEFAULT_STORE_ID),
            eq("test"), any(Pageable.class), Mockito.isNull())).thenReturn(new HashMap<>());
    GdnRestListResponse<CategoryHierarchyResponse> response = this.productController
        .getCategoryHierarchyByKeyword(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test");
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(eq(DEFAULT_STORE_ID),
            eq("test"), any(Pageable.class), Mockito.isNull());
    Assertions.assertNotNull(response);
    assertNull(response.getContent());
    Assertions.assertEquals(DEFAULT_SIZE.longValue(), response.getPageMetaData().getPageSize());
  }

  @Test
  public void getCategoryHierarchyByKeywordTest_withEmptyResponse() throws Exception {
    Map<String, Object> map = new HashMap<>();
    map.put("result", new ArrayList<CategoryHierarchyResponse>());
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(eq(DEFAULT_STORE_ID),
            eq("test"), any(Pageable.class), Mockito.isNull())).thenReturn(map);
    GdnRestListResponse<CategoryHierarchyResponse> response = this.productController
        .getCategoryHierarchyByKeyword(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test");
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(eq(DEFAULT_STORE_ID),
            eq("test"), any(Pageable.class), Mockito.isNull());
    Assertions.assertNotNull(response);
    Assertions.assertEquals(0, response.getContent().size());
    Assertions.assertEquals(DEFAULT_SIZE.longValue(), response.getPageMetaData().getPageSize());
  }

  @Test
  public void getCategoryHierarchyByKeywordWithProductCountTestException() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
    this.productController.getCategoryHierarchyByKeywordWithProductCount(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
        DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test", null);
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  @Test
  public void getCategoryHierarchyByKeywordWithProductCountTest() throws Exception {
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull())).thenReturn(generateCategoryHierarchyResponse());
    this.productController
        .getCategoryHierarchyByKeywordWithProductCount(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test", null);
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  @Test
  public void getCategoryHierarchyByKeywordWithProductCountDataIsNullTest() throws Exception {
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull())).thenReturn(null);
    this.productController
        .getCategoryHierarchyByKeywordWithProductCount(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test", null);
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  @Test
  public void getCategoryHierarchyByKeywordWithProductCountResultIsEmptyTest() throws Exception {
    Map<String, Object> generateCategoryHierarchyResponse = generateCategoryHierarchyResponse();
    generateCategoryHierarchyResponse.remove(RESULT);
    Mockito.when(this.productService
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull())).thenReturn(generateCategoryHierarchyResponse);
    this.productController
        .getCategoryHierarchyByKeywordWithProductCount(DEFAULT_STORE_ID, DEFAULT_CHANNEL_ID, DEFAULT_CLIENT_ID,
            DEFAULT_REQUEST_ID, DEFAULT_USERNAME, DEFAULT_PAGE, DEFAULT_SIZE, "test", null);
    Mockito.verify(this.productService)
        .getCategoryHierarchyByProductNameOrProductCode(any(), any(),
            any(), Mockito.isNull());
  }

  @Test
  public void testUpdateRejectedProduct() throws Exception {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    GdnBaseRestResponse response = new GdnBaseRestResponse(null, null, true, getRequestId());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_REJECTED_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    verify(this.productWorkflowService).updateRejectedProduct(any(ProductRequest.class));
    assertEquals(getObjectMapper().writeValueAsString(response),
        result.getResponse().getContentAsString());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void clearMasterProductCacheTest() throws Exception {
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CLEAR_MASTER_PRODUCT_CACHE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
            .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    System.out.println(uri.getPath());
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
                .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).clearMasterProductCache(any());
  }

  @Test
  public void clearMasterProductCacheExeptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .clearMasterProductCache(DEFAULT_PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CLEAR_MASTER_PRODUCT_CACHE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("productCode", ProductControllerTest.DEFAULT_PRODUCT_CODE).build();
    System.out.println(uri.getPath());
    getMockMvc()
        .perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).clearMasterProductCache(any());
  }

  @Test
  public void filterProductCollectionListWhenErrorIOException() throws Exception {
    ProductWorkflowStatus productWorkflowStatus = generateProductWorkflowStatus();
    Mockito.when(getProductService()
        .getActiveProductCollectionFromSolr(any(), any(), any(),
            Mockito.anyBoolean(), any(), any())).thenThrow(RuntimeException.class);

    doReturn(Arrays.asList(productWorkflowStatus)).when(productWorkflowService)
        .getProductWorkFlowByProductCodes(any(List.class));

    URI uri = generateURIProductCollection(ProductControllerPath.COLLECTION_FILTER_KEYWORD, "true", "true");
    Exception exception = new Exception();
    try {
      getMockMvc().perform(
          MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(getObjectMapper().writeValueAsString(this.productRequest)))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (Exception e) {
      exception = e;
    } finally {
      Mockito.verify(getProductService())
          .getActiveProductCollectionFromSolr(DEFAULT_STORE_ID, null, null, null, DEFAULT_SORT_TYPE,
              PageRequest.of(0, 10));
      Assertions.assertTrue(exception instanceof Exception);
    }
  }

  @Test
  public void filterProductCollectionListWhenActiveNotViewable() throws Exception {
    Mockito.when(getProductService().findProductsForDalamProcess(any(DalamProductListRequest.class))).thenReturn(new PageImpl<>(new ArrayList<>()));

    URI uri = generateURIProductCollection(ProductControllerPath.COLLECTION_FILTER_KEYWORD, "true", "false");
    getMockMvc()
        .perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(this.productRequest)))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    Mockito.verify(getProductService()).findProductsForDalamProcess(any(DalamProductListRequest.class));
  }

  private URI generateURIProductCollection(String path, String activated, String viewable) throws URISyntaxException{
    return new URIBuilder()
      .setPath(
          ProductControllerPath.BASE_PATH + path)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
      .addParameter("activated", activated)
      .addParameter("viewable", viewable)
      .addParameter("startAge", "2017-05-01 00:00")
      .addParameter("endAge", "2017-05-01 00:00")
      .addParameter("age", "2017-05-01 00:00")
      .build();
  }

  @Test
  public void findProductItemByKeywordAndCategoryCodesTest() throws Exception {
    Mockito.when(this.productService
        .findProductItemByKeywordAndCategoryCodes(any(), Mockito.anyList(), any(),
            Mockito.anyBoolean()))
        .thenReturn(new PageImpl<>(new ArrayList<>(), PageRequest.of(0, 1), 1));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.ITEM_FILTER_KEYWORD_AND_CATEGORY_CODES)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    ProductSearchRequest request = new ProductSearchRequest();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andReturn();
  }

  @Test
  public void findProductItemByKeywordAndCategoryCodesTestException() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .findProductItemByKeywordAndCategoryCodes(any(), Mockito.anyList(), any(),
            Mockito.anyBoolean());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.ITEM_FILTER_KEYWORD_AND_CATEGORY_CODES)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    ProductSearchRequest request = new ProductSearchRequest();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andReturn();
  }

  @Test
  public void countProductCollectionBySpecifiedDateRange_Valid_Success() throws Exception {
    ProductCollectionCountRequest request = new ProductCollectionCountRequest();
    request.setStoreId(DEFAULT_STORE_ID);
    request.setActivated(false);
    request.setViewable(false);
    ProductCollectionCountResponse response = new ProductCollectionCountResponse();
    response.setToday(COUNT_TODAY);
    Mockito.when(this.productService.countProductCollectionBySpecifiedDateRange(any()))
      .thenReturn(response);

    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_COLLECTION_COUNT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("activated", "false")
        .addParameter("viewable", "false")
        .build();

    MvcResult result = getMockMvc()
        .perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    GdnRestSingleResponse<ProductCollectionCountRestResponse> restResponse =
        getObjectMapper().readValue(result.getResponse().getContentAsByteArray(),
            new TypeReference<GdnRestSingleResponse<ProductCollectionCountRestResponse>>() {});
    assertTrue(restResponse.isSuccess());
    assertEquals(restResponse.getValue().getToday(), COUNT_TODAY);
    Mockito.verify(this.productService).countProductCollectionBySpecifiedDateRange(any());
  }

  @Test
  public void countProductCollectionBySpecifiedDateRange_Exception_ThrowException() throws Exception {
    Mockito.when(this.productService.countProductCollectionBySpecifiedDateRange(any()))
      .thenThrow(RuntimeException.class);

    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_COLLECTION_COUNT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("activated", "false")
        .addParameter("viewable", "false")
        .build();

    MvcResult result = getMockMvc()
        .perform(MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();

    GdnRestSingleResponse<ProductCollectionCountRestResponse> restResponse =
        getObjectMapper().readValue(result.getResponse().getContentAsByteArray(),
            new TypeReference<GdnRestSingleResponse<ProductCollectionCountRestResponse>>() {});
    assertFalse(restResponse.isSuccess());
    Mockito.verify(this.productService).countProductCollectionBySpecifiedDateRange(any());
  }

  @Test
  public void bulkDeleteProductWip_success() throws Exception {
    BulkDeleteProductWipRequest request = new BulkDeleteProductWipRequest();
    Set<String> ids = new HashSet<>();
    ids.add("1");
    request.setProductLevel1Ids(ids);
    Mockito.when(productLevel1CollectionService
        .findProductCodesByStoreIdAndProductIdsInAndMarkForDeleteFalse(DEFAULT_STORE_ID, ids, DEFAULT_USERNAME,
            DEFAULT_NOTE, "bp-code"))
        .thenReturn(new PostLiveProductCountResponse(3, new HashMap<>()));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.BULK_PRODUCT_WIP_DELETE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("businessPartnerCode", DEFAULT_BP_CODE)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productLevel1CollectionService)
        .findProductCodesByStoreIdAndProductIdsInAndMarkForDeleteFalse(DEFAULT_STORE_ID, ids, DEFAULT_USERNAME,
            DEFAULT_NOTE, "bp-code");
  }

  @Test
  public void testCreateProductWithWarnaAndFamilyColor() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithWarnaAndWithFamilyColor();
    request.setProductItems(new ArrayList<>());
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertEquals(Constants.WARNA,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getProductAttributeName());
    Mockito.verify(productOutbound).validCnCategory(any());
    Assertions.assertEquals(Constants.FAMILY_COLOUR,
      productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0)
        .getProductItemAttributeValueRequests().get(0).getAttribute().getName());
  }

  @Test
  public void testCreateProductWithOutWarnaAndWithFamilyColor() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndWithFamilyColor();
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertNotEquals(Constants.WARNA,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getProductAttributeName());
    Assertions.assertTrue(productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0)
        .getProductItemAttributeValueRequests().isEmpty());
    Assertions.assertFalse(productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0).getProductItemAttributeValueRequests().contains(Constants.FAMILY_COLOUR));
    Mockito.verify(productOutbound).validCnCategory(any());
    }

  @Test
  public void testCreateProductWithOutWarnaAndWithFamilyColorNull() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndWithFamilyColorNull();
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertNotEquals(Constants.WARNA,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getProductAttributeName());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void testCreateProductWithOutWarnaAndWithFamilyColorWithDuplicateAttributes() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndDuplicateAttributes();
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
          .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertNotEquals(Constants.WARNA,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getProductAttributeName());
    Assertions.assertEquals(productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0).getProductItemAttributeValueRequests().size(),1);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void testCreateProductWithoutWarnaAndWithoutFamilyColorProductItemsNull() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndWithoutFamilyColor();
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertEquals(Constants.DEFAULT,
        productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0)
            .getProductItemAttributeValueRequests().get(0).getAttribute().getName());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void testCreateProductWithoutWarnaAndWithoutFamilyColorProductItemAttributeNull() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndWithoutFamilyColor();
    request.getProductItemRequests().get(0).setProductItemAttributeValueRequests(null);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void testCreateProductWithoutWarnaAndWithoutFamilyColorProductItemsNonNull() throws Exception {
    ProductCreationRequest request = generateProductCreationRequestWithoutWarnaAndWithoutFamilyColor();
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());

    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertEquals(Constants.DEFAULT,
        productCreationRequestArgumentCaptor.getValue().getProductItemRequests().get(0)
            .getProductItemAttributeValueRequests().get(0).getAttribute().getName());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void bulkDeleteProductWip_fail() throws Exception {
    BulkDeleteProductWipRequest request = new BulkDeleteProductWipRequest();
    Set<String> ids = new HashSet<>();
    request.setProductLevel1Ids(ids);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.BULK_PRODUCT_WIP_DELETE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("businessPartnerCode", DEFAULT_BP_CODE)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
  }

  @Test
  public void createProductWithItemsEmptyTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.setProductItems(new ArrayList<>());
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithItemsEmptyNotCnCategoryTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.setProductItems(new ArrayList<>());
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), false));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void   createProductWithExistingSellerSkusAndProductDetailsMapTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).setMerchantSku("MERCHANT_SKU_123");
    request.getProductItemRequests().get(0).setItemGeneratedName("Test Item Name");
    
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ProductSystemParameter mockParam = new ProductSystemParameter();
    mockParam.setValue("jpg,png,jpeg");
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(anyString(), anyString())).thenReturn(mockParam);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
  }

  @Test
  public void createProductWithOmniChannelSkuDuplicateErrorTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    
    // Mock the validatePickupPointsAndFbb method to populate existingSellerSkusAndProductDetailsMap
    Mockito.doAnswer(invocation -> {
      Map<String, OmniChannelSkuResponse> existingSellerSkusAndProductDetailsMap = invocation.getArgument(3);
      OmniChannelSkuResponse omniChannelSkuResponse = new OmniChannelSkuResponse();
      omniChannelSkuResponse.setProductCode("PRODUCT_CODE_123");
      omniChannelSkuResponse.setSkuCode("SKU_CODE_123");
      omniChannelSkuResponse.setSellerSku("DUPLICATE_SKU_123");
      omniChannelSkuResponse.setItemName("Test Item Name");
      existingSellerSkusAndProductDetailsMap.put("DUPLICATE_SKU_123", omniChannelSkuResponse);
      return null;
    }).when(productService).validatePickupPointsAndFbb(anyString(), any(ProductCreationRequest.class), any(), any());
    
    ProductCreationRequest request = generateProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.getProductItemRequests().get(0).setMerchantSku("DUPLICATE_SKU_123");
    request.getProductItemRequests().get(0).setItemGeneratedName("Test Item Name");
    
    ProductSystemParameter mockParam = new ProductSystemParameter();
    mockParam.setValue("jpg,png,jpeg");
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(anyString(), anyString())).thenReturn(mockParam);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    
    Map<String, OmniChannelSkuResponse> omniChannelSkuToResponseMap = new HashMap<>();
    OmniChannelSkuResponse omniChannelSkuResponse = new OmniChannelSkuResponse();
    omniChannelSkuResponse.setProductCode("PRODUCT_CODE_123");
    omniChannelSkuResponse.setSkuCode("SKU_CODE_123");
    omniChannelSkuResponse.setSellerSku("DUPLICATE_SKU_123");
    omniChannelSkuResponse.setItemName("Test Item Name");
    omniChannelSkuToResponseMap.put("DUPLICATE_SKU_123", omniChannelSkuResponse);
    Mockito.when(productOutbound.getOmniChannelSkuToItemCode(anyString(), any(List.class))).thenReturn(omniChannelSkuToResponseMap);
    Mockito.when(mapper.writeValueAsString(Mockito.any()))
        .thenReturn(objectMapper.writeValueAsString(omniChannelSkuToResponseMap));

    Mockito.doThrow(new ApiDataNotFoundException(ApiErrorCode.OMNI_CHANNEL_SKU_ALREADY_EXISTS_OR_DUPLICATE.getDesc(),
            ApiErrorCode.OMNI_CHANNEL_SKU_ALREADY_EXISTS_OR_DUPLICATE)).when(productWorkflowServiceWrapper)
        .create(anyString(), any(ProductCreationRequest.class), eq(false), eq(true), any());
    
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    
    MvcResult result = this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andReturn();
    
    String responseContent = result.getResponse().getContentAsString();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper).create(anyString(), any(ProductCreationRequest.class), anyBoolean(), anyBoolean(), any());
    Mockito.verify(trackerService).trackProductCreationFailure(anyString(), anyString(), any(ProductCreationRequest.class), anyString());
    Mockito.verify(mapper).writeValueAsString(Mockito.any());
    Assertions.assertNotNull(responseContent);
  }


  @Test
  public void createProductTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithBopisShippingCategoryEligibleTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ProductCreationRequest request = generateProductCreationRequest();
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(false);
    categoryResponse.setBopisEligible(true);
    request.setProductType(ProductType.BOPIS.getCode());
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(
      categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test()
  public void createProductWithBopisShippingCategoryInEligibleExternalUserTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ProductCreationRequest request = generateProductCreationRequest();
    CategoryResponse categoryResponse = new CategoryResponse();
    categoryResponse.setBopisEligible(false);
    request.setProductType(ProductType.BOPIS.getCode());
    request.setExternalUser(true);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(
      categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
      eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithBopisShippingCategoryEligibleWithRegularShippingTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ProductCreationRequest request = generateProductCreationRequest();
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    categoryResponse.setBopisEligible(true);
    request.setProductType(ProductType.REGULAR.getCode());
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(
      categoryResponse, true));
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CM").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithBopisShippingCategoryEligibleWithRegularShippingInvalidSellerTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ProductCreationRequest request = generateProductCreationRequest();
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    categoryResponse.setBopisEligible(true);
    request.setProductType(ProductType.REGULAR.getCode());
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    profileResponse.setCompany(CompanyDTO.builder().merchantType("TD").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(
      categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithBopisShippingCategoryEligibleWithShippingTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ProductCreationRequest request = generateProductCreationRequest();
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    request.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    categoryResponse.setBopisEligible(true);
    request.setProductType(ProductType.BOPIS.getCode());
    ProfileResponse cm =
      ProfileResponse.builder().businessPartnerCode(request.getBusinessPartnerCode())
        .company(CompanyDTO.builder().merchantType("CM").build()).build();
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CC").build());
    when(productService.getProfileResponse(request.getBusinessPartnerCode())).thenReturn(cm);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(
      categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
  }


  @Test
  public void createProductTestWithShippingExceeded() throws Exception {
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit", 100000);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    request.setShippingWeight(3000000.00);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductEmptyDescriptionTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    request.setDescription(StringUtils.EMPTY.getBytes());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestL5WithBopisFalse() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setExternalUser(true);
    request.setProductType(ProductType.REGULAR.getCode());
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CM").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductTestL5WithBopisTrue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ReflectionTestUtils.setField(productController, "instoreNewFlowEnabled", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setExternalUser(true);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setProductType(ProductType.BOPIS.getCode());
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    categoryResponse.setBopisEligible(false);
    CategoryAndCnDetailDto categoryAndCnDetailDto = new CategoryAndCnDetailDto();
    categoryAndCnDetailDto.setCnCategory(true);
    categoryAndCnDetailDto.setCategoryResponse(categoryResponse);
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CM").offlineToOnlineFlag(true).build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(categoryAndCnDetailDto);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    request.setOff2OnChannelActive(true);
    request.setB2cActivated(false);
    request.getProductItemRequests().forEach(item -> item.getPickupPoints()
        .forEach(pickupPointCreateRequest -> pickupPointCreateRequest.setCncActive(false)));
    request.getProductItemRequests().forEach(item -> item.getPickupPoints()
        .forEach(pickupPointCreateRequest -> pickupPointCreateRequest.setBuyable(false)));
    request.getProductItemRequests().forEach(item -> item.getPickupPoints()
        .forEach(pickupPointCreateRequest -> pickupPointCreateRequest.setDisplay(false)));
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
    verify(trackerService).trackProductCreationFailure(
      eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestL5WithBopisTrueCategoryTrue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setExternalUser(true);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setProductType(ProductType.BOPIS.getCode());
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    categoryResponse.setBopisEligible(true);
    CategoryAndCnDetailDto categoryAndCnDetailDto = new CategoryAndCnDetailDto();
    categoryAndCnDetailDto.setCnCategory(true);
    categoryAndCnDetailDto.setCategoryResponse(categoryResponse);
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CM").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(categoryAndCnDetailDto);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }


  @Test
  public void createProductTestL5WithBopisTrueCategoryFalse() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setExternalUser(true);
    request.setProductType(ProductType.REGULAR.getCode());
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    categoryResponse.setBopisEligible(false);
    profileResponse.setBigProductFlag(true);
    profileResponse.setBopisFlag(true);
    profileResponse.setCompany(CompanyDTO.builder().merchantType("CM").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductTestL5WithBopisTDSeller() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "bopisCategoryRestrictionEnabled", true);
    ReflectionTestUtils.setField(productController, "bopisCategoryValidationMerchantTypes", "CM");
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setExternalUser(true);
    CategoryResponse categoryResponse = new CategoryResponse();
    request.setExternalUser(true);
    categoryResponse.setBopisEligible(false);
    profileResponse.setCompany(CompanyDTO.builder().merchantType("TD").build());
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    request.setSizeChartCode(SIZE_CHART);
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }


  @Test
  public void createProductValidationBasedOnSwitchTest() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateProductBasedOnSwitch", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    request.setImages(images);
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductB2bExclusiveErrorTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    CategoryResponse categoryResponse = new CategoryResponse();
    categoryResponse.setB2bExclusive(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(categoryResponse, true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductPopulateDefaultPromoskuValueTrueTest() throws Exception {
    ReflectionTestUtils.setField(productController, "populateDefaultPromoskuValue", true);

    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductPopulateDefaultPromoskuValueTrueTestAndBusinessPartnerInternal() throws Exception {
    ReflectionTestUtils.setField(productController, "populateDefaultPromoskuValue", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    request.setBusinessPartnerCode(Constants.INTERNAL);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestInternalL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    profileResponse.setBusinessPartnerCode(Constants.INTERNAL);
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductTestInternalCreateL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setBusinessPartnerCode(Constants.INTERNAL);
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestInternalCreateL5_withEmptyBpCode() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setBusinessPartnerCode(StringUtils.EMPTY);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }


  @Test
  public void createProductTestMPPValidationFalseL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(false);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
  }

  @Test
  public void createProductTestMPPValidationTrueL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setB2bFields(new B2bDetailsDTO());
    request.getProductItemRequests().get(0).getPickupPoints().get(0).getB2bFields().setPrice(10.0);
    profileResponse.setCompany(new CompanyDTO());
    profileResponse.getCompany().setSalesChannel(Arrays.asList(B2B_SELLER_CHANNEL, B2C_SELLER_CHANNEL));
    Mockito.when(productService.getProfileResponse(BUSINESS_PARTNER_CODE)).thenReturn(profileResponse);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
  }

  @Test
  public void createProductTestPreOrder() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, preOrderRequest.getPreOrderValue());
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
  }

  @Test
  public void createProductValidationPreOrderTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "sizeChartAdditionForProduct", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.setSizeChartCode(SIZE_CHART);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, preOrderRequest.getPreOrderValue());
    preOrderRequest.setPreOrderType("ANY");
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(
            jsonPath("$.errorCode", equalTo(ApiErrorCode.INVALID_PREORDER_TYPE.getCode())))
        .andExpect(
            jsonPath("$.errorMessage", equalTo(ApiErrorCode.INVALID_PREORDER_TYPE.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
  }

  @Test
  public void createProductSizeChartValidationTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "sizeChartAdditionForProduct", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setSizeChartCode(SIZE_CHART);
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, preOrderRequest.getPreOrderValue());
    preOrderRequest.setPreOrderType("ANY");
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
        .thenReturn(true);
    Mockito.when(productService.validateSizeChart(SIZE_CHART, STORE_ID))
        .thenReturn(ApiErrorCode.SIZE_CHART_CODE_INVALID);
    Mockito.when(productOutbound.validCnCategory(any()))
        .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(
            productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.SIZE_CHART_CODE_INVALID.getCode())))
        .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.SIZE_CHART_CODE_INVALID.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductProductLimitTest() throws Exception {
    ReflectionTestUtils.setField(productController, "productLimitSwitchEnabled", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "sellerPenaltyEnabledPhase1", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
        .thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any()))
        .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito
        .when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(productService.checkProductLimitExceeded(Mockito.anyString(), Mockito.anyString()))
        .thenReturn(ApiErrorCode.PRODUCT_LIMIT_REACHED);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.PRODUCT_LIMIT_REACHED.getCode())))
        .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.PRODUCT_LIMIT_REACHED.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkProductLimitExceeded(Mockito.anyString(), Mockito.anyString());
  }

  @Test
  public void createProductProductLimitNullErrorCodeTest() throws Exception {
    ReflectionTestUtils.setField(productController, "productLimitSwitchEnabled", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
        .thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any()))
        .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito
        .when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(productService.checkProductLimitExceeded(Mockito.anyString(), Mockito.anyString()))
        .thenReturn(null);
    Mockito.when(productService.checkBpBopisEligibility(any(), any()))
        .thenReturn(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getCode())))
        .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkProductLimitExceeded(Mockito.anyString(), Mockito.anyString());
    verify(productService).checkBpBopisEligibility(any(), any());
  }

  @Test
  public void createProductProductLimitNotApplicableTest() throws Exception {
    ReflectionTestUtils.setField(productController, "productLimitSwitchEnabled", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", false);
    profileResponse.setFlags(flags);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
        .thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any()))
        .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito
        .when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(productService.checkBpBopisEligibility(any(), any()))
        .thenReturn(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getCode())))
        .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductProductLimitNullProfileResponseTest() throws Exception {
    ReflectionTestUtils.setField(productController, "productLimitSwitchEnabled", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productService.getProfileResponse(Mockito.anyString())).thenReturn(null);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
        .thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any()))
        .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito
        .when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(productService.checkBpBopisEligibility(any(), any())).thenReturn(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getCode())))
        .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductPreOrderFalseTest() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    preOrderRequest.setIsPreOrder(false);
    cal.add(Calendar.DATE, preOrderRequest.getPreOrderValue());
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
  }

  private void setPickupPointCreateRequest(ProductCreationRequest request) {
    PickupPointCreateRequest pickupPointCreateRequest = new PickupPointCreateRequest();
    pickupPointCreateRequest.setPrice(1.0);
    pickupPointCreateRequest.setSalePrice(1.0);
    pickupPointCreateRequest.setPickupPointId("pickup-point-2");
    List<PickupPointCreateRequest> pickupPoints =
        new ArrayList<>(request.getProductItemRequests().get(0).getPickupPoints());
    pickupPoints
        .add(pickupPointCreateRequest);
    request.getProductItemRequests().get(0).setPickupPoints(pickupPoints);
  }

  @Test
  public void createProductTestPriceValidationL5() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(null);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestB2BPriceValidationL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setB2bActivated(true);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(10.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setB2bFields(new B2bDetailsDTO());
    request.getProductItemRequests().get(0).getPickupPoints().get(0).getB2bFields().setPrice(0.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    profileResponse.setCompany(new CompanyDTO());
    profileResponse.getCompany().setSalesChannel(Arrays.asList(B2B_SELLER_CHANNEL, B2C_SELLER_CHANNEL));
    Mockito.when(productService.getProfileResponse(BUSINESS_PARTNER_CODE)).thenReturn(profileResponse);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestSalePriceValidationL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(null);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestMinPriceValidationL5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    Mockito.when(productService.getMinimumPrice(DEFAULT_STORE_ID)).thenReturn(1000);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTestMinPriceValidation2L5() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1.0);
    Mockito.when(productService.getMinimumPrice(DEFAULT_STORE_ID)).thenReturn(1000);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductL5WholesaleTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.setProductType(null);
    for (ProductItemCreationRequest productItemRequest : request.getProductItemRequests()) {
      productItemRequest.setProductType(null);
    }
    request.setShippingWeight(8.9);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setB2bFields(new B2bDetailsDTO());
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    profileResponse.setCompany(new CompanyDTO());
    profileResponse.getCompany().setSalesChannel(Arrays.asList(B2B_SELLER_CHANNEL, B2C_SELLER_CHANNEL));
    Mockito.when(productService.getProfileResponse(BUSINESS_PARTNER_CODE)).thenReturn(profileResponse);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any())).thenReturn(true);
    CategoryResponse categoryResponse = new CategoryResponse();
    categoryResponse.setB2bExclusive(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(categoryResponse, true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false));
  }

  @Test
  public void createProductL5WholesaleErrorTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any())).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false));
  }

  @Test
  public void createProductApiNotFoundExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.setProductType(0);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.doThrow(new ApiDataNotFoundException(null, ApiErrorCode.ITEM_IS_REJECTED))
        .when(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any());
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false));
    verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
        any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductSalePriceGreaterThanPriceTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.1);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.doThrow(new ApiDataNotFoundException(null, ApiErrorCode.ITEM_IS_REJECTED))
        .when(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any());
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
        any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductApplicationRunTimeExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.doThrow(new ApplicationRuntimeException(ErrorCategory.INVALID_STATE, null))
        .when(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any());
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false));
    verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
        any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.doThrow(RuntimeException.class).when(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), any());
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false));
    verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
        any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductExceptionTestZeroShippingValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    request.setProductType(1);
    request.setShippingWeight(0.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success",
        equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductBPBopisNotEligibleTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(1);
    Mockito.when(productService.checkBpBopisEligibility(anyInt(), any())).thenReturn(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR);
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.errorCode",
        equalTo(ApiErrorCode.BP_BOPIS_ELIGIBILITY_ERROR.getCode()))).andReturn();
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestShippingValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      11111);
    request.setProductType(1);
    request.setShippingWeight(11.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success",
        equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
    Mockito.verify(productWorkflowServiceWrapper)
      .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(true), any());
  }

  @Test
  public void createProductExceptionTestZeroWeightValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(1);
    request.setWeight(-30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success",
        equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestDecimalWeightValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(1);
    request.setWeight(0.00009);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroWidthValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(1);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(-4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroWidthValidationForItem() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(2);
    request.setWeight(30.0);
    request.setLength(9.0);
    request.setWidth(-4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroLengthValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(2);
    request.setWeight(30.0);
    request.setShippingWeight(30.0);
    request.setWidth(4.0);
    request.setHeight(4.0);
    request.setLength(-9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestNegetiveHeightValidationForItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setShippingWeight(3.0);
    request.setHeight(-9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
      this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success",
          equalTo(false))).andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
          jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
        .andExpect(
          jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
      deleteDummyFiles(request.getProductItemRequests());
      Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestNegetiveHeightValidation() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(2);
    request.setShippingWeight(3.0);
    request.setHeight(-9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroShippingValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(1));
    request.setShippingWeight(0.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(
        jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroWeightValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setProductType(2);
    request.setWeight(-30.0);
    request.setLength(9.0);
    request.setWidth(4.0);
    request.setHeight(9.0);
    request.setShippingWeight(30.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroLengthValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setWeight(30.0);
    request.setShippingWeight(30.0);
    request.setWidth(4.0);
    request.setHeight(4.0);
    request.setLength(-9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestLengthExceededValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setWeight(30.0);
    request.setShippingWeight(30.0);
    request.setWidth(4.0);
    request.setHeight(4.0);
    request.setLength(900000.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestWeightExceededValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxProductDimensionLimit",
      100000);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setWeight(300000000.0);
    request.setShippingWeight(30.0);
    request.setWidth(4.0);
    request.setHeight(4.0);
    request.setLength(9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductExceptionTestZeroWidthValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(2));
    request.setWeight(30.0);
    request.setShippingWeight(30.0);
    request.setWidth(-4.0);
    request.setHeight(4.0);
    request.setLength(9.0);
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }


  @Test
  public void createProductExceptionTestNegetiveHeightValidationFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    request.setShippingWeight(3.0);
    request.setHeight(-9.0);
    request.setProductType(null);
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setProductType(1));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
      .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(
        jsonPath("$.errorCode", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.DIMENSION_LESS_THAN_ZERO.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Disabled
  @Test
  public void createProductExceptionStockValidationTestFromItem() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1L);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setPrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setSalePrice(1000.0);
    request.getProductItemRequests().get(0).getPickupPoints().get(0).setStock(1000);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(9);
    productItemWholesalePriceRequest.setQuantity(2);
    request.getProductItemRequests().get(0).getPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    request.getProductItemRequests().get(0).setMerchantSku(DEFAULT_CHANNEL_ID);
    Mockito.doThrow(RuntimeException.class).when(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(), eq(false), eq(true), null);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
        .thenReturn(true);
    Mockito.when(wholesaleValidationUtil
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(false)))
        .thenReturn(ApiErrorCode.WHOLESALE_CANNOT_BE_SET_TO_FREE_SAMPLE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(productService).checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse);
  }

  @Test
  public void createProductImageValidationTestFromItem() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    Image image = new Image();
    image.setLocationPath(".gif");
    request.setImages(Arrays.asList(image));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request)));
    } finally {
      deleteDummyFiles(request.getProductItemRequests());
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createProductWithItemsNullTestFromItem() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.setProductItems(null);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertTrue(
        Objects.nonNull(productCreationRequestArgumentCaptor.getValue().getProductItems()));
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDaysTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, preOrderRequest.getPreOrderValue());
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    assertTrue(productCreationRequestArgumentCaptor.getValue().getPreOrder().getIsPreOrder());
    assertEquals(PREORDER_DAYS_TYPE, productCreationRequestArgumentCaptor.getValue().getPreOrder().getPreOrderType());
    assertEquals(PREORDER_VALUE, productCreationRequestArgumentCaptor.getValue().getPreOrder().getPreOrderValue());
    assertEquals(PREORDER_DATE_FORMAT.format(cal.getTime()),
        PREORDER_DATE_FORMAT.format(productCreationRequestArgumentCaptor.getValue().getPreOrder().getPreOrderDate()));
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderValueMoreThanLimitTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderValue(91);
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(DAYS_MORE_THAN_LIMIT_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithSellerSkuLimitTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).setMerchantSku(new String(new char[300]).replace('\0', ' '));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(SELLER_SKU_LIMIT_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithValidProductAndItemsTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest));
    AttributeRequest attributeRequest  = new AttributeRequest();
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(com.gdn.x.productcategorybase.dto.AttributeType.DESCRIPTIVE_ATTRIBUTE);
    productAttributeRequest.setAttribute(attributeRequest);

    ProductAttributeRequest productAttributeRequest2 = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest1 = new ProductAttributeValueRequest();
    productAttributeValueRequest1.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest2.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest1));
    AttributeRequest attributeRequest1  = new AttributeRequest();
    attributeRequest1.setAttributeCode(PRODUCT_CODE);
    attributeRequest1.setAttributeType(DEFINING_ATTRIBUTE);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setValue(PRODUCT_SKU);
    productAttributeValueRequest1.setAllowedAttributeValue(allowedAttributeValueRequest);
    productAttributeRequest2.setAttribute(attributeRequest1);

    request.getProductAttributes().add(productAttributeRequest);
    request.getProductAttributes().add(productAttributeRequest2);
    TreeMap<String, String> attributesMap = new TreeMap<>();
    attributesMap.put(PRODUCT_CODE, PRODUCT_SKU);
    request.getProductItemRequests().get(0).setAttributesMap(attributesMap);
    request.getProductItemRequests().get(0).setMerchantSku(new String(new char[300]).replace('\0', ' '));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "validateItemAndProductAttributeValue", true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(SELLER_SKU_LIMIT_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithInvalidProductAttributeValueTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    TreeMap<String, String> attributesMap = new TreeMap<>();
    attributesMap.put(PRODUCT_CODE, PRODUCT_SKU);
    request.getProductItemRequests().get(0).setAttributesMap(attributesMap);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "validateItemAndProductAttributeValue", true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(ITEM_VALUE_INVALID))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithInvalidProductAttributeValue2Test() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest));
    AttributeRequest attributeRequest  = new AttributeRequest();
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(com.gdn.x.productcategorybase.dto.AttributeType.DESCRIPTIVE_ATTRIBUTE);
    productAttributeRequest.setAttribute(attributeRequest);

    ProductAttributeRequest productAttributeRequest2 = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest1 = new ProductAttributeValueRequest();
    productAttributeValueRequest1.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest2.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest1));
    AttributeRequest attributeRequest1  = new AttributeRequest();
    attributeRequest1.setAttributeCode(PRODUCT_CODE);
    attributeRequest1.setAttributeType(DEFINING_ATTRIBUTE);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setValue(VALUE);
    productAttributeValueRequest1.setAllowedAttributeValue(allowedAttributeValueRequest);
    productAttributeRequest2.setAttribute(attributeRequest1);

    request.getProductAttributes().add(productAttributeRequest);
    request.getProductAttributes().add(productAttributeRequest2);
    TreeMap<String, String> attributesMap = new TreeMap<>();
    attributesMap.put(PRODUCT_CODE, PRODUCT_SKU);
    request.getProductItemRequests().get(0).setAttributesMap(attributesMap);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "validateItemAndProductAttributeValue", true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(ITEM_VALUE_INVALID))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithInvalidProductAttributeValue3Test() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).setMerchantSku(new String(new char[300]).replace('\0', ' '));
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest));
    AttributeRequest attributeRequest  = new AttributeRequest();
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(com.gdn.x.productcategorybase.dto.AttributeType.DESCRIPTIVE_ATTRIBUTE);
    productAttributeRequest.setAttribute(attributeRequest);

    ProductAttributeRequest productAttributeRequest2 = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest1 = new ProductAttributeValueRequest();
    productAttributeValueRequest1.setDescriptiveAttributeValue(VALUE);
    productAttributeRequest2.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest1));
    AttributeRequest attributeRequest1  = new AttributeRequest();
    attributeRequest1.setAttributeCode(PRODUCT_CODE);
    attributeRequest1.setAttributeType(DEFINING_ATTRIBUTE);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setValue(VALUE);
    productAttributeValueRequest1.setAllowedAttributeValue(allowedAttributeValueRequest);
    productAttributeRequest2.setAttribute(attributeRequest1);

    request.getProductAttributes().add(productAttributeRequest);
    request.getProductAttributes().add(productAttributeRequest2);
    TreeMap<String, String> attributesMap = new TreeMap<>();
    attributesMap.put(PRODUCT_CODE, PRODUCT_SKU);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "validateItemAndProductAttributeValue", true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(SELLER_SKU_LIMIT_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderValueZeroTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderValue(0);
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(ZERO_DAYS_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeWeekSuccessTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_WEEK_TYPE);
    preOrderRequest.setPreOrderValue(13);
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeWeekAndMoreThanLimitTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_WEEK_TYPE);
    preOrderRequest.setPreOrderValue(14);
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(MAXIMUM_WEEK_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeWeekWithZeroWeekTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_WEEK_TYPE);
    preOrderRequest.setPreOrderValue(0);
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(ZERO_WEEK_ERROR))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDateSuccessTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_DATE_TYPE);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, 5);
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDateWithLessThanCurrentDateTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_DATE_TYPE);
    preOrderRequest.setPreOrderDate(new Date("01/06/2021"));
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage", equalTo(DATE_ERROR)))
        .andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDateWithExact90DaysTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_DATE_TYPE);
    Date currentDate = PREORDER_DATE_FORMAT.parse(PREORDER_DATE_FORMAT.format(new Date()));
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, 90);
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDateWithMoreThan90DaysTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PREORDER_DATE_TYPE);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, 91);
    preOrderRequest.setPreOrderDate(cal.getTime());
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(ErrorMessages.PREORDER_DATE_CANNOT_BE_GREATER_THAN_90_DAYS))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
        any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderTypeDateWithEqualToCurrentDateTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    Date currentDate = PREORDER_DATE_FORMAT.parse(PREORDER_DATE_FORMAT.format(new Date()));
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    preOrderRequest.setPreOrderDate(cal.getTime());
    preOrderRequest.setPreOrderType(PREORDER_DATE_TYPE);
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage", equalTo(DATE_ERROR)))
        .andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderFalseTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setIsPreOrder(false);
    request.setPreOrder(preOrderRequest);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithPreOrderAndPreOrderWrongTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    preOrderRequest.setPreOrderType(PRODUCT_SKU);
    preOrderRequest.setPreOrderDate(new Date("01/06/2021"));
    request.setPreOrder(preOrderRequest);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo(WRONG_PREORDER_TYPE))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  public void createProductUspNullTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.setUniqueSellingPoint(null);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Assertions.assertNotNull(productCreationRequestArgumentCaptor.getValue().getUniqueSellingPoint());
    Assertions.assertTrue(StringUtils.isEmpty(productCreationRequestArgumentCaptor.getValue().getUniqueSellingPoint()));
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithWholeSalePriceMoreThan5Test() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    ReflectionTestUtils.setField(productController, "maxWholesalePriceRequests", 5);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    List<ProductItemWholesalePriceRequest> productItemWholesalePriceRequests = new ArrayList<>();
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(1, 10));
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(2, 12));
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(3, 14));
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(4, 15));
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(5, 16));
    productItemWholesalePriceRequests.add(new ProductItemWholesalePriceRequest(6, 17));
    request.getProductItemRequests().get(0).setProductItemWholesalePriceRequests(productItemWholesalePriceRequests);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_API).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
        equalTo(WHOLESALE_SETTING_MORE_THAN_6)))
        .andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithWholeSalePricelessThan2QuantityTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest1000MinPrice();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    List<ProductItemWholesalePriceRequest> productItemWholesalePriceRequests = new ArrayList<>();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(1);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest);
    request.getProductItemRequests().get(0).setProductItemWholesalePriceRequests(productItemWholesalePriceRequests);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
        equalTo(ProductControllerErrorMessage.MIN_QUANTITY_ALLOWED_FOR_WHOLESALE_PRICE_IS_2))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithWholeSalePricelessThan1000PriceTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest1000MinPrice();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    List<ProductItemWholesalePriceRequest> productItemWholesalePriceRequests = new ArrayList<>();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(90);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest);
    request.getProductItemRequests().get(0).setProductItemWholesalePriceRequests(productItemWholesalePriceRequests);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    Mockito.when(productService.getMinimumPrice(DEFAULT_STORE_ID)).thenReturn(1000);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
        equalTo(String.format(ErrorMessages.WHOLESALE_PRICE_CANT_BE_LESS_THAN_MINIMUM_PRICE, "1000")))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_2), any(ProductCreationRequest.class), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithWholeSalePriceInvalidTiersTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest1000MinPrice();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    List<ProductItemWholesalePriceRequest> productItemWholesalePriceRequests = new ArrayList<>();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(30);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest1.setQuantity(4);
    productItemWholesalePriceRequest1.setWholesaleDiscount(20);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest1);
    request.getProductItemRequests().get(0).setProductItemWholesalePriceRequests(productItemWholesalePriceRequests);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_API).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage", equalTo(
        ProductControllerErrorMessage.WHOLESALE_PRICE_TIER_RULE_VIOLATION))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    deleteDummyFiles(request.getProductItemRequests());
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_2), any(ProductCreationRequest.class), any());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithWholeSalePriceTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest1000MinPrice();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    List<ProductItemWholesalePriceRequest> productItemWholesalePriceRequests = new ArrayList<>();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(20);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest1.setQuantity(4);
    productItemWholesalePriceRequest1.setWholesaleDiscount(30);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest);
    productItemWholesalePriceRequests.add(productItemWholesalePriceRequest1);
    request.getProductItemRequests().get(0).setProductItemWholesalePriceRequests(productItemWholesalePriceRequests);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)))
        .andReturn();
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(wholesaleValidationUtil)
        .validateWholesaleConfigOnFlow1(any(), productItemsCaptor.capture(), eq(true));
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductWithoutImageTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest1000MinPrice();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(FLOW_2), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTest_trueWithNonEmptyDescriptiveAttriValue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue("test");
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_API).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTest_falseWithLongDescriptiveAttriValue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue(LONG_STRING);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTest_withInvalidMinimumPrice() throws Exception {
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ProductCreationRequest request = generateProductCreationRequest();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().get(0).setPrice(0.0);
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    verify(trackerService).trackProductCreationFailure(
        eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
  }

  @Test
  public void createProductTest_trueWithSkuValueTrue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue(LONG_STRING);
    request.getProductAttributes().get(0).getAttribute().setSkuValue(true);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_API).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();

    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  private ProductCreationRequest generateProductCreationRequestAtL5() {
    ProductCreationRequest productCreationRequest = generateProductCreationRequest();
    PickupPointCreateRequest pickupPointCreateRequest = new PickupPointCreateRequest();
    pickupPointCreateRequest.setPrice(1.0);
    pickupPointCreateRequest.setSalePrice(1.0);
    pickupPointCreateRequest.setPickupPointId("pickup-point");
    productCreationRequest.getProductItemRequests().get(0).setPickupPoints(
        Collections.singletonList(pickupPointCreateRequest));
    productCreationRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    return productCreationRequest;
  }

  private ProductCreationRequest generateProductCreationRequest() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DESCRIPTIVE_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest.setDescriptiveAttributeValue("");
    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest, "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    AttributeRequest attributeRequest2 = new AttributeRequest();
    attributeRequest2.setName(Constants.FAMILY_COLOUR);
    ProductItemAttributeValueRequest productItemAttributeValue = new ProductItemAttributeValueRequest();
    productItemAttributeValue.setAttribute(attributeRequest2);

    AttributeRequest attributeRequest3 = new AttributeRequest();
    attributeRequest3.setVariantCreation(true);
    attributeRequest3.setName(Constants.WARNA);
    ProductAttributeRequest productAttributeRequest1 = new ProductAttributeRequest();
    productAttributeRequest1.setAttribute(attributeRequest3);

    request.getProductItemRequests().get(0).setProductItemAttributeValueRequests(Arrays.asList(productItemAttributeValue));
    request.getProductAttributes().add(productAttributeRequest1);
    productItemAttributeValue.setValue(VALUE);
    return request;
  }

  private ProductCreationRequest generateProductCreationRequestWithWarnaAndWithFamilyColor() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(Constants.FAMILY_COLOUR);
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();

    AttributeRequest attributeRequest3 = new AttributeRequest();
    attributeRequest3.setVariantCreation(true);
    attributeRequest3.setName(Constants.WARNA);
    ProductAttributeRequest productAttributeRequest1 = new ProductAttributeRequest();
    productAttributeRequest1.setAttribute(attributeRequest3);

    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest3, Constants.WARNA, false, 1,
            ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequests = new ArrayList<>();
    productItemAttributeValueRequests.add(productItemAttributeValueRequest);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    productItemCreationRequest.setProductItemAttributeValueRequests(productItemAttributeValueRequests);
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }

  private ProductCreationRequest generateProductCreationRequestWithoutWarnaAndWithoutFamilyColor() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(Constants.DEFAULT);
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();

    AttributeRequest attributeRequest3 = new AttributeRequest();
    attributeRequest3.setVariantCreation(true);
    attributeRequest3.setName(Constants.WARNA);
    ProductAttributeRequest productAttributeRequest1 = new ProductAttributeRequest();
    productAttributeRequest1.setAttribute(attributeRequest3);

    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest3, "Attribute1", false, 1, ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequests = new ArrayList<>();
    productItemAttributeValueRequests.add(productItemAttributeValueRequest);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    productItemCreationRequest.setProductItemAttributeValueRequests(productItemAttributeValueRequests);
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }

  private ProductCreationRequest generateProductCreationRequestWithoutWarnaAndWithFamilyColor() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(Constants.FAMILY_COLOUR);
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();

    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest, "Attribute1", false, 1, ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequests = new ArrayList<>();
    productItemAttributeValueRequests.add(productItemAttributeValueRequest);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    productItemCreationRequest.setProductItemAttributeValueRequests(productItemAttributeValueRequests);
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }

  private ProductCreationRequest generateProductCreationRequestWithoutWarnaAndWithFamilyColorNull() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(null);
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();

    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest, "Attribute1", false, 1, ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequests = new ArrayList<>();
    productItemAttributeValueRequests.add(productItemAttributeValueRequest);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    productItemCreationRequest.setProductItemAttributeValueRequests(productItemAttributeValueRequests);
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }

  private ProductCreationRequest generateProductCreationRequestWithoutWarnaAndDuplicateAttributes() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories()
      .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(null);
    attributeRequest.setAttributeCode(ATTRIBUTE_CODE);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();

    ProductAttributeRequest productAttributeRequest =
      new ProductAttributeRequest(attributeRequest, "Attribute1", false, 1, ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest.setAttribute(attributeRequest);
    ProductItemAttributeValueRequest productItemAttributeValueRequest2 =
      new ProductItemAttributeValueRequest();
    productItemAttributeValueRequest2.setAttribute(attributeRequest);
    List<ProductItemAttributeValueRequest> productItemAttributeValueRequests = new ArrayList<>();
    productItemAttributeValueRequests.add(productItemAttributeValueRequest);
    productItemAttributeValueRequests.add(productItemAttributeValueRequest2);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    productItemCreationRequest.setProductItemAttributeValueRequests(productItemAttributeValueRequests);
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }


  private ProductCreationRequest generateProductCreationRequest1000MinPrice() {
    ProductCreationRequest request = new ProductCreationRequest();
    request.setBusinessPartnerCode(DEFAULT_BP_CODE);
    request.setBrand(BRAND);
    request.setBrandCode(BRAND_CODE);
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.getProductCategories().add(
        new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setAttributeType(DESCRIPTIVE_ATTRIBUTE);
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest.setDescriptiveAttributeValue("");
    ProductAttributeRequest productAttributeRequest =
        new ProductAttributeRequest(attributeRequest, "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID);
    List<ProductAttributeValueRequest> productAttributeValueRequests = new ArrayList<>();
    productAttributeValueRequests.add(productAttributeValueRequest);
    this.productRequest.getProductAttributes().add(productAttributeRequest);
    productAttributeRequest.setProductAttributeValues(productAttributeValueRequests);
    BeanUtils.copyProperties(productRequest, request);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1800.0);
    productItemCreationRequest.setSalePrice(1800.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    List<ProductItemCreationRequest> productItemCreationRequests = new ArrayList<>();
    productItemCreationRequests.add(productItemCreationRequest);
    request.setProductItemRequests(productItemCreationRequests);
    return request;
  }


  @Test
  public void getProductCodeSequenceTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    Mockito.when(productService.generateProductCode()).thenReturn("test");
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_PRODUCT_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)))
        .andExpect(jsonPath("$.value", equalTo("test"))).andReturn();
    Mockito.verify(productService).generateProductCode();
  }

  @Test
  public void getProductCodeSequenceTest_failed() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    Mockito.when(productService.generateProductCode()).thenThrow(new ApplicationRuntimeException());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GENERATE_PRODUCT_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService).generateProductCode();
  }

  @Test
  public void updateActivatedProductsBulkMasterDataTest() throws Exception {
    BulkMasterProductUpdateRequest request = new BulkMasterProductUpdateRequest();
    request.setUpdatedBy(DEFAULT_USERNAME);
    request.setUpdatedDate(Calendar.getInstance().getTime());
    SimpleMasterProductUpdateRequest simpleMasterProductUpdateRequest =
        new SimpleMasterProductUpdateRequest.Builder().productCode(PRODUCT_CODE).name(PRODUCT_NAME)
            .length(LENGTH).width(WIDTH).height(HEIGHT).weight(WEIGHT).dangerousGoodsLevel(DANGEROUS_GOODS_LEVEL)
            .brand(BRAND).build();
    request.setSimpleMasterProductUpdateRequests(Collections.singletonList(simpleMasterProductUpdateRequest));
    SimpleMasterProductUpdateResponse simpleMasterProductUpdateResponse =
        new SimpleMasterProductUpdateResponse.Builder().productCode(PRODUCT_CODE).updateSuccess(Boolean.TRUE)
            .build();
    BulkMasterProductUpdateResponse response = new BulkMasterProductUpdateResponse();
    response.setSimpleMasterProductUpdateResponses(Collections.singletonList(simpleMasterProductUpdateResponse));
    Mockito.when(productServiceWrapper.bulkUpdateActivatedProducts(
        any(BulkMasterProductUpdateRequestDTO.class), any())).thenReturn(response);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_ACTIVATED_PRODUCTS_BULK_MASTER_DATA)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productServiceWrapper).bulkUpdateActivatedProducts(
        bulkMasterProductUpdateRequestDTOArgumentCaptor.capture(), eq(DEFAULT_STORE_ID));
    assertEquals(PRODUCT_CODE, bulkMasterProductUpdateRequestDTOArgumentCaptor.getValue()
        .getSimpleMasterProductUpdateRequestDTOS().get(0).getProductCode());
  }

  @Test
  public void updateActivatedProductsBulkMasterData_BlankRequestListTest() throws Exception {
    BulkMasterProductUpdateRequest request = new BulkMasterProductUpdateRequest();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_ACTIVATED_PRODUCTS_BULK_MASTER_DATA)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(Exception.class, () -> {
      this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
              .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    });
  }

  @Test
  public void updateActivatedProductsBulkMasterData_BlankUpdateByTest() throws Exception {
    BulkMasterProductUpdateRequest request = new BulkMasterProductUpdateRequest();
    SimpleMasterProductUpdateRequest simpleMasterProductUpdateRequest = new SimpleMasterProductUpdateRequest();
    request.setSimpleMasterProductUpdateRequests(Collections.singletonList(simpleMasterProductUpdateRequest));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_ACTIVATED_PRODUCTS_BULK_MASTER_DATA)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Assertions.assertThrows(Exception.class, () -> {
      this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
              .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
          .andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    });
  }

  @Test
  public void getStuckProductsTest() throws Exception {
    StuckProductResponse stuckProductResponse = getStuckProductResponse();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_STUCK_PRODUCTS)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("retryBatchSizeCount", String.valueOf(ProductControllerTest.RETRY_BATCH_SIZE_COUNT)).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(productServiceWrapper).getStuckProductCodeAndState(RETRY_BATCH_SIZE_COUNT);
  }

  @Test
  public void getStuckProducts_DefaultSizeTest() throws Exception {
    StuckProductResponse stuckProductResponse = getStuckProductResponse();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_STUCK_PRODUCTS)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE)).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(productServiceWrapper).getStuckProductCodeAndState(RETRY_BATCH_SIZE_COUNT);
  }

  private StuckProductResponse getStuckProductResponse() {
    List<ProductWfStateResponse> productWfStateResponseList = new ArrayList<>();
    ProductWfStateResponse productWfStateResponse = new ProductWfStateResponse();
    productWfStateResponse.setProductCode(DEFAULT_PRODUCT_CODE);
    productWfStateResponse.setState(STATE);
    productWfStateResponseList.add(productWfStateResponse);
    return new StuckProductResponse(
        productWfStateResponseList,
        TOTAL_STUCK_PRODUCTS,
        productWfStateResponseList);
  }

  @Test
  public void getStuckProductsTest_Exception() throws Exception {
    Mockito.doThrow(ApplicationRuntimeException.class).when(productServiceWrapper)
        .getStuckProductCodeAndState(RETRY_BATCH_SIZE_COUNT);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_STUCK_PRODUCTS)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("page", String.valueOf(ProductControllerTest.DEFAULT_PAGE))
        .addParameter("retryBatchSizeCount", String.valueOf(ProductControllerTest.RETRY_BATCH_SIZE_COUNT)).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(productServiceWrapper).getStuckProductCodeAndState(RETRY_BATCH_SIZE_COUNT);
  }

  @Test
  public void doScreeningProductsBulkActionsTest() throws Exception {
    ScreeningProductBulkActionsRequest request = new ScreeningProductBulkActionsRequest();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.SCREENING_PRODUCTS_BULK_ACTIONS
            .replaceAll("\\{actionType\\}", BulkActionType.ASSIGN.getBulkActionName()))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).doScreeningProductsBulkActions(DEFAULT_STORE_ID, BulkActionType.ASSIGN, request);
  }


  @Test
  public void doScreeningProductsBulkActionsTest_WrongActionType() throws Exception {
    ScreeningProductBulkActionsRequest request = new ScreeningProductBulkActionsRequest();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.SCREENING_PRODUCTS_BULK_ACTIONS
            .replaceAll("\\{actionType\\}", "random"))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
  }

  @Test
  public void getProductRevisionHistoryTest() throws Exception {
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_REVISION_HISTORY
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).getProductRevisionInfo(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void getProductRevisionHistoryExceptionTest() throws Exception {
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_REVISION_HISTORY
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    doThrow(ApplicationRuntimeException.class).when(productServiceWrapper)
        .getProductRevisionInfo(DEFAULT_STORE_ID, PRODUCT_CODE);
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).getProductRevisionInfo(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void getScreenerNotesTest() throws Exception {
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_SCREENER_NOTES
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).getScreeningNotes(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void generateQRCodeNotificationTest() throws Exception {
    Mockito.doNothing().when(productNotificationService).sendProductQRCodeDownloadNotification(BUSINESS_PARTNER_CODE, FILEPATH);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.QR_CODE_NOTIFICATION)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("businessPartnerCode", BUSINESS_PARTNER_CODE )
        .addParameter("filePath", FILEPATH).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(productNotificationService).sendProductQRCodeDownloadNotification(BUSINESS_PARTNER_CODE, FILEPATH);
  }

  @Test
  public void generateQRCodeNotificationExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productNotificationService).sendProductQRCodeDownloadNotification(BUSINESS_PARTNER_CODE, FILEPATH);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.QR_CODE_NOTIFICATION)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("businessPartnerCode", BUSINESS_PARTNER_CODE )
        .addParameter("filePath", FILEPATH).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(productNotificationService).sendProductQRCodeDownloadNotification(BUSINESS_PARTNER_CODE, FILEPATH);
  }

  @Test
  public void resizeImageTest() throws Exception {
    Mockito.doNothing().when(productServiceWrapper).resizeImages(DEFAULT_STORE_ID, PRODUCT_CODE, false, PAGE, SIZE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ROOT + RESIZE_IMAGE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("productCode", PRODUCT_CODE)
        .addParameter("page", String.valueOf(PAGE))
        .addParameter("size", String.valueOf(SIZE))
        .build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(productServiceWrapper).resizeImages(DEFAULT_STORE_ID, PRODUCT_CODE, false, PAGE, SIZE);
  }

  @Test
  public void resizeImageExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper).resizeImages(DEFAULT_STORE_ID, PRODUCT_CODE, false, PAGE, SIZE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ROOT + RESIZE_IMAGE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("productCode", PRODUCT_CODE)
        .addParameter("page", String.valueOf(PAGE))
        .addParameter("size", String.valueOf(SIZE))
        .build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(productServiceWrapper).resizeImages(DEFAULT_STORE_ID, PRODUCT_CODE, false, PAGE, SIZE);
  }

  @Test
  public void getProductsByFilterTest() throws Exception {
    Mockito.when(this.productService
        .getProductListFilter(DEFAULT_STORE_ID, new ProductFilterRequest(), DEFAULT_PAGE, DEFAULT_SIZE))
        .thenReturn(new PageImpl<>(new ArrayList<>(), PageRequest.of(0, 1), DEFAULT_SIZE));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_FILTER)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(new ProductFilterRequest())))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productService)
        .getProductListFilter(DEFAULT_STORE_ID, new ProductFilterRequest(), DEFAULT_PAGE, DEFAULT_SIZE);
  }

  @Test
  public void getProductsByFilter_expectExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .getProductListFilter(DEFAULT_STORE_ID, new ProductFilterRequest(), DEFAULT_PAGE, DEFAULT_SIZE);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.PRODUCT_FILTER)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(new ProductFilterRequest())))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productService)
        .getProductListFilter(DEFAULT_STORE_ID, new ProductFilterRequest(), DEFAULT_PAGE, DEFAULT_SIZE);
  }

  @Test
  public void createProductTest_withWarnaAndFamilyColourField() throws Exception {
    ReflectionTestUtils.setField(productController, "familyColourValidationSwitch", true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxWholesalePriceRequests", 1000);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.setProductItemRequests(new ArrayList<>());
    request.setProductAttributes(new ArrayList<>());
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setName(Constants.WARNA);
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest
        .setAllowedAttributeValue(new AllowedAttributeValueRequest(Constants.DEFAULT, 0, DEFAULT_STORE_ID));
    productAttributeRequest.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest));
    productAttributeRequest.setAttribute(attributeRequest);
    request.getProductAttributes().add(productAttributeRequest);
    ProductItemAttributeValueRequest productItemAttributeValueRequest = new ProductItemAttributeValueRequest();
    AttributeRequest attributeRequest1 = new AttributeRequest();
    attributeRequest1.setName(Constants.FAMILY_COLOUR);
    productItemAttributeValueRequest.setValue("FC");
    productItemAttributeValueRequest.setAttribute(attributeRequest1);
    ProductItemCreationRequest productItemCreationRequest = new ProductItemCreationRequest();
    productItemCreationRequest.setProductItemAttributeValueRequests(new ArrayList<>());
    productItemCreationRequest.getProductItemAttributeValueRequests().add(productItemAttributeValueRequest);
    List<Image> images = new ArrayList<>();
    Image image = new Image();
    image.setLocationPath("image1");
    images.add(image);
    productItemCreationRequest.setImages(images);
    productItemCreationRequest.setPrice(1.0);
    productItemCreationRequest.setSalePrice(1.0);
    productItemCreationRequest.setPickupPointId("pickup-point");
    request.getProductItemRequests().add(productItemCreationRequest);
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    generateDummyImageFiles(request.getProductItemRequests());
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
     }

  @Test
  public void updateProductCategoryTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_CATEGORY
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("categoryCode", ProductControllerTest.CATEGORY_1).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productServiceWrapper).updateProductCategory(DEFAULT_STORE_ID, PRODUCT_CODE, CATEGORY_1, true);
  }

  @Test
  public void updateReviewTypeTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_REVIEW_TYPE
            .replaceAll("\\{productCode\\}", PRODUCT_CODE).replaceAll("\\{reviewType\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("categoryCode", ProductControllerTest.CATEGORY_1).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productService).updateReviewType(DEFAULT_STORE_ID, PRODUCT_CODE, PRODUCT_CODE);
  }

  @Test
  public void updateProductCategoryExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper)
        .updateProductCategory(DEFAULT_STORE_ID, PRODUCT_CODE, CATEGORY_1, true);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_CATEGORY
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("categoryCode", ProductControllerTest.CATEGORY_1).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productServiceWrapper).updateProductCategory(DEFAULT_STORE_ID, PRODUCT_CODE, CATEGORY_1, true);
  }

  @Test
  public void updateProductCategoryApplcautionRuntimeExceptionTest() throws Exception {
    ApplicationRuntimeException applicationRuntimeException = new ApplicationRuntimeException();
    applicationRuntimeException.setErrorCodes(ErrorCategory.VALIDATION);
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper)
        .updateProductCategory(DEFAULT_STORE_ID, PRODUCT_CODE, CATEGORY_1, true);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PRODUCT_CATEGORY
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("categoryCode", ProductControllerTest.CATEGORY_1).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productServiceWrapper).updateProductCategory(DEFAULT_STORE_ID, PRODUCT_CODE, CATEGORY_1, true);
  }

  @Test
  public void productItemRequestValidationForCreateProductTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductItemRequests().get(0).getImages().clear();
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(ProductControllerErrorMessage.PRODUCT_ITEM_DETAILS_MUST_NOT_BE_BLANK));
      Mockito.verify(this.productWorkflowService, ProductControllerTest.NEVER_CALLED)
          .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
              any(ProductRequest.class));
      Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      verify(trackerService).trackProductCreationFailure(
          eq(DEFAULT_REQUEST_ID), eq(null), any(ProductCreationRequest.class), any());
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    }
  }

  @Test
  public void createProductTestDescriptiveMandatoryAttributeEmptyValue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue(StringUtils.EMPTY);
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(Constants.DESCRIPTIVE_MANDATORY_MUST_NOT_NULL));
      Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      deleteDummyFiles(request.getProductItemRequests());
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
      }
  }

  @Test
  public void createProductTestDescriptiveNonMandatoryAttributeEmptyValue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setDescriptiveAttributeValue(StringUtils.EMPTY);
    request.getProductAttributes().get(0).getAttribute().setMandatory(false);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
/*    Assertions.assertEquals(Constants.DELIMITER_DASH,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getProductAttributeValues().get(0)
            .getDescriptiveAttributeValue());*/
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestDescriptiveWarnaAttribute() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setVariantCreation(true);
    request.getProductAttributes().get(0).getAttribute().setName("Warna");
    request.getProductAttributes().get(0).getProductAttributeValues().get(0).setDescriptiveAttributeValue(VALUE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Assertions.assertEquals(true,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().get(0).getAttribute().isVariantCreation());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestPredefinedNonMandatoryAttributeEmptyValue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(false);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(PREDEFINED_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0).setPredefinedAllowedAttributeValue(
        new PredefinedAllowedAttributeValueRequest(StringUtils.EMPTY, 0, DEFAULT_STORE_ID));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestPredefinedMandatoryAttributeEmptyValue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(PREDEFINED_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0).setPredefinedAllowedAttributeValue(
        new PredefinedAllowedAttributeValueRequest(Constants.DELIMITER_DASH, 0, DEFAULT_STORE_ID));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(Constants.PREDEFINED_MANDATORY_MUST_NOT_NULL_OR_INVALID));
    } finally {
      Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      deleteDummyFiles(request.getProductItemRequests());
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
      }
  }

  @Test
  public void createProductTestPredefinedMandatoryAttributeEmptyValueFlow3() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    profileResponse.setBusinessPartnerCode(Constants.INTERNAL);
    request.setBusinessPartnerCode(null);
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    request.getProductAttributes().get(0).getAttribute().setSkuValue(true);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(PREDEFINED_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0).setPredefinedAllowedAttributeValue(
        new PredefinedAllowedAttributeValueRequest(StringUtils.EMPTY, 0, DEFAULT_STORE_ID));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductTestDefiningAttributeEmptyValue() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    ProductAttributeValueRequest productAttributeValueRequest = new ProductAttributeValueRequest();
    productAttributeValueRequest
        .setAllowedAttributeValue(new AllowedAttributeValueRequest(StringUtils.EMPTY, 0, DEFAULT_STORE_ID));
    productAttributeRequest.setProductAttributeValues(Collections.singletonList(productAttributeValueRequest));
    productAttributeRequest.setAttribute(attributeRequest);
    request.getProductAttributes().add(productAttributeRequest);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(DEFINING_ATTRIBUTE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(Constants.DEFINING_ATTRIBUTE_VALUE_MUST_NOT_NULL));
      Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      deleteDummyFiles(request.getProductItemRequests());
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createProductTestDescriptiveMandatoryAttributeEmptyValueFlow3() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    profileResponse.setBusinessPartnerCode(Constants.INTERNAL);
    request.setBusinessPartnerCode(null);
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    request.getProductAttributes().get(0).getAttribute().setSkuValue(true);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(DESCRIPTIVE_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0).setPredefinedAllowedAttributeValue(
        new PredefinedAllowedAttributeValueRequest(StringUtils.EMPTY, 0, DEFAULT_STORE_ID));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    when(productService.getProfileResponse(anyString())).thenReturn(profileResponse);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).build();
    ObjectMapper objectMapper = new ObjectMapper();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void createProductTestDefiningAttributeEmpty() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    AttributeRequest attributeRequest = new AttributeRequest();
    attributeRequest.setAttributeType(DEFINING_ATTRIBUTE);
    ProductAttributeRequest productAttributeRequest = new ProductAttributeRequest();
    productAttributeRequest.setAttribute(attributeRequest);
    request.getProductAttributes().add(productAttributeRequest);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(DEFINING_ATTRIBUTE);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(Constants.DEFINING_ATTRIBUTE_MUST_NOT_NULL));
      Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      deleteDummyFiles(request.getProductItemRequests());
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void getMinimumPriceTest() throws Exception {
    Mockito.when(this.productService.getMinimumPrice(DEFAULT_STORE_ID)).thenReturn(1);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MINIMUM_PRICE)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productService).getMinimumPrice(DEFAULT_STORE_ID);
  }

  @Test
  public void getMinimumPriceExceptionTest() throws Exception {
    MvcResult result = null;
    Mockito.doThrow(ApplicationRuntimeException.class).when(this.productService).getMinimumPrice(DEFAULT_STORE_ID);
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.MINIMUM_PRICE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    try {
      result = getMockMvc().perform(
          MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (ApplicationRuntimeException e) {
      Assertions.assertEquals(0, result.getResponse().getStatus());
    } finally {
      Mockito.verify(this.productService).getMinimumPrice(DEFAULT_STORE_ID);
    }
  }

  @Test
  public void createProductTest_logisticUpdateFailed() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    generateDummyImageFiles(request.getProductItemRequests());
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
            .setDescriptiveAttributeValue(LONG_STRING);
    request.getProductAttributes().get(0).getAttribute().setSkuValue(true);
    Mockito.when(productWorkflowServiceWrapper.create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class),
      eq(false), eq(false), any())).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    URI uri = new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest -> productItemCreationRequest.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
            .andExpect(MockMvcResultMatchers.status().isOk())
            .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
            .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
            .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  private void generateDummyImageFiles(List<ProductItemCreationRequest> productItemCreationRequests) {
    productItemCreationRequests.forEach(productItemRequest -> {
      productItemRequest.getImages().forEach(image -> {
        try {
          new File(SOURCE_DIRECTORY, FilenameUtils.getName(image.getLocationPath())).createNewFile();
        } catch (IOException e) {
          e.printStackTrace();
        }
      });
    });
  }

  private void deleteDummyFiles(List<ProductItemCreationRequest> productItemCreationRequests) {
    productItemCreationRequests.forEach(productItemRequest -> {
      productItemRequest.getImages().forEach(image -> {
        new File(SOURCE_DIRECTORY, FilenameUtils.getName(image.getLocationPath())).delete();
      });
    });
  }

  private ProductRequest getProductRequest() {
    this.productRequest.setId(UUID.randomUUID().toString());
    this.productRequest.setCreatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setCreatedDate(Calendar.getInstance().getTime());
    this.productRequest.setUpdatedBy(ProductControllerTest.DEFAULT_USERNAME);
    this.productRequest.setUpdatedDate(Calendar.getInstance().getTime());
    this.productRequest.setSpecificationDetail("Spesifikasi Detail");
    this.productRequest.setNotes(NOTES);
    this.productRequest.setBrand(BRAND);
    this.productRequest.setBrandCode(BRAND_CODE);
    this.productRequest.setBrandApprovalStatus(BRAND_APPROVAL_STATUS);
    this.productRequest.setUrl(YOUTUBE_INVALID_URL);
    this.productRequest.getProductCategories()
        .add(new ProductCategoryRequest(new CategoryRequest(), ProductControllerTest.DEFAULT_STORE_ID));
    this.productRequest.getProductAttributes().add(
        new ProductAttributeRequest(new AttributeRequest(), "Attribute 1", false, 1,
            ProductControllerTest.DEFAULT_STORE_ID));
    return productRequest;
  }

  private Product getProduct(ProductRequest productRequest) {
    Product product = new Product();
    BeanUtils.copyProperties(this.productRequest, product, "productCategories", "productAttributes");
    for (ProductCategoryRequest productCategoryRequest : this.productRequest.getProductCategories()) {
      ProductCategory productCategory = new ProductCategory();
      Category category = new Category();
      BeanUtils.copyProperties(productCategoryRequest, productCategory);
      BeanUtils.copyProperties(productCategoryRequest.getCategory(), category);
      productCategory.setCategory(category);
      product.getProductCategories().add(productCategory);
    }
    for (ProductAttributeRequest productAttributeRequest : this.productRequest.getProductAttributes()) {
      ProductAttribute productAttribute = new ProductAttribute();
      Attribute attribute = new Attribute();
      BeanUtils.copyProperties(productAttributeRequest, productAttribute);
      BeanUtils.copyProperties(productAttributeRequest.getAttribute(), attribute);
      productAttribute.setAttribute(attribute);
      product.getProductAttributes().add(productAttribute);
    }
    return product;
  }

  @Test
  public void createProductTestDefiningNonMandatoryAttributeEmptyValue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(false);
    request.getProductAttributes().get(0).getAttribute().setVariantCreation(true);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(DEFINING_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setAllowedAttributeValue((new AllowedAttributeValueRequest(StringUtils.EMPTY, 1, DEFAULT_STORE_ID)));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW2").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON).content(objectMapper.writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), productCreationRequestArgumentCaptor.capture(), eq(false), eq(false), any());
/*    Assertions.assertEquals(1,
        productCreationRequestArgumentCaptor.getValue().getProductAttributes().size());*/
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void createProductTestDefiningMandatoryAttributeEmptyValue() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.getProductAttributes().get(0).getAttribute().setMandatory(true);
    request.getProductAttributes().get(0).getAttribute().setVariantCreation(true);
    request.getProductAttributes().get(0).getAttribute().setAttributeType(DEFINING_ATTRIBUTE);
    request.getProductAttributes().get(0).getProductAttributeValues().get(0)
        .setAllowedAttributeValue((new AllowedAttributeValueRequest(StringUtils.EMPTY, 1, DEFAULT_STORE_ID)));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, null)).thenReturn(true);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    ObjectMapper objectMapper = new ObjectMapper();
    try {
      this.mockMvc.perform(
          MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
              .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(Constants.DEFINING_ATTRIBUTE_VALUE_MUST_NOT_NULL));
      Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    } finally {
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
      Mockito.verify(productSystemParameterService)
          .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
      deleteDummyFiles(request.getProductItemRequests());
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(null), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createWithUSPMoreThan400CharactersTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    request.setUniqueSellingPoint(USP_WITH_MORE_THAN_400_CHARACTERS);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW1").build();
    try {
      getMockMvc()
          .perform(
              MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                  .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(e.getMessage().contains(
          ProductControllerErrorMessage.UNIQUE_SELLING_POINT_MUST_NOT_BE_MORE_THAN_400_CHARACTERS));
    } finally {
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createProductWithUSPWithSpecialCharactersAndSpaceTest() throws Exception {
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ProductCreationRequest request = generateProductCreationRequest();
    request.setUniqueSellingPoint(USP_WITH_SPECIAL_CHARACTERS_AND_SPACES);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, false, profileResponse)).thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any())).thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    deleteDummyFiles(request.getProductItemRequests());
    Mockito.verify(productWorkflowServiceWrapper)
        .create(eq(DEFAULT_STORE_ID), any(ProductCreationRequest.class), eq(false), eq(false), any());
    Mockito.verify(productService).getMinimumPrice(DEFAULT_STORE_ID);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
    Mockito.verify(productOutbound).validCnCategory(any());
  }

  @Test
  public void rollbackMigratedProductSkuTest() throws Exception {
    Mockito.doNothing().when(productMigrationWrapperService).updateMigratedProductCode(Arrays.asList(PRODUCT_SKU));
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.ROLLBACK_MIGRATED_PRODUCT_SKU)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(new ObjectMapper().writeValueAsString(Arrays.asList(PRODUCT_SKU))))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(productMigrationWrapperService).updateMigratedProductCode(Arrays.asList(PRODUCT_SKU));
  }

  @Test
  public void rollbackMigratedProductSkuExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productMigrationWrapperService)
        .updateMigratedProductCode(Arrays.asList(PRODUCT_SKU));
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.ROLLBACK_MIGRATED_PRODUCT_SKU)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(new ObjectMapper().writeValueAsString(Arrays.asList(PRODUCT_SKU))))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(productMigrationWrapperService).updateMigratedProductCode(Arrays.asList(PRODUCT_SKU));
  }

  @Test
  public void createWithDescriptionMoreThan5000CharactersTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    String randomString = RandomStringUtils.randomAlphanumeric(6000); // Generate a random string
    String htmlString = "<p><strong>This is a random string: " + randomString + "</p></strong>";
    request.setDescription(htmlString.getBytes(StandardCharsets.UTF_8));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW1").build();
    try {
      getMockMvc().perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
          .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(
          e.getMessage().contains(ProductControllerErrorMessage.DESCRIPTION_MUST_NOT_BE_MORE_THAN_MAX_CHARACTERS));
    } finally {
      verify(trackerService).trackProductCreationFailure(
          eq(getRequestId()), eq(FLOW_1), any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createWithDescriptionMoreThan5000CharactersWithoutFormattingTest() throws Exception {
    ProductCreationRequest request = generateProductCreationRequest();
    String randomString = RandomStringUtils.randomAlphanumeric(200);
    String htmlString = "<p><strong>This is a random string: " + randomString + "</p></strong>";
    request.setDescription(htmlString.getBytes(StandardCharsets.UTF_8));
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("flowType", "FLOW1").build();
    try {
      ReflectionTestUtils.setField(productController, "maximumCharactersInDescription", 230);
      ReflectionTestUtils.setField(productController, "maximumCharactersWithoutFormattingDescription", 248);
      getMockMvc().perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
              .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk());
    } catch (Exception e) {
      assertTrue(
          e.getMessage().contains(ProductControllerErrorMessage.CHARACTER_LIMIT_REACHED_PLEASE_REDUCE_FORMATTING));
    } finally {
      verify(trackerService).trackProductCreationFailure(eq(getRequestId()), eq(FLOW_1),
          any(ProductCreationRequest.class), any());
    }
  }

  @Test
  public void createBulkUploadProductWithDescription500CharactersIncludingParagraphTagsTest() throws Exception {
    CreateProductRequest request = generateCreateProductRequest();
    request.setDescription(DESCRIPTION_WITH_PARAGRAPH_TAGS.getBytes());
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, BULK_CLIENT_ID);
    URI uri =
        new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_PRODUCT)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", ProductControllerTest.DEFAULT_REQUEST_ID)
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc()
        .perform(
            MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
                .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk());
    Mockito.verify(this.productWorkflowService)
        .create(any(), any(), eq(ProductCreationType.UNIFIED_BULK_UPLOAD),
            any(ProductRequest.class));
    Mockito.verify(this.productWorkflowService).createDirect(any());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.VALID_IMAGE_EXTENSION);
  }

  @Test
  public void retryResizeEdtiedImagesTest() throws Exception {
    Mockito.doNothing().when(productWorkflowService).retryResizeEditedImages(PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.RETRY_RESIZE_EDITED_IMAGE
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.put(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productWorkflowService).retryResizeEditedImages(PRODUCT_CODE);
  }

  @Test
  public void retryResizeEdtiedImagesExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productWorkflowService).retryResizeEditedImages(PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.RETRY_RESIZE_EDITED_IMAGE
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
      this.mockMvc.perform(MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk())
          .andExpect(jsonPath("$.success", equalTo(false)))
          .andReturn();
      verify(this.productWorkflowService).retryResizeEditedImages(PRODUCT_CODE);
  }

  @Test
  public void getProductSkusByProductCodeTest() throws Exception {
    when(productBusinessPartnerService.getProductSkusByProductCode(PRODUCT_CODE)).thenReturn(productSkus);
    GdnRestSimpleResponse<ProductSkuResponseList> L3s =
        new GdnRestSimpleResponse<>(null, null, true, requestId, new ProductSkuResponseList(productSkus));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCT_SKUS_BY_PRODUCT_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).addParameter("productCode", PRODUCT_CODE)
        .build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(L3s), result.getResponse().getContentAsString());
    verify(productBusinessPartnerService).getProductSkusByProductCode(PRODUCT_CODE);
  }

  @Test
  public void getProductSkusByProductCode_ExceptionTest() throws Exception {
    doThrow(RuntimeException.class).when(productBusinessPartnerService).getProductSkusByProductCode(PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCT_SKUS_BY_PRODUCT_CODE)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.MTA_APP).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).addParameter("productCode", PRODUCT_CODE)
        .build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(MockMvcResultMatchers.jsonPath("$.success", equalTo(false))).andReturn();
    verify(productBusinessPartnerService).getProductSkusByProductCode(PRODUCT_CODE);
  }

  @Test
  public void publishEditedEventTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_EDITED_EVENT
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("reviewType", EditedReviewTypeConstants.CONTENT_EDIT).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productService)
        .publishEditedProduct(DEFAULT_STORE_ID, PRODUCT_CODE, EditedReviewTypeConstants.CONTENT_EDIT);
  }

  @Test
  public void publishEditedEventExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productService)
        .publishEditedProduct(DEFAULT_STORE_ID, PRODUCT_CODE, EditedReviewTypeConstants.CONTENT_EDIT);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_EDITED_EVENT
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("reviewType", EditedReviewTypeConstants.CONTENT_EDIT).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productService)
        .publishEditedProduct(DEFAULT_STORE_ID, PRODUCT_CODE, EditedReviewTypeConstants.CONTENT_EDIT);
  }

  @Test
  public void publishRevisedEventTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_REVISION_EVENT
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productServiceWrapper)
        .publishRevisedEvent(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void publishRevisedEventExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper)
        .publishRevisedEvent(DEFAULT_STORE_ID, PRODUCT_CODE);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_REVISION_EVENT
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productServiceWrapper)
        .publishRevisedEvent(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void publishEditedEventInvalidReviewTypeTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.PUBLISH_EDITED_EVENT
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("reviewType", PRODUCT_CODE)
        .build();
    this.mockMvc.perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
  }

  @Test
  public void filterProductDetailWithPreOrderByProductCodeTest() throws Exception {
    ProductDetailResponse savedProduct = getProductDetailResponse();
    savedProduct.setPostLive(true);
    BeanUtils.copyProperties(savedProduct, productDetailCompleteResponse);
    productDetailCompleteResponse.setPreOrder(preOrderResponse);
    GdnRestSingleResponse<ProductDetailCompleteResponse> response =
        new GdnRestSingleResponse<>(null, null, true, productDetailCompleteResponse, this.requestId);
    when(getProductService()
        .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE))
        .thenReturn(productDetailCompleteResponse);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute = new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.DETAIL_FILTER_PRODUCT_CODE
            .replaceAll("\\{productCode\\}", savedProduct.getProductCode()))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("businessPartnerCode", BUSINESS_PARTNER_CODE).build();
    MvcResult result = getMockMvc().perform(
        MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    assertEquals(getObjectMapper().writeValueAsString(response), result.getResponse().getContentAsString());
    assertTrue(response.getValue().isPostLive());
    verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
        .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE);
    assertTrue(response.getValue().getPreOrder().getIsPreOrder());
    assertEquals(PREORDER_DAYS_TYPE, response.getValue().getPreOrder().getPreOrderType());
    assertEquals(PREORDER_VALUE, response.getValue().getPreOrder().getPreOrderValue());
  }

  @Test
  public void filterProductDetailWithPreOrderByProductCodeWithExceptionTest() throws Exception {
    ProductDetailResponse savedProduct = getProductDetailResponse();
    savedProduct.setPostLive(true);
    BeanUtils.copyProperties(savedProduct, productDetailCompleteResponse);
    productDetailCompleteResponse.setPreOrder(preOrderResponse);
    when(getProductService()
        .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE))
        .thenReturn(productDetailCompleteResponse);
    List<ProductBusinessPartnerAttribute> productBusinessPartnerAttributeList = new ArrayList<>();
    ProductBusinessPartnerAttribute productBusinessPartnerAttribute = new ProductBusinessPartnerAttribute();
    productBusinessPartnerAttribute.setValue("Value");
    productBusinessPartnerAttribute.setCreatedBy("User");
    productBusinessPartnerAttribute.setCreatedDate(new Date());
    productBusinessPartnerAttribute.setAttributeId("ID");
    productBusinessPartnerAttributeList.add(productBusinessPartnerAttribute);
    Mockito.when(this.productBusinessPartnerService
        .getSkuValueTrueAttributeList(Mockito.anyList(), any()))
        .thenReturn(productBusinessPartnerAttributeList);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.DETAIL_FILTER_PRODUCT_CODE
            .replaceAll("\\{productCode\\}", savedProduct.getProductCode()))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("businessPartnerCode", BUSINESS_PARTNER_CODE).build();
    try {
      getMockMvc().perform(
          MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
          .andExpect(MockMvcResultMatchers.status().isOk()).andReturn();
    } catch (Exception e) {
      verify(getProductService(), ProductControllerTest.AT_LEAST_ONE)
          .findProductDetailWithPreOrderByProductCode(DEFAULT_STORE_ID, savedProduct.getProductCode(), false, BUSINESS_PARTNER_CODE);
    }
  }

  @Test
  public void getVendorNotesTest() throws Exception {
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_VENDOR_NOTES
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).getVendorNotes(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void getVendorNotesExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productServiceWrapper)
        .getVendorNotes(DEFAULT_STORE_ID, PRODUCT_CODE);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_VENDOR_NOTES
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).getVendorNotes(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void updateVendorNotesTest() throws Exception {
    VendorNotesRequest request = new VendorNotesRequest();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_VENDOR_NOTES
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.put(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).updateVendorNotes(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE), any());
  }

  @Test
  public void updateVendorNotesExceptionTest() throws Exception {
    VendorNotesRequest request = new VendorNotesRequest();
    Mockito.doThrow(RuntimeException.class).when(this.productServiceWrapper)
        .updateVendorNotes(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE), any());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_VENDOR_NOTES
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.put(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).updateVendorNotes(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE), any());
  }

  @Test
  public void needRevisionTest() throws Exception {
    NeedRevisionSubmitRequest request = new NeedRevisionSubmitRequest();
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.NEED_REVISION_SUBMIT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).needRevisionSubmit(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME),any());
  }

  @Test
  public void needRevisionExceptionTest() throws Exception {
    NeedRevisionSubmitRequest request = new NeedRevisionSubmitRequest();
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper).needRevisionSubmit(any(), any(), any());
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.NEED_REVISION_SUBMIT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(request))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).needRevisionSubmit(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME), any());
  }

  @Test
  public void getAutoApprovalTypeTest() throws Exception {
    Mockito.when(this.productServiceWrapper.findAutoApprovalTypeByRequest(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME),
      eq(PRODUCT_CODE), eq(false), any(AutoApprovalTypeRequest.class))).thenReturn(new AutoApprovalTypeResponse(AutoApprovalType.NA.name()));
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CHECK_AUTO_APPROVAL_ELIGIBILITY
        .replaceAll("\\{productCode\\}", PRODUCT_CODE))
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(new AutoApprovalTypeRequest()))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).findAutoApprovalTypeByRequest(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME),
      eq(PRODUCT_CODE), eq(false), any(AutoApprovalTypeRequest.class));
  }

  @Test
  public void getProductStatus() throws Exception {
    Mockito.when(this.productService.getProductStatus(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE)))
        .thenReturn(AutoApprovalType.NA.name());
    URI uri = new URIBuilder()
            .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCT_STATUS
                    .replaceAll("\\{productCode\\}", PRODUCT_CODE))
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId())
            .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
                    .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
            .andExpect(MockMvcResultMatchers.status().isOk())
            .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productService).getProductStatus(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE));
  }

  @Test
  public void getProductStatusException() throws Exception {
    Mockito.when(this.productService.getProductStatus(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE)))
        .thenThrow(RuntimeException.class);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCT_STATUS
            .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
            .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).getProductStatus(eq(DEFAULT_STORE_ID), eq(PRODUCT_CODE));
  }

  @Test
  public void validateDuplicateProductTest() throws Exception {
    Mockito.when(
            this.productService.validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE, validateDuplicateProductRequest))
        .thenReturn(validateDuplicateProductResponse);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.VALIDATE_DUPLICATE_PRODUCT.replaceAll(
                "\\{merchantCode\\}", MERCHANT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(validateDuplicateProductRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE,
        validateDuplicateProductRequest);
  }

  @Test
  public void validateDuplicateProductNotFoundTest() throws Exception {
    validateDuplicateProductResponse.setProductName(null);
    Mockito.when(
            this.productService.validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE, validateDuplicateProductRequest))
        .thenReturn(validateDuplicateProductResponse);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.VALIDATE_DUPLICATE_PRODUCT.replaceAll(
                "\\{merchantCode\\}", MERCHANT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(validateDuplicateProductRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productService).validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE,
        validateDuplicateProductRequest);
  }

  @Test
  public void validateDuplicateProductApplicationRuntimeExceptionTest() throws Exception {
    Mockito.when(
            this.productService.validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE, validateDuplicateProductRequest))
        .thenThrow(new ApplicationRuntimeException());
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.VALIDATE_DUPLICATE_PRODUCT.replaceAll(
                "\\{merchantCode\\}", MERCHANT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(validateDuplicateProductRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE,
        validateDuplicateProductRequest);
  }

  @Test
  public void validateDuplicateProductExceptionTest() throws Exception {
    Mockito.when(
            this.productService.validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE, validateDuplicateProductRequest))
        .thenThrow(new Exception());
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.VALIDATE_DUPLICATE_PRODUCT.replaceAll(
                "\\{merchantCode\\}", MERCHANT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(validateDuplicateProductRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).validateDuplicateProduct(DEFAULT_STORE_ID, MERCHANT_CODE,
        validateDuplicateProductRequest);
  }

  @Test
  public void getAutoApprovalType_exceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productServiceWrapper)
        .findAutoApprovalTypeByRequest(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME), eq(PRODUCT_CODE), eq(false),
            any(AutoApprovalTypeRequest.class));
    URI uri = new URIBuilder()
      .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CHECK_AUTO_APPROVAL_ELIGIBILITY
        .replaceAll("\\{productCode\\}", PRODUCT_CODE))
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.post(uri).content(this.objectMapper.writeValueAsString(new AutoApprovalTypeRequest()))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).findAutoApprovalTypeByRequest(eq(DEFAULT_STORE_ID), eq(DEFAULT_USERNAME),
      eq(PRODUCT_CODE), eq(false), any(AutoApprovalTypeRequest.class));
  }

  @Test
  public void fetchInProgressProductsByMerchantCodeTest() throws Exception {
    when(productService.findInProgressProductsByMerchantCode(DEFAULT_STORE_ID, MERCHANT_CODE, 0, 100))
        .thenReturn(new InProgressProductResponsePageResponse(new ArrayList<>(), 1));
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.FETCH_IN_PROGRESS_PRODUCTS_BY_MERCHANT_CODE
            .replaceAll("\\{merchantCode\\}", MERCHANT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productService).findInProgressProductsByMerchantCode(DEFAULT_STORE_ID, MERCHANT_CODE, 0, 100);
  }

  @Test
  public void fetchInProgressProductsByMerchantCodeExceptionTest() throws Exception {
    doThrow(RuntimeException.class).when(productService).findInProgressProductsByMerchantCode(DEFAULT_STORE_ID, MERCHANT_CODE, 0, 100);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.FETCH_IN_PROGRESS_PRODUCTS_BY_MERCHANT_CODE
            .replaceAll("\\{merchantCode\\}", MERCHANT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).findInProgressProductsByMerchantCode(DEFAULT_STORE_ID, MERCHANT_CODE, 0, 100);
  }

  @Test
  public void retryAutoNeedRevisionTest() throws Exception {
    RetryAutoNeedRevisionResponse retryAutoNeedRevisionResponse = new RetryAutoNeedRevisionResponse();
    retryAutoNeedRevisionResponse.setSuccess(true);
    Mockito.when(productServiceWrapper.retryAutoNeedRevision(new RetryNeedRevisionRequest(), true))
        .thenReturn(retryAutoNeedRevisionResponse);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.RETRY_AUTO_NEED_REVISION)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.put(uri)
        .content(this.objectMapper.writeValueAsString(new RetryNeedRevisionRequest()))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productServiceWrapper).retryAutoNeedRevision(new RetryNeedRevisionRequest(), true);
  }

  @Test
  public void retryAutoNeedRevisionExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productServiceWrapper)
        .retryAutoNeedRevision(new RetryNeedRevisionRequest(), true);
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.RETRY_AUTO_NEED_REVISION)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.put(uri)
        .content(this.objectMapper.writeValueAsString(new RetryNeedRevisionRequest()))
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productServiceWrapper).retryAutoNeedRevision(new RetryNeedRevisionRequest(), true);
  }

  @Test
  public void getCogsValueByMaterialCodeTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.GET_COGS_VALUE_BY_MATERIAL_CODE
            .replaceAll("\\{materialCode\\}", ITEM_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productService).fetchCogsValueByMaterialCode(DEFAULT_STORE_ID, ITEM_CODE);
  }

  @Test
  public void getCogsValueByMaterialCodeExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
        .fetchCogsValueByMaterialCode(DEFAULT_STORE_ID, ITEM_CODE);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.GET_COGS_VALUE_BY_MATERIAL_CODE
            .replaceAll("\\{materialCode\\}", ITEM_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).fetchCogsValueByMaterialCode(DEFAULT_STORE_ID, ITEM_CODE);
  }

  @Test
  public void updatePbpWorkflowByProductCodeTest() throws Exception {
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PBP_PRODUCT_WORKFLOW
          .replaceAll("\\{productCode\\}", PRODUCT_CODE))
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
      .addParameter("state", STATE).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(this.productService).updatePbpProductWorkflowState(DEFAULT_STORE_ID, PRODUCT_CODE,
      STATE);
  }

  @Test
  public void updatePbpWorkflowByProductCodeExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(this.productService)
      .updatePbpProductWorkflowState(DEFAULT_STORE_ID, PRODUCT_CODE, STATE);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_PBP_PRODUCT_WORKFLOW
          .replaceAll("\\{productCode\\}", PRODUCT_CODE))
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
      .addParameter("state", STATE).build();
    this.mockMvc.perform(MockMvcRequestBuilders.get(uri)
        .accept(MediaType.APPLICATION_JSON))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(this.productService).updatePbpProductWorkflowState(DEFAULT_STORE_ID, PRODUCT_CODE,
      STATE);
  }

  @Test
  public void updateReviewPendingTest() throws Exception {
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_REVIEW_PENDING.replaceAll(
                "\\{productCode\\}", PRODUCT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("reviewPending", REVIEW_PENDING)
        .build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productServiceWrapper)
        .updateReviewPending(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.valueOf(REVIEW_PENDING));
  }

  @Test
  public void updateActivatedAndViewableTest() throws Exception {
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_ACTIVATED_AND_VIEWABLE.replaceAll(
                "\\{productCode\\}", PRODUCT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("activated", REVIEW_PENDING)
        .addParameter("viewable", REVIEW_PENDING).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true)));
    Mockito.verify(this.productServiceWrapper)
        .updateActivatedAndViewable(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.parseBoolean(REVIEW_PENDING),
            Boolean.parseBoolean(REVIEW_PENDING));
  }

  @Test
  public void updateReviewPendingExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper)
        .updateReviewPending(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.valueOf(REVIEW_PENDING));
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_REVIEW_PENDING
                .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("reviewPending", REVIEW_PENDING).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productServiceWrapper)
        .updateReviewPending(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.valueOf(REVIEW_PENDING));
  }

  @Test
  public void updateReviewPendingApplicationnRuntimeExceptionTest() throws Exception {
    ApplicationRuntimeException applicationRuntimeException = new ApplicationRuntimeException();
    applicationRuntimeException.setErrorCodes(ErrorCategory.VALIDATION);
    Mockito.doThrow(RuntimeException.class).when(productServiceWrapper)
        .updateReviewPending(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.valueOf(REVIEW_PENDING));
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_REVIEW_PENDING
                .replaceAll("\\{productCode\\}", PRODUCT_CODE))
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID)
        .addParameter("reviewPending", REVIEW_PENDING).build();
    this.mockMvc.perform(
            MockMvcRequestBuilders.put(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false)));
    Mockito.verify(this.productServiceWrapper)
        .updateReviewPending(DEFAULT_STORE_ID, PRODUCT_CODE, Boolean.valueOf(REVIEW_PENDING));
  }

  @Test
  public void editPriceStockVariantsInfoTest() throws Exception {
    ReflectionTestUtils.setField(productController, "webpConversionEnabled", true);
    productVariantUpdateRequest.setOnlyL5Update(true);
    productVariantUpdateRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.EDIT_PRICE_STOCK_VARIANTS_INFO)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(productVariantUpdateRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(getProductService())
        .editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
            eq(new EditProductResponse()),eq(false));
  }

  @Test
  public void editPriceStockVariantsInfoAndNRTrueTest() throws Exception {
    ReflectionTestUtils.setField(productController, "webpConversionEnabled", true);
    productVariantUpdateRequest.setNeedCorrection(true);
    productVariantUpdateRequest.setOnlyL5Update(true);
    productVariantUpdateRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.EDIT_PRICE_STOCK_VARIANTS_INFO)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(productVariantUpdateRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    verify(getProductService()).editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
        eq(new EditProductResponse()), eq(false));
  }

  @Test
  public void editPriceStockVariantsInfoApplicationExceptionTest() throws Exception {
    productVariantUpdateRequest.setOnlyL5Update(true);
    doThrow(new ApplicationRuntimeException(ErrorCategory.UNSPECIFIED)).when(getProductService())
        .editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
            eq(new EditProductResponse()),eq(false));
    productVariantUpdateRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.EDIT_PRICE_STOCK_VARIANTS_INFO)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(productVariantUpdateRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(getProductService())
        .editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
            eq(new EditProductResponse()),eq(false));
  }

  @Test
  public void editPriceStockVariantsInfoExceptionTest() throws Exception {
    productVariantUpdateRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    productVariantUpdateRequest.setOnlyL5Update(true);
    productLevel3.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    doThrow(RuntimeException.class).when(getProductService())
        .editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
            eq(new EditProductResponse()),eq(false));
    URI uri =
        new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.EDIT_PRICE_STOCK_VARIANTS_INFO)
            .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
            .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
            .addParameter("requestId", getRequestId()).addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
            .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(productVariantUpdateRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    verify(getProductService())
        .editPriceStockVariantsInfo(eq(DEFAULT_STORE_ID), any(), eq(productVariantUpdateRequest),
            eq(new EditProductResponse()),eq(false));
  }

  @Test
  public void deleteProductInSolrProductCollectionByIdTest() throws Exception {
    GenericStringListRequest genericStringListRequest = new GenericStringListRequest();
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_IN_PRODUCT_COLLECTION_SOLR)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(genericStringListRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productService).deleteProductInSolrProductCollectionByIds(any());
  }

  @Test
  public void deleteProductInSolrProductCollectionByIdApplicationRuntimeExceptionTest() throws Exception {
    GenericStringListRequest genericStringListRequest = new GenericStringListRequest();
    Mockito.doThrow(new ApplicationRuntimeException()).when(productService)
        .deleteProductInSolrProductCollectionByIds(any());
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_IN_PRODUCT_COLLECTION_SOLR)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(genericStringListRequest)))
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService).deleteProductInSolrProductCollectionByIds(any());
  }

  @Test
  public void deleteProductInSolrProductCollectionByIdExceptionTest() throws Exception {
    GenericStringListRequest genericStringListRequest = new GenericStringListRequest();
    Mockito.doThrow(new Exception()).when(productService).deleteProductInSolrProductCollectionByIds(any());
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_PRODUCT_IN_PRODUCT_COLLECTION_SOLR)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(genericStringListRequest)))
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService).deleteProductInSolrProductCollectionByIds(any());
  }

  @Test
  public void deleteTerminatedSellerProductsTest() throws Exception {
    Mockito.doNothing().when(productServiceWrapper)
        .deleteTerminatedSellerNonSharedProducts(DEFAULT_STORE_ID, PRODUCT_SKU);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.DELETE_TERMINATED_SELLER_PRODUCTS.replaceAll(
                "\\{productSku\\}", PRODUCT_SKU)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productServiceWrapper).deleteTerminatedSellerNonSharedProducts(DEFAULT_STORE_ID, PRODUCT_SKU);
  }

  @Test
  public void getHalaProductHistoryTest() throws Exception {
    Page<HalalProductHistoryResponse> halalProductHistoryResponses =
        new PageImpl<>(List.of(halalProductHistoryResponse), pageRequest, 1);
    Mockito.when(halalHistoryUpdateService.getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest))
        .thenReturn(halalProductHistoryResponses);
    this.mockMvc.perform(
            get(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_HALAL_PRODUCT_HISTORY, PRODUCT_SKU).accept(
                    MediaType.APPLICATION_JSON).param("storeId", STORE_ID).param("requestId", REQUEST_ID)
                .param("username", DEFAULT_USERNAME)).andExpect(status().isOk())
        .andExpect(jsonPath("$.success", equalTo(Boolean.TRUE)))
        .andExpect(jsonPath("$.content[0].activity", equalTo(ACTIVITY)))
        .andExpect(jsonPath("$.content[0].previousValue", equalTo(PREVIOUS_VALUE)))
        .andExpect(jsonPath("$.content[0].currentValue", equalTo(CURRENT_VALUE)))
        .andExpect(jsonPath("$.content[0].createdBy", equalTo(CREATED_BY)))
        .andExpect(jsonPath("$.requestId", equalTo(REQUEST_ID))).andReturn();
    Mockito.verify(halalHistoryUpdateService).getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest);
  }

  @Test
  public void getRestrictedKeywordHistoryApplicationRuntimeExceptionTest() throws Exception {
    Mockito.when(halalHistoryUpdateService.getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest))
        .thenThrow(new ApplicationRuntimeException());
    this.mockMvc.perform(
            get(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_HALAL_PRODUCT_HISTORY, PRODUCT_SKU).accept(
                    MediaType.APPLICATION_JSON).param("storeId", STORE_ID).param("requestId", REQUEST_ID)
                .param("username", DEFAULT_USERNAME)).andExpect(status().isOk())
        .andExpect(jsonPath("$.success", equalTo(Boolean.FALSE)))
        .andExpect(jsonPath("$.requestId", equalTo(REQUEST_ID))).andReturn();
    Mockito.verify(halalHistoryUpdateService).getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest);
  }

  @Test
  public void getRestrictedKeywordHistoryExceptionTest() throws Exception {
    Mockito.when(halalHistoryUpdateService.getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest))
        .thenThrow(new NullPointerException());
    this.mockMvc.perform(
            get(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_HALAL_PRODUCT_HISTORY, PRODUCT_SKU).accept(
                    MediaType.APPLICATION_JSON).param("storeId", STORE_ID).param("requestId", REQUEST_ID)
                .param("username", DEFAULT_USERNAME)).andExpect(status().isOk())
        .andExpect(jsonPath("$.success", equalTo(Boolean.FALSE)))
        .andExpect(jsonPath("$.requestId", equalTo(REQUEST_ID))).andReturn();
    Mockito.verify(halalHistoryUpdateService).getHalalProductHistory(STORE_ID, PRODUCT_SKU, pageRequest);
  }

  @Test
  public void processProductVendorSearchAutoHealTest() throws Exception {
    Mockito.doNothing().when(productServiceWrapper).processProductVendorSearchAutoHeal(DEFAULT_STORE_ID, PRODUCT_CODE);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.PROCESS_PRODUCT_VENDOR_SEARCH_AUTO_HEAL.replaceAll(
                "\\{productCode\\}", PRODUCT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productServiceWrapper).processProductVendorSearchAutoHeal(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void processProductVendorSearchAutoHealErrorTest() throws Exception {
    Mockito.doThrow(ApplicationRuntimeException.class).when(productServiceWrapper).processProductVendorSearchAutoHeal(DEFAULT_STORE_ID, PRODUCT_CODE);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.PROCESS_PRODUCT_VENDOR_SEARCH_AUTO_HEAL.replaceAll(
                "\\{productCode\\}", PRODUCT_CODE)).addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
        .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
        .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).addParameter("requestId", getRequestId())
        .addParameter("username", ProductControllerTest.DEFAULT_USERNAME).build();
    getMockMvc().perform(
            MockMvcRequestBuilders.get(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON))
        .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productServiceWrapper).processProductVendorSearchAutoHeal(DEFAULT_STORE_ID, PRODUCT_CODE);
  }

  @Test
  public void updateAppealInProgressProductTest() throws Exception {
    AppealProductResponse appealProductResponse = new AppealProductResponse();
    Mockito.when(
        productAppealService.updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest))
      .thenReturn(appealProductResponse);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.APPEAL_IN_PROGRESS_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)
        .content(getObjectMapper().writeValueAsString(appealProductRequest)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productAppealService)
      .updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest);
  }

  @Test
  public void updateAppealInProgressProductExceptionTest() throws Exception {
    AppealProductResponse appealProductResponse = new AppealProductResponse();
    doThrow(RuntimeException.class).when(productAppealService)
      .updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.APPEAL_IN_PROGRESS_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)
        .content(getObjectMapper().writeValueAsString(appealProductRequest)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productAppealService)
      .updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest);
  }

  @Test
  public void updateAppealInProgressNonNullErrorCodeProductTest() throws Exception {
    AppealProductResponse appealProductResponse = new AppealProductResponse();
    appealProductResponse.setErrorCode("Error");
    Mockito.when(
        productAppealService.updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest))
      .thenReturn(appealProductResponse);
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.APPEAL_IN_PROGRESS_PRODUCT)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)
        .content(getObjectMapper().writeValueAsString(appealProductRequest)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productAppealService)
      .updateAppealProductForInProgressProducts(STORE_ID, appealProductRequest);
  }

  @Test
  public void fetchAppealProductConfigTest() throws Exception {
    AppealProductConfigResponse appealProductConfigResponse = new AppealProductConfigResponse();
    Mockito.when(productAppealService.fetchAppealProductConfig(STORE_ID, BUSINESS_PARTNER_CODE))
      .thenReturn(appealProductConfigResponse);

    this.mockMvc.perform(
        get(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_APPEAL_PRODUCT_ELIGIBILITY,
          BUSINESS_PARTNER_CODE).accept(MediaType.APPLICATION_JSON).param("storeId", STORE_ID)
          .param("requestId", REQUEST_ID)).andExpect(status().isOk())
      .andExpect(jsonPath("$.success").value(true))
      .andReturn();

    Mockito.verify(productAppealService).fetchAppealProductConfig(STORE_ID, BUSINESS_PARTNER_CODE);
  }

  @Test
  public void fetchAppealProductConfigExceptionTest() throws Exception {
    Mockito.doThrow(RuntimeException.class).when(productAppealService)
      .fetchAppealProductConfig(STORE_ID, BUSINESS_PARTNER_CODE);

    this.mockMvc.perform(
        get(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_APPEAL_PRODUCT_ELIGIBILITY,
          BUSINESS_PARTNER_CODE).accept(MediaType.APPLICATION_JSON).param("storeId", STORE_ID)
          .param("requestId", REQUEST_ID)).andExpect(status().isOk())
      .andExpect(jsonPath("$.success").value(false)).andReturn();

    Mockito.verify(productAppealService).fetchAppealProductConfig(STORE_ID, BUSINESS_PARTNER_CODE);
  }

  @Test
  public void migrateProductAndL5DetailByProductSkuTest() throws Exception {
    ProductAndL5MigrationRequest productAndL5MigrationRequest =
      ProductAndL5MigrationRequest.builder().productSku(PRODUCT_SKU).build();
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.MIGRATE_PRODUCT_AND_L5_DETAIL_BY_PRODUCT_SKU)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doNothing().when(
      productMigrationWrapperService).migrateProductAndL5DetailsByProductSku(DEFAULT_STORE_ID,
        productAndL5MigrationRequest, DEFAULT_USERNAME);
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)
        .content(getObjectMapper().writeValueAsString(productAndL5MigrationRequest)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productMigrationWrapperService).migrateProductAndL5DetailsByProductSku(DEFAULT_STORE_ID, productAndL5MigrationRequest, DEFAULT_USERNAME);
  }

  @Test
  public void migrateProductAndL5DetailByProductSkuErrorTest() throws Exception {
    ProductAndL5MigrationRequest productAndL5MigrationRequest =
      ProductAndL5MigrationRequest.builder().productSku(PRODUCT_SKU).build();
    URI uri = new URIBuilder().setPath(
        ProductControllerPath.BASE_PATH + ProductControllerPath.MIGRATE_PRODUCT_AND_L5_DETAIL_BY_PRODUCT_SKU)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID)
      .addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.DEFAULT_CLIENT_ID).build();
    Mockito.doThrow(new ApplicationRuntimeException()).when(
      productMigrationWrapperService).migrateProductAndL5DetailsByProductSku(DEFAULT_STORE_ID,
      productAndL5MigrationRequest, DEFAULT_USERNAME);
    getMockMvc().perform(MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON)
        .contentType(MediaType.APPLICATION_JSON)
        .content(getObjectMapper().writeValueAsString(productAndL5MigrationRequest)))
      .andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productMigrationWrapperService).migrateProductAndL5DetailsByProductSku(DEFAULT_STORE_ID, productAndL5MigrationRequest, DEFAULT_USERNAME);
  }

  @Test
  public void findDistinctBusinessPartnerCodesByStateAndUpdatedStepDateTest() throws Exception {
    NeedRevisionProductsRequest needRevisionProductsRequest =
        NeedRevisionProductsRequest.builder().state(PRODUCT_SKU).build();
    Mockito.when(productService.getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID,
        needRevisionProductsRequest, pageRequest)).thenReturn(new PageImpl<>(Arrays.asList(BUSINESS_PARTNER_CODE)));
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.GET_DISTINCT_BUSINESS_PARTNER_CODE_FOR_REVISED_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID).addParameter("requestId", getRequestId())
        .addParameter("page", "0").addParameter("size", "10").build();
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(needRevisionProductsRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(true))).andReturn();
    Mockito.verify(productService)
        .getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID, needRevisionProductsRequest, pageRequest);
  }

  @Test
  public void findDistinctBusinessPartnerCodesByStateAndUpdatedStepDateApplicationRuntimeTest() throws Exception {
    NeedRevisionProductsRequest needRevisionProductsRequest =
        NeedRevisionProductsRequest.builder().state(PRODUCT_SKU).build();
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.GET_DISTINCT_BUSINESS_PARTNER_CODE_FOR_REVISED_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID).addParameter("requestId", getRequestId())
        .addParameter("page", "0").addParameter("size", "10").build();
    Mockito.doThrow(new ApplicationRuntimeException()).when(productService)
        .getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID, needRevisionProductsRequest, pageRequest);
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(needRevisionProductsRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService)
        .getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID, needRevisionProductsRequest, pageRequest);
  }

  @Test
  public void findDistinctBusinessPartnerCodesByStateAndUpdatedStepDateApplicationExceptionTest() throws Exception {
    NeedRevisionProductsRequest needRevisionProductsRequest =
        NeedRevisionProductsRequest.builder().state(PRODUCT_SKU).build();
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.GET_DISTINCT_BUSINESS_PARTNER_CODE_FOR_REVISED_PRODUCT)
        .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID).addParameter("requestId", getRequestId())
        .addParameter("page", "0").addParameter("size", "10").build();
    Mockito.doThrow(new ApiDataNotFoundException(null, null)).when(productService)
        .getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID, needRevisionProductsRequest, pageRequest);
    getMockMvc().perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(getObjectMapper().writeValueAsString(needRevisionProductsRequest)))
        .andExpect(MockMvcResultMatchers.status().isOk()).andExpect(jsonPath("$.success", equalTo(false))).andReturn();
    Mockito.verify(productService)
        .getDistinctBusinessPartnerCodesForNeedRevisionProduct(DEFAULT_STORE_ID, needRevisionProductsRequest, pageRequest);
  }

  @Test
  public void testGetAllProductsByBusinessPartnerCodeForLastXDays() throws Exception {
    String storeId = "store-123";
    String requestId = "req-456";
    String businessPartnerCode = "partner-789";
    Page<ProductCodeAndNameDetails> productDetails = new PageImpl<>(
        Arrays.asList(new ProductCodeAndNameDetails("prod-001", "Product 1"),
            new ProductCodeAndNameDetails("prod-002", "Product 2")));
    when(productService.fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode,
        pageRequest)).thenReturn(productDetails);
    mockMvc.perform(get(ProductControllerPath.BASE_PATH
        + ProductControllerPath.GET_ALL_PRODUCTS_BY_BUSINESS_PARTNER_CODE_FOR_LAST_X_DAYS).param("storeId", storeId)
        .param("requestId", requestId).param("businessPartnerCode", businessPartnerCode).param("page", "0")
        .param("size", "10").accept(MediaType.APPLICATION_JSON)).andExpect(status().isOk()).andExpect(jsonPath("$.success").value(true));
    verify(productService, times(1)).fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode, pageRequest);
  }

  @Test
  public void testGetAllProductsByBusinessPartnerCodeForLastXdaysApplicationRuntimeException() throws Exception {
    String storeId = "store-123";
    String requestId = "req-456";
    String businessPartnerCode = "partner-789";
    Mockito.doThrow(new ApplicationRuntimeException(ErrorCategory.COMMUNICATION_FAILURE, "error")).when(productService)
        .fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode, pageRequest);
    mockMvc.perform(get(ProductControllerPath.BASE_PATH
            + ProductControllerPath.GET_ALL_PRODUCTS_BY_BUSINESS_PARTNER_CODE_FOR_LAST_X_DAYS).param("storeId", storeId)
            .param("requestId", requestId).param("businessPartnerCode", businessPartnerCode).param("page", "0")
            .param("size", "10").accept(MediaType.APPLICATION_JSON)).andExpect(status().isOk()).andExpect(jsonPath("$.success").value(false))
        .andExpect(jsonPath("$.errorMessage").value("Can not communicate :error"));
    verify(productService, times(1)).fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode, pageRequest);
  }

  @Test
  public void testGetAllProductsByBusinessPartnerCodeForLastXdaysException() throws Exception {
    String storeId = "store-123";
    String requestId = "req-456";
    String businessPartnerCode = "partner-789";
    doThrow(NullPointerException.class).when(productService)
        .fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode, pageRequest);
    mockMvc.perform(get(ProductControllerPath.BASE_PATH
            + ProductControllerPath.GET_ALL_PRODUCTS_BY_BUSINESS_PARTNER_CODE_FOR_LAST_X_DAYS).param("storeId", storeId)
            .param("requestId", requestId).param("businessPartnerCode", businessPartnerCode).param("page", "0")
            .param("size", "10")
            .accept(MediaType.APPLICATION_JSON)).andExpect(status().isOk()).andExpect(jsonPath("$.success").value(false))
        .andExpect(jsonPath("$.errorMessage").value("Error occurred on the system"));
    verify(productService, times(1)).fetchProductsByBusinessPartnerCodeForLastXDays(storeId, businessPartnerCode,
        pageRequest);
  }

  @Test
  public void createProductSellerPenaltyTest() throws Exception {
    ReflectionTestUtils.setField(productController, "sellerPenaltyEnabledPhase1", true);
    ReflectionTestUtils.setField(productController, "maxStockLimit", 1000000000000L);
    ReflectionTestUtils.setField(productController, "validateCreateShippingAndDimensions", false);
    ProductCreationRequest request = generateProductCreationRequestAtL5();
    setPickupPointCreateRequest(request);
    request.getProductItemRequests().getFirst().setMerchantSku(DEFAULT_CHANNEL_ID);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productConsequenceLimitation", true);
    profileResponse.setFlags(flags);
    Mockito.when(productWorkflowServiceWrapper.create(DEFAULT_STORE_ID, request, false, true, profileResponse))
      .thenReturn(true);
    Mockito.when(productOutbound.validCnCategory(any()))
      .thenReturn(new CategoryAndCnDetailDto(new CategoryResponse(), true));
    Mockito
      .when(productService.checkIfMPPIsAllowed(DEFAULT_STORE_ID, request.getBusinessPartnerCode(), profileResponse))
      .thenReturn(true);
    ReflectionTestUtils.setField(productController, "imageSourceDirectory", SOURCE_DIRECTORY);
    generateDummyImageFiles(request.getProductItemRequests());
    URI uri = new URIBuilder().setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.CREATE_NEW_PRODUCT_V2)
      .addParameter("storeId", ProductControllerTest.DEFAULT_STORE_ID)
      .addParameter("channelId", ProductControllerTest.DEFAULT_CHANNEL_ID).addParameter("requestId", getRequestId())
      .addParameter("username", ProductControllerTest.DEFAULT_USERNAME)
      .addParameter("clientId", ProductControllerTest.PCU_EXTERNAL_APP).addParameter("flowType", "FLOW1").build();
    ObjectMapper objectMapper = new ObjectMapper();
    request.getProductItemRequests().forEach(productItemCreationRequest1 -> productItemCreationRequest1.setStock(100));
    this.mockMvc.perform(
        MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
          .content(objectMapper.writeValueAsString(request))).andExpect(MockMvcResultMatchers.status().isOk())
      .andExpect(jsonPath("$.errorCode", equalTo(ApiErrorCode.SELLER_PENALTY_RESTRICTION.getCode())))
      .andExpect(jsonPath("$.errorMessage", equalTo(ApiErrorCode.SELLER_PENALTY_RESTRICTION.getDesc())));
    deleteDummyFiles(request.getProductItemRequests());
  }

  @Test
  void checkIfSellerSkuExistsSuccess() throws Exception {
    OmniChannelSkuRequest omniChannelSkuRequest = new OmniChannelSkuRequest();
    Mockito.when(productLevel3V2Wrapper.checkIfOmniChannelSkuExists(DEFAULT_STORE_ID, new OmniChannelSkuRequest()))
        .thenReturn(null);
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.CHECK_IF_SELLER_SKU_EXISTS)
        .addParameter("storeId", DEFAULT_STORE_ID).addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("requestId", DEFAULT_REQUEST_ID).addParameter("username", DEFAULT_USERNAME)
        .addParameter("clientId", DEFAULT_CLIENT_ID).build();
    mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(omniChannelSkuRequest))).andExpect(status().isOk())
        .andExpect(jsonPath("$.success").value(true)).andExpect(jsonPath("$.errorCode").value(nullValue()));
    Mockito.verify(productLevel3V2Wrapper).checkIfOmniChannelSkuExists(DEFAULT_STORE_ID, new OmniChannelSkuRequest());
  }

  @Test
  void checkIfSellerSkuExistsException() throws Exception {
    OmniChannelSkuRequest omniChannelSkuRequest = new OmniChannelSkuRequest();
    Mockito.when(productLevel3V2Wrapper.checkIfOmniChannelSkuExists(DEFAULT_STORE_ID, new OmniChannelSkuRequest()))
        .thenThrow(new RuntimeException("error occurred"));
    URI uri = new URIBuilder().setPath(
            ProductControllerPath.BASE_PATH + ProductControllerPath.CHECK_IF_SELLER_SKU_EXISTS)
        .addParameter("storeId", DEFAULT_STORE_ID).addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("requestId", DEFAULT_REQUEST_ID).addParameter("username", DEFAULT_USERNAME)
        .addParameter("clientId", DEFAULT_CLIENT_ID).build();
    mockMvc.perform(
            MockMvcRequestBuilders.post(uri).accept(MediaType.APPLICATION_JSON).contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(omniChannelSkuRequest))).andExpect(status().isOk())
        .andExpect(jsonPath("$.success").value(false)).andExpect(jsonPath("$.errorMessage").value("error occurred"));
    Mockito.verify(productLevel3V2Wrapper).checkIfOmniChannelSkuExists(DEFAULT_STORE_ID, new OmniChannelSkuRequest());
  }

  @Test
  public void getProductsByBrandName_Success() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    String brandName = "TestBrand";
    int page = 0;
    int size = 10;
    Pageable pageable = PageRequest.of(page, size);
    
    // Create test data
    ProductAndBrandResponse response1 = ProductAndBrandResponse.builder()
        .productId("PRODUCT_ID_1")
        .productCode("PRODUCT_CODE_1")
        .brandName(brandName)
        .businessPartnerCodes(Set.of("BP_001", "BP_002"))
        .build();
    
    ProductAndBrandResponse response2 = ProductAndBrandResponse.builder()
        .productId("PRODUCT_ID_2")
        .productCode("PRODUCT_CODE_2")
        .brandName(brandName)
        .businessPartnerCodes(Set.of("BP_003"))
        .build();
    
    List<ProductAndBrandResponse> responseList = Arrays.asList(response1, response2);
    Page<ProductAndBrandResponse> productPage = new PageImpl<>(responseList, pageable, 2);
    
    // Mock service call
    when(productService.getProductsByBrandName(storeId, brandName, pageable)).thenReturn(productPage);
    
    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCTS_BY_BRAND_NAME)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .addParameter("brandName", brandName)
        .addParameter("page", String.valueOf(page))
        .addParameter("size", String.valueOf(size))
        .build();
    
    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.get(uri)
            .accept(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)))
        .andExpect(jsonPath("$.content", hasSize(2)))
        .andExpect(jsonPath("$.content[0].productId", equalTo("PRODUCT_ID_1")))
        .andExpect(jsonPath("$.content[0].productCode", equalTo("PRODUCT_CODE_1")))
        .andExpect(jsonPath("$.content[0].brandName", equalTo(brandName)))
        .andExpect(jsonPath("$.content[1].productId", equalTo("PRODUCT_ID_2")))
        .andExpect(jsonPath("$.content[1].productCode", equalTo("PRODUCT_CODE_2")))
        .andReturn();
    
    // Verify service interaction
    verify(productService).getProductsByBrandName(storeId, brandName, pageable);
  }

  @Test
  public void getProductsByBrandName_Success_EmptyResults() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    String brandName = "NonExistentBrand";
    int page = 0;
    int size = 10;
    Pageable pageable = PageRequest.of(page, size);
    
    // Empty result
    Page<ProductAndBrandResponse> emptyPage = new PageImpl<>(Collections.emptyList(), pageable, 0);
    
    // Mock service call
    when(productService.getProductsByBrandName(storeId, brandName, pageable)).thenReturn(emptyPage);
    
    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCTS_BY_BRAND_NAME)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .addParameter("brandName", brandName)
        .addParameter("page", String.valueOf(page))
        .addParameter("size", String.valueOf(size))
        .build();
    
    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.get(uri)
            .accept(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)))
        .andExpect(jsonPath("$.content", hasSize(0)))
        .andExpect(jsonPath("$.pageMetaData.totalRecords", equalTo(0)))
        .andReturn();
    
    // Verify service interaction
    verify(productService).getProductsByBrandName(storeId, brandName, pageable);
  }

  @Test
  public void getProductsByBrandName_Failure_Exception() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    String brandName = "TestBrand";
    int page = 0;
    int size = 10;
    Pageable pageable = PageRequest.of(page, size);
    
    // Mock service to throw exception
    when(productService.getProductsByBrandName(storeId, brandName, pageable)).thenThrow(
        new Exception());
    
    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCTS_BY_BRAND_NAME)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .addParameter("brandName", brandName)
        .addParameter("page", String.valueOf(page))
        .addParameter("size", String.valueOf(size))
        .build();
    
    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.get(uri)
            .accept(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
            equalTo("Error occurred on the system")))
        .andExpect(jsonPath("$.errorCode", equalTo(ErrorCategory.UNSPECIFIED.name())))
        .andReturn();
    
    // Verify service interaction
    verify(productService).getProductsByBrandName(storeId, brandName, pageable);
  }

  @Test
  public void getProductsByBrandName_Failure_ApplicationRuntimeException() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    String brandName = "TestBrand";
    int page = 0;
    int size = 10;
    Pageable pageable = PageRequest.of(page, size);

    ApplicationRuntimeException exception = new ApplicationRuntimeException(
        ErrorCategory.VALIDATION, "Brand validation failed");

    // Mock service to throw exception
    when(productService.getProductsByBrandName(storeId, brandName, pageable)).thenThrow(exception);

    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.GET_PRODUCTS_BY_BRAND_NAME)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .addParameter("brandName", brandName)
        .addParameter("page", String.valueOf(page))
        .addParameter("size", String.valueOf(size))
        .build();

    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.get(uri)
            .accept(MediaType.APPLICATION_JSON))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
            equalTo("Can not process invalid input data :Brand validation failed")))
        .andExpect(jsonPath("$.errorCode", equalTo(ErrorCategory.VALIDATION.getMessage())))
        .andReturn();

    // Verify service interaction
    verify(productService).getProductsByBrandName(storeId, brandName, pageable);
  }

  @Test
  public void updateBrand_Success() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    ProductBrandUpdateRequest request = ProductBrandUpdateRequest.builder()
        .productCode("PRODUCT_CODE_1")
        .oldBrandName("New Brand Name")
        .oldBrandCode("NEW_BRAND_CODE")
        .onlyBrandNameUpdate(false)
        .brandLevelUpdateRequired(true)
        .build();

    // Mock service to do nothing (success case)
    Mockito.doNothing().when(productServiceWrapper).updateProductBrandValue(storeId, request);

    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_BRAND)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .build();

    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.post(uri)
            .accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(true)))
        .andReturn();

    // Verify service interaction
    verify(productServiceWrapper).updateProductBrandValue(storeId, request);
  }

  @Test
  public void updateBrand_Failure_ApplicationRuntimeException() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    ProductBrandUpdateRequest request = ProductBrandUpdateRequest.builder()
        .productCode("PRODUCT_CODE_1")
        .newBrandName("New Brand Name")
        .oldBrandCode("NEW_BRAND_CODE")
        .onlyBrandNameUpdate(false)
        .brandLevelUpdateRequired(true)
        .build();

    ApplicationRuntimeException exception = new ApplicationRuntimeException(
        ErrorCategory.VALIDATION, "Brand update validation failed");

    // Mock service to throw ApplicationRuntimeException
    Mockito.doThrow(exception).when(productServiceWrapper).updateProductBrandValue(storeId, request);

    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_BRAND)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .build();

    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.post(uri)
            .accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false))).andExpect(jsonPath("$.errorMessage",
            equalTo("Can not process invalid input data :Brand update validation failed")))
        .andExpect(jsonPath("$.errorCode", equalTo(ErrorCategory.VALIDATION.getMessage())))
        .andReturn();

    // Verify service interaction
    verify(productServiceWrapper).updateProductBrandValue(storeId, request);
  }

  @Test
  public void updateBrand_Failure_Exception() throws Exception {
    // Given
    String storeId = "TEST_STORE";
    ProductBrandUpdateRequest request = ProductBrandUpdateRequest.builder()
        .productCode("PRODUCT_CODE_1")
        .newBrandName("New Brand Name")
        .oldBrandCode("NEW_BRAND_CODE")
        .onlyBrandNameUpdate(false)
        .brandLevelUpdateRequired(true)
        .build();

    // Mock service to throw generic Exception
    Mockito.doThrow(new RuntimeException("Unexpected error")).when(productServiceWrapper)
        .updateProductBrandValue(storeId, request);

    // Build URI
    URI uri = new URIBuilder()
        .setPath(ProductControllerPath.BASE_PATH + ProductControllerPath.UPDATE_BRAND)
        .addParameter("storeId", storeId)
        .addParameter("channelId", DEFAULT_CHANNEL_ID)
        .addParameter("clientId", DEFAULT_CLIENT_ID)
        .addParameter("requestId", getRequestId())
        .addParameter("username", DEFAULT_USERNAME)
        .build();

    // When & Then
    mockMvc.perform(MockMvcRequestBuilders.post(uri)
            .accept(MediaType.APPLICATION_JSON)
            .contentType(MediaType.APPLICATION_JSON)
            .content(getObjectMapper().writeValueAsString(request)))
        .andExpect(MockMvcResultMatchers.status().isOk())
        .andExpect(jsonPath("$.success", equalTo(false)))
        .andExpect(jsonPath("$.errorMessage", equalTo("Error occurred on the system")))
        .andExpect(jsonPath("$.errorCode", equalTo(ErrorCategory.UNSPECIFIED.getCode())))
        .andReturn();

    // Verify service interaction
    verify(productServiceWrapper).updateProductBrandValue(storeId, request);
  }

}
