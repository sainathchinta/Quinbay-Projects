package com.gdn.mta.product.service;

import static com.gdn.partners.pbp.commons.constants.Constants.ACTIVE;
import static com.gdn.partners.pbp.commons.constants.Constants.COPY_ALL_STATUS;
import static com.gdn.partners.pbp.commons.constants.Constants.DEFAULT;
import static com.gdn.partners.pbp.commons.constants.Constants.DEFAULT_STORE_ID;
import static com.gdn.partners.pbp.commons.constants.Constants.HYPHEN;
import static com.gdn.partners.pbp.commons.constants.Constants.PARTIAL_SUCCESS;
import static com.gdn.partners.pbp.commons.constants.Constants.PRODUCT_NAME;
import static com.gdn.partners.pbp.commons.constants.Constants.STORE_ID;
import static com.gdn.partners.pbp.commons.constants.Constants.SUCCESS;
import static com.gdn.partners.pbp.commons.constants.Constants.UPC_CODE;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyList;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.doNothing;
import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;
import static org.mockito.Mockito.atLeastOnce;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;

import com.gda.mta.product.dto.AuditTrailDto;
import com.gda.mta.product.dto.PreOrderRequest;
import com.gda.mta.product.dto.ProductItemDistributionInfoRequest;
import com.gdn.mta.product.entity.ProductFieldHistory;
import com.gdn.mta.product.service.config.KafkaPublisher;
import com.gda.mta.product.dto.BuyableScheduleRequest;
import com.gda.mta.product.dto.DiscoverableScheduleRequest;
import com.gda.mta.product.dto.ProductCollectionDTO;
import com.gda.mta.product.dto.ProductDetailEditDTO;
import com.gda.mta.product.dto.ProductItemImageHistoryDTO;
import com.gda.mta.product.dto.ProductLevel3ViewConfigStockRequest;
import com.gda.mta.product.dto.SyncStockUpdateOrInsertVo;
import com.gda.mta.product.dto.UpdateOrInsertStockVo;
import com.gda.mta.product.dto.response.ProductLevel3DetailResponse;
import com.gdn.mta.domain.event.config.DomainEventName;
import com.gdn.mta.product.entity.ProductBusinessPartner;
import com.gdn.mta.product.entity.ProductItemLevel3;
import com.gdn.mta.product.entity.ProductItemWholesalePrice;
import com.gdn.mta.product.repository.CategoryRepository;
import com.gdn.mta.product.repository.ProductBusinessPartnerRepository;
import com.gdn.mta.product.service.config.PreOrderConfig;
import com.gdn.mta.product.util.ProductWorkflowLookup;
import com.gdn.partners.pbp.commons.constants.SaveHistoryConstants;
import com.gdn.partners.pbp.service.productlevel1.ProductLevel1HistoryService;
import com.gdn.x.product.domain.event.config.ProductDomainEventName;
import com.gdn.x.product.enums.ProductType;
import com.gdn.x.product.model.entity.ItemViewConfig;
import com.gdn.x.product.model.entity.Price;
import com.gdn.x.product.rest.web.model.CombinedEditItemResponse;
import com.gdn.x.product.model.vo.ItemPickupPointVo;
import com.gdn.x.product.rest.web.model.request.ItemViewConfigAndItemSkuRequest;
import com.gdn.x.product.rest.web.model.request.ProductDetailPageEditRequest;
import com.gdn.x.product.rest.web.model.request.ProductEditRequest;
import com.gdn.x.product.rest.web.model.request.ProductRequest;
import com.gdn.x.product.rest.web.model.response.BuyableScheduleResponse;
import com.gdn.x.product.rest.web.model.response.DiscoverableScheduleResponse;
import com.gdn.x.product.rest.web.model.response.ProductAndItemsResponse;
import com.gdn.x.product.rest.web.model.response.ProductResponse;
import com.gdn.x.productcategorybase.dto.request.ItemImageEditRequest;
import com.gdn.x.productcategorybase.dto.response.AttributeResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryResponse;
import com.gdn.x.productcategorybase.dto.response.EditProductItemAndImageResponse;

import com.gdn.x.productcategorybase.dto.response.PredefinedAllowedAttributeValueResponse;
import org.apache.commons.collections4.CollectionUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.tuple.ImmutablePair;
import org.apache.commons.lang3.tuple.Pair;
import org.jetbrains.annotations.NotNull;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.mockito.Captor;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.MockitoAnnotations;
import org.slf4j.MDC;
import com.gdn.mta.product.util.BeanUtils;
import org.springframework.context.ApplicationContext;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.test.util.ReflectionTestUtils;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.gda.mta.product.dto.B2BFields;
import com.gda.mta.product.dto.ProductBundleRecipeRequest;
import com.gda.mta.product.dto.DeletedProductItems;
import com.gda.mta.product.dto.EditFlagChangesDTO;
import com.gda.mta.product.dto.EditProductResponse;
import com.gda.mta.product.dto.EditedResizeAndImagesUpdateStatusResponse;
import com.gda.mta.product.dto.ItemPickupPointRequest;
import com.gda.mta.product.dto.L5HistoryDTO;
import com.gda.mta.product.dto.PickupPointDeleteRequest;
import com.gda.mta.product.dto.PostLiveFlagsDTO;
import com.gda.mta.product.dto.ProductItemWholesalePriceRequest;
import com.gda.mta.product.dto.ProductLevel3SummaryDetailsImageRequest;
import com.gda.mta.product.dto.ProductVariantPriceStockAndImagesRequest;
import com.gda.mta.product.dto.ProductVariantUpdateRequest;
import com.gda.mta.product.dto.response.ItemBulkArchiveResponse;
import com.gda.mta.product.dto.response.ItemsPriceStockImagesUpdateResponse;
import com.gda.mta.product.dto.response.SimpleStringResponse;
import com.gdn.common.exception.ApplicationException;
import com.gdn.common.exception.ApplicationRuntimeException;
import com.gdn.common.web.param.MandatoryRequestParam;
import com.gdn.common.web.wrapper.response.GdnRestSingleResponse;
import com.gdn.micro.graphics.web.model.ImageRequest;
import com.gdn.mta.domain.event.modal.EditedImageResizeEvent;
import com.gdn.mta.product.commons.constant.UpdateProductActivity;
import com.gdn.mta.product.entity.ProductCollection;
import com.gdn.mta.product.entity.ProductItemBusinessPartner;
import com.gdn.mta.product.entity.ProductLevel3;
import com.gdn.mta.product.entity.ProductLevel3Attribute;
import com.gdn.mta.product.entity.ProductLevel3Logistics;
import com.gdn.mta.product.entity.ProductSystemParameter;
import com.gdn.mta.product.enums.ApiErrorCode;
import com.gdn.mta.product.enums.ProductLevel3Status;
import com.gdn.mta.product.repository.BusinessPartnerRepository;
import com.gdn.mta.product.repository.ProductCollectionRepository;
import com.gdn.mta.product.repository.ProductItemBusinessPartnerRepository;
import com.gdn.mta.product.repository.ProductLevel3Repository;
import com.gdn.mta.product.repository.ProductRepository;
import com.gdn.mta.product.repository.ProductStockAlertRepository;
import com.gdn.mta.product.service.converter.UpdateProductItemLevel3ModelConverter;
import com.gdn.mta.product.service.util.MapperUtil;
import com.gdn.mta.product.util.GdnBaseLookup;
import com.gdn.mta.product.util.GdnMandatoryRequestParameterUtil;
import com.gdn.partners.pbp.commons.constants.Constants;
import com.gdn.partners.pbp.commons.constants.SystemParameterConstants;
import com.gdn.partners.pbp.entity.productlevel3.ProductLevel3Aggregator;
import com.gdn.partners.pbp.model.productlevel3.ProductLevel3Inventory;
import com.gdn.partners.pbp.outbound.campaign.CampaignOutbound;
import com.gdn.partners.pbp.outbound.inventory.InventoryOutbound;
import com.gdn.partners.pbp.outbound.product.ProductOutbound;
import com.gdn.partners.pbp.outbound.product.feign.PCBFeign;
import com.gdn.partners.pbp.outbound.productPricing.ProductPricingOutbound;
import com.gdn.partners.pbp.outbound.xProduct.XProductOutbound;
import com.gdn.partners.pbp.service.notification.ProductNotificationService;
import com.gdn.partners.pbp.service.productlevel3.ProductItemWholesalePriceService;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3AggregatorService;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3InventoryService;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3LogisticsService;
import com.gdn.partners.product.pricing.web.model.dto.FailedItemReasonDto;
import com.gdn.partners.product.pricing.web.model.dto.WholeSalePriceSkuStatusDto;
import com.gdn.partners.product.pricing.web.model.response.BulkActivateDeactivateResponse;
import com.gdn.partners.product.pricing.web.model.response.WholesalePriceBulkUpdateResponse;
import com.gdn.partners.product.pricing.web.model.response.WholesalePriceSkuResponse;
import com.gdn.x.businesspartner.dto.CompanyDTO;
import com.gdn.x.businesspartner.dto.ProfileResponse;
import com.gdn.x.campaign.rest.web.model.request.CampaignUpdateDiscountRequest;
import com.gdn.x.campaign.rest.web.model.response.CampaignUpdateDiscountResponse;
import com.gdn.x.inventory.v2.rest.web.model.transaction.request.InventoryDetailInfoRequestDTO;
import com.gdn.x.inventory.v2.rest.web.model.transaction.response.WebInventoryUpdatePickupPointResponseDTO;
import com.gdn.x.product.model.entity.ItemPickupPoint;
import com.gdn.x.product.rest.web.model.EditItemResponse;
import com.gdn.x.product.rest.web.model.L3VersionResponse;
import com.gdn.x.product.rest.web.model.dto.CategoryDTO;
import com.gdn.x.product.rest.web.model.dto.MasterCatalogDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataProductDTO;
import com.gdn.x.product.rest.web.model.request.AddDeleteVariantRequest;
import com.gdn.x.product.rest.web.model.request.ItemPickupPointListingRequest;
import com.gdn.x.product.rest.web.model.request.ItemPickupPointQuickEditRequest;
import com.gdn.x.product.rest.web.model.response.ItemPickupPointListingResponse;
import com.gdn.x.product.rest.web.model.response.ItemResponseV2;
import com.gdn.x.product.rest.web.model.response.PriceResponse;
import com.gdn.x.product.rest.web.model.response.ProductL3Response;
import com.gda.mta.product.dto.ProductL3UpdateRequest;
import com.gdn.x.productcategorybase.dto.response.ProductDetailResponse;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3Helper;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.gdn.x.productcategorybase.entity.Product;
import com.gdn.mta.product.service.DistributionInfoServiceBean;
import com.gdn.x.businesspartner.dto.ProfileResponse;
import com.gdn.x.product.rest.web.model.response.ViewConfigResponse;
import com.gdn.x.productcategorybase.AttributeType;
import com.gdn.x.productcategorybase.dto.ConfigurationStatusRequest;
import com.gdn.x.productcategorybase.dto.ConfigurationStatusResponse;
import com.gdn.x.productcategorybase.dto.allowedvalue.AllowedAttributeValueRequest;
import com.gdn.x.productcategorybase.dto.allowedvalue.AllowedAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.allowedvalue.AllowedValueResponse;
import com.gdn.x.productcategorybase.dto.request.CopyImageEditRequest;
import com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemImageUpdateRequest;
import com.gdn.x.productcategorybase.dto.request.SkuCodesRequest;
import com.gdn.x.productcategorybase.dto.response.NewlySavedItemResponse;
import com.gdn.x.productcategorybase.dto.response.ProductItemResponse;
import com.gdn.x.productcategorybase.dto.response.WholesaleMappingResponse;
import com.gdn.x.productcategorybase.entity.AllowedAttributeValue;
import com.gdn.x.productcategorybase.entity.Attribute;
import com.gdn.x.productcategorybase.entity.Product;
import com.gdn.x.productcategorybase.entity.ProductAttribute;
import com.gdn.x.productcategorybase.entity.ProductAttributeValue;

public class ProductLevel3ServiceBeanNewTest {

  private static final String STOREID = "storeId";
  private static final String CHANNELID = "channelId";
  private static final String CLIENTID = "clientId";
  private static final String REQUESTID = "requestId";
  private static final String USERNAME = "username";
  private static final String PRODUCT_CODE = "productCode";
  private static final String ITEM_CODE = "MTA-00001-00001";
  private static final String CATEGORY_CODE = "categoryCode";
  private static final String BUSINESS_PARTNER_CODE = "bpCode";
  private static final String ITEM_SKU = "itemSku";
  private static final String ITEM_SKU_COPY = "itemSkuCopy";
  private static final String DEFAULT_MERCHANT_SKU_2 = "MSKU-00002";
  private static final String PICKUP_POINT_CODE = "pickupPointCode";
  private static final String PICKUP_POINT_CODE_1 = "pickupPointCode1";
  private static final String PICKUP_POINT_CODE_2 = "pickupPointCode2";
  private static final String PICKUP_POINT_CODE_3 = "pickupPointCode3";
  private static final Integer MIN_STOCK = 5;
  private static final String PRODUCT_SKU = "productSku";
  private static final String ITEM_SKU_1 = "itemSku1";
  private static final String ITEM_SKU_2 = "itemSku2";
  private static final String ITEM_SKU_3 = "itemSku3";
  private static final String ITEM_NAME = "itemName";
  private static final String ITEM_NAME_1 = "itemName1";
  private static final String UPDATED_UPC_CODE = "upcCode";
  private static final String SKU_CODE = "skuCode";
  private static final String SKU_CODE_1 = "skuCode1";
  private static final String UPDATE = "update";
  private static final String LOCATION_PATH = "locationPath";
  private static final String SELLER_SKU = "sellerSku";
  private static final String ACTIVE_STATUS = "ACTIVE";
  private static final String INACTIVE_STATUS = "INACTIVE";
  private static final String VALUE_1 = "value1";
  private static final String ATTRIBUTE_CODE_1 = "attributeCode1";
  private static final String VALUE_2 = "value2";
  private static final String ATTRIBUTE_CODE_2 = "attributeCode2";
  private static final String NO_MAIN_IMAGE_PRESENT = "No main image present";
  private static final String GDN_SKU = "gdnSku";
  private static final String CURRENT_VALUE = "current_value";
  private static final String PREVIOUS_VALUE = "previous_value";
  private static final String ACTIVITY = "activity";
  private static final String BUSINESS_PARTNER_ID = "businessPartnerId";

  @InjectMocks
  private ProductLevel3ServiceBean productLevel3ServiceBean;

  @Mock
  private PreOrderConfig preOrderConfig;

  @Mock
  private XProductOutbound xProductOutbound;

  @Mock
  private VariantEditValidationService variantEditValidationService;

  @Mock
  private ProductOutbound productOutbound;

  @Mock
  private ProductItemBusinessPartnerRepository productItemBusinessPartnerRepository;

  @Mock
  private ProductItemWholesalePriceService productItemWholesalePriceService;

  @Mock
  private ProductLevel3InventoryService productLevel3InventoryService;

  @Mock
  private ProductPricingOutbound productPricingOutbound;

  @Mock
  private ProductService productService;

  @Mock
  private UpdatedProductHistoryService updatedProductHistoryService;

  @Mock
  private BusinessPartnerRepository businessPartnerRepository;

  @Mock
  private ProductBusinessPartnerService productBusinessPartnerService;

  @Mock
  private ProductItemBusinessPartnerService productItemBusinessPartnerService;

  @Mock
  private ProductNotificationService productNotificationService;

  @Mock
  private ProductCollectionRepository productCollectionRepository;

  @Mock
  private ProductRepository productRepository;

  @Mock
  private CampaignOutbound campaignOutbound;

  @Mock
  private PCBFeign pcbFeign;

  @Mock
  private UpdateProductItemLevel3ModelConverter updateProductItemLevel3ModelConverter;

  @Mock
  private ProductLevel3Helper productLevel3Helper;

  @Mock
  private ObjectMapper objectMapper;

  @Mock
  private DistributionInfoServiceBean distributionInfoServiceBean;

  @Mock
  private ProductLevel3Repository productLevel3Repository;

  @Mock
  private MapperUtil mapperUtil;

  @Mock
  private ApplicationContext applicationContext;

  @Mock
  InventoryOutbound inventoryOutbound;

  @Mock
  private ProductSystemParameterService productSystemParameterService;

  @Mock
  private ProductLevel3LogisticsService productLevel3LogisticsService;

  @Mock
  private ProductLevel3ServiceBean productLevel3ServiceBeanMock;

  @Mock
  private ProductPublisherService productPublisherService;

  @Mock
  private ProductLevel3AggregatorService productLevel3AggregatorService;

  @Mock
  private ProductStockAlertRepository productStockAlertRepository;

  @Mock
  private ProductLevel3V2Service productLevel3V2Service;

  @Mock
  private FileStorageService fileStorageService;

  @Mock
  private KafkaPublisher kafkaProducer;

  @Mock
  private CategoryRepository categoryRepository;

  @Mock
  private ProductBusinessPartnerRepository productBusinessPartnerRepository;

  @Captor
  private ArgumentCaptor<List<InventoryDetailInfoRequestDTO>> inventoryDetailInfoRequestDTOListCaptor;

  @Captor
  private ArgumentCaptor<List<ItemPickupPointQuickEditRequest>> itemPickupPointQuickEditRequestCaptor;

  @Captor
  private ArgumentCaptor<List<ProductItemBusinessPartner>> productItemBusinessPartnerListCaptor;

  @Captor
  private ArgumentCaptor<List<ProductLevel3Inventory>> productLevel3InventoryListArgumentCaptor;

  @Captor
  private ArgumentCaptor<SyncStockUpdateOrInsertVo> syncStockUpdateOrInsertVoArgumentCaptor;

  @Captor
  private ArgumentCaptor<ProductCollection> productCollectionArgumentCaptor;

  @Captor
  private ArgumentCaptor<UpdateOrInsertStockVo> updateOrInsertStockVoArgumentCaptor;

  @Mock
  private BundleRecipeService bundleRecipeService;

  @Mock
  private ProductLevel1HistoryService productLevel1HistoryService;

  @Captor
  private ArgumentCaptor<List<ProductItemWholesalePrice>> productItemWholesalePriceArgumentCaptor;
  private MandatoryRequestParam mandatoryRequestParam;
  private ProductVariantUpdateRequest productVariantUpdateRequest;
  private ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest;
  private ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1;
  private ItemPickupPointRequest itemPickupPointRequest;
  private ItemPickupPointRequest itemPickupPointRequestCopy = new ItemPickupPointRequest();
  private ItemPickupPointRequest addPickupPointRequest;
  private ItemPickupPointRequest itemPickupPointRequest1;
  private ProductL3Response productL3Response;
  private EditProductResponse editProductResponse;
  private ItemPickupPointListingRequest itemPickupPointListingRequest;
  private ItemPickupPointListingRequest itemPickupPointListingRequest1;
  private ItemPickupPointListingRequest itemPickupPointListingRequest2;
  private ItemPickupPointListingResponse itemPickupPointListingResponse;
  private ItemPickupPointListingResponse itemPickupPointListingResponse1;
  private ProductItemBusinessPartner productItemBusinessPartner;
  private List<InventoryDetailInfoRequestDTO> inventoryDetailInfoRequestDTOList;
  private List<ProductLevel3Inventory> productLevel3Inventories;
  private ProfileResponse profileResponse;
  private ProductCollection productCollection;
  private WholesaleMappingResponse wholesaleMappingResponse;
  private EditItemResponse editItemResponse = new EditItemResponse();
  private WebInventoryUpdatePickupPointResponseDTO updatePickupPointResponse;
  private Product product;
  private Map<String, ProductLevel3Attribute> newProductAttributes = new HashMap<>();
  private Map<String, List<String>> attributeCodeToValuesRequestMap = new HashMap<>();
  private ProductLevel3 productLevel3 = new ProductLevel3();
  private CombinedEditItemResponse combinedEditItemResponse;
  private EditProductItemAndImageResponse editProductItemAndImageResponse;
  private  Pair<CombinedEditItemResponse, EditProductItemAndImageResponse>
      combinedEditItemResponseEditProductItemAndImageResponsePair;
  private L5HistoryDTO l5HistoryDTO = new L5HistoryDTO();
  private Map<String, String> historyMap = new HashMap<>();
  private ProductBundleRecipeRequest bundleRecipeRequest = new ProductBundleRecipeRequest();
  private ProductDetailEditDTO productDetailEditDTO;
  private ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
  private ItemPickupPointListingResponse response1;
  private ItemPickupPointListingResponse response2;
  private ItemPickupPointListingResponse response3;

  @BeforeEach
  public void setUp() throws Exception {
    MockitoAnnotations.initMocks(this);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "maxWholesalePriceRequests", 5);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPriceClientId", "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPrice", false);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "relaxPriceEditDisabledCheck", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"instoreNewFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"wholesalePriceFetchBatchSize", 2);
    MDC.put(GdnMandatoryRequestParameterUtil.REQUEST_ID_KEY_PARAMETER, REQUESTID);
    mandatoryRequestParam =
        MandatoryRequestParam.generateMandatoryRequestParam(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, null);

    MDC.put(GdnMandatoryRequestParameterUtil.STORE_ID_KEY_PARAMETER, STOREID);
    MDC.put(GdnMandatoryRequestParameterUtil.CHANNEL_ID_KEY_PARAMETER, CHANNELID);
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, CLIENTID);
    MDC.put(GdnMandatoryRequestParameterUtil.REQUEST_ID_KEY_PARAMETER, REQUESTID);
    MDC.put(GdnMandatoryRequestParameterUtil.USERNAME_KEY_PARAMETER, USERNAME);
    MDC.put(GdnMandatoryRequestParameterUtil.AUTHENTICATOR_KEY, null);

    productVariantUpdateRequest = new ProductVariantUpdateRequest();
    productVariantUpdateRequest.setProductSku(PRODUCT_SKU);
    productVariantUpdateRequest.setProductName(Constants.PRODUCT_NAME);
    productVariantUpdateRequest.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest = new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1 = new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME_1);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU_1);

    itemPickupPointRequest = new ItemPickupPointRequest();
    itemPickupPointRequest.setItemSku(ITEM_SKU);
    itemPickupPointRequest.setPickupPointId(PICKUP_POINT_CODE);
    itemPickupPointRequest.setPrice(100.0);
    itemPickupPointRequest.setSalePrice(100.0);

    addPickupPointRequest = new ItemPickupPointRequest();
    addPickupPointRequest.setItemSku(ITEM_SKU);
    addPickupPointRequest.setPickupPointId(PICKUP_POINT_CODE);
    addPickupPointRequest.setPrice(100.0);
    addPickupPointRequest.setSalePrice(100.0);

    itemPickupPointRequest1 = new ItemPickupPointRequest();
    itemPickupPointRequest1.setItemSku(ITEM_SKU_1);
    itemPickupPointRequest1.setPickupPointId(PICKUP_POINT_CODE);
    itemPickupPointRequest1.setPrice(100.0);
    itemPickupPointRequest1.setSalePrice(100.0);

    productVariantPriceStockAndImagesRequest
        .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
        .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
        Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));

    productL3Response = new ProductL3Response();
    productL3Response.setProductSku(PRODUCT_SKU);
    productL3Response.setProductCode(PRODUCT_CODE);
    MasterCatalogDTO masterCatalogDTO = new MasterCatalogDTO();
    CategoryDTO categoryDTO = new CategoryDTO();
    categoryDTO.setCategoryCode(CATEGORY_CODE);
    masterCatalogDTO.setCategory(categoryDTO);
    productL3Response.setMasterCatalog(masterCatalogDTO);
    productL3Response.getMasterCatalog().getCategory().getCategoryCode();
    itemPickupPointListingRequest = new ItemPickupPointListingRequest();
    itemPickupPointListingRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setItemSku(ITEM_SKU);
    itemPickupPointListingRequest.setPickupPointCodes(Collections.singleton(PICKUP_POINT_CODE));

    itemPickupPointListingRequest1 = new ItemPickupPointListingRequest();
    itemPickupPointListingRequest1.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest1.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest1.setItemSku(ITEM_SKU_1);
    itemPickupPointListingRequest1.setPickupPointCodes(Collections.singleton(PICKUP_POINT_CODE));

    itemPickupPointListingRequest2 = new ItemPickupPointListingRequest();
    itemPickupPointListingRequest2.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest2.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest2.setItemSku(ITEM_SKU_COPY);
    itemPickupPointListingRequest2.setPickupPointCodes(new HashSet<>());

    itemPickupPointListingResponse = new ItemPickupPointListingResponse();
    itemPickupPointListingResponse.setItemSku(ITEM_SKU);
    itemPickupPointListingResponse.setItemName(ITEM_NAME);
    itemPickupPointListingResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    PriceResponse priceResponse = new PriceResponse();
    priceResponse.setPrice(100);
    priceResponse.setSalePrice(100);
    itemPickupPointListingResponse.setPrices(Collections.singletonList(priceResponse));
    ViewConfigResponse viewConfigResponse = new ViewConfigResponse();
    viewConfigResponse.setBuyable(false);
    viewConfigResponse.setDisplay(false);
    itemPickupPointListingResponse.setViewConfigs(Collections.singletonList(viewConfigResponse));

    itemPickupPointListingResponse1 = new ItemPickupPointListingResponse();
    itemPickupPointListingResponse1.setItemSku(ITEM_SKU_1);
    itemPickupPointListingResponse1.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse1.setProductSku(PRODUCT_SKU);
    itemPickupPointListingResponse1.setItemName(ITEM_NAME_1);
    itemPickupPointListingResponse1.setPickUpPointCode(PICKUP_POINT_CODE);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setPrices(Collections.singletonList(priceResponse));
    itemPickupPointListingResponse1.setPrices(Collections.singletonList(priceResponse));
    itemPickupPointListingResponse1.setViewConfigs(Collections.singletonList(viewConfigResponse));

    productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productItemBusinessPartner.setPickupPointId(PICKUP_POINT_CODE);

    inventoryDetailInfoRequestDTOList = new ArrayList<>();
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO = new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setWebItemSku(ITEM_SKU);
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);

    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO1 = new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO1.setWebItemSku(ITEM_SKU_1);
    inventoryDetailInfoRequestDTO1.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO1.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTOList.add(inventoryDetailInfoRequestDTO);
    inventoryDetailInfoRequestDTOList.add(inventoryDetailInfoRequestDTO1);

    productLevel3Inventories = new ArrayList<>();
    ProductLevel3Inventory productLevel3Inventory = new ProductLevel3Inventory();
    productLevel3Inventory.setWebItemSku(ITEM_SKU);
    productLevel3Inventory.setWebPickupPointCode(PICKUP_POINT_CODE);
    productLevel3Inventory.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Inventory.setWebAvailable(10);

    ProductLevel3Inventory productLevel3Inventory1 = new ProductLevel3Inventory();
    productLevel3Inventory1.setWebItemSku(ITEM_SKU_1);
    productLevel3Inventory1.setWebPickupPointCode(PICKUP_POINT_CODE);
    productLevel3Inventory1.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Inventory1.setWebAvailable(10);

    productLevel3Inventories.add(productLevel3Inventory);
    productLevel3Inventories.add(productLevel3Inventory1);

    profileResponse = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setCncActivated(true);
    companyDTO.setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BUSINESS_PARTNER);
    profileResponse.setCompany(companyDTO);

    productCollection = new ProductCollection();
    productCollection.setBusinessPartnerCode(Constants.INTERNAL);

    wholesaleMappingResponse = new WholesaleMappingResponse();

    Mockito.when(applicationContext.getBean(ProductLevel3Service.class))
        .thenReturn(productLevel3ServiceBean);

    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    updatePickupPointResponse = new WebInventoryUpdatePickupPointResponseDTO();
    WebInventoryUpdatePickupPointResponseDTO.UpdatePickupPointError error =
      new WebInventoryUpdatePickupPointResponseDTO.UpdatePickupPointError();
    updatePickupPointResponse.setErrors(Arrays.asList(error));

    product = new Product();
    ProductAttribute productAttribute = new ProductAttribute();
    Attribute attribute = new Attribute();
    attribute.setVariantCreation(true);
    attribute.setAttributeType(AttributeType.DEFINING_ATTRIBUTE);
    attribute.setAttributeCode(ATTRIBUTE_CODE_1);
    productAttribute.setAttribute(attribute);
    ProductAttributeValue productAttributeValue = new ProductAttributeValue();
    AllowedAttributeValue allowedAttributeValue = new AllowedAttributeValue();
    allowedAttributeValue.setValue(VALUE_1);
    productAttributeValue.setAllowedAttributeValue(allowedAttributeValue);
    productAttribute.setProductAttributeValues(new ArrayList<>(Collections.singletonList(productAttributeValue)));

    ProductAttribute productAttribute2 = new ProductAttribute();
    Attribute attribute2 = new Attribute();
    attribute2.setVariantCreation(true);
    attribute2.setAttributeType(AttributeType.DESCRIPTIVE_ATTRIBUTE);
    attribute2.setAttributeCode(ATTRIBUTE_CODE_2);
    productAttribute2.setAttribute(attribute2);
    ProductAttributeValue productAttributeValue2 = new ProductAttributeValue();
    productAttributeValue2.setDescriptiveAttributeValue(VALUE_2);
    productAttribute2.setProductAttributeValues(new ArrayList<>(Collections.singletonList(productAttributeValue2)));

    product.setProductAttributes(new ArrayList<>(Arrays.asList(productAttribute, productAttribute2)));

    newProductAttributes = new HashMap<>();
    ProductLevel3Attribute productLevel3Attribute = new ProductLevel3Attribute();
    productLevel3Attribute.setAttributeCode(ATTRIBUTE_CODE_1);
    productLevel3Attribute.setValues(new ArrayList<>(Collections.singletonList(VALUE_1)));

    ProductLevel3Attribute productLevel3Attribute1 = new ProductLevel3Attribute();
    productLevel3Attribute1.setAttributeCode(ATTRIBUTE_CODE_2);
    productLevel3Attribute1.setValues(new ArrayList<>(Collections.singletonList(VALUE_2)));
    newProductAttributes.put(ATTRIBUTE_CODE_1, productLevel3Attribute);
    newProductAttributes.put(ATTRIBUTE_CODE_2, productLevel3Attribute1);

    attributeCodeToValuesRequestMap = new HashMap<>();
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_1, Collections.singletonList(VALUE_1));
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_2, Collections.singletonList(VALUE_2));

    productLevel3.setDeletedItems(Arrays.asList(ITEM_SKU));

    historyMap.put(ITEM_NAME, ITEM_NAME);
    historyMap.put(CURRENT_VALUE, CURRENT_VALUE);
    historyMap.put(PREVIOUS_VALUE, PREVIOUS_VALUE);
    historyMap.put(ACTIVITY, ACTIVITY);

    l5HistoryDTO.setItemSku(ITEM_SKU);
    l5HistoryDTO.setPickupPointCode(PICKUP_POINT_CODE);
    l5HistoryDTO.setHistoryList(Arrays.asList(historyMap));

    ReflectionTestUtils.setField(productLevel3ServiceBean, "enableAddPickupPointCheck", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "inventoryInsertBatchSizeForEdit", 100);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "suppressItemImageUpdateError", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    editProductResponse = new EditProductResponse();
    productDetailEditDTO = new ProductDetailEditDTO();
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productEditRequest.setForceReview(false);
    productEditRequest.setProductRequest(new ProductRequest());
    productEditRequest.setLatefulfillment(false);
    ItemViewConfigAndItemSkuRequest itemViewConfigAndItemSkuRequest =
      ItemViewConfigAndItemSkuRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_CODE)
        .build();
    itemViewConfigAndItemSkuRequest.setBuyable(true);
    itemViewConfigAndItemSkuRequest.setDiscoverable(true);
    productEditRequest.setItemViewConfigAndItemSkuListRequest(Collections.singletonList(itemViewConfigAndItemSkuRequest));
    productDetailEditDTO.setProductDetailEditRequestForXProduct(
      ProductDetailPageEditRequest.builder().productEditRequest(productEditRequest).build());
    ProductCollectionDTO productCollectionDTO =
      ProductCollectionDTO.builder().productCode(PRODUCT_CODE).postLive(true).build();
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
      new ProductImageEditRequest();
    productImageEditRequest.setImagePath(LOCATION_PATH);
    productImageEditRequest.setProductItems(Collections.singletonList(new ItemImageEditRequest()));
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setAdd(true);
    copyImageEditRequest.setMainImage(true);
    productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
    productDetailEditDTO.setProductImageEditRequests(Collections.singletonList(productImageEditRequest));
    productDetailEditDTO.setProductLevel3(productLevel3);
    productDetailEditDTO.getProductLevel3().setProductType(1);
    productDetailEditDTO.setProductLevel3DetailResponse(new ProductLevel3DetailResponse());
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    combinedEditItemResponse =  new CombinedEditItemResponse();
    editProductItemAndImageResponse = new EditProductItemAndImageResponse();
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Arrays.asList(newlySavedItemResponse, newlySavedItemResponse1));
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap("new", LOCATION_PATH)));
    BeanUtils.copyProperties(editItemResponse, combinedEditItemResponse);
      combinedEditItemResponseEditProductItemAndImageResponsePair =
      Pair.of(combinedEditItemResponse, editProductItemAndImageResponse);
    Mockito.when(productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(),any())).thenReturn(combinedEditItemResponseEditProductItemAndImageResponsePair);
    Mockito.when(productLevel3V2Service.performPCBUpdateForPDPEditRequest(any() ,any())).thenReturn(editProductItemAndImageResponse);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "brandAttributeCodes", "BR-M036969, BR-M036968");
    response1 = new ItemPickupPointListingResponse();
    response1.setItemSku(ITEM_SKU_1);
    response1.setPickUpPointCode(PICKUP_POINT_CODE_1);
    response2 = new ItemPickupPointListingResponse();
    response2.setItemSku(ITEM_SKU_2);
    response2.setPickUpPointCode(PICKUP_POINT_CODE_2);
    response3 = new ItemPickupPointListingResponse();
    response3.setItemSku(ITEM_SKU_3);
    response3.setPickUpPointCode(PICKUP_POINT_CODE_3);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(false);
  }

  @AfterEach
  public void tearDown() throws Exception {
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(productOutbound);
    Mockito.verifyNoMoreInteractions(productItemBusinessPartnerRepository);
    Mockito.verifyNoMoreInteractions(productLevel3InventoryService);
    Mockito.verifyNoMoreInteractions(updatedProductHistoryService);
    Mockito.verifyNoMoreInteractions(businessPartnerRepository);
    Mockito.verifyNoMoreInteractions(productBusinessPartnerService);
    Mockito.verifyNoMoreInteractions(productNotificationService);
    Mockito.verifyNoMoreInteractions(productCollectionRepository);
    Mockito.verifyNoMoreInteractions(productRepository);
    Mockito.verifyNoMoreInteractions(pcbFeign);
    Mockito.verifyNoMoreInteractions(productPricingOutbound);
    Mockito.verifyNoMoreInteractions(updateProductItemLevel3ModelConverter);
    Mockito.verifyNoMoreInteractions(applicationContext);
    Mockito.verifyNoMoreInteractions(inventoryOutbound);
    Mockito.verifyNoMoreInteractions(productItemBusinessPartnerService);
    Mockito.verifyNoMoreInteractions(productSystemParameterService);
    Mockito.verifyNoMoreInteractions(productLevel3LogisticsService);
    Mockito.verifyNoMoreInteractions(productPublisherService, productLevel3AggregatorService,
        productLevel3AggregatorService, productStockAlertRepository, bundleRecipeService,
        productLevel3V2Service);
    Mockito.verifyNoMoreInteractions(kafkaProducer);
  }

  private ProductType getProductTypeFromCode(int code) {
    if (ProductType.REGULAR.getCode() == code) {
      return ProductType.REGULAR;
    } else if (ProductType.BIG_PRODUCT.getCode() == code) {
      return ProductType.BIG_PRODUCT;
    } else {
      return ProductType.BOPIS;
    }
  }

  @Test
  public void updateProductItemViewConfigTest() throws Exception {
    ProductLevel3ViewConfigStockRequest productLevel3ViewConfigStockRequest =
        new ProductLevel3ViewConfigStockRequest();
    productLevel3ViewConfigStockRequest.setDisplay(false);
    productLevel3ViewConfigStockRequest.setBuyable(false);
    productLevel3ViewConfigStockRequest.setChannelId(CHANNELID);
    productLevel3ViewConfigStockRequest.setCncActive(true);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setProductItemBusinessPartners(
        Arrays.asList(productItemBusinessPartner));
    Mockito.when(
        this.productBusinessPartnerRepository.findByStoreIdAndGdnProductSkuIn(Mockito.any(),
            Mockito.anyList())).thenReturn(Arrays.asList(productBusinessPartner));

    productLevel3ServiceBean.updateProductItemViewConfig(productLevel3ViewConfigStockRequest,
        PRODUCT_SKU);

    Mockito.verify(this.productBusinessPartnerRepository)
        .findByStoreIdAndGdnProductSkuIn(Mockito.any(), Mockito.anyList());
    Mockito.verify(productBusinessPartnerRepository).saveAll(Mockito.anyList());
  }

  @Test
  public void updateProductItemViewConfig_cncForWarehouseTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    ProductLevel3ViewConfigStockRequest productLevel3ViewConfigStockRequest =
        new ProductLevel3ViewConfigStockRequest();
    productLevel3ViewConfigStockRequest.setDisplay(false);
    productLevel3ViewConfigStockRequest.setBuyable(false);
    productLevel3ViewConfigStockRequest.setChannelId(CHANNELID);
    productLevel3ViewConfigStockRequest.setCncActive(true);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setProductItemBusinessPartners(
        Arrays.asList(productItemBusinessPartner));
    Mockito.when(
        this.productBusinessPartnerRepository.findByStoreIdAndGdnProductSkuIn(Mockito.any(),
            Mockito.anyList())).thenReturn(Arrays.asList(productBusinessPartner));

    productLevel3ServiceBean.updateProductItemViewConfig(productLevel3ViewConfigStockRequest,
        PRODUCT_SKU);

    Mockito.verify(this.productBusinessPartnerRepository)
        .findByStoreIdAndGdnProductSkuIn(Mockito.any(), Mockito.anyList());
    Mockito.verify(productBusinessPartnerRepository).saveAll(Mockito.anyList());
  }

  @Test
  public void updateProductItemViewConfigTestForB2bTrue() throws Exception {
    ProductLevel3ViewConfigStockRequest productLevel3ViewConfigStockRequest =
        new ProductLevel3ViewConfigStockRequest();
    productLevel3ViewConfigStockRequest.setDisplay(false);
    productLevel3ViewConfigStockRequest.setBuyable(false);
    productLevel3ViewConfigStockRequest.setChannelId(CHANNELID);
    productLevel3ViewConfigStockRequest.setCncActive(true);
    productLevel3ViewConfigStockRequest.setB2bDisplay(true);
    productLevel3ViewConfigStockRequest.setB2bBuyable(true);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setProductItemBusinessPartners(
        Arrays.asList(productItemBusinessPartner));
    Mockito.when(
        this.productBusinessPartnerRepository.findByStoreIdAndGdnProductSkuIn(Mockito.any(),
            Mockito.anyList())).thenReturn(Arrays.asList(productBusinessPartner));

    productLevel3ServiceBean.updateProductItemViewConfig(productLevel3ViewConfigStockRequest,
        PRODUCT_SKU);

    Mockito.verify(this.productBusinessPartnerRepository)
        .findByStoreIdAndGdnProductSkuIn(Mockito.any(), Mockito.anyList());
    Mockito.verify(productBusinessPartnerRepository).saveAll(Mockito.anyList());
  }

  @Test
  public void updateProductItemViewConfigWithStockTest() throws Exception {
    ProductLevel3ViewConfigStockRequest productLevel3ViewConfigStockRequest =
        new ProductLevel3ViewConfigStockRequest();
    productLevel3ViewConfigStockRequest.setDisplay(false);
    productLevel3ViewConfigStockRequest.setBuyable(false);
    productLevel3ViewConfigStockRequest.setAvailableStock(10);
    productLevel3ViewConfigStockRequest.setChannelId(CHANNELID);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setProductItemBusinessPartners(
        Arrays.asList(productItemBusinessPartner));
    Mockito.when(
        this.productBusinessPartnerRepository.findByStoreIdAndGdnProductSkuIn(Mockito.any(),
            Mockito.anyList())).thenReturn(Arrays.asList(productBusinessPartner));

    productLevel3ServiceBean.updateProductItemViewConfig(productLevel3ViewConfigStockRequest,
        ITEM_SKU);

    Mockito.verify(this.productBusinessPartnerRepository)
        .findByStoreIdAndGdnProductSkuIn(Mockito.any(), Mockito.anyList());
    Mockito.verify(productBusinessPartnerRepository).saveAll(Mockito.anyList());
  }

  @Test
  public void updateProductItemViewConfigExceptionTest() throws Exception {
    ProductLevel3ViewConfigStockRequest productLevel3ViewConfigStockRequest =
        new ProductLevel3ViewConfigStockRequest();
    productLevel3ViewConfigStockRequest.setDisplay(false);
    productLevel3ViewConfigStockRequest.setBuyable(false);
    productLevel3ViewConfigStockRequest.setChannelId(CHANNELID);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setProductItemBusinessPartners(new ArrayList());
    Mockito.when(
        this.productBusinessPartnerRepository.findByStoreIdAndGdnProductSkuIn(Mockito.any(),
            Mockito.anyList())).thenReturn(Arrays.asList(productBusinessPartner));

    try {
      Assertions.assertThrows(ApplicationException.class, () -> {
        productLevel3ServiceBean.updateProductItemViewConfig(productLevel3ViewConfigStockRequest,
            ITEM_SKU);
      });
    } finally {
      Mockito.verify(this.productBusinessPartnerRepository)
          .findByStoreIdAndGdnProductSkuIn(Mockito.any(), Mockito.anyList());
    }
  }

  @Test
  public void editProductItemsPriceStockImagesL5NullTest() throws Exception {
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(ITEM_SKU, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemSku());
    Assertions.assertEquals(ITEM_SKU_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemSku());
    Assertions.assertEquals(ITEM_NAME, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemName());
    Assertions.assertEquals(ITEM_NAME_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemName());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getPickupPointCode());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getMessage());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getMessage());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNullTest() throws Exception {
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(null, null, false, null, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(new ArrayList<>(), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(new ArrayList<>(), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(ITEM_SKU, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemSku());
    Assertions.assertEquals(ITEM_SKU_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemSku());
    Assertions.assertEquals(ITEM_NAME, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemName());
    Assertions.assertEquals(ITEM_NAME_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemName());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getPickupPointCode());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getMessage());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getMessage());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductArchivedTest() throws Exception {
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);

    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(ITEM_SKU, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemSku());
    Assertions.assertEquals(ITEM_SKU_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemSku());
    Assertions.assertEquals(ITEM_NAME, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemName());
    Assertions.assertEquals(ITEM_NAME_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemName());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getPickupPointCode());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getMessage());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getMessage());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNotEditableTest() throws Exception {
    productL3Response.setSynchronized(false);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(ITEM_SKU, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemSku());
    Assertions.assertEquals(ITEM_SKU_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemSku());
    Assertions.assertEquals(ITEM_NAME, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getItemName());
    Assertions.assertEquals(ITEM_NAME_1, itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getItemName());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getPickupPointCode());
    Assertions.assertEquals(
        ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(0).getMessage());
    Assertions.assertEquals(
        ApiErrorCode.PRODUCT_NOT_FOUND.getDesc() + StringUtils.SPACE + productVariantUpdateRequest.getProductSku(),
        itemsPriceStockImagesUpdateResponse.getVariantsErrorList().get(1).getMessage());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesTest() throws Exception {
    productL3Response.setSynchronized(true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingResponse1.setFbbActive(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesLogisticsSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", false);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesAddDeleteSwitchTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getAddPickupPoints().forEach(itemPickupPointRequest2 -> itemPickupPointRequest2.setFbbActive(false));
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesAddDeleteSwitchProductItemsTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "mppForWhEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "combinedEditFlowEnabled", true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setFbbActive(true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productItemBusinessPartner.setFbbActive(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    productVariantUpdateRequest.getAddPickupPoints().forEach(itemPickupPointRequest2 -> itemPickupPointRequest2.setFbbActive(true));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
      eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
      Mockito.any());
    Mockito.verify(productLevel3InventoryService).insertInventory(anyList());
    Mockito.verify(updatedProductHistoryService, times(2))
      .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
        any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesAddDeleteSwitchProductItemsTestWithWHSwitchOn() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "mppForWhEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.getAddPickupPoints().forEach(itemPickupPointRequest2 -> itemPickupPointRequest2.setFbbActive(false));
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
      productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
      eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
      Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
        Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductLogisticsUpdate() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    productCollection.setProductCode(PRODUCT_CODE);
    editResponse.setProductCollection(productCollection);
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
        eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
        Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
            Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
            UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
            Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductForNoDeleteList() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Collections.emptyList());
    DeletedProductItems deletedProductItems = new DeletedProductItems();
    deletedProductItems.setItemSku(ITEM_SKU);
    deletedProductItems.setItemCode(ITEM_CODE);
    productVariantUpdateRequest.setDeletedProductItems(Collections.singletonList(deletedProductItems));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
      productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
      eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
      Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU_1,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
      productVariantPriceStockAndImagesRequest.getProductSku(), null,
      UpdateProductActivity.ITEM_DELETED.getDesc(), ITEM_SKU, StringUtils.EMPTY, false, Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductWithNoAddDeleteRequest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setAddPickupPoints(Collections.emptyList());
    productVariantUpdateRequest.setDeletePickupPoints(Collections.emptyList());
    productVariantUpdateRequest.getProductItems().stream().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setNewlyAddedItem(false));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Collections.emptyList());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
      productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
      eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
      Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU_1,
        false,
        Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WithDeifferntItemsFromPCB() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(PRODUCT_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(PRODUCT_CODE);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
      productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
      eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
      Mockito.any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU,
        false,
        Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, ITEM_SKU_1,
        false,
        Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService)
      .generateNewProductItemBusinessPartnerData(any(),
        any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductLogisticsUpdateEditResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "inventoryInsertBatchSizeForEdit", 1);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(DEFAULT_STORE_ID,
        SystemParameterConstants.ITEM_SUMMARY_PAGE_SIZE)).thenReturn(
        new ProductSystemParameter(SystemParameterConstants.ITEM_SUMMARY_PAGE_SIZE, "1", "max-size", false));
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
        .thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ProductLevel3Logistics productLevel3Logistics = new ProductLevel3Logistics();
    productLevel3Logistics.setSelected(true);
    productLevel3Logistics.setLogisticProductCode(ITEM_CODE);
    editResponse.setProductLevel3LogisticsRequest(Collections.singletonList(productLevel3Logistics));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
        eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
        Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService, times(2))
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
            Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService)
        .generateNewProductItemBusinessPartnerData(any(),
            any());
    Mockito.verify(productLevel3InventoryService, times(2))
        .insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.ITEM_SUMMARY_PAGE_SIZE);
    String itemSku = PRODUCT_SKU + HYPHEN + "00001";
    Mockito.verify(productLevel3LogisticsService, times(2))
        .saveLogisticsByItemSku(Collections.singletonList(itemSku), productCollection.getBusinessPartnerCode(),
            Collections.singletonList(productLevel3Logistics), true);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductLogisticsUpdateEditResponse1Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(0).setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.getProductItems().get(1).setItemSku(ITEM_SKU_1);
    EditProductResponse editResponse = editProductResponse;
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode("MTA-00001-00002");
    editResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ProductLevel3Logistics productLevel3Logistics = new ProductLevel3Logistics();
    productLevel3Logistics.setSelected(true);
    productLevel3Logistics.setLogisticProductCode(ITEM_CODE);
    editResponse.setProductLevel3LogisticsRequest(Collections.singletonList(productLevel3Logistics));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
        eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
        Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false,
            Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00002",
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
            UpdateProductActivity.ITEM_ADDED.getDesc(), StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00002", false,
            Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, SystemParameterConstants.ITEM_SUMMARY_PAGE_SIZE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesAddDeleteEditResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(true);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(true);
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setGeneratedItemName(ITEM_NAME);
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    NewlySavedItemResponse newlySavedItemResponse1 = new NewlySavedItemResponse();
    newlySavedItemResponse1.setGeneratedItemName(ITEM_NAME_1);
    newlySavedItemResponse1.setItemCode(ITEM_CODE);
    editProductResponse.setNewlySavedItemResponseList(Arrays.asList(newlySavedItemResponse1, newlySavedItemResponse));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
        eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
        Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME, UpdateProductActivity.ITEM_ADDED.getDesc(),
        StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, PRODUCT_SKU + HYPHEN + "00001",
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1, UpdateProductActivity.ITEM_ADDED.getDesc(),
        StringUtils.EMPTY, PRODUCT_SKU + HYPHEN + "00001", false, Constants.HYPHEN);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductNoAddDeleteEditResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    productVariantUpdateRequest.getProductItems().get(0).setNewlyAddedItem(false);
    productVariantUpdateRequest.getProductItems().get(1).setNewlyAddedItem(false);
    Map<String, String> itemCodeToItemNameMapping = new HashMap<>();
    itemCodeToItemNameMapping.put(ITEM_CODE, ITEM_NAME);
    editProductResponse.setItemCodeToItemNameMapping(itemCodeToItemNameMapping);
    NewlySavedItemResponse newlySavedItemResponse = new NewlySavedItemResponse();
    newlySavedItemResponse.setItemCode(ITEM_CODE);
    newlySavedItemResponse.setGeneratedItemName(productVariantUpdateRequest.getProductItems().get(0).getItemName());
    DeletedProductItems deletedProductItems = new DeletedProductItems();
    deletedProductItems.setItemSku(ITEM_SKU);
    deletedProductItems.setItemCode(ITEM_CODE);
    productVariantUpdateRequest.setDeletedProductItems(Collections.singletonList(deletedProductItems));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), eq(new ArrayList<>()), eq(new ArrayList<>()), eq(new ArrayList<>()),
        eq(null), eq(false), eq(null), eq(false), eq(null), eq(false), Mockito.any(), Mockito.any(),
        Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.ITEM_DELETED.getDesc(), ITEM_SKU, StringUtils.EMPTY, false, Constants.HYPHEN);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductCNCFlagChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, false, true, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductCNCFlagChangedTest2() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(true);
    productL3Response.setProductType(ProductType.REGULAR);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductResponse.setProductDetailEditDTO(null);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(Mockito.any())).thenReturn(gdnRestSingleResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any()))
        .thenReturn(profileResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(categoryRepository.findHierarchyByCategoryCode(Mockito.anyString())).thenReturn(new ArrayList<>());
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest,
          new EditFlagChangesDTO(false, false, false)))
        .thenReturn(editItemResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1))
        .thenReturn(new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.eq(STOREID), Mockito.eq(productL3Response.getProductSku()), Mockito.any(),
            Mockito.eq(new ArrayList<>()), Mockito.eq(new ArrayList<>()), Mockito.eq(new ArrayList<>()), Mockito.any(),
            Mockito.eq(false), Mockito.eq(false), Mockito.eq(true), Mockito.any(), Mockito.eq(false), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any(), any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductFBBFlagChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound.updateItemPickupPoints(STOREID, productL3Response.getProductSku(),
        productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
        false, true, true, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, false, true, true, true,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductFBBFlagChangedFalseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setFbbActiveAtL3Level(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setFbbActiveAtL3Level(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound.updateItemPickupPoints(STOREID, productL3Response.getProductSku(),
        productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
        false, true, true, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, false, true, false, true,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductFBBFlagNotChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound.updateItemPickupPoints(STOREID, productL3Response.getProductSku(),
        productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
        false, false, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, false, true, false, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductCNCFlagFalseChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setCncActivated(false);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(false);
    itemPickupPointListingResponse.setCncActiveAtL3Level(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setCnc(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, true, true, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }


  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), false, true, true, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.ONLINE_FLAG.getDesc(), String.valueOf(productL3Response.isOnline()),
        String.valueOf(!productL3Response.isOnline()), false, Constants.HYPHEN);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPointsTest() throws Exception {
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.ONLINE_FLAG.getDesc(), String.valueOf(productL3Response.isOnline()),
        String.valueOf(!productL3Response.isOnline()), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
            productVariantPriceStockAndImagesRequest.getProductSku(), PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_ADDED.getDesc(), StringUtils.EMPTY, itemPickupPointRequest.getPickupPointId(), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPointsInventoryExceptionTest() throws Exception {
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(
        itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(STOREID, productL3Response.getProductSku(),
            productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
            false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO()))
        .thenReturn(editItemResponse);
    Mockito.when(
        productItemBusinessPartnerRepository.findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(
            STOREID, ITEM_SKU, PICKUP_POINT_CODE)).thenReturn(productItemBusinessPartner);
    Mockito.when(
        xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(
            xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
                Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1))
        .thenReturn(new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.doThrow(Exception.class).when(productLevel3InventoryService).insertInventory(Mockito.any());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
            Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.ONLINE_FLAG.getDesc(), String.valueOf(productL3Response.isOnline()),
        String.valueOf(!productL3Response.isOnline()), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), PRODUCT_NAME,
        UpdateProductActivity.PICKUP_POINT_ADDED.getDesc(), StringUtils.EMPTY,
        itemPickupPointRequest.getPickupPointId(), false, itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPointsInventorySuppressExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"suppressInsertInventoryException", true);
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(
        itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(STOREID, productL3Response.getProductSku(),
            productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
            false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO()))
        .thenReturn(editItemResponse);
    Mockito.when(
        productItemBusinessPartnerRepository.findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(
            STOREID, ITEM_SKU, PICKUP_POINT_CODE)).thenReturn(productItemBusinessPartner);
    Mockito.when(
        xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(
            xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
                Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1))
        .thenReturn(new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.doThrow(Exception.class).when(productLevel3InventoryService).insertInventory(Mockito.any());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
            Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.ONLINE_FLAG.getDesc(), String.valueOf(productL3Response.isOnline()),
        String.valueOf(!productL3Response.isOnline()), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), PRODUCT_NAME,
        UpdateProductActivity.PICKUP_POINT_ADDED.getDesc(), StringUtils.EMPTY,
        itemPickupPointRequest.getPickupPointId(), false, itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagFalseChangedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, true, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.ONLINE_FLAG.getDesc(), String.valueOf(productL3Response.isOnline()),
        String.valueOf(!productL3Response.isOnline()), false, Constants.HYPHEN);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse.setMissingFields(Collections.singleton(Constants.DIMENSIONS_MISSING));
    itemPickupPointListingResponse1.setMissingFields(Collections.singleton(Constants.DIMENSIONS_MISSING));
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(true);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productLevel3DetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productLevel3DetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productLevel3DetailResponse.setLength(Constants.DOUBLE_ZERO);
    productLevel3DetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest1() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(true);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest2() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));


    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME,
        ProductLevel3Status.TEASER.name());
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest3() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setCncBuyable(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));


    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest7() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));

    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(3);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(3));
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME,
        ProductLevel3Status.B2B.name());
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest8() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));

    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(3);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(false);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(3));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest9() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse.setMissingFields(Collections.singleton(Constants.DESCRIPTION_MISSING));
    itemPickupPointListingResponse1.setMissingFields(Collections.singleton(Constants.DESCRIPTION_MISSING));
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));

    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(3);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());

    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest4() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));


    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME,
        ProductLevel3Status.B2B.name());
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest5() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setCncDisplay(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));


    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductTest6() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(false);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);

    itemPickupPointRequest = new ItemPickupPointRequest();
    itemPickupPointRequest.setItemSku(ITEM_SKU);
    itemPickupPointRequest.setPickupPointId(PICKUP_POINT_CODE);
    itemPickupPointRequest.setPrice(100.0);
    itemPickupPointRequest.setSalePrice(100.0);
    itemPickupPointRequest.setCncDisplay(true);

    addPickupPointRequest = new ItemPickupPointRequest();
    addPickupPointRequest.setItemSku(ITEM_SKU);
    addPickupPointRequest.setPickupPointId(PICKUP_POINT_CODE);
    addPickupPointRequest.setPrice(100.0);
    addPickupPointRequest.setSalePrice(100.0);
    addPickupPointRequest.setCncDisplay(true);

    itemPickupPointRequest1 = new ItemPickupPointRequest();
    itemPickupPointRequest1.setItemSku(ITEM_SKU_1);
    itemPickupPointRequest1.setPickupPointId(PICKUP_POINT_CODE);
    itemPickupPointRequest1.setPrice(100.0);
    itemPickupPointRequest1.setSalePrice(100.0);
    itemPickupPointRequest1.setCncDisplay(true);

    productVariantPriceStockAndImagesRequest
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest));
    productVariantPriceStockAndImagesRequest1
      .setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    productVariantUpdateRequest.setProductItems(new ArrayList<>(
      Arrays.asList(productVariantPriceStockAndImagesRequest, productVariantPriceStockAndImagesRequest1)));


    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductOnlineFlagForInstoreProductSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"instoreNewFlowEnabled", false);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"fetchL5DataForAddPickupPointEnabled", true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    itemPickupPointListingResponse.setOnline(false);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(true);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    productLevel3DetailResponse.setDescription("test");
    productLevel3DetailResponse.setOff2OnChannelActive(true);
    productLevel3DetailResponse.setHeight(1.0);
    productLevel3DetailResponse.setWeight(1.0);
    productLevel3DetailResponse.setWidth(1.0);
    productLevel3DetailResponse.setLength(1.0);
    productLevel3DetailResponse.setShippingWeight(1.0);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);

    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    productL3Response.setOff2OnChannelActive(true);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
      .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    Mockito.when(xProductOutbound
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
        new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductItemsEmptyTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    productVariantUpdateRequest.setProductItems(new ArrayList<>());
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    itemPickupPointListingRequest.setItemSku(null);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.eq(0), Mockito.eq(1), Mockito.any(ItemPickupPointListingRequest.class));
    Assertions.assertFalse(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }
  @Test
  public void editProductItemsPriceStockImagesL5ProductNoChangesEmptyInvResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }


  @Test
  public void editProductItemsPriceStockImagesL5ExceptionTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.doThrow(RuntimeException.class).when(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductItemsExceptionTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setModifiedItemPickupPoints(new ArrayList<>());
    productVariantUpdateRequest.getProductItems().get(1).setModifiedItemPickupPoints(new ArrayList<>());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.doThrow(ApplicationRuntimeException.class).when(xProductOutbound)
        .getItemPickupPointList(eq(STOREID), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any());
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductItemsExceptionAddAndDeleteTest() throws Exception {
    profileResponse.getCompany().setCncActivated(false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setModifiedItemPickupPoints(new ArrayList<>());
    productVariantUpdateRequest.getProductItems().get(1).setModifiedItemPickupPoints(new ArrayList<>());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequest));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.doThrow(ApplicationRuntimeException.class).when(xProductOutbound)
        .getItemPickupPointList(eq(STOREID), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any());
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    editProductResponse.setProductDetailEditDTO(null);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingResponse.setProductType(ProductType.BIG_PRODUCT);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO1 = new ProductDetailEditDTO();
    productVariantUpdateRequest.setProductSku(PRODUCT_SKU);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, productLevel3, true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1,
          itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
        itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductPreOrderQuotaUpdateTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    editProductResponse.setProductDetailEditDTO(null);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingResponse.setProductType(ProductType.BIG_PRODUCT);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO1 = new ProductDetailEditDTO();
    productVariantUpdateRequest.setProductSku(PRODUCT_SKU);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setInitialPreOrderQuota(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
            .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1,
            itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.PRE_ORDER_QUOTA.getDesc(), String.valueOf(0), String.valueOf(10), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateInventoryErrorTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingResponse.setProductType(ProductType.BIG_PRODUCT);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
            .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(
            productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1,
            itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateInventoryNotPresentTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingResponse.setProductType(ProductType.BIG_PRODUCT);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductType(2);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
            .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(new ArrayList<>());
    Mockito.when(
            productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1,
            itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateFreeSampleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ProductRequest productRequest = new ProductRequest();
    productRequest.setFreeSample(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setProductRequest(productRequest);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setFreeSample(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setFreeSample(false));
    Map<String, String> success1 = new HashMap<>();
    Map<String, Map<String, String>> success = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
            productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateFreeSamplePartialSuccessTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ProductRequest productRequest = new ProductRequest();
    productRequest.setFreeSample(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setProductRequest(productRequest);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setFreeSample(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setFreeSample(false));
    Map<String, String> success1 = new HashMap<>();
    Map<String, Map<String, String>> success = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, PARTIAL_SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
        productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }


  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateFreeSampleFromSavedDataTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ProductRequest productRequest = new ProductRequest();
    productRequest.setFreeSample(true);
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setProductRequest(productRequest);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setFreeSample(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setFreeSample(true));
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap("new", LOCATION_PATH)));
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, PARTIAL_SUCCESS)));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
            productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateNewImageFromSavedDataTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ProductRequest productRequest = new ProductRequest();
    productRequest.setFreeSample(true);
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setProductRequest(productRequest);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setFreeSample(false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setFreeSample(true));
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setAdd(false);
    copyImageEditRequest.setCopy(true);
    copyImageEditRequest.setMainImage(true);
    com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
      new ProductImageEditRequest();
    productImageEditRequest.setImagePath(LOCATION_PATH);
    productImageEditRequest.setProductItems(Collections.singletonList(new ItemImageEditRequest()));
    productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductResponse.getProductDetailEditDTO().setProductImageEditRequests(Collections.singletonList(productImageEditRequest));
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, "SUCCESS")));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
            productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }


  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateFreeSampleOffCombinedEditEnabledTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ProductRequest productRequest = new ProductRequest();
    productRequest.setFreeSample(false);
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setProductRequest(productRequest);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setFreeSample(false);
    productVariantUpdateRequest.setProductEditable(false);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    productVariantUpdateRequest.getProductItems().forEach(productVariantPriceStockAndImagesRequest2 -> productVariantPriceStockAndImagesRequest2.setFreeSample(false));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
            productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductStockUpdateStockUpdateErrorTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setStock(0);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
            .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(
        productLevel3InventoryService.updateStockForItemPickupPoint(BUSINESS_PARTNER_CODE, ITEM_SKU, PICKUP_POINT_CODE,
            10, 0, false)).thenReturn(ApiErrorCode.MAXIMUM_STOCK_LIMIT_EXCEEDED);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), true, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockChangeNotAllowedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5MppNull() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5MppFalse() throws Exception {
    profileResponse.getCompany().setCncActivated(false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5MppFalseRelaxPriceDisabledCheckOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "relaxPriceEditDisabledCheck", false);
    profileResponse.getCompany().setCncActivated(false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(
            xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
                Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest))
        .thenReturn(new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(
        xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(
        productItemBusinessPartnerRepository.findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(
            STOREID, ITEM_SKU, PICKUP_POINT_CODE)).thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOList)).thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false, null,
            productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockChangeTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(false), String.valueOf(true), false,
        PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getBusinessPartnerCode());
    Assertions.assertEquals(ITEM_SKU_1,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getPickupPointCode());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockAtL5LevelChangeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "inventoryL5SyncStockEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(false), String.valueOf(true), false,
        PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockMergeStockFlagAndValueTest() throws Exception {
    List<ItemPickupPointRequest> modifiedItemPickupPoints =
        new ArrayList<>(productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints());
    ItemPickupPointRequest itemPickupPointRequest2 = new ItemPickupPointRequest();
    itemPickupPointRequest2.setSynchronizeStock(true);
    itemPickupPointRequest2.setPickupPointId(PICKUP_POINT_CODE_1);
    itemPickupPointRequest2.setStock(20);
    itemPickupPointRequest2.setSalePrice(100.0);
    itemPickupPointRequest2.setPrice(100.0);
    modifiedItemPickupPoints.add(itemPickupPointRequest2);
    ItemPickupPointListingRequest itemPickupPointListingRequest2 = new ItemPickupPointListingRequest();
    itemPickupPointListingRequest2.setItemSku(ITEM_SKU);
    itemPickupPointListingRequest2.setProductSku(PRODUCT_SKU);

    itemPickupPointListingRequest2.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest2.setPickupPointCodes(Set.of(PICKUP_POINT_CODE, PICKUP_POINT_CODE_1));

    ItemPickupPointListingResponse itemPickupPointListingResponse2 = new ItemPickupPointListingResponse();
    itemPickupPointListingResponse2.setItemSku(ITEM_SKU);
    itemPickupPointListingResponse2.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse2.setProductSku(PRODUCT_SKU);
    itemPickupPointListingResponse2.setItemName(ITEM_NAME);
    itemPickupPointListingResponse2.setPickUpPointCode(PICKUP_POINT_CODE_1);
    itemPickupPointListingResponse2.setWholesalePriceConfigEnabled(true);
    PriceResponse priceResponse = new PriceResponse();
    priceResponse.setPrice(100);
    priceResponse.setSalePrice(100);
    itemPickupPointListingResponse2.setPrices(Collections.singletonList(priceResponse));
    ViewConfigResponse viewConfigResponse = new ViewConfigResponse();
    viewConfigResponse.setBuyable(false);
    viewConfigResponse.setDisplay(false);
    itemPickupPointListingResponse2.setViewConfigs(Collections.singletonList(viewConfigResponse));

    ReflectionTestUtils.setField(productLevel3ServiceBean, "mergeStockValueAndSyncStockUpdate", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"inventoryL5SyncStockEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPickupPointId(PICKUP_POINT_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    ProductLevel3Inventory productLevel3Inventory = new ProductLevel3Inventory();
    productLevel3Inventory.setWebItemSku(ITEM_SKU);
    productLevel3Inventory.setWebPickupPointCode(PICKUP_POINT_CODE_1);
    productLevel3Inventory.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Inventory.setWebAvailable(10);
    productLevel3Inventories.add(productLevel3Inventory);
    productLevel3Inventories.get(0).setWebSyncStock(false);
    productLevel3Inventories.get(1).setWebSyncStock(false);
    productLevel3Inventories.get(2).setWebSyncStock(false);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 2, itemPickupPointListingRequest2)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse,itemPickupPointListingResponse2), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(Mockito.anyList()))
      .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 2, itemPickupPointListingRequest2);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE_1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
      productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
      UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(false), String.valueOf(true), false,
      itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(30), false,
            PICKUP_POINT_CODE_1);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(false), String.valueOf(true), false,
            PICKUP_POINT_CODE_1);

    Mockito.verify(productLevel3InventoryService, times(2))
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(2).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(2).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(2).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockMergeStockFlagAndValueWithSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "mergeStockValueAndSyncStockUpdate", false);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"inventoryL5SyncStockEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPickupPointId(PICKUP_POINT_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(false);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
      productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
      UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(false), String.valueOf(true), false,
      itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productLevel3InventoryService)
      .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockMergeStockFlagAndValueWithExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "mergeStockValueAndSyncStockUpdate", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"inventoryL5SyncStockEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPickupPointId(PICKUP_POINT_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productLevel3Inventories.get(0).setWebSyncStock(false);
    Mockito.doThrow(new RuntimeException())
      .when(productLevel3InventoryService)
      .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
  }


  @Test
  public void editProductItemsPriceStockImagesL5ProductSyncStockAtL5TrueLevelChangeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "inventoryL5SyncStockEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setSynchronizeStock(false);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setSynchronizeStock(false);
    productLevel3Inventories.get(0).setWebSyncStock(false);
    productLevel3Inventories.get(1).setWebSyncStock(true);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(true), String.valueOf(false), false,
        PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductMinStockChangeTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setMinimumStock(1);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setMinimumStock(1);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(false);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(0).setWebMinAlert(5);
    productLevel3Inventories.get(1).setWebMinAlert(1);
    productLevel3Inventories.get(1).setWebSyncStock(true);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
        .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
        UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(true), String.valueOf(false), false,
        PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getBusinessPartnerCode());
    Assertions.assertEquals(ITEM_SKU_1,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getPickupPointCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productLevel3InventoryService)
      .updateMinimumStockAlert(BUSINESS_PARTNER_CODE, ITEM_SKU, 1);
    Mockito.verify(productBusinessPartnerService).updateMinimumStockByGdnProductItemSku(ITEM_SKU,
      1);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
            productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
            UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20),
          false, PICKUP_POINT_CODE);
    Mockito.verify(updatedProductHistoryService, times(3))
      .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
        any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductMinStockNoChangeTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setStock(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSynchronizeStock(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setMinimumStock(1);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setMinimumStock(1);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSynchronizeStock(false);
    productLevel3Inventories.get(0).setWebSyncStock(true);
    productLevel3Inventories.get(0).setWebMinAlert(1);
    productLevel3Inventories.get(1).setWebMinAlert(1);
    productLevel3Inventories.get(1).setWebSyncStock(true);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(productLevel3InventoryService
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOList))
      .thenReturn(productLevel3Inventories);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20), false,
        itemPickupPointRequest.getPickupPointId());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_1,
      productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME_1,
      UpdateProductActivity.SYNC_STOCK.getDesc(), String.valueOf(true), String.valueOf(false), false,
      PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getBusinessPartnerCode());
    Assertions.assertEquals(ITEM_SKU_1,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
        syncStockUpdateOrInsertVoArgumentCaptor.getValue().getUpdateOrInsertStockVo().getPickupPointCode());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, itemPickupPointRequest.getItemSku(),
        productVariantPriceStockAndImagesRequest.getProductSku(), ITEM_NAME,
        UpdateProductActivity.STOCK_VALUE.getDesc(), String.valueOf(10), String.valueOf(20),
        false, PICKUP_POINT_CODE);
    Mockito.verify(updatedProductHistoryService, times(2))
      .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
        any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(PICKUP_POINT_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getPickupPointCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebMerchantCode());
    Assertions.assertEquals(BUSINESS_PARTNER_CODE,
      inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebMerchantCode());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setSkuCode(SKU_CODE);
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean()))
        .thenReturn(new L3VersionResponse());
    productCollection.setReviewPending(true);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
        .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
        .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
        .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, PRODUCT_SKU, productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
            any(), anyBoolean(), any());
    Mockito.verify(productOutbound).editItemUpcCode(Mockito.any(), Mockito.anyList());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseCombinedEditEnabledTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean()))
      .thenReturn(new L3VersionResponse());
    productCollection.setReviewPending(true);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ProductDetailEditDTO productDetailEditDTO = editProductResponse.getProductDetailEditDTO();
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
      .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    itemPickupPointListingResponse.setProductType(ProductType.BOPIS);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    productItemResponse.setSkuCode(SKU_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), 3);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.anyList(), Mockito.anyList(),
            Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(ProductVariantUpdateRequest.class), Mockito.any(EditFlagChangesDTO.class));
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseCombinedEditEnabledFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean()))
      .thenReturn(new L3VersionResponse());
    productCollection.setReviewPending(true);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ProductDetailEditDTO productDetailEditDTO = editProductResponse.getProductDetailEditDTO();
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
      .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    itemPickupPointListingResponse.setProductType(ProductType.BOPIS);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), 3);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.anyList(), Mockito.anyList(),
        Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(ProductVariantUpdateRequest.class), Mockito.any(EditFlagChangesDTO.class));
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }


  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseNewUpcValidateFlowTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "newUpcCodeValidateFlow", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setSkuCode(SKU_CODE);
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(Mockito.anyString(),
        Mockito.anyString(),Mockito.anyBoolean()))
        .thenReturn(new L3VersionResponse());
    productCollection.setReviewPending(true);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
        .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
        .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
        .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(STOREID, PRODUCT_SKU, productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(Mockito.any(),
      Mockito.anyString(),Mockito.anyBoolean());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
            any(), anyBoolean(), any());
    Mockito.verify(productOutbound).editItemUpcCode(Mockito.any(), Mockito.anyList());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseFlowTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "newUpcCodeValidateFlow", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setSkuCode(SKU_CODE);
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(Mockito.anyString(),
        Mockito.anyString(),Mockito.anyBoolean()))
      .thenReturn(new L3VersionResponse());
    productCollection.setReviewPending(false);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
      .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, PRODUCT_SKU, productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(Mockito.any(),
      Mockito.anyString(),Mockito.anyBoolean());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
        any(), anyBoolean(), any());
    Mockito.verify(productOutbound).editItemUpcCode(Mockito.any(), Mockito.anyList());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductUPCCodeReviewPendingFalseNewUpcValidateFlowCombinedEditTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "newUpcCodeValidateFlow", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    productL3Response.setSynchronized(true);
    productLevel3.setProductType(2);
    editProductResponse.getProductDetailEditDTO().getProductCollectionDTO().setReviewPending(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    productVariantUpdateRequest.setProductEditable(true);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    List<ProductItemResponse> productItemResponseList = new ArrayList<>();
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setSkuCode(SKU_CODE);
    productItemResponse.setUpcCode(UPC_CODE);
    productItemResponseList.add(productItemResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    productCollection.setReviewPending(true);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any()))
      .thenReturn(productCollection);
    Mockito.when(productOutbound.getProductItemBySkuCodes(Mockito.any(SkuCodesRequest.class)))
      .thenReturn(productItemResponseList);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingResponse.setProductCode(PRODUCT_CODE);
    itemPickupPointListingResponse.setProductSku(PRODUCT_SKU);
    itemPickupPointListingRequest.setResponseWithoutPickupPoint(true);
    Mockito.when(productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(),any())).thenReturn(combinedEditItemResponseEditProductItemAndImageResponsePair);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    for (ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest : productVariantUpdateRequest
      .getProductItems()) {
      productVariantPriceStockAndImagesRequest.setModifiedItemPickupPoints(new ArrayList<>());
    }
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, false);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setResponseWithoutPickupPoint(true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Collections.singleton(SKU_CODE));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(), any());
    productItemResponse.setSkuCode(SKU_CODE);
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ModifiedPickupPointsTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setCncActive(true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any()))
        .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.ONLINE.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(itemPickupPointQuickEditRequestCaptor.getValue().get(0).isCncActivated());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ModifiedPickupPointsFbbTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setCncActive(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(variantEditValidationService)
        .validateNewL5AdditionRequests(eq(productVariantUpdateRequest), Mockito.any(), eq(profileResponse),
            Mockito.any(), Mockito.anyMap());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(ProductLevel3Status.ONLINE.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ModifiedPickupPointsNotificationB2BTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    productL3Response.getMasterCatalog().setCategory(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.B2B.name());
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(ProductLevel3Status.B2B.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ModifiedPickupPointsNotificationTeaserTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productL3Response.setMasterCatalog(null);
    productVariantUpdateRequest.setProductEditable(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPpCodeChangedForNonMppSeller(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any()))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    when(inventoryOutbound.updatePickupPoint(
      any(MandatoryRequestParam.class),
      any())).thenReturn(updatePickupPointResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(1000.9);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setB2bFields(b2BFields);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    verify(inventoryOutbound).updatePickupPoint(
      Mockito.any(MandatoryRequestParam.class),
      Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "schedulesAddEditEnabled", true);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    Date startDate = new Date(System.currentTimeMillis() - 10000);
    Date endDate = new Date();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setDiscoverableSchedule(
      DiscoverableScheduleRequest.builder().endDateTime(endDate).startDateTime(startDate).build());
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
        .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(Constants.DEFAULT_STORE_ID), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE);
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(eq(BUSINESS_PARTNER_CODE), eq(ITEM_SKU), eq(PRODUCT_SKU), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean());
    verify(productCollectionRepository, times(2)).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(2, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse.setItemName(ITEM_NAME);
    itemPickupPointListingResponse1.setItemName(ITEM_NAME_1);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO =
      ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
      .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
 REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.setProductEditable(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditTestNew() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse.setItemName(ITEM_NAME);
    itemPickupPointListingResponse1.setItemName(ITEM_NAME_1);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO =
        ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
            .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
        Collections.singletonMap(COPY_ALL_STATUS, SUCCESS)));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
        REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.setProductEditable(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
            getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
            false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
            editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
            itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
            Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }



  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    CombinedEditItemResponse combinedEditItemResponse = new CombinedEditItemResponse();
    combinedEditItemResponse.setL3Version(1L);
    Pair<CombinedEditItemResponse, EditProductItemAndImageResponse> pairCombinedResponse =
        new ImmutablePair<>(combinedEditItemResponse, new EditProductItemAndImageResponse());
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    List<ProductLevel3SummaryDetailsImageRequest> copyToAllRequest = new ArrayList<>();
    productLevel3SummaryDetailsImageRequest.setMainImage(true);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setReviewType("NEW");
    copyToAllRequest.add(productLevel3SummaryDetailsImageRequest);
    productVariantUpdateRequest.setCopyToAllVariantImages(copyToAllRequest);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse.setItemName(ITEM_NAME);
    itemPickupPointListingResponse1.setItemName(ITEM_NAME_1);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO =
        ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
            .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
        Collections.singletonMap(COPY_ALL_STATUS, SUCCESS)));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
        REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(
            productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(Mockito.any(), Mockito.any()))
        .thenReturn(pairCombinedResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(
        productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.setProductEditable(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
            getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
            false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
            editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    Mockito.verify(productLevel3V2Service)
        .updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(Mockito.any(), Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
            itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
            Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(any());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(any(),
      anyString(), anyBoolean());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditTest3() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    CombinedEditItemResponse combinedEditItemResponse = new CombinedEditItemResponse();
    combinedEditItemResponse.setL3Version(1L);
    Pair<CombinedEditItemResponse, EditProductItemAndImageResponse> pairCombinedResponse =
        new ImmutablePair<>(combinedEditItemResponse, new EditProductItemAndImageResponse());
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME_1);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    List<ProductLevel3SummaryDetailsImageRequest> copyToAllRequest = new ArrayList<>();
    productLevel3SummaryDetailsImageRequest.setMainImage(true);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setReviewType("NEW");
    copyToAllRequest.add(productLevel3SummaryDetailsImageRequest);
    productVariantUpdateRequest.setCopyToAllVariantImages(copyToAllRequest);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse.setItemName(ITEM_NAME);
    itemPickupPointListingResponse1.setItemName(ITEM_NAME_1);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    productLevel3.setProductType(2);
    ProductDetailEditDTO productDetailEditDTO =
        ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
            .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
        Collections.singletonMap(COPY_ALL_STATUS, PARTIAL_SUCCESS)));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
        REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
            productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(Mockito.any(), Mockito.any()))
        .thenReturn(pairCombinedResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(
        productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.setProductEditable(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
            getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
            false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
            editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
        , eq(2));
    Mockito.verify(productLevel3V2Service)
        .updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(Mockito.any(), Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
            itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
            eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
            Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(any());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(any(),
      anyString(), anyBoolean());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditRegularTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productDetailEditDTO.getProductLevel3().setProductType(2);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.setProductName(null);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductDetailEditDTO productDetailEditDTO =
      ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
        .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
      REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(2));
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditBOPISTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productDetailEditDTO.getProductLevel3().setProductType(3);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    productDetailEditDTO.setReviewTypeList(Collections.singletonList("IMAGE"));
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductDetailEditDTO productDetailEditDTO =
      ProductDetailEditDTO.builder().productEditable(true).productLevel3(productLevel3)
        .productRequestForPCB(new com.gdn.x.productcategorybase.dto.request.ProductRequest()).build();
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    productL3Response.setProductType(ProductType.REGULAR);
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
      REQUESTID);
    editProductResponse.getProductDetailEditDTO().setProductLevel3DetailResponse(null);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.setProductName(PRODUCT_NAME);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, false);
    Mockito.verify(businessPartnerRepository, times(3)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any()
      , eq(3));
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditWithEmptyDTOTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    profileResponse.setCompany(CompanyDTO.builder().merchantDeliveryType("CM").build());
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    productDetailEditDTO.setProductLevel3DetailResponse(null);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    itemPickupPointListingRequest1.setPickupPointCodes(Collections.emptySet());
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
      REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    editProductResponse.getProductDetailEditDTO().setProductLevel3DetailResponse(null);
    itemPickupPointListingRequest.setPickupPointCodes(Collections.emptySet());
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(3)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(), any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productLevel3LogisticsService).findLogisticsByItemSku(null,
      BUSINESS_PARTNER_CODE, "CM");
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithCombinedEditWithEmptyDTOAndInCompleteProfileResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    profileResponse.setCompany(CompanyDTO.builder().build());
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    productL3Response.setProductType(ProductType.BIG_PRODUCT);
    productDetailEditDTO.setProductLevel3DetailResponse(null);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    itemPickupPointListingRequest1.setPickupPointCodes(Collections.emptySet());
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response,
      REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    editProductResponse.getProductDetailEditDTO().setProductLevel3DetailResponse(null);
    itemPickupPointListingRequest.setPickupPointCodes(Collections.emptySet());
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(3)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(), any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithNEwImageCombinedEditTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType("new");
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(fileStorageService.generateFinalImageFullPath(Mockito.anyString())).thenReturn(LOCATION_PATH);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, false);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(fileStorageService).generateFinalImageFullPath(Mockito.anyString());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productPublisherService).publishEditImageResizeEvent(Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithNEwImageCombinedEditAddDeleteSwtchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", false);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType("new");
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(fileStorageService.generateFinalImageFullPath(Mockito.anyString())).thenReturn(LOCATION_PATH);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(fileStorageService).generateFinalImageFullPath(Mockito.anyString());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(), any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productPublisherService).publishEditImageResizeEvent(Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithNEwImageEmptyRequestTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"addDeleteVariantSwitch", false);
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType("new");
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(fileStorageService.generateFinalImageFullPath(Mockito.anyString())).thenReturn(LOCATION_PATH);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    Mockito.doNothing().when(xProductOutbound).updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
      productL3Response.getProductType(), new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null,
      false, null, false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
      editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse,productLevel3, true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(any(),
      any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(fileStorageService).generateFinalImageFullPath(Mockito.anyString());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(), any());
    verify(updatedProductHistoryService).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productPublisherService).publishEditImageResizeEvent(Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }


  @Test
  public void editProductItemsPriceStockImagesL5ImagesUpdatedWithNEwImageCombinedEditUpdateTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    productL3Response.setSynchronized(true);
    productLevel3.setProductType(3);
    productDetailEditDTO.setProductLevel3(productLevel3);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest2 =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest2.setReviewType("update");
    productLevel3SummaryDetailsImageRequest2.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest2.setMainImage(false);
    productLevel3SummaryDetailsImageRequest2.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Arrays.asList(productLevel3SummaryDetailsImageRequest, productLevel3SummaryDetailsImageRequest2));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    Map<String, String> success1 = new HashMap<>();
    Map<String, Map<String, String>> success = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success1.put(Constants.COPY_ALL_STATUS, PARTIAL_SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    editProductItemAndImageResponse.setNewlySavedItemResponses(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Arrays.asList(itemPickupPointListingResponse, itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Constants.DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
      .thenReturn(editItemResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doNothing().when(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(STOREID, productL3Response.getProductSku(),
        getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType()),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null,
        false, new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO(),
        editProductResponse.getProductDetailEditDTO());
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, productLevel3, false);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), 3);
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointsForCombinedEdit(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(getProductTypeFromCode(productDetailEditDTO.getProductLevel3().getProductType())),
        itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.any(),
        Mockito.any(), eq(editProductResponse.getProductDetailEditDTO()));
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productLevel3V2Service).updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(any(), any());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Constants.STORE_ID, PRODUCT_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Mockito.anyList());
    Mockito.verify(productLevel3V2Service).performPCBUpdateForPDPEditRequest(any(),any());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CampaignValidation1Test() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    editProductResponse.setYouTubeUrlUpdated(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5CampaignValidationExceptionTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    doThrow(ApplicationRuntimeException.class).when(campaignOutbound).validateDiscountPrice(anyBoolean(),any(
      CampaignUpdateDiscountRequest.class));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(ITEM_SKU, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CampaignExceptionForNullResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    doThrow(new ApplicationRuntimeException()).when(campaignOutbound).validateDiscountPrice(anyBoolean(),any(CampaignUpdateDiscountRequest.class));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), false);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(any(), any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CampaignValidateNullResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
      Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }


  @Test
  public void editProductItemsPriceStockImagesL5CampaignNullResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    doThrow(new ApplicationRuntimeException()).when(campaignOutbound).validateDiscountPrice(anyBoolean(),any(CampaignUpdateDiscountRequest.class));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test()
  public void editProductItemsPriceStockImagesL5CampaignUpdateFailedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    Map<String, String> itemInfoStatus = new HashMap<>();
    itemInfoStatus.put(ITEM_SKU,ITEM_SKU);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(itemInfoStatus).build());
    doThrow(ApplicationRuntimeException.class).when(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());

  }

  @Test()
  public void editProductItemsPriceStockImagesL5UpdateFailedTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    Map<String, String> itemInfoStatus = new HashMap<>();
    itemInfoStatus.put(ITEM_SKU,ITEM_SKU);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().build());
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(itemInfoStatus).build());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), false);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
      Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CampaignValidationAndRevertTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.doThrow(RuntimeException.class).when(xProductOutbound)
        .updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
            eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(),
            eq(new ArrayList<>()), eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSellerSku(SELLER_SKU);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(campaignOutbound).validateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertEquals(SELLER_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setFbbActive(true);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTrue1Test() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    itemPickupPointRequest.setWholesalePriceActivated(null);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTruePriceTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.doNothing().when(productLevel3InventoryService).insertInventory(Mockito.anyList());
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    addPickupPointRequest.setStock(10);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(any(),any(),
      any(),any(),any(),any(),any(),anyBoolean(),any());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTruePriceAndFbbTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
      .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.doNothing().when(productLevel3InventoryService).insertInventory(Mockito.anyList());
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    addPickupPointRequest.setStock(10);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(true);
    productVariantUpdateRequest.getAddPickupPoints().get(0).setFbbActive(true);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
      Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
      Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound)
      .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
      Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
        UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
        itemPickupPointRequest.getPickupPointId());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(any(),any(),
      any(),any(),any(),any(),any(),anyBoolean(),any());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
      Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5OnlyDeleteTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "updateLogisticsForNewlyAddedItem", true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(
            xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
                Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest))
        .thenReturn(new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(
        xProductOutbound.getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(
        productItemBusinessPartnerRepository.findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(
            STOREID, ITEM_SKU, PICKUP_POINT_CODE)).thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
            Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.doNothing().when(productLevel3InventoryService).insertInventory(Mockito.anyList());
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    addPickupPointRequest.setStock(10);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(
        itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE,
            productVariantUpdateRequest, editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound).bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(any(), any(), any(), any(), any(), any(),
        any(), anyBoolean(), any());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleTruePriceNotUpdatedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled",true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productVariantUpdateRequest.setAddPickupPoints(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    itemPickupPointRequestCopy.setFbbActive(true);
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleFlagNotUpdatedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled",true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
      .thenReturn(wholesalePriceBulkUpdateResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceSkuResponse.setSkuStatus(Constants.ACTIVE_STATUS);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleFlagUpdatedTest() throws Exception {
    productL3Response.setSynchronized(true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled",false);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceSkuResponse.setSkuStatus(Constants.ACTIVE_STATUS);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    itemPickupPointRequestCopy.setFbbActive(false);
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled",false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    itemPickupPointRequestCopy.setFbbActive(true);
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeFlagUpdateResponseEmptyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled",true);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setCncActive(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    itemPickupPointRequestCopy.setFbbActive(false);
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeFlagUpdateResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Map<String, String> failedWholeSaleMap = new HashMap();
    failedWholeSaleMap.putIfAbsent(ITEM_SKU, ITEM_SKU);
    bulkActivateDeactivateResponse.setFailedItemSkuToFailedReasonMap(failedWholeSaleMap);
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeFlagUpdateResponseSkuStatusActiveTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, ACTIVE_STATUS);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    wholesalePriceBulkUpdateResponse.setFailedItemSkuToFailedReasonMap(wholeSaleMap);
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseEmptyListTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    Date startDate = new Date(System.currentTimeMillis() - 10000);
    Date endDate = new Date();
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDiscoverableSchedule(
      DiscoverableScheduleRequest.builder().endDateTime(endDate).startDateTime(startDate).build());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponse1Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"throwErrorOnEmptyL5Response", true);
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter)
        .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
        .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
    Mockito.verify(updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
            Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
            eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditEmptyResponse1Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"throwErrorOnEmptyL5Response", true);
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    itemPickupPointListingResponse.setItemSku(PRODUCT_SKU);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertFalse(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseWithFreeSAmpleTest() throws Exception {

    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().getProductRequest().setFreeSample(true);
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
      .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
      Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
      Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
    Mockito.verify(updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
        Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
        eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseForForceReviewTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", true);
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    editProductResponse.getProductDetailEditDTO().getProductDetailEditRequestForXProduct().getProductEditRequest().setForceReview(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
      .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
      Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository, times(2))
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(any(), anyString(),
        anyString());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
    Mockito.verify(updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
        Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
        eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseSellerSkuTest() throws Exception {
    productL3Response.setSynchronized(true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "schedulesAddEditEnabled", true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    Date date = new Date();
    Map<String, Set<String>> scheduleUpdatedL5s = new HashMap<>();
    scheduleUpdatedL5s.put(ITEM_SKU.concat(HYPHEN).concat(PICKUP_POINT_CODE),
      Collections.singleton(Constants.BUYABLE_SCHEDULE_UPDATE));
    editItemResponse.setFbbFlagChangedAtL3Level(true);
    itemPickupPointListingResponse.getViewConfigs().get(0).setBuyableScheduleResponse(
      BuyableScheduleResponse.builder().endDateTime(date).startDateTime(date).build());
    itemPickupPointListingResponse.getViewConfigs().get(0).setDiscoverableScheduleResponse(
      DiscoverableScheduleResponse.builder().startDateTime(date).endDateTime(date).build());
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.DEFAULT);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    itemPickupPoint.setMerchantSku(SKU_CODE);
    editProductResponse.setScheduleUpdatedL5s(scheduleUpdatedL5s);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    editItemResponse.setAllUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyableSchedule(
      BuyableScheduleRequest.builder().build());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setDiscoverableSchedule(DiscoverableScheduleRequest.builder().build());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter)
        .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
        .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
    Mockito.verify(updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
            Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
            eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, null,
            ITEM_NAME, UpdateProductActivity.MERCHANT_SKU.getDesc(), itemPickupPointListingResponse.getMerchantSku(),
            itemPickupPoint.getMerchantSku(), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
        productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
        UpdateProductActivity.FBB_FLAG.getDesc(), String.valueOf(false), String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, null, ITEM_NAME,
        UpdateProductActivity.BUYABLE_SCHEDULE.getDesc(),
        date.toString().concat(Constants.SPACE).concat(HYPHEN).concat(Constants.SPACE)
          .concat(date.toString()), HYPHEN, false, PICKUP_POINT_CODE);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, null, ITEM_NAME,
        UpdateProductActivity.DISCOVERABLE_SCHEDULE.getDesc(),
        date.toString().concat(Constants.SPACE).concat(HYPHEN).concat(Constants.SPACE)
          .concat(date.toString()), HYPHEN, false, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(2, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5EditResponseDiscoverableScheduleTest() throws Exception {
    productL3Response.setSynchronized(true);
    productL3Response.setProductEditable(true);
    productL3Response.setMasterCatalog(null);
    Date date = new Date();
    ReflectionTestUtils.setField(productLevel3ServiceBean, "schedulesAddEditEnabled", true);
    Map<String, Set<String>> scheduleUpdatedL5s = new HashMap<>();
    scheduleUpdatedL5s.put(ITEM_SKU.concat(HYPHEN).concat(PICKUP_POINT_CODE),
      Collections.singleton(Constants.DISCOVERABLE_SCHEDULE_UPDATE));
    editItemResponse.setFbbFlagChangedAtL3Level(true);
    itemPickupPointListingResponse.getViewConfigs().get(0).setDiscoverableScheduleResponse(
      DiscoverableScheduleResponse.builder().startDateTime(date).endDateTime(date).build());
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.DEFAULT);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
      .thenReturn(campaignUpdateDiscountResponse);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    itemPickupPoint.setMerchantSku(SKU_CODE);
    editProductResponse.setScheduleUpdatedL5s(scheduleUpdatedL5s);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    editItemResponse.setAllUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
      Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setDiscoverableSchedule(DiscoverableScheduleRequest.builder().build());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
    Mockito.verify(updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
        Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
        eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, null,
        ITEM_NAME, UpdateProductActivity.MERCHANT_SKU.getDesc(), itemPickupPointListingResponse.getMerchantSku(),
        itemPickupPoint.getMerchantSku(), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT,
      productVariantPriceStockAndImagesRequest.getProductSku(), productVariantUpdateRequest.getProductName(),
      UpdateProductActivity.FBB_FLAG.getDesc(), String.valueOf(false), String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(updatedProductHistoryService)
      .createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, null, ITEM_NAME,
        UpdateProductActivity.DISCOVERABLE_SCHEDULE.getDesc(),
        date.toString().concat(Constants.SPACE).concat(HYPHEN).concat(Constants.SPACE)
          .concat(date.toString()), HYPHEN, false, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(2, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
  }


  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesUpdatedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "schedulesAddEditEnabled", true);
    Map<String, Set<String>> scheduleUpdatedL5s = new HashMap<>();
    scheduleUpdatedL5s.put(ITEM_SKU.concat(HYPHEN).concat(PICKUP_POINT_CODE),
      Collections.singleton(Constants.BUYABLE_SCHEDULE_UPDATE));
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyableSchedule(
      BuyableScheduleRequest.builder().build());
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.DEFAULT);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);

    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMarkForDelete(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(Mockito.anyList(),
        Mockito.anyList())).thenReturn(Arrays.asList(productVariantPriceStockAndImagesRequest));
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
        .thenReturn(new L3VersionResponse());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemPickupPoint itemPickupPoint = new ItemPickupPoint();
    itemPickupPoint.setItemSku(ITEM_SKU);
    itemPickupPoint.setPickupPointCode(PICKUP_POINT_CODE);
    itemPickupPoint.setMerchantSku(SKU_CODE);
    editItemResponse.setUpdatedItemPickupPoints(Collections.singletonList(itemPickupPoint));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(4))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(eq(BUSINESS_PARTNER_CODE), eq(itemPickupPointListingResponse.getItemSku()),
        Mockito.any(), Mockito.any(), eq(StringUtils.EMPTY), eq(itemPickupPointListingResponse.getProductSku()),
        eq(itemPickupPointListingResponse.getItemName()), eq(false), eq(StringUtils.EMPTY));
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPointListingResponse(itemPickupPointListingResponse, new HashMap<>());
    Mockito.verify(updateProductItemLevel3ModelConverter)
      .convertFromItemPickupPoint(Mockito.any(), Mockito.anySet(), Mockito.any(), Mockito.anyMap());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesUpdatedAddDeleteTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);

    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMarkForDelete(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Collections.emptyList());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(Mockito.anyList(),
      Mockito.anyList())).thenReturn(Arrays.asList(productVariantPriceStockAndImagesRequest));
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
      .thenReturn(new L3VersionResponse());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
      productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(updatedProductHistoryService, Mockito.times(1))
      .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesUpdateFailedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);

    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMarkForDelete(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(Mockito.anyList(),
        Mockito.anyList())).thenReturn(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, Constants.FAIL);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(Constants.DEFAULT_STORE_ID), Mockito.any())).thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
        .thenReturn(new L3VersionResponse());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(Constants.DEFAULT_STORE_ID), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(2)).findByStoreIdAndProductCode(STOREID, PRODUCT_CODE);
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(Mockito.any(), Mockito.any(), Mockito.anyBoolean());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesNRUpdatedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    productVariantUpdateRequest.setNeedCorrection(false);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);

    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMarkForDelete(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(new ArrayList<>());
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(Mockito.anyList(),
        Mockito.anyList())).thenReturn(productVariantUpdateRequest.getProductItems());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    List<ProductItemBusinessPartner> productItemBusinessPartnerList = new ArrayList<>();
    productItemBusinessPartner.setPickupPointId(PICKUP_POINT_CODE);
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productItemBusinessPartner.setMerchantSku(DEFAULT_MERCHANT_SKU_2);
    productItemBusinessPartner.setMinimumStock(MIN_STOCK);
    productItemBusinessPartner.setBuyable(false);
    productItemBusinessPartner.setDisplay(true);
    productItemBusinessPartner.setSalePrice(999.0);
    productItemBusinessPartner.setPrice(999.0);
    productItemBusinessPartnerList.add(productItemBusinessPartner);

    ProductItemBusinessPartner productItemBusinessPartner1 = new ProductItemBusinessPartner();
    productItemBusinessPartner1.setPickupPointId(PICKUP_POINT_CODE);
    productItemBusinessPartner1.setGdnProductItemSku(ITEM_SKU_1);
    productItemBusinessPartner1.setMerchantSku(DEFAULT_MERCHANT_SKU_2);
    productItemBusinessPartner1.setMinimumStock(MIN_STOCK);
    productItemBusinessPartner1.setBuyable(false);
    productItemBusinessPartner1.setDisplay(true);
    productItemBusinessPartner1.setSalePrice(999.0);
    productItemBusinessPartner1.setPrice(999.0);
    productItemBusinessPartnerList.add(productItemBusinessPartner1);
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        any(), any(), anyList())).thenReturn(productItemBusinessPartnerList);

    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(Constants.DEFAULT_STORE_ID), Mockito.any())).thenReturn(productCollection);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
        .thenReturn(new L3VersionResponse());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).setProductCode(PRODUCT_CODE);
    productVariantUpdateRequest.setCopyToAllVariantImages(new ArrayList<>());

    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);

    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(productCollectionRepository, times(2)).findByStoreIdAndProductCode(eq(STOREID), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(eq(Constants.DEFAULT_STORE_ID), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(updatedProductHistoryService, Mockito.times(1))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesAddedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
        .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.POST_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesAddedTestForReviewPEnding() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"combinedEditFlowEnabled", false);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(true);
    productCollection.setReviewPending(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
      productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
      .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
      .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.POST_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), false);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
      .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productCollectionRepository).saveAndFlush(Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesFalseAddedTest() throws Exception {
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    productVariantUpdateRequest.setProductEditable(true);
    productCollection.setPostLive(false);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
        .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
            Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.PRE_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository).saveAndFlush(productCollectionArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(Constants.PRE_LIVE, itemsPriceStockImagesUpdateResponse.getReviewType());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesFalseAddedPostLiveUpdateTest() throws Exception {
    productL3Response.setSynchronized(true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setProductSyncStatus(true);
    productVariantUpdateRequest.setProductEditable(true);
    productCollection.setPostLive(false);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(applicationContext.getBean(ProductLevel3Service.class)).thenReturn(productLevel3ServiceBeanMock);
    Mockito.when(productLevel3ServiceBeanMock.productAfterUpdateGoingForReviewIsPostLive(eq(STOREID),
        eq(PRODUCT_SKU), eq(BUSINESS_PARTNER_CODE), any(), any(), any(), eq(false))).thenReturn(new PostLiveFlagsDTO(false, true));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
        .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any()))
        .thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.PRE_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(1)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productCollectionRepository, times(2)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Assertions.assertEquals(Constants.POST_LIVE, itemsPriceStockImagesUpdateResponse.getReviewType());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImages1AddedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
        .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.POST_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productCollectionRepository).saveAndFlush(productCollectionArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertFalse(productCollectionArgumentCaptor.getValue().isPostLive());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImageAddedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType("");
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantPriceStockAndImagesRequest.setItemName(ITEM_NAME);
    productVariantPriceStockAndImagesRequest1.setItemName(ITEM_NAME);
    productVariantUpdateRequest.getProductItems().get(0)
      .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
      new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(false);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
      productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
      .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
      .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.POST_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
      eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
      eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
      Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(Mockito.any(),
      Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
      itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }


  @Test
  public void editProductItemsPriceStockImagesL5CommonImages2AddedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    productCollection.setRestrictedKeywordsPresent(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    L3VersionResponse l3VersionResponse = new L3VersionResponse();
    l3VersionResponse.setL3Version(1L);
    Mockito.when(xProductOutbound
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false))
        .thenReturn(l3VersionResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse(BUSINESS_PARTNER_CODE, CATEGORY_CODE, Constants.POST_LIVE);
    Mockito.when(this.productRepository.getConfigurationStatus(Mockito.anyList())).thenReturn(Arrays.asList(configurationStatusResponse));
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productOutbound).updateCommonImages(Mockito.anyList());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(1, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    verify(productLevel3Repository).getProductNameByProductSku(anyList());
    Mockito.verify(updatedProductHistoryService, Mockito.times(3))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productCollectionRepository).saveAndFlush(productCollectionArgumentCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertFalse(productCollectionArgumentCaptor.getValue().isPostLive());
  }

  @Test
  public void editProductItemsPriceStockImagesL5CommonImagesNRAddedTest() throws Exception {
    itemPickupPointListingResponse1.setProductSyncStatus(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(true);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(UPDATE);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest.setMainImage(false);
    productLevel3SummaryDetailsImageRequest.setMarkForDelete(false);
    productVariantUpdateRequest.getProductItems().get(0)
        .setImages(Collections.singletonList(productLevel3SummaryDetailsImageRequest));

    productVariantUpdateRequest.getProductItems().get(0).setSkuCode(SKU_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setSkuCode(SKU_CODE_1);
    productVariantUpdateRequest.getProductItems().get(0).setUpcCode(UPDATED_UPC_CODE);
    productVariantUpdateRequest.getProductItems().get(1).setUpcCode(UPDATED_UPC_CODE);
    itemPickupPointListingResponse.setPriceEditDisabled(true);
    itemPickupPointListingResponse1.setPriceEditDisabled(true);

    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType("NEW");
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequest1.setMainImage(true);
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest1));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    when(productCollectionRepository.findByStoreIdAndProductCode(eq(STOREID), Mockito.any())).thenReturn(productCollection);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);

    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setBuyable(false);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setDisplay(true);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setPrice(999.0);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setSalePrice(999.0);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STOREID, PRODUCT_CODE))
        .thenReturn(productCollection);
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse = new CampaignUpdateDiscountResponse();
    Map<String, String> responseMap = new HashMap<>();
    responseMap.putIfAbsent(STOREID, STOREID);
    campaignUpdateDiscountResponse.setItemSkuStatusMap(responseMap);
    Mockito.when(campaignOutbound.validateAndUpdateDiscountPrice(eq(true), Mockito.any()))
        .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(productLevel3Repository.getProductNameByProductSku(Mockito.anyList())).thenReturn(new HashMap());
    productVariantUpdateRequest.getProductItems().get(0).setProductCode(PRODUCT_CODE);
    Mockito.when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(Mockito.anyList(),
        Mockito.anyList())).thenReturn(productVariantUpdateRequest.getProductItems());
    List<ProductItemBusinessPartner> productItemBusinessPartnerList = new ArrayList<>();
    productItemBusinessPartner.setPickupPointId(PICKUP_POINT_CODE);
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productItemBusinessPartner.setMerchantSku(DEFAULT_MERCHANT_SKU_2);
    productItemBusinessPartner.setMinimumStock(MIN_STOCK);
    productItemBusinessPartner.setBuyable(false);
    productItemBusinessPartner.setDisplay(true);
    productItemBusinessPartner.setSalePrice(999.0);
    productItemBusinessPartner.setPrice(999.0);
    productItemBusinessPartnerList.add(productItemBusinessPartner);

    ProductItemBusinessPartner productItemBusinessPartner1 = new ProductItemBusinessPartner();
    productItemBusinessPartner1.setPickupPointId(PICKUP_POINT_CODE);
    productItemBusinessPartner1.setGdnProductItemSku(ITEM_SKU_1);
    productItemBusinessPartner1.setMerchantSku(DEFAULT_MERCHANT_SKU_2);
    productItemBusinessPartner1.setMinimumStock(MIN_STOCK);
    productItemBusinessPartner1.setBuyable(false);
    productItemBusinessPartner1.setDisplay(true);
    productItemBusinessPartner1.setSalePrice(999.0);
    productItemBusinessPartner1.setPrice(999.0);
    productItemBusinessPartnerList.add(productItemBusinessPartner1);
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        any(), eq(ITEM_SKU), anyList())).thenReturn(productItemBusinessPartnerList);
    when(this.productItemWholesalePriceService.findByStoreIdAndItemSkuAndPickupPointCode(Mockito.any(),
        Mockito.anyList())).thenReturn(new ArrayList());
    Map<String, Map<String, String>> success = new HashMap<>();
    Map<String, String> success1 = new HashMap<>();
    success1.put(Constants.COPY_ALL_STATUS, SUCCESS);
    success.put(productVariantUpdateRequest.getProductItems().get(0).getImages().get(0).getLocationPath(), success1);
    Mockito.when(this.productOutbound.updateCommonImages(Mockito.anyList())).thenReturn(success);
    when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.any(), Mockito.any())).thenReturn(
        productCollection);
    Mockito.when(xProductOutbound.updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any())).thenReturn(editItemResponse);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false))
        .thenReturn(new L3VersionResponse());
    productVariantUpdateRequest.setCopyToAllVariantImages(Arrays.asList(productLevel3SummaryDetailsImageRequest));

    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);

    Mockito.verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), eq(new ArrayList<>()),
        eq(new ArrayList<>()), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(campaignOutbound).validateAndUpdateDiscountPrice(eq(true), Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productItemBusinessPartnerService).saveAll(productItemBusinessPartnerListCaptor.capture());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME, ProductLevel3Status.TEASER.name());
    Mockito.verify(productNotificationService)
        .sendNotificationForProductStatus(BUSINESS_PARTNER_CODE, ITEM_NAME_1, ProductLevel3Status.TEASER.name());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository, times(3)).findByStoreIdAndProductCode(Mockito.any(), Mockito.any());
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(Mockito.any());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    ConfigurationStatusRequest configurationStatusRequest = new ConfigurationStatusRequest();
    configurationStatusRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    configurationStatusRequest.setCategoryCode(CATEGORY_CODE);
    Mockito.verify(productRepository).getConfigurationStatus(Collections.singletonList(configurationStatusRequest));
    SkuCodesRequest skuCodesRequest = new SkuCodesRequest();
    skuCodesRequest.getSkuCodes().addAll(Arrays.asList(SKU_CODE, SKU_CODE_1));
    skuCodesRequest.setFetchArchived(true);
    Mockito.verify(productOutbound).getProductItemBySkuCodes(skuCodesRequest);
    Mockito.verify(applicationContext).getBean(ProductLevel3Service.class);
    Assertions.assertEquals(2, itemPickupPointQuickEditRequestCaptor.getValue().size());
    Assertions.assertEquals(ITEM_SKU, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPickupPointCode());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getWholeSaleActivated());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getMerchantSku());
    Assertions.assertEquals(ProductLevel3Status.TEASER.name(),
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getStatus());
    Assertions.assertNull(itemPickupPointQuickEditRequestCaptor.getValue().get(0).getOff2OnActiveFlag());
    Assertions.assertEquals(Constants.DEFAULT,
        itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getChannel());
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getOfferPrice(), 0);
    Assertions.assertEquals(999, itemPickupPointQuickEditRequestCaptor.getValue().get(0).getPrice().getListPrice(), 0);
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
    Mockito.verify(updatedProductHistoryService, Mockito.times(1))
        .createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
            Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeFlagUpdateResponseWithoutPickupPointCodeTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeFlagUpdateResponsePickupPointCodeTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    profileResponse.setCompany(CompanyDTO.builder().purchaseTerm(GdnBaseLookup.PURCHASE_TERM_PURCHASE_ORDER).build());
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    FailedItemReasonDto failedItemReasonDto = new FailedItemReasonDto();
    failedItemReasonDto.setFailedReason(REQUESTID);
    failedItemReasonDto.setItemSku(ITEM_SKU);
    failedItemReasonDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setFailedItemReason(Collections.singletonList(failedItemReasonDto));
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(Collections.singletonList(failedItemReasonDto));
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequest));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFalse2Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    profileResponse.setCompany(CompanyDTO.builder().purchaseTerm(GdnBaseLookup.PURCHASE_TERM_PURCHASE_ORDER).build());
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    itemPickupPointListingRequest.setPickupPointCodes(new HashSet<>());
    itemPickupPointListingRequest1.setPickupPointCodes(new HashSet<>());
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
            Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    FailedItemReasonDto failedItemReasonDto = new FailedItemReasonDto();
    failedItemReasonDto.setFailedReason(REQUESTID);
    failedItemReasonDto.setItemSku(PICKUP_POINT_CODE);
    failedItemReasonDto.setPickUpPointCode(PICKUP_POINT_CODE);
    FailedItemReasonDto failedItemReasonDto2 = new FailedItemReasonDto();
    failedItemReasonDto2.setFailedReason(REQUESTID);
    failedItemReasonDto2.setItemSku(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setFailedItemReason(List.of(failedItemReasonDto2, failedItemReasonDto));
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(List.of(failedItemReasonDto, failedItemReasonDto2));
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequest));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0).setFbbActive(false);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsNullTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFalseTest3() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFalseTest1() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(false);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(),  PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFalseTest2() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),Mockito.any() , Mockito.anyBoolean(), Mockito.any() , Mockito.anyBoolean(),
        Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(),  PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5WholeSaleExistsFreeGiftTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
      .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
      .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
      .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    wholesalePriceSkuResponse.setSkuStatus(Constants.AUTO_INACTIVE);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, Constants.AUTO_INACTIVE);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
      .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
      .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
         editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productPricingOutbound)
      .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
      Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
      UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
      PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(3)).createProductL3AuditLog(Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY, false,
            itemPickupPointRequest.getPickupPointId());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(Boolean.FALSE, itemPickupPointRequest.getWholesalePriceActivated());
    Assertions.assertNull(itemPickupPointListingResponse.getWholesalePriceActivated());
  }

  @Test
  public void editProductItemsPriceStockImagesL5NoAdditionTest() throws Exception {
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE, INACTIVE_STATUS);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    FailedItemReasonDto failedItemReasonDto = new FailedItemReasonDto();
    failedItemReasonDto.setFailedReason(REQUESTID);
    failedItemReasonDto.setItemSku(ITEM_SKU);
    failedItemReasonDto.setPickUpPointCode(PICKUP_POINT_CODE);
    FailedItemReasonDto failedItemReasonDto2 = new FailedItemReasonDto();
    failedItemReasonDto2.setFailedReason(REQUESTID);
    failedItemReasonDto2.setItemSku(ITEM_SKU);
    wholesalePriceBulkUpdateResponse.setFailedItemReason(Arrays.asList(failedItemReasonDto, failedItemReasonDto2));
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(List.of(failedItemReasonDto, failedItemReasonDto2));
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    productVariantUpdateRequest.setAddPickupPoints(new ArrayList<>());
    PickupPointDeleteRequest pickupPointDeleteRequest = new PickupPointDeleteRequest();
    pickupPointDeleteRequest.setPickupPointId(PICKUP_POINT_CODE);
    pickupPointDeleteRequest.setItemSku(ITEM_SKU);
    productVariantUpdateRequest.setDeletePickupPoints(Collections.singletonList(pickupPointDeleteRequest));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
           editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound).bulkActivateOrDeactivateSku(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, Constants.DEFAULT, PRODUCT_SKU, Constants.PRODUCT_NAME,
            UpdateProductActivity.PICKUP_POINT_DELETED.getDesc(), PICKUP_POINT_CODE, StringUtils.EMPTY,false,
            itemPickupPointRequest.getPickupPointId());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
  }

  @Test
  public void editProductItemsPriceStockImagesL5NoDeleteTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,"mppForWhEnabled", false);
    productL3Response.setSynchronized(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(true);
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setQuantity(2);
    productItemWholesalePriceRequest.setWholesaleDiscount(10);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setProductItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest));
    productVariantUpdateRequest.getProductItems().get(1).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(null);
    productVariantUpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
        .setWholesalePriceActivated(false);
    productVariantUpdateRequest.setFbbActiveAtL3Level(true);
    itemPickupPointListingResponse.setCategoryCode(CATEGORY_CODE);
    itemPickupPointListingResponse.setWholesalePriceConfigEnabled(true);
    itemPickupPointListingResponse.setFbbActive(true);
    itemPickupPointListingResponse.setWholesalePriceActivated(false);
    itemPickupPointListingResponse1.setFbbActive(true);
    itemPickupPointListingResponse1.setWholesalePriceActivated(false);
    itemPickupPointListingResponse1.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(productItemBusinessPartnerRepository
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(pcbFeign.getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE))
        .thenReturn(new GdnRestSingleResponse(wholesaleMappingResponse, REQUESTID));
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU_COPY);
    wholesalePriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    Map<Integer, Double> map = new HashMap();
    map.put(2, 10.0);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    wholesalePriceSkuResponse.setSkuStatus(Constants.AUTO_INACTIVE);
    Mockito.when(productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList()))
        .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    WholesalePriceBulkUpdateResponse wholesalePriceBulkUpdateResponse = new WholesalePriceBulkUpdateResponse();
    Map<String, String> wholeSaleMap = new HashMap();
    wholeSaleMap.putIfAbsent(ITEM_SKU_COPY + Constants.HYPHEN + PICKUP_POINT_CODE, Constants.AUTO_INACTIVE);
    WholeSalePriceSkuStatusDto wholeSalePriceSkuStatusDto = new WholeSalePriceSkuStatusDto();
    wholeSalePriceSkuStatusDto.setItemSku(ITEM_SKU_COPY);
    wholeSalePriceSkuStatusDto.setPickUpPointCode(PICKUP_POINT_CODE);
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatus(Collections.singletonList(wholeSalePriceSkuStatusDto));
    wholesalePriceBulkUpdateResponse.setWholesalePriceSkuStatusMap(wholeSaleMap);
    wholesalePriceBulkUpdateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE)))
        .thenReturn(wholesalePriceBulkUpdateResponse);
    BulkActivateDeactivateResponse bulkActivateDeactivateResponse = new BulkActivateDeactivateResponse();
    bulkActivateDeactivateResponse.setFailedItemReason(new ArrayList<>());
    Mockito.when(productPricingOutbound.bulkActivateOrDeactivateSku(Mockito.anyList()))
        .thenReturn(bulkActivateDeactivateResponse);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    productVariantUpdateRequest.setDeletePickupPoints(new ArrayList<>());
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound).updateItemPickupPoints(eq(STOREID), eq(productL3Response.getProductSku()),
        eq(productL3Response.getProductType()), itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(),
        Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any(), Mockito.any(), Mockito.any());
    Mockito.verify(productPricingOutbound)
        .bulkUpdateWholesalePrice(Mockito.anyList(), eq(BUSINESS_PARTNER_CODE));
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(pcbFeign).getWholesaleConfigToCategory(Constants.DEFAULT_STORE_ID, Constants.DEFAULT_CHANNEL_ID,
        Constants.DEFAULT_CLIENT_ID, Constants.DEFAULT_REQUEST_ID, Constants.DEFAULT_USERNAME, CATEGORY_CODE);
    Mockito.verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU_COPY, PRODUCT_SKU, null,
        UpdateProductActivity.UPDATE_WHOLE_SALE_RULES.getDesc(), null, null, false,
        PICKUP_POINT_CODE);
    verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(Mockito.any(),
      Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.anyBoolean(), Mockito.any());
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertEquals(ITEM_SKU, inventoryDetailInfoRequestDTOListCaptor.getValue().get(0).getWebItemSku());
    Assertions.assertEquals(ITEM_SKU_1, inventoryDetailInfoRequestDTOListCaptor.getValue().get(1).getWebItemSku());
    Assertions.assertEquals(Boolean.FALSE, itemPickupPointRequest.getWholesalePriceActivated());
    Assertions.assertEquals(Boolean.FALSE, itemPickupPointListingResponse.getWholesalePriceActivated());
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeTest() throws Exception {
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeVariantCreationFalse2Test() throws Exception {
    product.getProductAttributes().get(0).getAttribute().setVariantCreation(false);
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", false);
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeNewDefiningAttributeValueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setAttributeCode(ATTRIBUTE_CODE_1);
    allowedAttributeValueRequest.setAttributeType(com.gdn.x.productcategorybase.dto.AttributeType.DEFINING_ATTRIBUTE.name());
    allowedAttributeValueRequest.setValues(Collections.singletonList(ATTRIBUTE_CODE_1));
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    AllowedValueResponse allowedValueResponse = new AllowedValueResponse();
    allowedValueResponse.setValue(ATTRIBUTE_CODE_1);
    allowedAttributeValueResponse.setAllowedValue(Collections.singletonList(allowedValueResponse));
    Mockito.when(productOutbound.findAllowedAttributeValue(Mockito.anyList()))
        .thenReturn(Collections.singletonList(allowedAttributeValueResponse));
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_1, Collections.singletonList(ATTRIBUTE_CODE_1));
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
    Mockito.verify(productOutbound).findAllowedAttributeValue(Mockito.anyList());
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeNewDefiningAttributeValueAreDeletedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    try {
      Mockito.when(productOutbound.findAllowedAttributeValue(Mockito.anyList())).thenReturn(null);
      attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_1, Collections.singletonList(ATTRIBUTE_CODE_1));
      productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(),
          newProductAttributes, new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
    } catch (ApplicationRuntimeException exp) {
      Assertions.assertEquals("Unspecified error :The attribute value does not exist anymore", exp.getMessage());
    } finally {
      Mockito.verify(productOutbound).findAllowedAttributeValue(Mockito.anyList());
    }
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeNewDefiningAttributeValueMfdTrueAttributeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setAttributeCode(ATTRIBUTE_CODE_1);
    allowedAttributeValueRequest.setAttributeType(com.gdn.x.productcategorybase.dto.AttributeType.DEFINING_ATTRIBUTE.name());
    allowedAttributeValueRequest.setValues(Collections.singletonList(ATTRIBUTE_CODE_1));
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    AllowedValueResponse allowedValueResponse = new AllowedValueResponse();
    allowedValueResponse.setValue(ATTRIBUTE_CODE_1);
    allowedAttributeValueResponse.setAllowedValue(Collections.singletonList(allowedValueResponse));
    Mockito.when(productOutbound.findAllowedAttributeValue(Mockito.anyList()))
        .thenReturn(Collections.singletonList(allowedAttributeValueResponse));
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_1, Collections.singletonList(ATTRIBUTE_CODE_1));
    product.getProductAttributes().get(0).setMarkForDelete(true);
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
    Mockito.verify(productOutbound).findAllowedAttributeValue(Mockito.anyList());
  }

  @Test
  public void checkIfNewValuesAreAddedToExistingAttributeNewDescriptiveAttributeValueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "addDeleteVariantSwitch", true);
    AllowedAttributeValueRequest allowedAttributeValueRequest = new AllowedAttributeValueRequest();
    allowedAttributeValueRequest.setAttributeCode(ATTRIBUTE_CODE_1);
    allowedAttributeValueRequest.setAttributeType(
        com.gdn.x.productcategorybase.dto.AttributeType.DESCRIPTIVE_ATTRIBUTE.name());
    allowedAttributeValueRequest.setValues(Collections.singletonList(ATTRIBUTE_CODE_1));
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_1, Collections.singletonList(ATTRIBUTE_CODE_1));
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    allowedAttributeValueResponse.setAllowedValue(new ArrayList<>());
    when(productOutbound.findAllowedAttributeValue(Mockito.anyList())).thenReturn(
        Collections.singletonList(allowedAttributeValueResponse));
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
    verify(productOutbound).findAllowedAttributeValue(Mockito.anyList());
  }

  @Test
  public void checkIfExistingValueIsDeletedFromExistingValue() throws Exception {
    attributeCodeToValuesRequestMap.put(ATTRIBUTE_CODE_2, Collections.singletonList(ATTRIBUTE_CODE_2));
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    allowedAttributeValueResponse.setAllowedValue(new ArrayList<>());
    when(productOutbound.findAllowedAttributeValue(Mockito.anyList())).thenReturn(
        Collections.singletonList(allowedAttributeValueResponse));
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, new ArrayList<>(), productLevel3);
  }

  @Test
  public void checkIfExistingAttributeIsDeletedTest() throws Exception {
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    allowedAttributeValueResponse.setAllowedValue(new ArrayList<>());
    when(productOutbound.findAllowedAttributeValue(Mockito.anyList())).thenReturn(
        Collections.singletonList(allowedAttributeValueResponse));
    ProductLevel3 productData = new ProductLevel3();
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, Arrays.asList(ATTRIBUTE_CODE_1), productData);
  }

  @Test
  public void checkIfExistingAttributeIsDeletedTest2() throws Exception {
    AllowedAttributeValueResponse allowedAttributeValueResponse = new AllowedAttributeValueResponse();
    allowedAttributeValueResponse.setAllowedValue(new ArrayList<>());
    when(productOutbound.findAllowedAttributeValue(Mockito.anyList())).thenReturn(
        Collections.singletonList(allowedAttributeValueResponse));
    productLevel3ServiceBean.checkIfValuesAreUpdatedToExistingAttribute(product, new HashMap<>(), newProductAttributes,
        new HashMap<>(), attributeCodeToValuesRequestMap, Arrays.asList(ATTRIBUTE_CODE_2), productLevel3);
  }

  @Test
  public void validateFreeSampleInL5UpdateTest() throws Exception {
    productVariantUpdateRequest.setFreeSample(true);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
      new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
      .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
        editProductResponse, new ProductLevel3(), true);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
        new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
        null, productVariantUpdateRequest, new EditFlagChangesDTO());
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
      .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    Mockito.verify(productCollectionRepository)
      .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
  }

  @Test
  public void checkIfItemChangedL5Test() {
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertFalse(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5Test2() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPriceClientId", "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPrice", true);
    itemPickupPointListingResponse.setOriginalSellingPrice(889899.0);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertFalse(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5Test3() {
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPriceClientId", "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPrice", true);
    itemPickupPointListingResponse.setOriginalSellingPrice(889899.0);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5Test4() {
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPriceClientId", "x-bulk");
    ReflectionTestUtils.setField(productLevel3ServiceBean, "validateOnOriginalSellingPrice", true);
    itemPickupPointListingResponse.setOriginalSellingPrice(889899.0);
    itemPickupPointRequest.setSalePrice(889899.0);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertFalse(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5UpdatedToOnlineTest() {
    itemPickupPointRequest.setBuyable(true);
    itemPickupPointRequest.setDisplay(true);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5UpdatedToCncOnlineTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    itemPickupPointRequest.setCncBuyable(true);
    itemPickupPointRequest.setCncDisplay(true);
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.CNC_CHANNEL);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5CNCNotUpdated_switchOnTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    itemPickupPointRequest.setCncBuyable(false);
    itemPickupPointRequest.setCncDisplay(false);
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.CNC_CHANNEL);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertFalse(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5UpdatedToCncOnline_absentInDbTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    itemPickupPointRequest.setCncBuyable(true);
    itemPickupPointRequest.setCncDisplay(true);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5NotUpdatedToCncActiveSwitchOffTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", false);
    itemPickupPointRequest.setCncActive(false);
    itemPickupPointListingResponse.setCncActive(false);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertFalse(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5UpdatedToCncActiveSwitchOffTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", false);
    itemPickupPointRequest.setCncActive(false);
    itemPickupPointListingResponse.setCncActive(true);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void checkIfItemChangedL5UpdatedToOfflineTest() {
    itemPickupPointListingResponse.getViewConfigs().get(0).setChannelId(Constants.DEFAULT);
    itemPickupPointListingResponse.getViewConfigs().get(0).setBuyable(true);
    itemPickupPointListingResponse.getViewConfigs().get(0).setDisplay(true);
    boolean itemChanged = productLevel3ServiceBean
        .checkIfItemChangedL5(itemPickupPointRequest, itemPickupPointListingResponse);
    Assertions.assertTrue(itemChanged);
  }

  @Test
  public void productAfterUpdateGoingForReviewIsPostLiveTest() throws Exception {
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE)).thenReturn(new ProfileResponse());
    PostLiveFlagsDTO postLiveFlagsDTO = productLevel3ServiceBean.productAfterUpdateGoingForReviewIsPostLive(STOREID,
        PRODUCT_SKU, BUSINESS_PARTNER_CODE, null, null, null, false);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Assertions.assertNull(postLiveFlagsDTO.getPostLiveConfigOfProduct());
    Assertions.assertFalse(postLiveFlagsDTO.isPostLiveConfig());
  }

  @Test
  public void publishEditedResizeEventIfApplicableNoResizeImagesTest() {
    EditedResizeAndImagesUpdateStatusResponse editedResizeAndImagesUpdateStatusResponse =
        new EditedResizeAndImagesUpdateStatusResponse();
    EditedResizeAndImagesUpdateStatusResponse response =
        productLevel3ServiceBean.publishEditedResizeEventIfApplicable(productVariantUpdateRequest, editProductResponse,
            editedResizeAndImagesUpdateStatusResponse, PRODUCT_CODE);
    Assertions.assertNull(response);
  }

  @Test
  public void publishEditedResizeEventIfApplicableTest() {
    EditedResizeAndImagesUpdateStatusResponse editedResizeAndImagesUpdateStatusResponse =
        new EditedResizeAndImagesUpdateStatusResponse();
    editedResizeAndImagesUpdateStatusResponse.setEditedImages(Collections.singletonList(new ImageRequest()));
    productLevel3ServiceBean.publishEditedResizeEventIfApplicable(productVariantUpdateRequest,
        editProductResponse, editedResizeAndImagesUpdateStatusResponse, PRODUCT_CODE);
    Mockito.verify(productPublisherService).publishEditImageResizeEvent(
        new EditedImageResizeEvent(PRODUCT_CODE, DEFAULT_STORE_ID,
            editedResizeAndImagesUpdateStatusResponse.getEditedImages()));
  }

  @Test
  public void publishEditedResizeEventIfApplicableAutoNeedRevisionTest() {
    EditedResizeAndImagesUpdateStatusResponse editedResizeAndImagesUpdateStatusResponse =
        new EditedResizeAndImagesUpdateStatusResponse();
    editedResizeAndImagesUpdateStatusResponse.setEditedImages(Collections.singletonList(new ImageRequest()));
    editProductResponse.setAction(2);
    EditedResizeAndImagesUpdateStatusResponse response =
        productLevel3ServiceBean.publishEditedResizeEventIfApplicable(productVariantUpdateRequest, editProductResponse,
            editedResizeAndImagesUpdateStatusResponse, PRODUCT_CODE);
    assertNotNull(response);
  }

  @Test
  public void validateL5UpdateRequestTest() throws Exception {
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
          profileResponse);
    Mockito.verify(variantEditValidationService)
        .validateL5UpdateRequestNew(new ProductVariantUpdateRequest(), new SimpleStringResponse(), new ArrayList<>(),
          profileResponse);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertNull(itemsPriceStockImagesUpdateResponse);
  }

  @Test
  public void validateL5UpdateRequestExceptionTest() throws Exception {
    Mockito.doThrow(Exception.class).when(variantEditValidationService)
        .validateL5UpdateRequestNew(new ProductVariantUpdateRequest(), new SimpleStringResponse(), new ArrayList<>(),
          profileResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
          profileResponse);
    Mockito.verify(variantEditValidationService)
        .validateL5UpdateRequestNew(new ProductVariantUpdateRequest(), new SimpleStringResponse(), new ArrayList<>(),
          profileResponse);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertNotNull(itemsPriceStockImagesUpdateResponse);
  }

  @Test
  public void validateL5UpdateRequestApplicationExceptionTest() throws Exception {
    Mockito.doThrow(ApplicationRuntimeException.class).when(variantEditValidationService)
        .validateL5UpdateRequestNew(new ProductVariantUpdateRequest(), new SimpleStringResponse(), new ArrayList<>(),
          profileResponse);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse =
        productLevel3ServiceBean.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
          profileResponse);
    Mockito.verify(variantEditValidationService)
        .validateL5UpdateRequestNew(new ProductVariantUpdateRequest(), new SimpleStringResponse(), new ArrayList<>(),
          profileResponse);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Assertions.assertNotNull(itemsPriceStockImagesUpdateResponse);
  }

  @Test
  public void updateItemLevelImagesTest() throws Exception {
    Mockito.doThrow(Exception.class).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    try {
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
            new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(), new ArrayList<>());
      });
    } finally {
      Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    }
  }

  @Test
  public void updateItemLevelImagesExceptionTest() throws Exception {
    Exception exception = new Exception(PRODUCT_CODE);
    Mockito.doThrow(exception).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    try {
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
            new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(), new ArrayList<>());
      });
    } finally {
      Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    }
  }

  @Test
  public void updateItemLevelImagesException1Test() throws Exception {
    Exception exception = new Exception(NO_MAIN_IMAGE_PRESENT);
    Mockito.doThrow(exception).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    try {
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
            new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(), new ArrayList<>());
      });
    } finally {
      Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    }
  }

  @Test
  public void updateItemLevelImagesException2Test() throws Exception {
    Exception exception = new Exception(NO_MAIN_IMAGE_PRESENT);
    Mockito.doThrow(exception).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
        new ProductImageEditRequest();
    productImageEditRequest.setCopyToAllVariantImages(new CopyImageEditRequest());
    try {
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
            new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(),
            Collections.singletonList(productImageEditRequest));
      });
    } finally {
      Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    }
  }

  @Test
  public void updateItemLevelImagesException4Test() throws Exception {
    Exception exception = new Exception(NO_MAIN_IMAGE_PRESENT);
    Mockito.doThrow(exception).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
        new ProductImageEditRequest();
    productImageEditRequest.setCopyToAllVariantImages(null);
    try {
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
            new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(),
            Collections.singletonList(productImageEditRequest));
      });
    } finally {
      Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    }
  }

  @Test
  public void updateItemLevelImagesException3Test() throws Exception {
    Exception exception = new Exception(NO_MAIN_IMAGE_PRESENT);
    Mockito.doThrow(exception).when(productOutbound)
        .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
    com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
        new ProductImageEditRequest();
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setAdd(true);
    productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
    productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
        new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(),
        Collections.singletonList(productImageEditRequest));
    Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
  }

    @Test
    public void updateItemLevelImagesExceptionSwitchOffTest() throws Exception {
      ReflectionTestUtils.setField(productLevel3ServiceBean, "suppressItemImageUpdateError", false);
      Exception exception = new Exception(NO_MAIN_IMAGE_PRESENT);
      Mockito.doThrow(exception).when(productOutbound)
          .updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
      com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest productImageEditRequest =
          new ProductImageEditRequest();
      CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
      copyImageEditRequest.setAdd(true);
      productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
      try {
        Assertions.assertThrows(Exception.class, () -> {
          productLevel3ServiceBean.updateItemLevelImages(BUSINESS_PARTNER_CODE, false, new ArrayList<>(),
              new ProductItemImageUpdateRequest(), PRODUCT_SKU, new HashMap<>(), new HashMap<>(),
              Collections.singletonList(productImageEditRequest));
        });
      } finally {
        Mockito.verify(productOutbound).updateProductItemImagesByProductCode(new ProductItemImageUpdateRequest());
      }
    }

  @Test
  public void toggleArchiveProductsTest() throws Exception {
    productL3Response.setItemSkus(Arrays.asList(ITEM_SKU));
    productL3Response.setMerchantCode(BUSINESS_PARTNER_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    masterDataProductDTO.setProductName(PRODUCT_NAME);
    when(xProductOutbound.getProductDetailsByProductSku(anyString()))
        .thenReturn(new GdnRestSingleResponse<ProductL3Response>(productL3Response, REQUESTID));

    when(productStockAlertRepository.findByGdnSkuOrderByUpdatedDateDesc(anyString())).thenReturn(new ArrayList<>());
    doNothing().when(updatedProductHistoryService)
        .createProductL3AuditLog(BUSINESS_PARTNER_CODE, GDN_SKU, PRODUCT_SKU, PRODUCT_NAME,
            ProductLevel3Aggregator.ProductLevel3AggregatorState.ARCHIVED.name(), VALUE_1, VALUE_2,
            false, PICKUP_POINT_CODE);
    ItemBulkArchiveResponse response = productLevel3ServiceBean.toggleArchiveProducts(Arrays.asList(PRODUCT_SKU), true);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound).toggleArchiveProduct(PRODUCT_SKU, true);
    Mockito.verify(productLevel3AggregatorService)
        .updateState(ITEM_SKU, BUSINESS_PARTNER_CODE, ProductLevel3Aggregator.ProductLevel3AggregatorState.ARCHIVED);
    Mockito.verify(productStockAlertRepository).findByGdnSkuOrderByUpdatedDateDesc(ITEM_SKU);
  }

  @Test
  public void getPickUpPointByItemSkuTest() throws Exception {
    ItemResponseV2 itemResponse1 = new ItemResponseV2();
    itemResponse1.setItemSku(ITEM_SKU);
    itemResponse1.setPickUpPointCode(PICKUP_POINT_CODE);
    ItemResponseV2 itemResponse2 = new ItemResponseV2();
    itemResponse2.setItemSku(ITEM_SKU);
    itemResponse2.setPickUpPointCode(PICKUP_POINT_CODE);
    when(xProductOutbound.getItemPickupPointsByItemSku(any())).thenReturn(Arrays.asList(itemResponse1, itemResponse2));
    productLevel3ServiceBean.getPickUpPointByItemSku(Arrays.asList(ITEM_SKU), 1);
    verify(xProductOutbound).getItemPickupPointsByItemSku(any());
  }

  @Test
  public void addMissingL4sFromAddPickupPointsListTest() {
    itemPickupPointListingRequest.setItemSku(ITEM_SKU);
    addPickupPointRequest.setItemSku(ITEM_SKU);
    itemPickupPointRequest1.setItemSku(ITEM_SKU_1);
    List<ItemPickupPointListingRequest> itemPickupPointListingRequests =
        new ArrayList<>(Arrays.asList(itemPickupPointListingRequest));
    productLevel3ServiceBean.addMissingL4sFromAddPickupPointsList(BUSINESS_PARTNER_CODE, PRODUCT_SKU,
        itemPickupPointListingRequests, Arrays.asList(addPickupPointRequest, itemPickupPointRequest1));
    Assertions.assertEquals(itemPickupPointListingRequests.size(), 2, 0);
  }

  @Test
  public void getUpdatedItemPickupPointsTest(){
    ItemPickupPointVo itemPickupPointVo = new ItemPickupPointVo();
    itemPickupPointVo.setItemSku(ITEM_NAME);
    ItemViewConfig itemViewConfig = new ItemViewConfig();
    itemViewConfig.setBuyable(true);
    itemViewConfig.setChannel(DEFAULT);
    itemPickupPointVo.setItemViewConfig(Collections.singleton(itemViewConfig));
    Price price = new Price();
    price.setChannel(DEFAULT);
    itemPickupPointVo.setPrice(Collections.singleton(price));
    List<ItemPickupPoint> itemPickupPointList =
        productLevel3ServiceBean.getUpdatedItemPickupPoints(editItemResponse, true,
            CombinedEditItemResponse.builder().updatedItemPickupPointsVo(Arrays.asList(itemPickupPointVo))
                .build());
    Assertions.assertEquals(ITEM_NAME, itemPickupPointList.get(0).getItemSku());
    Assertions.assertTrue(itemPickupPointList.get(0).getItemViewConfig().iterator().next().isBuyable());
    Assertions.assertEquals(DEFAULT, itemPickupPointList.get(0).getItemViewConfig().iterator().next().getChannel());
    Assertions.assertEquals(DEFAULT, itemPickupPointList.get(0).getPrice().iterator().next().getChannel());
  }

  @Test
  public void getL3VersionResponseTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "combinedEditFlowEnabled", true);
    Mockito.when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(null,
        productVariantUpdateRequest.getProductCode(), false)).thenReturn(new L3VersionResponse());
    L3VersionResponse l3VersionResponse =
        productLevel3ServiceBean.getL3VersionResponse(PRODUCT_CODE, true, new HashMap<>(), combinedEditItemResponse);
    Assertions.assertNull(l3VersionResponse.getL3Version());
    Mockito.verify(xProductOutbound)
        .generateProductScoreByProductSkuOrProductCode(null, productVariantUpdateRequest.getProductCode(), false);
  }

  @Test
  public void saveProductItemBusinessPartnerAndUpdateHistoryTest() throws Exception {
    productLevel3ServiceBean.saveProductItemBusinessPartnerAndUpdateHistory(BUSINESS_PARTNER_CODE,
        PRODUCT_SKU, Arrays.asList(productItemBusinessPartner), Arrays.asList(l5HistoryDTO));
    Mockito.verify(productItemBusinessPartnerService).save(Arrays.asList(productItemBusinessPartner));
    Mockito.verify(updatedProductHistoryService).createProductL3AuditLog(BUSINESS_PARTNER_CODE, ITEM_SKU,
        PRODUCT_SKU, ITEM_NAME, ACTIVITY, PREVIOUS_VALUE, CURRENT_VALUE, false, PICKUP_POINT_CODE);
  }

  @Test
  public void saveProductItemBusinessPartnerAndUpdateHistoryEmptyTest() throws Exception {
    productLevel3ServiceBean.saveProductItemBusinessPartnerAndUpdateHistory(BUSINESS_PARTNER_CODE,
        PRODUCT_SKU, new ArrayList<>(), Arrays.asList(l5HistoryDTO));
  }

  @Test
  public void updateBundleRecipeInProductItemBusinessPartnerTest()
      throws JsonProcessingException, ApplicationException {
    when(bundleRecipeService.updateBundleRecipeInProductItemBusinessPartner(STOREID,
        Arrays.asList(productItemBusinessPartner), Arrays.asList(bundleRecipeRequest)))
        .thenReturn(Pair.of(Arrays.asList(productItemBusinessPartner), Arrays.asList(l5HistoryDTO)));
    when(productItemBusinessPartnerService.mergeProductItemBusinessPartnerLists(
        Arrays.asList(productItemBusinessPartner), Arrays.asList(productItemBusinessPartner)))
        .thenReturn(Arrays.asList(productItemBusinessPartner));
    productLevel3ServiceBean.updateBundleRecipeInProductItemBusinessPartner(STOREID,
        Arrays.asList(bundleRecipeRequest), Arrays.asList(productItemBusinessPartner),
        new ArrayList<>());
    verify(bundleRecipeService).updateBundleRecipeInProductItemBusinessPartner(STOREID,
        Arrays.asList(productItemBusinessPartner), Arrays.asList(bundleRecipeRequest));
    verify(productItemBusinessPartnerService).mergeProductItemBusinessPartnerLists(
        Arrays.asList(productItemBusinessPartner), Arrays.asList(productItemBusinessPartner));
  }

  @Test
  public void testHistoryUpdateForItemImages() throws Exception {
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.singletonMap(LOCATION_PATH,
      Collections.singletonMap(COPY_ALL_STATUS, LOCATION_PATH)));
    ProductItemImageUpdateRequest productItemImageUpdateRequest =
      new ProductItemImageUpdateRequest();
    EditedResizeAndImagesUpdateStatusResponse editedResizeAndImagesUpdateStatusResponse =
      new EditedResizeAndImagesUpdateStatusResponse();
    ProductItemImageHistoryDTO mockProductItemImageHistoryDTO =
      new ProductItemImageHistoryDTO();
    mockProductItemImageHistoryDTO.setProductItemImageUpdateRequest(productItemImageUpdateRequest);

    editedResizeAndImagesUpdateStatusResponse.setProductItemImageHistoryDTO(mockProductItemImageHistoryDTO);
    productLevel3ServiceBean.historyUpdateForItemImages(BUSINESS_PARTNER_CODE, productVariantUpdateRequest
      , editProductItemAndImageResponse, editedResizeAndImagesUpdateStatusResponse);
    assertNotNull(editedResizeAndImagesUpdateStatusResponse.getProductItemImageHistoryDTO());
  }

  @Test
  public void testHistoryUpdateForItemImagesEmptyMap() throws Exception {
    editProductItemAndImageResponse.setImagePathErrorMap(Collections.emptyMap());
    ProductItemImageUpdateRequest productItemImageUpdateRequest =
      new ProductItemImageUpdateRequest();
    EditedResizeAndImagesUpdateStatusResponse editedResizeAndImagesUpdateStatusResponse =
      new EditedResizeAndImagesUpdateStatusResponse();
    ProductItemImageHistoryDTO mockProductItemImageHistoryDTO =
      new ProductItemImageHistoryDTO();
    mockProductItemImageHistoryDTO.setProductItemImageUpdateRequest(productItemImageUpdateRequest);

    editedResizeAndImagesUpdateStatusResponse.setProductItemImageHistoryDTO(mockProductItemImageHistoryDTO);
    productLevel3ServiceBean.historyUpdateForItemImages(BUSINESS_PARTNER_CODE, productVariantUpdateRequest
      , editProductItemAndImageResponse, editedResizeAndImagesUpdateStatusResponse);
    assertNotNull(editedResizeAndImagesUpdateStatusResponse.getProductItemImageHistoryDTO());
  }

  @Test
  public void testGetProductCollectionFromEditResponse() {
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID,
      productVariantUpdateRequest, editProductResponse, new ProductDetailEditDTO());
    Mockito.verifyNoMoreInteractions(productCollectionRepository);
  }

  @Test
  public void testGetProductCollectionFromEditNullProductCollectionDTOResponse() {
    productDetailEditDTO.setProductCollectionDTO(null);
    editProductResponse.setProductDetailEditDTO(productDetailEditDTO);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID,
      productVariantUpdateRequest, editProductResponse, new ProductDetailEditDTO());
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any() ,
      any());  }


  @Test
  public void testGetProductCollectionFromVariantUpdateRequest() {
    ProductVariantUpdateRequest variantUpdateRequest = new ProductVariantUpdateRequest();
    editProductResponse.setProductDetailEditDTO(null);
    productVariantUpdateRequest.setProductCode(null);
    List<ProductVariantPriceStockAndImagesRequest> productItems = Collections.singletonList(
      productVariantPriceStockAndImagesRequest);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID,
      productVariantUpdateRequest, editProductResponse, new ProductDetailEditDTO());
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any() ,
      any());
  }

  @Test
  public void testGetProductCollectionFromVariantUpdateRequest2() {
    editProductResponse.setProductDetailEditDTO(null);
    productVariantUpdateRequest.setProductCode(null);
    List<ProductVariantPriceStockAndImagesRequest> productItems = Collections.singletonList(productVariantPriceStockAndImagesRequest);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID, productVariantUpdateRequest, editProductResponse,
      new ProductDetailEditDTO());
    verify(productCollectionRepository, times(1)).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any(), any());
    Mockito.verifyNoMoreInteractions(productCollectionRepository);
  }

  @Test
  public void testGetProductCollectionFromRepository() {
    ProductVariantUpdateRequest variantUpdateRequest = new ProductVariantUpdateRequest();
    productVariantUpdateRequest.setProductItems(Collections.emptyList());
    editProductResponse.setProductDetailEditDTO(null);
    List<ProductVariantPriceStockAndImagesRequest> productItems = Collections.singletonList(
      productVariantPriceStockAndImagesRequest);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID,
      productVariantUpdateRequest, editProductResponse, new ProductDetailEditDTO());
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any() ,
      any());
  }

  @Test
  public void testGetProductCollectionFromEmptyProductItems() {
    editProductResponse.setProductDetailEditDTO(null);
    productVariantUpdateRequest.setProductItems(Collections.emptyList());
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID, productVariantUpdateRequest, editProductResponse,
      new ProductDetailEditDTO());
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any() ,
      any());
  }

  @Test
  public void testGetProductCollectionFromRepository2() {
    editProductResponse.setProductDetailEditDTO(null);
    ProductVariantUpdateRequest variantUpdateRequest = new ProductVariantUpdateRequest();
    productVariantUpdateRequest.setProductItems(Collections.emptyList());
    editProductResponse.setProductDetailEditDTO(null);
    List<ProductVariantPriceStockAndImagesRequest> productItems = Collections.singletonList(
      productVariantPriceStockAndImagesRequest);
    ProductCollection result = productLevel3ServiceBean.getProductCollection(STOREID,
      productVariantUpdateRequest, editProductResponse, new ProductDetailEditDTO());
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(any() ,
      any());
  }

  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCBEligibleCombinedEditFalse() throws Exception{
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setProductName(PRODUCT_NAME);
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    productData.setNewlyAddedItems(Collections.emptyList());
    productData.setCategoryUpdated(true);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
        eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
  }

  @Test
  public void testBrandAttributeUpdateFromExternalSwitchOn() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,
        "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "brandCategoryEditEnabledForExternal",
        true);
    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setProductName(PRODUCT_NAME);
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    product.getProductAttributes().get(0).getAttribute().setAttributeCode("BR-M036969");
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    PredefinedAllowedAttributeValueResponse predefinedAllowedAttributeValueResponse =
        new PredefinedAllowedAttributeValueResponse();
    predefinedAllowedAttributeValueResponse.setPredefinedAllowedAttributeCode("BR-M99999");
    when(productOutbound.getPredefinedAllowedAttributeValueByAttributeCodeAndValue(Mockito.any(),
        Mockito.any(), Mockito.anyBoolean())).thenReturn(predefinedAllowedAttributeValueResponse);
    productData.setNewlyAddedItems(Collections.emptyList());
    productData.setBrandUpdated(true);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>>
        result =
        productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
            productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(),
            editProductResponse, productDetailEditDTO, new ProductL3Response(), new ProductL3UpdateRequest());
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false),
        Mockito.anyBoolean(), eq(true), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(),
        Mockito.anyBoolean(), Mockito.anyBoolean(), eq(new ArrayList<>()), Mockito.any(),
        Mockito.any(EditProductResponse.class));
    verify(productOutbound).getPredefinedAllowedAttributeValueByAttributeCodeAndValue(Mockito.any(),
        Mockito.any(), Mockito.anyBoolean());
  }

  @Test
  public void testBrandAttributeUpdateFromExternalSwitchOnPreDefinedValueNotFoundExceptionTest()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,
        "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "brandCategoryEditEnabledForExternal",
        true);

    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setProductName(PRODUCT_NAME);
    productCollection.setProductId(PRODUCT_CODE);
    productData.setItems(Collections.emptyList());
    product.getProductAttributes().get(0).getAttribute().setAttributeCode("BR-M036969");

    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    when(productOutbound.getPredefinedAllowedAttributeValueByAttributeCodeAndValue(
        Mockito.any(), Mockito.any(), Mockito.anyBoolean()))
        .thenReturn(null); // outbound returns null -> service should throw

    productData.setNewlyAddedItems(Collections.emptyList());
    productData.setBrandUpdated(true);

    //  assert exception
    ApplicationRuntimeException ex = Assertions.assertThrows(
        ApplicationRuntimeException.class,
        () -> productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(
            productCollection,
            productData,
            true,
            true,
            true,
            new CategoryResponse(),
            editProductResponse,
            productDetailEditDTO,
            new ProductL3Response(), new ProductL3UpdateRequest()
        )
    );

   Assertions.assertEquals("Can not process invalid input data :Invalid Brand Code, Value not Found",
        ex.getMessage());

    //  verify expected interactions
    verify(productRepository, times(1)).findOne(anyString());
    verify(productOutbound, times(1))
        .getPredefinedAllowedAttributeValueByAttributeCodeAndValue(Mockito.any(),
            Mockito.any(), Mockito.anyBoolean());

    //  do NOT verify productRepository.update(...) because it never gets called in exception path
  }

  @Test
  public void testBrandAttributeUpdateFromExternalSwitchOnBrandIsNotUpdated() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean,
        "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "brandCategoryEditEnabledForExternal",
        true);
    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setProductName(PRODUCT_NAME);
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    product.getProductAttributes().get(0).getAttribute().setAttributeCode("BR-M036969");
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    PredefinedAllowedAttributeValueResponse predefinedAllowedAttributeValueResponse =
        new PredefinedAllowedAttributeValueResponse();
    predefinedAllowedAttributeValueResponse.setPredefinedAllowedAttributeCode("BR-M99999");
    productData.setNewlyAddedItems(Collections.emptyList());
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>>
        result =
        productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
            productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(),
            editProductResponse, productDetailEditDTO, new ProductL3Response(), new ProductL3UpdateRequest());
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false),
        Mockito.anyBoolean(), eq(true), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(),
        Mockito.anyBoolean(), Mockito.anyBoolean(), eq(new ArrayList<>()), Mockito.any(),
        Mockito.any(EditProductResponse.class));
  }

  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCBEligibleCombinedEditFalse2() throws Exception{
    ProductLevel3 productData = new ProductLevel3();
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", false);
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setItems(Collections.singletonList(new ProductItemLevel3()));
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
        eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
  }

  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCB_ValidDuplicateAttributeCheck() throws Exception{
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setItems(Collections.singletonList(new ProductItemLevel3()));
    productCollection.setProductId(PRODUCT_CODE);
    ProductItemLevel3 productItemLevel3 = new ProductItemLevel3();
    productData.setNewlyAddedItems(Collections.singletonList(productItemLevel3));
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
      eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
  }
  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCB_SkipDuplicateAttributeCheck() throws Exception{
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", false);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ProductLevel3 productData = new ProductLevel3();
    productData.setProductSku(PRODUCT_SKU);
    productData.setDescription(" ");
    productData.setItems(Collections.singletonList(new ProductItemLevel3()));
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productData.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productData, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
      eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
  }





  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCBEligibleCombinedEditFalseAttribute() throws Exception{
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", false);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductSku(PRODUCT_SKU);
    productLevel3.setDescription(" ");
    ProductLevel3Attribute productLevel3Attribute = new ProductLevel3Attribute();
    productLevel3Attribute.setAttributeCode(ATTRIBUTE_CODE_1);
    productLevel3Attribute.setAttributeName(ATTRIBUTE_CODE_2);
    productLevel3.setAttributes(Collections.singletonList(productLevel3Attribute));
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productLevel3.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    when(productOutbound.getAttributeDetailByAttributeCode(anyString())).thenReturn(
      AttributeResponse.builder().attributeCode(ATTRIBUTE_CODE_1).build());
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productLevel3, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
        eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
 }

  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCBEligibleCombinedEditTrueAttribute() throws Exception{
    ReflectionTestUtils.setField(productLevel3ServiceBean, "addDeleteVariantSwitch", true);
    ReflectionTestUtils.setField(productLevel3ServiceBean,
      "validateAttributeAdditionForOnlyNewlyAddedAttributes", true);
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductSku(PRODUCT_SKU);
    productLevel3.setDescription(" ");
    ProductLevel3Attribute productLevel3Attribute = new ProductLevel3Attribute();
    productLevel3Attribute.setAttributeCode(ATTRIBUTE_CODE_1);
    productLevel3Attribute.setAttributeName(ATTRIBUTE_CODE_2);
    productLevel3.setAttributes(Collections.singletonList(productLevel3Attribute));
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = true;
    productLevel3.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    when(productOutbound.getPredefinedAllowedAttributeValueByAttributeCodeAndValue(any(),
      anyString(), anyBoolean())).thenReturn(new PredefinedAllowedAttributeValueResponse());
    when(productOutbound.getAttributeDetailByAttributeCode(anyString())).thenReturn(
      AttributeResponse.builder().attributeCode(ATTRIBUTE_CODE_1).build());
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productLevel3, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
      eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
    verify(productOutbound).getAttributeDetailByAttributeCode(anyString());
    verify(productOutbound).getPredefinedAllowedAttributeValueByAttributeCodeAndValue(anyString()
      , anyString(), anyBoolean());
  }

  @Test
  public void testCopyProductLevel3ToProductAndUpdateToPCBEligibleCombinedEditFalseAutoApprovedFalse() throws Exception{
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setProductSku(PRODUCT_SKU);
    productLevel3.setDescription(" ");
    productCollection.setProductId(PRODUCT_CODE);
    boolean contentChanged = true;
    boolean isKeywordPresent = true;
    boolean autoApproved = false;
    productLevel3.setItems(Collections.emptyList());
    when(productRepository.findOne(Mockito.any())).thenReturn(product);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> result = productLevel3ServiceBean.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productLevel3, contentChanged, isKeywordPresent, autoApproved, new CategoryResponse(), editProductResponse, productDetailEditDTO,
      new ProductL3Response(), null);
    verify(productRepository, times(1)).findOne(anyString());
    verify(this.productRepository).update(Mockito.any(), Mockito.any(), eq(false), Mockito.anyBoolean(), eq(true),
      Mockito.anyList(), Mockito.anyMap(),Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(),
        eq(new ArrayList<>()), Mockito.any(), Mockito.any(EditProductResponse.class));
  }

  @Test
  public void updateProductCollectionAndSolrAndPublishHistoryEventForBrandUpdatedTest() throws Exception {
    productCollection.setActivated(false);
    productDetailEditDTO.setAutoCategoryChange(true);
    productDetailEditDTO.setOldCategoryName(ITEM_NAME);
    productDetailEditDTO.setBrandChanged(true);
    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    Mockito.when(productBusinessPartnerService.findByStoreIdAndProductId(Constants.DEFAULT_STORE_ID,
        productCollection.getProductId())).thenReturn(Collections.singletonList(productBusinessPartner));
    productLevel3ServiceBean.updateProductCollectionAndSolrAndPublishHistoryEvent(productLevel3.getProductName(), productCollection,
        new ArrayList<>(), productDetailEditDTO, StringUtils.EMPTY);
    Mockito.verify(productBusinessPartnerService)
        .findByStoreIdAndProductId(Constants.DEFAULT_STORE_ID, productCollection.getProductId());
    Mockito.verify(kafkaProducer)
        .send(eq(DomainEventName.PRODUCT_INTERNAL_HISTORY_SAVE), eq(productCollection.getProductCode()), Mockito.any());
    Mockito.verify(kafkaProducer)
        .send(eq(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY), eq(productBusinessPartner.getGdnProductSku()),
            Mockito.any());
  }

  @Test
  public void updateProductCollectionAndSolrAndPublishHistoryEventTest2() throws Exception {
    productCollection.setActivated(false);
    productDetailEditDTO.setAutoCategoryChange(true);
    productDetailEditDTO.setOldCategoryName(ITEM_NAME);
    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    Mockito.when(productBusinessPartnerService.findByStoreIdAndProductId(Constants.DEFAULT_STORE_ID,
        productCollection.getProductId())).thenReturn(Collections.singletonList(productBusinessPartner));
    productDetailEditDTO.setRestrictedKeywordsByFieldAndActionType(null);
    productLevel3ServiceBean.updateProductCollectionAndSolrAndPublishHistoryEvent(productLevel3.getProductName(), productCollection,
        new ArrayList<>(), productDetailEditDTO, StringUtils.EMPTY);
    Mockito.verify(productBusinessPartnerService)
        .findByStoreIdAndProductId(Constants.DEFAULT_STORE_ID, productCollection.getProductId());
    Mockito.verify(kafkaProducer)
        .send(eq(DomainEventName.PRODUCT_INTERNAL_HISTORY_SAVE), eq(productCollection.getProductCode()), Mockito.any());
    Mockito.verify(kafkaProducer)
        .send(eq(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY), eq(productBusinessPartner.getGdnProductSku()),
            Mockito.any());
  }

  @Test
  public void getProductItemsAndSynchronizeProductTest() throws Exception {
    com.gda.mta.product.dto.ProductImageEditRequest request = new com.gda.mta.product.dto.ProductImageEditRequest();
    productL3Response.setSynchronized(true);
    productLevel3ServiceBean.getProductItemsAndSynchronizeProduct(request, productL3Response);
    Assertions.assertEquals(PRODUCT_SKU, productL3Response.getProductSku());
  }

  @Test
  public void getProductItemsAndSynchronizeProductSyncFalseTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ProductResponse productResponse = new ProductResponse();
    productResponse.setMasterDataProduct(new MasterDataProductDTO());
    productAndItemsResponse.setProduct(productResponse);
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productAndItemsResponse, REQUESTID);
    com.gda.mta.product.dto.ProductImageEditRequest request = new com.gda.mta.product.dto.ProductImageEditRequest();
    productL3Response.setSynchronized(false);
    when(
        xProductOutbound.getProductAndItemsWithProductData(anyBoolean(), any(), anyBoolean(), anyBoolean())).thenReturn(
        gdnRestSingleResponse);
    productLevel3ServiceBean.getProductItemsAndSynchronizeProduct(request, productL3Response);
    verify(xProductOutbound).getProductAndItemsWithProductData(anyBoolean(), any(), anyBoolean(), anyBoolean());
    verify(productOutbound).migrateProduct(any(), any(), any(), any());
    Assertions.assertEquals(PRODUCT_SKU, productL3Response.getProductSku());
  }

  @Test
  public void migrateUnsyncProductForEditTest() throws Exception {
    ProductL3Response productData = new ProductL3Response();
    productData.setProductEditable(false);
    productData.setSynchronized(true);

    productLevel3ServiceBean.migrateUnsyncProductForEdit(productData, true);

    Mockito.verifyNoInteractions(xProductOutbound, productOutbound, productLevel3Repository);
  }

  @Test
  public void testUpdateOrInsertStock() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    productResponse.setProfileResponse(null);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(6)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void testUpdateOrInsertStock3() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setMinimumStock(1);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    inventory.setWebMinAlert(1);
    savedInventoryList.add(inventory);
    productResponse.setProfileResponse(null);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(ApiErrorCode.STOCK_UPDATE_FAILED);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(6)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void testUpdateOrInsertStock4() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(null);
    pickupPoint.setPrice(price);
    pickupPoint.setMinimumStock(1);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    productResponse.setProfileResponse(null);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(ApiErrorCode.STOCK_UPDATE_FAILED);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(5)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
    verify(productLevel3InventoryService, times(1)).updateMinimumStockAlert(Mockito.any(), Mockito.any(), Mockito.any());
  }

  @Test
  public void testUpdateOrInsertStock5() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(12d);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.TRUE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {
    }
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(8)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    verify(this.productLevel3InventoryService).updateSyncStockOrInsertStock(Mockito.any());
  }

  @Test
  public void testUpdateOrInsertStockTest2() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(300d);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(7)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void deleteInProgressL5ForDeletePPWithStoreIdTest() {
    String storeId = "store123";
    String productState = "ACTIVE";
    Map<String, String> itemXOldPickUpPointMap = new HashMap<>();
    itemXOldPickUpPointMap.put("item1", "oldPickupPoint1");
    Map<String, String> itemXNewPickUpPointMap = new HashMap<>();
    itemXNewPickUpPointMap.put("item1", "newPickupPoint1");
    ProductItemWholesalePrice mockWholesalePrice = new ProductItemWholesalePrice();
    mockWholesalePrice.setPickupPointCode("oldPickupPoint1");
    ReflectionTestUtils.setField(productLevel3ServiceBean,"wholesaleL5EntryByStoreId",true);
    productLevel3ServiceBean.updateWholesaleEntriesOnPickupPointChange(storeId, itemXOldPickUpPointMap,
        itemXNewPickUpPointMap, productState);
  }

  @Test
  public void deleteInProgressL5ForDeletePPWithStoreIdStateNotActiveTest() {
    String storeId = "store123";
    String productState = "NOT_ACTIVE";
    Map<String, String> itemXOldPickUpPointMap = new HashMap<>();
    itemXOldPickUpPointMap.put("item1", "oldPickupPoint1");
    Map<String, String> itemXNewPickUpPointMap = new HashMap<>();
    itemXNewPickUpPointMap.put("item1", "newPickupPoint1");
    ProductItemWholesalePrice mockWholesalePrice = new ProductItemWholesalePrice();
    mockWholesalePrice.setPickupPointCode("oldPickupPoint1");
    when(productItemWholesalePriceService.findOneByStoreIdAndItemSkuAndPickupPointCode(anyString(), anyString(),
        anyString())).thenReturn(mockWholesalePrice);
    ReflectionTestUtils.setField(productLevel3ServiceBean, "wholesaleL5EntryByStoreId", true);
    productLevel3ServiceBean.updateWholesaleEntriesOnPickupPointChange(storeId, itemXOldPickUpPointMap,
        itemXNewPickUpPointMap, productState);
    verify(productItemWholesalePriceService).findOneByStoreIdAndItemSkuAndPickupPointCode(storeId, "item1",
        "oldPickupPoint1");
    verify(productItemWholesalePriceService).saveWholesalePriceNew(
        productItemWholesalePriceArgumentCaptor.capture());
    Assertions.assertEquals("newPickupPoint1",productItemWholesalePriceArgumentCaptor.getValue().get(0).getPickupPointCode());
  }

  @Test
  public void updateProductCollectionTest() {
    ProductCollection savedRecord =
      productLevel3ServiceBean.updateProductCollection(productCollection);
    Mockito.verify(productCollectionRepository).save(productCollection);
    Assertions.assertEquals(ACTIVE, savedRecord.getState());
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusNullTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    productAndItemsResponse.setProduct(new ProductResponse());
    List<CategoryResponse> categoryResponses = productLevel3ServiceBean.getCategoryResponses(null, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusNullTest2() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    List<CategoryResponse> categoryResponses =
        productLevel3ServiceBean.getCategoryResponses(productAndItemsResponse, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    productAndItemsResponse.setProduct(new ProductResponse());
    List<CategoryResponse> categoryResponses =
        productLevel3ServiceBean.getCategoryResponses(productAndItemsResponse, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusNotNullMasterTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ProductResponse productResponse = new ProductResponse();
    productResponse.setMasterCatalog(new MasterCatalogDTO());
    productAndItemsResponse.setProduct(productResponse);
    List<CategoryResponse> categoryResponses =
        productLevel3ServiceBean.getCategoryResponses(productAndItemsResponse, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusNotNullCategoryTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ProductResponse productResponse = new ProductResponse();
    MasterCatalogDTO masterCatalogDTO = new MasterCatalogDTO();
    masterCatalogDTO.setCategory(new CategoryDTO());
    productResponse.setMasterCatalog(masterCatalogDTO);
    productAndItemsResponse.setProduct(productResponse);
    List<CategoryResponse> categoryResponses =
        productLevel3ServiceBean.getCategoryResponses(productAndItemsResponse, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void findDetailByGdnSkuForAllItemSkusNotEmptyCategoryTest() throws Exception {
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ProductResponse productResponse = new ProductResponse();
    MasterCatalogDTO masterCatalogDTO = new MasterCatalogDTO();
    CategoryDTO categoryDTO = new CategoryDTO();
    categoryDTO.setCategoryCode(CATEGORY_CODE);
    masterCatalogDTO.setCategory(categoryDTO);
    productResponse.setMasterCatalog(masterCatalogDTO);
    productAndItemsResponse.setProduct(productResponse);
    List<CategoryResponse> categoryResponses =
        productLevel3ServiceBean.getCategoryResponses(productAndItemsResponse, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(categoryResponses));
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncFlagNoChange_switchOn() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(5)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncFlagChange_switchOn() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    request.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    pickupPoint.setCncBuyable(true);
    pickupPoint.setCncDisplay(true);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(7)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(eq(storeId), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any(ItemPickupPointListingRequest.class));
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncFlagChange_switchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", false);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    request.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    pickupPoint.setCncActive(true);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(5)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(eq(storeId), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any(ItemPickupPointListingRequest.class));
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncFlagChange_switchOn_l3CncUpdate() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    request.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    pickupPoint.setCncBuyable(true);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    mockProductItemBusinessPartner.setProductBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setId(BUSINESS_PARTNER_ID);
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    Mockito.when(productBusinessPartnerService.findByProductSkuList(storeId, Collections.singletonList(productSku)))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(6)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    verify(productLevel3V2Service).saveL3NeedRevisionHistory(businessPartnerCode, request, productBusinessPartner);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(eq(storeId), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any(ItemPickupPointListingRequest.class));
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncUpcoming_switchOn_l3CncUpdate() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", true);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    request.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    pickupPoint.setCncDisplay(true);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    mockProductItemBusinessPartner.setProductBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setId(BUSINESS_PARTNER_ID);
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    Mockito.when(productBusinessPartnerService.findByProductSkuList(storeId, Collections.singletonList(productSku)))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(6)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    verify(productLevel3V2Service).saveL3NeedRevisionHistory(businessPartnerCode, request, productBusinessPartner);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(eq(storeId), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any(ItemPickupPointListingRequest.class));
  }

  @Test
  public void saveItemsPriceStockImagesNeedCorrectionL5_cncActive_switchOff_l3CncUpdate() throws Exception {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "cncForWarehouseFeatureSwitch", false);
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    request.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    pickupPoint.setCncActive(true);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setInventoryFulfillment("BL");
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .pickupPointId(pickupPointId).display(true).buyable(true).installation(false).cncActivated(true)
            .fbbActivated(true).build();
    mockProductItemBusinessPartner.setProductBusinessPartnerId(BUSINESS_PARTNER_ID);
    productBusinessPartner.setId(BUSINESS_PARTNER_ID);
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    Mockito.when(productBusinessPartnerService.findByProductSkuList(storeId, Collections.singletonList(productSku)))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
        productResponse);
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(5)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    verify(productLevel3V2Service).saveL3NeedRevisionHistory(businessPartnerCode, request, productBusinessPartner);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(eq(storeId), eq(Constants.DEFAULT_CHANNEL_ID), eq(Constants.DEFAULT_CLIENT_ID),
            eq(Constants.REQUIRED_ID), eq(Constants.DEFAULT_CLIENT_ID), eq(0), eq(1), Mockito.any(ItemPickupPointListingRequest.class));
  }

  @Test
  public void addMissingL5sFromAddPickupPointListEmptyMapTest() {
    Map<String, ItemPickupPointListingResponse> map = new HashMap<>();
    productLevel3ServiceBean.addMissingL5sFromAddPickupPointList(Constants.STORE_ID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, map);
    Assertions.assertTrue(map.isEmpty());
  }

  @Test
  public void addMissingL5sFromAddPickupPointListMultiplePageTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "newlyAddedPickupPointL5FetchBatchSize", 2);
    List<ItemPickupPointListingResponse> firstPageResponses = List.of(response1, response2);
    List<ItemPickupPointListingResponse> secondPageResponses = List.of(response3);
    Page<ItemPickupPointListingResponse> firstPage = new PageImpl<>(firstPageResponses, PageRequest.of(0, 2), 3);
    Page<ItemPickupPointListingResponse> secondPage = new PageImpl<>(secondPageResponses, PageRequest.of(1, 2), 3);
    Mockito.when(xProductOutbound.getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 0, 2,
        itemPickupPointListingRequest)).thenReturn(firstPage);
    Mockito.when(xProductOutbound.getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 1, 2,
        itemPickupPointListingRequest)).thenReturn(secondPage);
    Map<String, ItemPickupPointListingResponse> map = new HashMap<>();
    productVariantUpdateRequest.setAddPickupPoints(List.of(itemPickupPointRequest));
    productLevel3ServiceBean.addMissingL5sFromAddPickupPointList(STOREID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, map);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 0, 2, itemPickupPointListingRequest);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 1, 2, itemPickupPointListingRequest);
    Assertions.assertEquals(3, map.size());
  }

  @Test
  public void addMissingL5sFromAddPickupPointListResponsePageContentIsNullTest() {
    ReflectionTestUtils.setField(productLevel3ServiceBean, "newlyAddedPickupPointL5FetchBatchSize", 1);
    Mockito.when(xProductOutbound.getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 0, 1,
        itemPickupPointListingRequest)).thenReturn(null);
    Map<String, ItemPickupPointListingResponse> map = new HashMap<>();
    productVariantUpdateRequest.setAddPickupPoints(List.of(itemPickupPointRequest));
    productLevel3ServiceBean.addMissingL5sFromAddPickupPointList(STORE_ID, BUSINESS_PARTNER_CODE,
        productVariantUpdateRequest, map);
    Mockito.verify(xProductOutbound, Mockito.times(1))
        .getItemPickupPointList(STOREID, CHANNELID, CLIENTID, REQUESTID, USERNAME, 0, 1, itemPickupPointListingRequest);
    Assertions.assertTrue(map.isEmpty());
  }

  @Test
  public void handleNonContentEditEventTest() {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productCollection.setReviewPending(false);
    productLevel3ServiceBean.handleNonContentEditEvent(productCollection, new EditProductResponse(),
        productDetailEditDTO, new ArrayList<>());
    Assertions.assertTrue(StringUtils.isEmpty(productDetailEditDTO.getContentType()));
  }

  @Test
  public void handleNonContentEditEventReviewPendingTrueTest() {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productCollection.setReviewPending(true);
    ConfigurationStatusResponse configurationStatusResponse = new ConfigurationStatusResponse();
    productLevel3ServiceBean.handleNonContentEditEvent(productCollection, new EditProductResponse(),
        productDetailEditDTO, Collections.singletonList(configurationStatusResponse));
    Assertions.assertFalse(StringUtils.isEmpty(productDetailEditDTO.getContentType()));
  }

  @Test
  public void testUpdateOrInsertStockWithInitialPreOrderQuota() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    int initialPreOrderQuota = 50;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setInitialPreOrderQuota(initialPreOrderQuota);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    productResponse.setProfileResponse(null);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .preOrderQuota(20).pickupPointId(pickupPointId).display(true).buyable(true).installation(false)
            .cncActivated(true).fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(7)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void testUpdateOrInsertStockWithInitialPreOrderQuotaZero() throws Exception {
    String storeId = "store123";
    String businessPartnerCode = "BP123";
    String productSku = "productSku123";
    String itemSku = "itemSku123";
    String pickupPointId = "pickupPoint123";
    String merchantCode = "merchantCode123";
    double price = 100.0;
    double salePrice = 90.0;
    int initialPreOrderQuota = 0;
    ProductVariantUpdateRequest request = new ProductVariantUpdateRequest();
    request.setStoreId(storeId);
    request.setProductSku(productSku);
    EditProductResponse productResponse = new EditProductResponse();
    productResponse.setProfileResponse(new ProfileResponse());
    List<ProductVariantPriceStockAndImagesRequest> successValidationVariantList = new ArrayList<>();
    List<ProductLevel3Inventory> savedInventoryList = new ArrayList<>();
    ProductCollection productCollectioEntity = new ProductCollection();
    productCollectioEntity.setPostLive(true);
    ProductVariantPriceStockAndImagesRequest productVariant = new ProductVariantPriceStockAndImagesRequest();
    productVariant.setItemSku(itemSku);
    productVariant.setMerchantCode(merchantCode);
    ItemPickupPointRequest pickupPoint = new ItemPickupPointRequest();
    pickupPoint.setPickupPointId(pickupPointId);
    pickupPoint.setStock(10);
    pickupPoint.setPrice(price);
    pickupPoint.setSalePrice(salePrice);
    pickupPoint.setInitialPreOrderQuota(initialPreOrderQuota);
    pickupPoint.setSynchronizeStock(Boolean.FALSE);
    productVariant.setModifiedItemPickupPoints(Collections.singletonList(pickupPoint));
    successValidationVariantList.add(productVariant);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setWebItemSku(itemSku);
    inventory.setWebPickupPointCode(pickupPointId);
    savedInventoryList.add(inventory);
    productResponse.setProfileResponse(null);
    when(variantEditValidationService.validateListOfVariantsForNeedCorrectionL5(any(), any())).thenReturn(
        successValidationVariantList);
    when(productCollectionRepository.findByStoreIdAndProductCode(storeId, request.getProductCode())).thenReturn(
        productCollectioEntity);
    when(
        productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any())).thenReturn(
        savedInventoryList);
    ProfileResponse profileResponse1 = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    profileResponse1.setCompany(companyDTO);
    when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.any())).thenReturn(profileResponse1);
    ProductItemBusinessPartner mockProductItemBusinessPartner =
        new ProductItemBusinessPartner.Builder().productItemId(itemSku).productType(1).merchantSku(merchantCode)
            .gdnProductItemSku(itemSku).price(price).salePrice(salePrice).stock(10).minimumStock(5)
            .preOrderQuota(20).pickupPointId(pickupPointId).display(true).buyable(true).installation(false)
            .cncActivated(true).fbbActivated(true).build();
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productItemBusinessPartnerRepository.findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList())).thenReturn(Collections.singletonList(mockProductItemBusinessPartner));
    when(productLevel3InventoryService.updateOrInsertStock(any())).thenReturn(null);
    try {
      productLevel3ServiceBean.saveItemsPriceStockImagesNeedCorrectionL5(storeId, request, businessPartnerCode,
          productResponse);
    } catch (Exception e) {}
    verify(productLevel3InventoryService).updateOrInsertStock(Mockito.any());
    verify(variantEditValidationService).validateListOfVariantsForNeedCorrectionL5(any(), any());
    verify(productCollectionRepository).findByStoreIdAndProductCode(storeId, request.getProductCode());
    verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(any());
    verify(
        productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuAndPickupPointIdIn(
        eq(storeId), eq(itemSku), anyList());
    verify(productItemBusinessPartnerRepository).findByStoreIdAndMarkForDeleteFalseAndGdnProductItemSkuIn(eq(storeId),
        anyList());
    verify(updatedProductHistoryService, times(6)).createProductL3AuditLog(Mockito.any(), Mockito.any(), Mockito.any(),
        Mockito.any(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.any());
    verify(productItemBusinessPartnerService).updateMerchantSkuByStoreIdAndItemSku(Mockito.any(), Mockito.any(),
        Mockito.any());
    verify(productBusinessPartnerService).findByProductSkuList(Mockito.anyString(), Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    verify(productItemBusinessPartnerService).save(Mockito.any());
    verify(businessPartnerRepository, times(2)).filterDetailByBusinessPartnerCode(Mockito.any());
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPoints_withPreOrderQuota_historySwitchOffTest() throws Exception {
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setStock(0);
    itemPickupPointRequestCopy.setInitialPreOrderQuota(10);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(eq(BUSINESS_PARTNER_CODE), eq(Constants.DEFAULT),
        eq(productVariantPriceStockAndImagesRequest.getProductSku()), eq(productVariantUpdateRequest.getProductName()),
        Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), eq(false), Mockito.anyString());
    Mockito.verify(this.updatedProductHistoryService).createProductL3AuditLog(Mockito.anyString(),
        Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString(), eq(UpdateProductActivity.STOCK_VALUE.getDesc()),
        eq(Constants.HYPHEN), Mockito.anyString(), eq(false),
        Mockito.anyString());
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPoints_withPreOrderQuota_nonOmgSellerTest() throws Exception {
    profileResponse.setFlags(Collections.singletonMap(Constants.BLIBLI_OMG, Boolean.FALSE));
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setStock(0);
    itemPickupPointRequestCopy.setInitialPreOrderQuota(10);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(Boolean.TRUE);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(eq(BUSINESS_PARTNER_CODE), eq(Constants.DEFAULT),
        eq(productVariantPriceStockAndImagesRequest.getProductSku()), eq(productVariantUpdateRequest.getProductName()),
        Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), eq(false), Mockito.anyString());
    Mockito.verify(this.updatedProductHistoryService).createProductL3AuditLog(Mockito.anyString(),
        Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString(), eq(UpdateProductActivity.STOCK_VALUE.getDesc()),
        eq(Constants.HYPHEN), Mockito.anyString(), eq(false),
        Mockito.anyString());
    Mockito.verify(preOrderConfig).isPoQuotaFeatureSwitch();
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPoints_withPreOrderQuota_nullPreOrderQuotaTest() throws Exception {
    profileResponse.setFlags(Collections.singletonMap(Constants.BLIBLI_OMG, Boolean.TRUE));
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setStock(0);
    itemPickupPointRequestCopy.setInitialPreOrderQuota(null);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(Boolean.TRUE);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(eq(BUSINESS_PARTNER_CODE), eq(Constants.DEFAULT),
        eq(productVariantPriceStockAndImagesRequest.getProductSku()), eq(productVariantUpdateRequest.getProductName()),
        Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), eq(false), Mockito.anyString());
    Mockito.verify(this.updatedProductHistoryService).createProductL3AuditLog(Mockito.anyString(),
        Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString(), eq(UpdateProductActivity.STOCK_VALUE.getDesc()),
        eq(Constants.HYPHEN), Mockito.anyString(), eq(false),
        Mockito.anyString());
    Mockito.verify(preOrderConfig).isPoQuotaFeatureSwitch();
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void editProductItemsPriceStockImagesL5ProductAddPickupPoints_withPreOrderQuotaNonNull() throws Exception {
    profileResponse.setFlags(Collections.singletonMap(Constants.BLIBLI_OMG, Boolean.TRUE));
    Date date = new Date();
    Calendar c = Calendar.getInstance();
    c.setTime(date);
    c.add(Calendar.DATE, 1);
    itemPickupPointListingResponse1.setArchiveFlagAtL3Level(true);
    productL3Response.setSynchronized(true);
    productL3Response.setOnline(true);
    productL3Response.setCncActivated(true);
    itemPickupPointListingResponse.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse1.setCncActiveAtL3Level(true);
    itemPickupPointListingResponse.setOnline(true);
    itemPickupPointListingResponse1.setOnline(true);
    productVariantUpdateRequest.setProductEditable(false);
    productVariantUpdateRequest.setOnline(false);
    productVariantUpdateRequest.setCnc(true);
    BeanUtils.copyProperties(itemPickupPointRequest, itemPickupPointRequestCopy);
    itemPickupPointRequestCopy.setStock(0);
    itemPickupPointRequestCopy.setInitialPreOrderQuota(15);
    itemPickupPointRequestCopy.setItemSku(ITEM_SKU_COPY);
    itemPickupPointRequestCopy.setProductItemWholesalePriceRequests(itemPickupPointRequest.getProductItemWholesalePriceRequests());
    productVariantUpdateRequest.setPreOrder(PreOrderRequest.builder().isPreOrder(true).preOrderDate(c.getTime()).build());
    productVariantUpdateRequest.setAddPickupPoints(Collections.singletonList(itemPickupPointRequestCopy));
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse(productL3Response, REQUESTID);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(Boolean.TRUE);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(gdnRestSingleResponse);
    Mockito.when(xProductOutbound
        .updateItemPickupPoints(STOREID, productL3Response.getProductSku(), productL3Response.getProductType(),
            new ArrayList<>(), new ArrayList<>(), new ArrayList<>(), null, false, null, false, null, false,
            new AddDeleteVariantRequest(), productVariantUpdateRequest, new EditFlagChangesDTO())).thenReturn(editItemResponse);
    Mockito.when(productItemBusinessPartnerRepository
            .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE))
        .thenReturn(productItemBusinessPartner);
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse1), PageRequest.of(0, 1), 1));
    Mockito.when(xProductOutbound
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1)).thenReturn(
        new PageImpl<>(Collections.singletonList(itemPickupPointListingResponse), PageRequest.of(0, 1), 1));
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = productLevel3ServiceBean
        .editProductItemsPriceStockImagesL5(STOREID, BUSINESS_PARTNER_CODE, productVariantUpdateRequest,
            editProductResponse, new ProductLevel3(), true);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPoints(Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyList(),
            itemPickupPointQuickEditRequestCaptor.capture(), Mockito.anyList(), Mockito.any(), Mockito.anyBoolean(),
            Mockito.any(), Mockito.anyBoolean(), Mockito.any(), Mockito.anyBoolean(), Mockito.any(),
            Mockito.any(), Mockito.any());
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU, PICKUP_POINT_CODE);
    Mockito.verify(productItemBusinessPartnerRepository)
        .findByStoreIdAndGdnProductItemSkuAndPickupPointIdAndMarkForDeleteFalse(STOREID, ITEM_SKU_1, PICKUP_POINT_CODE);
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest);
    Mockito.verify(productCollectionRepository)
        .findByStoreIdAndProductCode(STOREID, itemPickupPointListingResponse1.getProductCode());
    Mockito.verify(xProductOutbound)
        .getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
            Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest1);
    Mockito.verify(productLevel3InventoryService).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        inventoryDetailInfoRequestDTOListCaptor.capture());
    Mockito.verify(productLevel3InventoryService).insertInventory(productLevel3InventoryListArgumentCaptor.capture());
    Mockito.verify(productBusinessPartnerService).generateNewProductItemBusinessPartnerData(new ArrayList<>(), null);
    verify(xProductOutbound).getItemPickupPointList(STOREID, Constants.DEFAULT_CHANNEL_ID, Constants.DEFAULT_CLIENT_ID,
        Constants.REQUIRED_ID, Constants.DEFAULT_CLIENT_ID, 0, 1, itemPickupPointListingRequest2);
    Mockito.verify(productItemBusinessPartnerService).getDeletedVariantItemSkus(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, times(2)).createProductL3AuditLog(eq(BUSINESS_PARTNER_CODE), eq(Constants.DEFAULT),
        eq(productVariantPriceStockAndImagesRequest.getProductSku()), eq(productVariantUpdateRequest.getProductName()),
        Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), eq(false), Mockito.anyString());
    Mockito.verify(this.updatedProductHistoryService).createProductL3AuditLog(Mockito.anyString(),
        Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString(), eq(UpdateProductActivity.STOCK_VALUE.getDesc()),
        eq(Constants.HYPHEN), Mockito.anyString(), eq(false),
        Mockito.anyString());
    Mockito.verify(this.updatedProductHistoryService).createProductL3AuditLog(Mockito.anyString(),
        Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString(), eq(UpdateProductActivity.PRE_ORDER_QUOTA.getDesc()),
        eq(Constants.HYPHEN), Mockito.anyString(), eq(false),
        Mockito.anyString());
    Mockito.verify(preOrderConfig, times(2)).isPoQuotaFeatureSwitch();
    Assertions.assertTrue(CollectionUtils.isEmpty(itemsPriceStockImagesUpdateResponse.getVariantsErrorList()));
  }

  @Test
  public void saveNeedCorrectionChangesInPCB_withNullProductL3UpdateRequest() throws Exception {
    ProductLevel3 product = getProductLevel3();

    List<PickupPointDeleteRequest> pickupPointDeleteRequests = new ArrayList<>();
    ProductL3Response savedProductData = new ProductL3Response();
    ProductL3UpdateRequest productL3UpdateRequest = null;

    ProductCollection productCollection = new ProductCollection();
    productCollection.setStoreId(DEFAULT_STORE_ID);
    productCollection.setProductCode(PRODUCT_CODE);

    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);

    ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));

    ProductDetailResponse productDetailResponse = getProductDetailResponse();

    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productLevel3Helper.getRestrictedKeywordsInProductDetails(Mockito.any(), Mockito.anyString()))
        .thenReturn(new ArrayList<>());
    Mockito.when(objectMapper.writeValueAsString(Mockito.any())).thenReturn("{}");

    Product pcbProduct = new Product();
    pcbProduct.setProductItems(new ArrayList<>());
    Mockito.when(productRepository.findOne(Mockito.any())).thenReturn(pcbProduct);
    Mockito.when(productRepository.update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any())).thenReturn(new ArrayList<>());
    Mockito.when(distributionInfoServiceBean.validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList())).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productCollectionRepository.save(Mockito.any())).thenReturn(productCollection);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString())).thenReturn(new ProfileResponse());
    Mockito.doNothing().when(productBusinessPartnerService).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());

    EditProductResponse result = productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(
        product, pickupPointDeleteRequests, false, savedProductData, productL3UpdateRequest, productCollection);

    assertNotNull(result);
    Assertions.assertFalse(result.isProductReview());
    Assertions.assertEquals(StringUtils.EMPTY, result.getReviewType());

    Mockito.verify(productOutbound, times(2)).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).getMerchantModifiedFields(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).saveUpdateProductLevel3Audit(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.anyBoolean(), Mockito.anyString());
    Mockito.verify(businessPartnerRepository, atLeastOnce()).filterDetailByBusinessPartnerCode(Mockito.anyString());
    Mockito.verify(productBusinessPartnerService, atLeastOnce()).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());
    Mockito.verify(productCollectionRepository, atLeastOnce()).getProductCodeByGdnSku(Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).save(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).findOne(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3Detail(Mockito.any(), Mockito.anyBoolean());
  }

  @Test
  public void saveNeedCorrectionChangesInPCB_withEmptyDistributionInfo() throws Exception {
    ProductLevel3 product = getProductLevel3();

    List<PickupPointDeleteRequest> pickupPointDeleteRequests = new ArrayList<>();
    ProductL3Response savedProductData = new ProductL3Response();
    ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
    productL3UpdateRequest.setDistributionInfoRequest(new HashMap<>());
    productL3UpdateRequest.setDistributionAndUOMRequest(new ArrayList<>());

    ProductCollection productCollection = new ProductCollection();
    productCollection.setStoreId(DEFAULT_STORE_ID);
    productCollection.setProductCode(PRODUCT_CODE);

    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);

    ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));

    ProductDetailResponse productDetailResponse = getProductDetailResponse();

    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productLevel3Helper.getRestrictedKeywordsInProductDetails(Mockito.any(), Mockito.anyString()))
        .thenReturn(new ArrayList<>());
    Mockito.when(objectMapper.writeValueAsString(Mockito.any())).thenReturn("{}");

    Product pcbProduct = new Product();
    pcbProduct.setProductItems(new ArrayList<>());
    Mockito.when(productRepository.findOne(Mockito.any())).thenReturn(pcbProduct);
    Mockito.when(productRepository.update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any())).thenReturn(new ArrayList<>());
    Mockito.when(distributionInfoServiceBean.validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList())).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productCollectionRepository.save(Mockito.any())).thenReturn(productCollection);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString())).thenReturn(new ProfileResponse());
    Mockito.doNothing().when(productBusinessPartnerService).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());

    EditProductResponse result = productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(
        product, pickupPointDeleteRequests, false, savedProductData, productL3UpdateRequest, productCollection);

    assertNotNull(result);
    Assertions.assertFalse(result.isProductReview());
    Assertions.assertEquals(StringUtils.EMPTY, result.getReviewType());

    Mockito.verify(productOutbound, times(2)).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).getMerchantModifiedFields(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).saveUpdateProductLevel3Audit(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.anyBoolean(), Mockito.anyString());
    Mockito.verify(businessPartnerRepository, atLeastOnce()).filterDetailByBusinessPartnerCode(Mockito.anyString());
    Mockito.verify(productBusinessPartnerService, atLeastOnce()).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());
    Mockito.verify(productCollectionRepository, atLeastOnce()).getProductCodeByGdnSku(Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).save(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).findOne(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3Detail(Mockito.any(), Mockito.anyBoolean());
  }

  @Test
  public void saveNeedCorrectionChangesInPCB_withNonEmptyDistributionInfo() throws Exception {
    ProductLevel3 product = getProductLevel3();

    List<PickupPointDeleteRequest> pickupPointDeleteRequests = new ArrayList<>();
    ProductL3Response savedProductData = new ProductL3Response();
    ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
    Map<String, String> distributionInfoRequest = new HashMap<>();
    distributionInfoRequest.put("key", "value");
    productL3UpdateRequest.setDistributionInfoRequest(distributionInfoRequest);
    productL3UpdateRequest.setDistributionAndUOMRequest(new ArrayList<>());

    ProductCollection productCollection = new ProductCollection();
    productCollection.setStoreId(DEFAULT_STORE_ID);
    productCollection.setProductCode(PRODUCT_CODE);

    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);

    ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));

    ProductDetailResponse productDetailResponse = getProductDetailResponse();

    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productLevel3Helper.getRestrictedKeywordsInProductDetails(Mockito.any(), Mockito.anyString()))
        .thenReturn(new ArrayList<>());
    Mockito.when(objectMapper.writeValueAsString(Mockito.any())).thenReturn("{}");

    Product pcbProduct = new Product();
    pcbProduct.setProductItems(new ArrayList<>());
    Mockito.when(productRepository.findOne(Mockito.any())).thenReturn(pcbProduct);
    Mockito.when(productRepository.update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any())).thenReturn(new ArrayList<>());
    Mockito.when(distributionInfoServiceBean.validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList())).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productCollectionRepository.save(Mockito.any())).thenReturn(productCollection);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString())).thenReturn(new ProfileResponse());
    Mockito.doNothing().when(productBusinessPartnerService).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());

    EditProductResponse result = productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(
        product, pickupPointDeleteRequests, false, savedProductData, productL3UpdateRequest, productCollection);

    assertNotNull(result);
    Assertions.assertFalse(result.isProductReview());
    Assertions.assertEquals(StringUtils.EMPTY, result.getReviewType());

    Mockito.verify(productOutbound, times(2)).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).getMerchantModifiedFields(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).saveUpdateProductLevel3Audit(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.anyBoolean(), Mockito.anyString());
    Mockito.verify(businessPartnerRepository, atLeastOnce()).filterDetailByBusinessPartnerCode(Mockito.anyString());
    Mockito.verify(productBusinessPartnerService, atLeastOnce()).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());
    Mockito.verify(productCollectionRepository, atLeastOnce()).getProductCodeByGdnSku(Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).save(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).findOne(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3Detail(Mockito.any(), Mockito.anyBoolean());
  }

  @Test
  public void saveNeedCorrectionChangesInPCB_withNonEmptyDistributionInfo2_And_Category_Change() throws Exception {
    ProductLevel3 product = getProductLevel3();
    product.setCategoryUpdated(true);

    List<PickupPointDeleteRequest> pickupPointDeleteRequests = new ArrayList<>();
    ProductL3Response savedProductData = new ProductL3Response();
    ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
    productL3UpdateRequest.setDistributionInfoRequest(null);
    productL3UpdateRequest.setDistributionAndUOMRequest(
        Collections.singletonList(new ProductItemDistributionInfoRequest()));

    ProductCollection productCollection = new ProductCollection();
    productCollection.setStoreId(DEFAULT_STORE_ID);
    productCollection.setProductCode(PRODUCT_CODE);

    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);

    ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));

    ProductDetailResponse productDetailResponse = getProductDetailResponse();

    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productLevel3Helper.getRestrictedKeywordsInProductDetails(Mockito.any(), Mockito.anyString()))
        .thenReturn(new ArrayList<>());
    Mockito.when(objectMapper.writeValueAsString(Mockito.any())).thenReturn("{}");

    Product pcbProduct = new Product();
    pcbProduct.setProductItems(new ArrayList<>());
    Mockito.when(productRepository.findOne(Mockito.any())).thenReturn(pcbProduct);
    Mockito.when(productRepository.update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any())).thenReturn(new ArrayList<>());
    Mockito.when(distributionInfoServiceBean.validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList())).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productCollectionRepository.save(Mockito.any())).thenReturn(productCollection);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString())).thenReturn(new ProfileResponse());
    Mockito.doNothing().when(productBusinessPartnerService).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());

    EditProductResponse result = productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(
        product, pickupPointDeleteRequests, false, savedProductData, productL3UpdateRequest, productCollection);

    assertNotNull(result);
    Assertions.assertFalse(result.isProductReview());
    Assertions.assertEquals(StringUtils.EMPTY, result.getReviewType());

    Mockito.verify(productOutbound, times(2)).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).getMerchantModifiedFields(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).saveUpdateProductLevel3Audit(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.anyBoolean(), Mockito.anyString());
    Mockito.verify(businessPartnerRepository, atLeastOnce()).filterDetailByBusinessPartnerCode(Mockito.anyString());
    Mockito.verify(productBusinessPartnerService, atLeastOnce()).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());
    Mockito.verify(productCollectionRepository, atLeastOnce()).getProductCodeByGdnSku(Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).save(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).findOne(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3Detail(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(productLevel3V2Service)
        .publishProductLevelHistoryToPcbForDistributionUpdate(Mockito.anyString(), Mockito.anyString(),
            Mockito.anyList());
  }

  @Test
  public void saveNeedCorrectionChangesInPCB_withAddingPickupPoints() throws Exception {
    ProductLevel3 product = getProductLevel3();

    List<PickupPointDeleteRequest> pickupPointDeleteRequests = new ArrayList<>();
    ProductL3Response savedProductData = new ProductL3Response();
    ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
    productL3UpdateRequest.setDistributionInfoRequest(new HashMap<>());
    productL3UpdateRequest.setDistributionAndUOMRequest(new ArrayList<>());

    ProductCollection productCollection = new ProductCollection();
    productCollection.setStoreId(DEFAULT_STORE_ID);
    productCollection.setProductCode(PRODUCT_CODE);

    ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    productBusinessPartner.setBusinessPartnerId(BUSINESS_PARTNER_ID);

    ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));

    ProductDetailResponse productDetailResponse = getProductDetailResponse();

    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productLevel3Helper.getRestrictedKeywordsInProductDetails(Mockito.any(), Mockito.anyString()))
        .thenReturn(new ArrayList<>());
    Mockito.when(objectMapper.writeValueAsString(Mockito.any())).thenReturn("{}");

    Product pcbProduct = new Product();
    pcbProduct.setProductItems(new ArrayList<>());
    Mockito.when(productRepository.findOne(Mockito.any())).thenReturn(pcbProduct);
    Mockito.when(productRepository.update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any())).thenReturn(new ArrayList<>());
    Mockito.when(distributionInfoServiceBean.validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList())).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productCollectionRepository.save(Mockito.any())).thenReturn(productCollection);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString())).thenReturn(new ProfileResponse());
    Mockito.doNothing().when(productBusinessPartnerService).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());

    EditProductResponse result = productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(
        product, pickupPointDeleteRequests, true, savedProductData, productL3UpdateRequest, productCollection);

    assertNotNull(result);
    Assertions.assertFalse(result.isProductReview());
    Assertions.assertEquals(StringUtils.EMPTY, result.getReviewType());

    Mockito.verify(productOutbound, times(2)).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).getMerchantModifiedFields(Mockito.any(), Mockito.any());
    Mockito.verify(updatedProductHistoryService, atLeastOnce()).saveUpdateProductLevel3Audit(Mockito.anyString(), Mockito.anyString(), Mockito.any(), Mockito.any(), Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.anyBoolean(), Mockito.anyString());
    Mockito.verify(businessPartnerRepository, atLeastOnce()).filterDetailByBusinessPartnerCode(Mockito.anyString());
    Mockito.verify(productBusinessPartnerService, atLeastOnce()).updateNeedRevisionL3Details(Mockito.anyString(), Mockito.any());
    Mockito.verify(productCollectionRepository, atLeastOnce()).getProductCodeByGdnSku(Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Mockito.verify(productCollectionRepository, atLeastOnce()).save(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).findOne(Mockito.any());
    Mockito.verify(productRepository, atLeastOnce()).update(Mockito.any(), Mockito.any(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.anyMap(), Mockito.anyList(), Mockito.anyBoolean(), Mockito.anyBoolean(), Mockito.anyList(), Mockito.any(), Mockito.any());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(updateProductItemLevel3ModelConverter, atLeastOnce()).convertFromProductLevel3Detail(Mockito.any(), Mockito.anyBoolean());
  }

  private static ProductLevel3 getProductLevel3() {
    ProductLevel3 product = new ProductLevel3();
    product.setProductCode(PRODUCT_CODE);
    product.setProductSku(PRODUCT_SKU);
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    product.setProductName(PRODUCT_NAME);
    product.setCategoryCode(CATEGORY_CODE);
    product.setNeedCorrection(true);
    product.setDescription("Test Description");
    return product;
  }

  private static ProductDetailResponse getProductDetailResponse() {
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setName(PRODUCT_NAME);
    productDetailResponse.setBrand("Test Brand");
    productDetailResponse.setDescription("Test Description".getBytes());
    productDetailResponse.setSpecificationDetail("Test Specification");
    productDetailResponse.setUniqueSellingPoint("Test USP");
    productDetailResponse.setProductStory("Test Story");
    productDetailResponse.setUrl("http://test.com");
    productDetailResponse.setProductAttributeResponses(new ArrayList<>());
    return productDetailResponse;
  }

  @Test
  public void publishUomHistoryIfNotEmptyTest() {
    productLevel3ServiceBean.publishUomHistoryIfNotEmpty(new ProductLevel3(),
        Collections.singletonList(new AuditTrailDto()));
    Mockito.verify(productLevel3V2Service)
        .publishProductLevelHistoryToPcbForDistributionUpdate(eq(null), eq(null), Mockito.anyList());
    Assertions.assertNotNull(response1);
  }

  @Test
  public void getProductLevel3InventoryByL5Test() {
    ProductLevel3Inventory productLevel3InventoryByL5 =
        productLevel3ServiceBean.getProductLevel3InventoryByL5(null, new HashMap<>(),
            new ItemPickupPointListingResponse());
    Assertions.assertNull(productLevel3InventoryByL5);
  }
}
