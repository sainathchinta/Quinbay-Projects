
package com.gdn.mta.product.service;

import static com.gdn.mta.product.util.GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI;
import static com.gdn.mta.product.util.validator.ValidationUtil.PREORDER_WEEK_TYPE;
import static com.gdn.partners.pbp.commons.constants.Constants.B2B_CHANNEL;
import static com.gdn.partners.pbp.commons.constants.Constants.DESCRIPTION;
import static com.gdn.partners.pbp.commons.constants.Constants.SKU_CODE;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyList;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.verifyNoMoreInteractions;
import static org.mockito.Mockito.when;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collections;
import java.util.Date;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import java.util.TreeMap;
import java.util.UUID;
import java.util.concurrent.TimeUnit;
import java.util.stream.Collectors;

import com.gda.mta.product.dto.CogsDataResponse;
import com.gda.mta.product.dto.CogsUpdateDtoRequest;
import com.gda.mta.product.dto.CogsUpdateRequests;
import com.gda.mta.product.dto.DistributionItemRequest;
import com.gda.mta.product.dto.NeedRevisionEligibilityRequest;
import com.gda.mta.product.dto.NeedRevisionEligibilityResponse;
import com.gda.mta.product.dto.ProductItemDistributionInfoRequest;
import com.gda.mta.product.dto.ProductMasterDataEditRequest;
import com.gda.mta.product.dto.response.ProductL3BasicResponse;
import com.gdn.common.enums.ErrorCategory;
import com.gdn.mta.product.enums.L3InfoUpdateChangeType;
import com.gdn.mta.product.service.config.PreOrderConfig;
import com.gdn.mta.product.util.CommonUtils;
import com.gdn.common.exception.ApplicationException;
import com.gdn.mta.product.entity.ProductSkuBusinessPartnerDTO;
import com.gdn.partners.pbp.dao.InventoryDetailInfoResponseV2DTO;
import com.gdn.partners.pbp.dao.WebInventoryResponseV2DTO;
import com.gdn.partners.pbp.outbound.AGPQuery.AGPQueryOutbound;
import com.gdn.partners.pbp.outbound.xProduct.feign.PromoEligibilityRequest;
import com.gdn.x.campaign.rest.web.model.request.CampaignPriceSkuRequest;
import com.gdn.x.product.rest.web.model.dto.DistributionInfoDTO;
import com.gdn.x.product.rest.web.model.response.CogsResponse;

import com.gdn.x.productcategorybase.dto.brand.BrandResponse;
import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.tuple.Pair;
import org.apache.log4j.MDC;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.ArgumentCaptor;
import org.mockito.Captor;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.MockitoAnnotations;
import com.gdn.mta.product.util.BeanUtils;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.test.util.ReflectionTestUtils;
import org.springframework.context.ApplicationContext;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.core.ValueOperations;
import com.gdn.mta.product.config.RedisProperties;

import com.gdn.mta.product.service.config.KafkaPublisher;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.gda.mta.product.dto.AuditTrailDto;
import com.gda.mta.product.dto.B2BFields;
import com.gda.mta.product.dto.B2bFieldsRequest;
import com.gda.mta.product.dto.BrandUpdateRequest;
import com.gda.mta.product.dto.BuyableScheduleRequest;
import com.gda.mta.product.dto.DeletedProductItems;
import com.gda.mta.product.dto.DiscoverableScheduleRequest;
import com.gda.mta.product.dto.EditProductResponse;
import com.gda.mta.product.dto.FbbCreatePickupPointRequest;
import com.gda.mta.product.dto.FbbCreatePickupPointResponse;
import com.gda.mta.product.dto.ItemL5ListingRequest;
import com.gda.mta.product.dto.ItemPriceStockQuickUpdateResponse;
import com.gda.mta.product.dto.ItemSkuPpCodeRequest;
import com.gda.mta.product.dto.PickupPointDeleteRequest;
import com.gda.mta.product.dto.PreOrderRequest;
import com.gda.mta.product.dto.ProductBundleRecipeRequest;
import com.gda.mta.product.dto.ProductCollectionDTO;
import com.gda.mta.product.dto.ProductDetailEditDTO;
import com.gda.mta.product.dto.ProductEditValidationDTO;
import com.gda.mta.product.dto.ProductItemWholesalePriceRequest;
import com.gda.mta.product.dto.ProductL3ListingRequest;
import com.gda.mta.product.dto.ProductL3UpdateRequest;
import com.gda.mta.product.dto.ProductLevel3AttributeRequest;
import com.gda.mta.product.dto.ProductLevel3AttributeResponse;
import com.gda.mta.product.dto.ProductLevel3PriceRequest;
import com.gda.mta.product.dto.ProductLevel3QuickEditV2Request;
import com.gda.mta.product.dto.ProductLevel3SummaryDetailsImageRequest;
import com.gda.mta.product.dto.ProductLevel3UpdateRequest;
import com.gda.mta.product.dto.ProductVariantPriceStockAndImagesRequest;
import com.gda.mta.product.dto.ProductVariantUpdateRequest;
import com.gda.mta.product.dto.QuickEditV2Request;
import com.gda.mta.product.dto.SyncStockUpdateOrInsertVo;
import com.gda.mta.product.dto.UpdateOrInsertStockVo;
import com.gda.mta.product.dto.response.AgpSimpleQueryResponse;
import com.gda.mta.product.dto.response.HitsResponse;
import com.gdn.partners.pbp.workflow.product.CreateProductWorkflowWorkerBean;
import com.gdn.x.productcategorybase.dto.brand.BrandWipResponse;
import com.gda.mta.product.dto.response.AuditTrailListRequest;
import com.gda.mta.product.dto.response.InternalProductHistoryEventModel;
import com.gda.mta.product.dto.response.ItemPickupPointListingL3Response;
import com.gda.mta.product.dto.response.ItemSummaryL4Response;
import com.gda.mta.product.dto.response.ItemsPriceStockImagesUpdateResponse;
import com.gda.mta.product.dto.response.ProductL3DetailsResponse;
import com.gda.mta.product.dto.response.ProductLevel3DetailResponse;
import com.gda.mta.product.dto.response.ProductLevel3DetailsV2Response;
import com.gda.mta.product.dto.response.ProductSuspensionHistoryResponse;
import com.gdn.client_sdk.shade.org.apache.commons.lang3.RandomStringUtils;
import com.gdn.common.exception.ApplicationRuntimeException;
import com.gdn.common.web.param.MandatoryRequestParam;
import com.gdn.common.web.wrapper.response.GdnRestListResponse;
import com.gdn.common.web.wrapper.response.GdnRestSingleResponse;
import com.gdn.common.web.wrapper.response.PageMetaData;
import com.gdn.mta.domain.event.modal.AddEditedProductToPDTEvent;
import com.gdn.mta.product.commons.constant.ProductLevel3SummaryCriteria;
import com.gdn.mta.product.commons.constant.UpdateProductActivity;
import com.gdn.mta.product.config.ApplicationProperties;
import com.gdn.mta.product.entity.ItemSkuToItemIdMapping;
import com.gdn.mta.product.entity.ProductBundleRecipe;
import com.gdn.mta.product.entity.ProductBusinessPartner;
import com.gdn.mta.product.entity.ProductCollection;
import com.gdn.mta.product.entity.ProductHistory;
import com.gdn.mta.product.entity.ProductItemBusinessPartner;
import com.gdn.mta.product.entity.ProductItemLevel3;
import com.gdn.mta.product.entity.ProductLevel3;
import com.gdn.mta.product.entity.ProductLevel3Image;
import com.gdn.mta.product.entity.ProductLevel3Logistics;
import com.gdn.mta.product.entity.ProductLevel3Summary;
import com.gdn.mta.product.entity.ProductSystemParameter;
import com.gdn.mta.product.entity.WorkflowStates;
import com.gdn.mta.product.enums.ApiErrorCode;
import com.gdn.mta.product.enums.AutoApprovalType;
import com.gdn.mta.product.enums.BrandApprovalStatus;
import com.gdn.mta.product.enums.ProductLevel3Status;
import com.gdn.mta.product.repository.BusinessPartnerRepository;
import com.gdn.mta.product.repository.CategoryRepositoryBean;
import com.gdn.mta.product.repository.PickupPointRepositoryBean;
import com.gdn.mta.product.repository.ProductBusinessPartnerRepository;
import com.gdn.mta.product.repository.ProductCollectionRepository;
import com.gdn.mta.product.repository.ProductDistributionTaskRepository;
import com.gdn.mta.product.repository.ProductLevel3Repository;
import com.gdn.mta.product.repository.ProductRepository;
import com.gdn.mta.product.service.converter.UpdateProductItemLevel3ModelConverterBean;
import com.gdn.mta.product.service.exception.ApiIncorrectInputDataException;
import com.gdn.mta.product.service.util.WholesaleValidationUtilBean;
import com.gdn.mta.product.util.ConverterUtil;
import com.gdn.mta.product.util.GdnBaseLookup;
import com.gdn.mta.product.util.GdnMandatoryRequestParameterUtil;
import com.gdn.mta.product.util.ProductWorkflowLookup;
import com.gdn.mta.product.valueobject.InventoryStockInfoDTO;
import com.gdn.mta.product.valueobject.UpdateProductItemLevel3Model;
import com.gdn.partners.pbp.commons.constants.Constants;
import com.gdn.partners.pbp.dto.productlevel3.ProductLevel3CountResponse;
import com.gdn.partners.pbp.model.productlevel3.ProductLevel3Inventory;
import com.gdn.partners.pbp.outbound.AGPQuery.AGPQueryFeign;
import com.gdn.partners.pbp.outbound.campaign.CampaignOutboundBean;
import com.gdn.partners.pbp.outbound.inventory.InventoryOutbound;
import com.gdn.partners.pbp.outbound.pickuppoint.PickupPointOutbound;
import com.gdn.partners.pbp.outbound.product.ProductOutbound;
import com.gdn.partners.pbp.outbound.product.ProductOutboundBean;
import com.gdn.partners.pbp.outbound.product.feign.PCBFeign;
import com.gdn.partners.pbp.outbound.productPricing.ProductPricingOutboundBean;
import com.gdn.partners.pbp.outbound.warehouse.WareHouseOutBound;
import com.gdn.partners.pbp.outbound.xProduct.XProductOutbound;
import com.gdn.partners.pbp.service.notification.ProductNotificationServiceBean;
import com.gdn.partners.pbp.service.productlevel1.ProductLevel1HistoryService;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3HelperBean;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3InventoryServiceBean;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3LogisticsService;
import com.gdn.partners.pbp.service.productlevel3.ProductLevel3WipService;
import com.gdn.partners.product.pricing.web.model.dto.ItemInfoDto;
import com.gdn.partners.product.pricing.web.model.response.WholesalePriceSkuResponse;
import com.gdn.pbp.property.MandatoryParameterHelper;
import com.gdn.warehouse.itemmaster.webmodel.response.CreateUpdateBOMRecipeResponse;
import com.gdn.x.businesspartner.commons.enums.MerchantType;
import com.gdn.x.businesspartner.dto.CompanyDTO;
import com.gdn.x.businesspartner.dto.PickupPointDTO;
import com.gdn.x.businesspartner.dto.PickupPointResponse;
import com.gdn.x.businesspartner.dto.ProfileResponse;
import com.gdn.x.campaign.rest.web.model.dto.UpdateDiscountDTO;
import com.gdn.x.campaign.rest.web.model.request.CampaignPriceRequest;
import com.gdn.x.campaign.rest.web.model.request.CampaignUpdateDiscountRequest;
import com.gdn.x.campaign.rest.web.model.response.CampaignPriceResponse;
import com.gdn.x.campaign.rest.web.model.response.CampaignPriceSkuResponse;
import com.gdn.x.campaign.rest.web.model.response.CampaignUpdateDiscountResponse;
import com.gdn.x.inventory.v2.rest.web.model.transaction.request.InventoryBaseRequest;
import com.gdn.x.inventory.v2.rest.web.model.transaction.request.InventoryDetailInfoRequestDTO;
import com.gdn.x.inventory.v2.rest.web.model.transaction.response.WarehouseInventoryResponseDTO;
import com.gdn.x.product.domain.event.config.ProductDomainEventName;
import com.gdn.x.product.enums.MasterDataAttributeType;
import com.gdn.x.product.enums.ProductType;
import com.gdn.x.product.rest.web.model.CombinedEditItemResponse;
import com.gdn.x.product.rest.web.model.L3VersionResponse;
import com.gdn.x.product.rest.web.model.NewlyAddedL5Response;
import com.gdn.x.product.rest.web.model.dto.B2bFieldsDTO;
import com.gdn.x.product.rest.web.model.dto.CategoryDTO;
import com.gdn.x.product.rest.web.model.dto.DiscountPriceDTO;
import com.gdn.x.product.rest.web.model.dto.ItemBuyableScheduleDTO;
import com.gdn.x.product.rest.web.model.dto.ItemDiscoverableScheduleDTO;
import com.gdn.x.product.rest.web.model.dto.ItemViewConfigDTO;
import com.gdn.x.product.rest.web.model.dto.MasterCatalogDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataAttributeDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataItemImageDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataProductAttributeDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataProductAttributeValueDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataProductDTO;
import com.gdn.x.product.rest.web.model.dto.MasterDataProductImageDTO;
import com.gdn.x.product.rest.web.model.dto.PreOrderDTO;
import com.gdn.x.product.rest.web.model.dto.PriceDTO;
import com.gdn.x.product.rest.web.model.dto.ProductAttributeDTO;
import com.gdn.x.product.rest.web.model.dto.ProductAttributeDetailDTO;
import com.gdn.x.product.rest.web.model.dto.ProductSpecialAttributeDTO;
import com.gdn.x.product.rest.web.model.enums.EditChangeType;
import com.gdn.x.product.rest.web.model.request.CreateFbbPickupPointRequest;
import com.gdn.x.product.rest.web.model.request.ItemPickupPointQuickEditRequest;
import com.gdn.x.product.rest.web.model.request.ItemPickupPointRequest;
import com.gdn.x.product.rest.web.model.request.ItemRequest;
import com.gdn.x.product.rest.web.model.request.ProductDetailPageEditRequest;
import com.gdn.x.product.rest.web.model.request.ProductEditRequest;
import com.gdn.x.product.rest.web.model.request.ProductSummaryRequestV2;
import com.gdn.x.product.rest.web.model.response.BasicProductResponse;
import com.gdn.x.product.rest.web.model.response.BuyableScheduleResponse;
import com.gdn.x.product.rest.web.model.response.CreateFbbPickupPointResponse;
import com.gdn.x.product.rest.web.model.response.DiscoverableScheduleResponse;
import com.gdn.x.product.rest.web.model.response.ItemBasicDetailV2Response;
import com.gdn.x.product.rest.web.model.response.ItemL4SummaryResponse;
import com.gdn.x.product.rest.web.model.response.ItemPickupPointBasicResponse;
import com.gdn.x.product.rest.web.model.response.ItemResponse;
import com.gdn.x.product.rest.web.model.response.ItemSummaryListResponse;
import com.gdn.x.product.rest.web.model.response.PriceResponse;
import com.gdn.x.product.rest.web.model.response.ProductAndItemsResponse;
import com.gdn.x.product.rest.web.model.response.ProductCountResponse;
import com.gdn.x.product.rest.web.model.response.ProductL3Response;
import com.gdn.x.product.rest.web.model.response.ProductL3SummaryResponse;
import com.gdn.x.product.rest.web.model.response.ProductL5DetailResponse;
import com.gdn.x.product.rest.web.model.response.ProductScoreResponse;
import com.gdn.x.product.rest.web.model.response.ProductSummaryResponseV2;
import com.gdn.x.product.rest.web.model.response.ViewConfigResponse;
import com.gdn.x.productcategorybase.dto.Image;
import com.gdn.x.productcategorybase.dto.request.AttributeCodesRequest;
import com.gdn.x.productcategorybase.dto.request.CopyImageEditRequest;
import com.gdn.x.productcategorybase.dto.request.EditProductDetailRequest;
import com.gdn.x.productcategorybase.dto.request.OmniChannelSkuRequest;
import com.gdn.x.productcategorybase.dto.request.ProductAttributeRequest;
import com.gdn.x.productcategorybase.dto.request.ProductCategoryRequest;
import com.gdn.x.productcategorybase.dto.request.ProductImageEditRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemUpcCodeUpdateRequest;
import com.gdn.x.productcategorybase.dto.request.ProductItemUpcCodesSkuCodesRequest;
import com.gdn.x.productcategorybase.dto.request.ProductRequest;
import com.gdn.x.productcategorybase.dto.response.AllowedAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.response.AttributeResponse;
import com.gdn.x.productcategorybase.dto.response.CatalogResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryAttributeResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryDetailResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryNamesResponse;
import com.gdn.x.productcategorybase.dto.response.CategoryResponse;
import com.gdn.x.productcategorybase.dto.response.DistributionInfoResponse;
import com.gdn.x.productcategorybase.dto.response.EditProductItemAndImageResponse;
import com.gdn.x.productcategorybase.dto.response.NewlySavedItemResponse;
import com.gdn.x.productcategorybase.dto.response.PredefinedAllowedAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.response.ProductAttributeResponse;
import com.gdn.x.productcategorybase.dto.response.ProductAttributeValueResponse;
import com.gdn.x.productcategorybase.dto.response.ProductBrandUpdateResponse;
import com.gdn.x.productcategorybase.dto.response.ProductDetailResponse;
import com.gdn.x.productcategorybase.dto.response.ProductItemResponse;
import com.gdn.x.productcategorybase.entity.Product;
import com.google.api.services.youtube.YouTube;
import com.google.api.services.youtube.model.PageInfo;
import com.google.api.services.youtube.model.VideoListResponse;
import com.google.common.collect.ImmutableMap;
import com.google.common.collect.ImmutableSet;

public class ProductLevel3V2ServiceImplTest {

  private static final String PRODUCT_SKU = "productSku";
  private static final String PRODUCT_SKU_1 = "DR6-10111-100001";
  private static final String PRODUCT_SKU_2 = "productSku-2";
  private static final String PRODUCT_SKU_3 = "productSku-3";
  private static final String STORE_ID = "10001";
  private static final String ITEM_SKU = "itemSku";
  private static final String ITEM_SKU_2 = "itemSku2";
  private static final String ITEM_SKU_1 = "DR6-10111-100001-100001";
  private static final String PICKUP_POINT_CODE = "pickupPointCode";
  private static final String PICKUP_POINT_CODE_1 = "pickupPointCode-1";
  private static final Double OLD_NORMAL_PRICE = 1000.0;
  private static final Double OLD_SALE_PRICE = 900.0;
  private static final Double NEW_NORMAL_PRICE = 1100.0;
  private static final Double NEW_SALE_PRICE = 1000.0;
  private static final String MERCHANT_CODE = "merchantCode";
  private static final String CATEGORY_CODE = "categoryCode";
  private static final String CATEGORY_NAME = "categoryName";
  private static final String MASTER_CATALOG_CODE = "masterCatalogCode";
  private static final String ITEM_NAME = "itemName";
  public static final String DEFAULT = "DEFAULT";
  private static final String DEFAULT_CHANNEL = "DEFAULT";
  private static final Integer MIN_PRICE = 1;
  private static final String INACTIVE = "INACTIVE";
  private static final String EXISTING_NAME = " Product  name ";
  private static final String REQUESTED_NAME = "Product name";
  private static final String ACTIVE = "ACTIVE";
  private static final String DEFAULT_DESCRIPTION = "CODE-1000";
  private static final String DEFAULT_USP = "DEFAULT-USP";
  private static final String DEFAULT_BUSINESS_PARTNER_CODE = "BLI-00001";
  private static final String DEFAULT_BRAND = "CODE-1000";
  private static final String DEFAULT_SPECIFICATION = "CODE-1000";
  private static final String DEFAULT_PRODUCT_NAME = "PRODUCT-NAME";
  private static final Boolean DEFAULT_SKU_VALUE = true;
  private static final String LARGE_PRODUCT_NAME =
    "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut sit amet placerat erat. "
      + "Pellentesque mi turpis, suscipit at pellentesque sit amet tincidunt.";
  private static final String YOUTUBE_URL = "https://www.youtube.com/watch?v=P1xAhgKTqDA";
  private static final String YOUTUBE_INVALID_URL = "https://www.youtube.com/watch?v";
  private static final String API_KEY = "apiKey";
  private static final String DEFAULT_STORE_ID = "10001";
  private static final Integer PAGE = 0;
  private static final Integer SIZE = 10;
  private static final String REQUEST_ID = "requestId";
  private static final Integer ORIGINAL_STOCK = 10;
  private static final Integer AVALIABLE_STOCK = 10;
  private static final String TEXT = "text";
  private static final String CHANNEL_ID = "channelId";
  private static final String CLIENT_ID = "clientId";
  private static final String USERNAME = "username";
  private static final String AUTHENTICATOR = "authenticator";
  private static final String PRODUCT_CODE = "product-code";
  private static final String ITEM_CODE = "product-code";
  private static final String ID = "ID";
  private static final String SETTLEMENT_TYPE = "settlement-type";
  private static final String SIZE_CHART_CODE = "sizeChartCode";
  private static final String DEFAULT_ATTRIBUTE_CODE_1 = "attribute-1";
  private static final String DEFAULT_ATTRIBUTE_CODE_2 = "attribute-2";
  private static final String DEFAULT_ATTRIBUTE_CODE_3 = "attribute-3";
  private static final String DEFAULT_ATTRIBUTE_CODE_4 = "attribute-4";
  private static final String DEFAULT_ATTRIBUTE_TYPE = "attribute-type";
  private static final String DEFAULT_ATTRIBUTE_TYPE_2 = "attribute-type-2";
  private static final String DEFAULT_ATTRIBUTE_TYPE_3 = "attribute-type-3";
  private static final String PICKUP = "PICKUP";
  private static final String DEFAULT_LOCATION_PATH = "default-location-path";
  private static final String PREORDER_TYPE = "DAYS";
  private static final Integer PREORDER_VALUE = 10;
  private static final String PRODUCT_NAME = "product-name";
  private static final String BRAND_NAME = "brand-name";
  private static final String BRAND_CODE = "brand-code";
  private static final String CREATED_BY = "system";
  private static final String CREATED_ON = String.valueOf(new Date().getTime());
  private static final double DISCOUNT_PRICE = 100.00;
  public static final String B_2_C_ACTIVATED = "B2C_ACTIVATED";
  public static final String B_2_B_ACTIVATED = "B2B_ACTIVATED";
  public static final String NEED_REVISION = "- Need revision";
  public static final String ACCESS_CHANNEL = "web";
  public static final String FAAS_ACTIVATED = "faasActivated";
  private static final String PRODUCT_SKU_4 = "product-sku-4";
  private static final String PRODUCT_SKU_5 = "product-sku-5";
  private final String[] CAMPAIGN_REQUEST = {"price"};
  private final String[] INVENTORY_REQUEST = {"deltaStock", "useWarehouseStock"};
  private final String[] PRODUCT_REQUEST =
    {"cncActive", "sellerSku", "off2OnActiveFlag", "wholeSaleActivated", "status"};
  private static final String INVENTORY_UPDATE_FAILED = "Inventory Update Failed";
  private static final String PRICE_UPDATE_FAILED = "Can not process invalid input data :itemSku "
    + "for price data update for PP code : itemSku-pickupPointCode";
  private static final String OFF2_ON_FLAG_UPDATE_ERROR = "Off2onFlag Update error ";
  private static final String L5_UPDATE_FAIL_ERROR = "L5 Update was not success ";
  private static final Integer MAXIMUM_STOCK_LIMIT_EXCEEDED = 100000000;
  private static final Integer MAXIMUM_STOCK_LIMIT = 10000000;
  private static final String PICKUP_POINT_ID = "itemSku-pickupPointCode";
  private static final String BUSINESS_PARTNER_CODE = "merchantCode";
  private static final String REVIEW = "review";
  private static final String LOCATION_PATH = PRODUCT_CODE + "location path";
  private QuickEditV2Request quickEditV2Request = new QuickEditV2Request();
  private ProductLevel3QuickEditV2Request productLevel3QuickEditV2Request =
    new ProductLevel3QuickEditV2Request();
  private ItemPickupPointRequest itemPickupPointRequest =
    new ItemPickupPointRequest(ITEM_SKU, PICKUP_POINT_CODE);
  private ItemSummaryListResponse itemSummaryListResponse = new ItemSummaryListResponse();
  private PriceDTO priceDTO = new PriceDTO();
  private ProductLevel3PriceRequest productLevel3PriceRequest = new ProductLevel3PriceRequest();
  private ProfileResponse profileResponse = new ProfileResponse();
  private CompanyDTO companyDTO = new CompanyDTO();
  private CategoryResponse categoryResponse = new CategoryResponse();
  private CatalogResponse catalogResponse = new CatalogResponse();
  private PickupPointResponse pickupPointResponse = new PickupPointResponse();
  private ProductLevel3Inventory productLevel3Inventory = new ProductLevel3Inventory();
  private ItemInfoDto itemInfoDto = new ItemInfoDto();
  private WholesalePriceSkuResponse wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
  private UpdateProductItemLevel3Model oldUpdateProductItemLevel3Model =
    new UpdateProductItemLevel3Model();
  private UpdateProductItemLevel3Model newUpdateProductItemLevel3Model =
    new UpdateProductItemLevel3Model();
  private ItemViewConfigDTO itemViewConfigDTO = new ItemViewConfigDTO();
  private ProductSystemParameter productSystemParameter = new ProductSystemParameter();
  private ProductSystemParameter youtubeProductSystemParameter = new ProductSystemParameter();
  private ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
  private ProductLevel3 productLevel3 = new ProductLevel3();
  private ProductLevel3UpdateRequest productLevel3UpdateRequest = new ProductLevel3UpdateRequest();
  private ProductL3ListingRequest productL3ListingRequest = new ProductL3ListingRequest();
  private ProductL3SummaryResponse productL3SummaryResponse = new ProductL3SummaryResponse();
  private CategoryNamesResponse categoryNamesResponse = new CategoryNamesResponse();
  private InventoryDetailInfoResponseV2DTO inventoryDetailInfoResponseV2DTO = new InventoryDetailInfoResponseV2DTO();
  private CampaignPriceResponse campaignPriceResponse = new CampaignPriceResponse();
  private InventoryStockInfoDTO inventoryStockInfoDTO = new InventoryStockInfoDTO();
  private PageMetaData pageMetaData = new PageMetaData(PAGE, SIZE, SIZE);
  private ItemL4SummaryResponse itemL4SummaryResponse = new ItemL4SummaryResponse();
  private DiscountPriceDTO discountPriceDTO = new DiscountPriceDTO();
  private WebInventoryResponseV2DTO webInventoryResponseV2DTO = new WebInventoryResponseV2DTO();
  private WarehouseInventoryResponseDTO warehouseInventoryResponseDTO = new WarehouseInventoryResponseDTO();
  private CampaignPriceSkuResponse campaignPriceSkuResponse = new CampaignPriceSkuResponse();
  private ProductSuspensionHistoryResponse productSuspensionHistoryResponse = new ProductSuspensionHistoryResponse();
  private MandatoryRequestParam mandatoryRequestParam;
  private ProductBusinessPartner productBusinessPartner = new ProductBusinessPartner();
  private ProductItemBusinessPartner productItemBusinessPartner = new ProductItemBusinessPartner();
  private Image image;
  private PreOrderDTO preOrderDTO;
  private List<CategoryResponse> categoriesData;
  private ProductCollection productCollection = new ProductCollection();
  private ProductSummaryResponseV2 productSummaryResponseV2 = new ProductSummaryResponseV2();
  private AttributeResponse attribute;
  private AttributeResponse attribute2;
  private EditProductResponse editResponse = new EditProductResponse();
  private NewlyAddedL5Response newlyAddedL5Response = new NewlyAddedL5Response();

  private ItemSkuPpCodeRequest itemSkuPpCodeRequest = new ItemSkuPpCodeRequest();

  private ProductL5DetailResponse productL5DetailResponse = new ProductL5DetailResponse();

  private PriceResponse priceResponse = new PriceResponse();
  private BrandUpdateRequest brandUpdateRequest = new BrandUpdateRequest();
  private ProductBrandUpdateResponse productBrandUpdateResponse = new ProductBrandUpdateResponse();
  private Calendar calendar;
  private Date currentDate;
  private Date startDate;
  private Date endDate;

  @Mock
  private PreOrderConfig preOrderConfig;

  @Mock
  private XProductOutbound xProductOutbound;

  @Mock
  private WareHouseOutBound wareHouseOutBound;

  @Mock
  private CampaignOutboundBean campaignOutbound;

  @Mock
  private PickupPointOutbound pickupPointOutbound;

  @Mock
  private ProductLevel3InventoryServiceBean productLevel3InventoryService;

  @Mock
  private BusinessPartnerRepository businessPartnerRepository;

  @Mock
  private ProductLevel3WipService productLevel3WipService;

  @Mock
  private ProductLevel3HelperBean productLevel3Helper;

  @Mock
  private ProductNotificationServiceBean productNotificationService;

  @Mock
  private UpdatedProductHistoryServiceBean updatedProductHistoryService;

  @Mock
  private CategoryRepositoryBean categoryRepository;

  @Mock
  private PickupPointRepositoryBean pickupPointRepository;

  @Mock
  private ProductPricingOutboundBean productPricingOutbound;

  @Mock
  private WholesaleValidationUtilBean wholesaleValidationUtil;

  @Mock
  private UpdateProductItemLevel3ModelConverterBean updateProductItemLevel3ModelConverter;

  @Mock
  private ProductSystemParameterServiceImpl productSystemParameterService;

  @Mock
  private FileStorageServiceImpl fileStorageService;

  @Mock
  private YouTube youTube;

  @Mock
  private ProductLevel3Service productLevel3Service;

  @Mock
  private ProductLevel3ServiceBean productLevel3ServiceBean;

  @Mock
  private ProductOutbound productOutbound;

  @Mock
  private InventoryOutbound inventoryOutbound;

  @Mock
  private ApplicationProperties applicationProperties;

  @Mock
  private ProductCollectionRepository productCollectionRepository;

  @Mock
  private ProductLevel3LogisticsService productLevel3LogisticsService;

  @Mock
  private ProductBusinessPartnerRepository productBusinessPartnerRepository;

  @Mock
  private ProductService productService;

  @Mock
  private ProductL3Service productL3Service;

  @Mock
  private MandatoryParameterHelper mandatoryParameterHelper;

  @Mock
  private KafkaPublisher kafkaProducer;

  @Mock
  private ProductRepository productRepository;

  @Mock
  private PCBFeign pcbFeign;

  @Mock
  private ProductLevel3Repository productLevel3Repository;

  @Mock
  private ProductDistributionTaskRepository productDistributionTaskRepository;

  @Mock
  private ProductLevel1HistoryService productLevel1HistoryService;

  @Mock
  private AGPQueryFeign agpQueryFeign;

  @Mock
  private ProductOutboundBean productOutboundBean;

  @Mock
  private ObjectMapper objectMapper;

  @Mock
  private ProductItemBusinessPartnerService productItemBusinessPartnerService;

  @Mock
  private DistributionInfoService distributionInfoService;

  @InjectMocks
  private ProductLevel3V2ServiceImpl productLevel3V2Service;

  @Captor
  private ArgumentCaptor<List<ItemPickupPointQuickEditRequest>> itemPickupPointQuickEditRequestlistArgumentCaptor;

  @Captor
  private ArgumentCaptor<ProductLevel3Summary> productLevel3SummaryArgumentCaptor;

  @Captor
  private ArgumentCaptor<TypeReference> typeReferenceArgumentCaptor;

  @Captor
  private ArgumentCaptor<UpdateOrInsertStockVo> updateOrInsertStockVoArgumentCaptor;

  @Captor
  private ArgumentCaptor<SyncStockUpdateOrInsertVo> syncStockUpdateOrInsertVoArgumentCaptor;

  @Captor
  private ArgumentCaptor<List<ProductLevel3Inventory>> productLevel3InventoriesCaptor;

  @Mock
  private ProductBusinessPartnerServiceBean productBusinessPartnerServiceBean;

  @Mock
  private AGPQueryOutbound agpQueryOutboundBean;

  @Mock
  private CreateProductWorkflowWorkerBean createProductWorkflowWorkerBean;


  ProductRequest productRequest = new ProductRequest();

  @Mock
  private StringRedisTemplate stringRedisTemplate;

  @Mock
  private ValueOperations<String, String> valueOperations;

  @Mock
  private RedisProperties redisProperties;

  @Mock
  private ApplicationContext applicationContext;

  @BeforeEach
  public void setUp() throws Exception {
    MockitoAnnotations.initMocks(this);
    ReflectionTestUtils.setField(productLevel3V2Service, "maximumCharactersInDescription", 5000);
    ReflectionTestUtils.setField(productLevel3V2Service, "maximumCharactersWithoutFormattingDescription", 5000);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisUnsupportedMerchantTypes", "CM,CC");
    productLevel3PriceRequest.setPrice(NEW_NORMAL_PRICE);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "instore2FlowSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisEnabled", true);
    productLevel3PriceRequest.setSalePrice(NEW_SALE_PRICE);
    quickEditV2Request.setPrice(productLevel3PriceRequest);
    quickEditV2Request.setVersion(1L);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    quickEditV2Request.setWholeSaleActivated(false);
    quickEditV2Request.setDeltaStock(1);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setScheduleUpdate(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    itemSummaryListResponse.setItemSku(ITEM_SKU);
    itemSummaryListResponse.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setProductSku(PRODUCT_SKU);
    itemSummaryListResponse.setVersion(0L);
    itemSummaryListResponse.setFreeSample(false);
    itemSummaryListResponse.setMerchantCode(MERCHANT_CODE);
    itemSummaryListResponse.setMasterCategoryCode(CATEGORY_CODE);
    itemSummaryListResponse.setProductType(ProductType.BIG_PRODUCT);
    itemSummaryListResponse.setItemName(ITEM_NAME);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemViewConfigDTO.setBuyable(true);
    itemViewConfigDTO.setDiscoverable(true);
    itemViewConfigDTO.setChannel(DEFAULT_CHANNEL);
    itemSummaryListResponse.setItemViewConfigs(new HashSet<>(Arrays.asList(itemViewConfigDTO)));
    profileResponse.setCompany(companyDTO);
    profileResponse.setBusinessPartnerCode(MERCHANT_CODE);
    profileResponse.setFlags(new HashMap<>());
    profileResponse.getFlags().put("productConsequenceLimitation",true);
    categoryResponse.setCategoryCode(CATEGORY_CODE);
    categoryResponse.setName(CATEGORY_NAME);
    catalogResponse.setCatalogCode(MASTER_CATALOG_CODE);
    categoryResponse.setCatalog(catalogResponse);
    itemInfoDto.setItemSku(ITEM_SKU);
    itemInfoDto.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setFbbActivated(true);
    itemInfoDto.setItemPickupPointId(ITEM_SKU + Constants.HYPHEN + PICKUP_POINT_CODE);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(Constants.ALL)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
            Mockito.anyList(), eq(null)))
        .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
        Mockito.any(CampaignUpdateDiscountRequest.class)))
      .thenReturn(new CampaignUpdateDiscountResponse());
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(MERCHANT_CODE))
      .thenReturn(profileResponse);
    Mockito.when(this.categoryRepository.findHierarchyByCategoryCode(CATEGORY_CODE))
      .thenReturn(Collections.singletonList(categoryResponse));
    Mockito.when(this.pickupPointRepository.findByPickupPointCode(PICKUP_POINT_CODE))
      .thenReturn(pickupPointResponse);
    Mockito.when(
        this.productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList()))
      .thenReturn(Collections.singletonList(productLevel3Inventory));
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, false)).thenReturn(true);

    Mockito.when(updateProductItemLevel3ModelConverter.convertFromProductLevel3Summary(
        Mockito.any(ProductLevel3Summary.class))).thenReturn(oldUpdateProductItemLevel3Model)
      .thenReturn(newUpdateProductItemLevel3Model);
    Mockito.doNothing().when(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    productSystemParameter.setValue(String.valueOf(MIN_PRICE));
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
      Constants.MINIMUM_PRICE)).thenReturn(productSystemParameter);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
        .itemSkuStatusMap(new HashMap<>()).build());
    when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
        .itemSkuStatusMap(new HashMap<>()).build());
    youtubeProductSystemParameter.setValue("false");
    Mockito.when(productSystemParameterService
      .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
      .thenReturn(youtubeProductSystemParameter);

    ReflectionTestUtils.setField(productLevel3V2Service, "youTubeDataApiKey", API_KEY);
    productL3ListingRequest.setSuspended(false);
    attribute = new AttributeResponse();
    attribute.setId(DEFAULT_ATTRIBUTE_CODE_2);
    attribute.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_1);
    attribute2 = new AttributeResponse();
    BeanUtils.copyProperties(attribute, attribute2);

    itemL4SummaryResponse.setPrice(new HashSet<>(Arrays.asList(new PriceDTO())));
    itemL4SummaryResponse.setItemViewConfigs(Arrays.asList(new ItemViewConfigDTO()));
    itemL4SummaryResponse.setItemSku(ITEM_SKU);
    itemL4SummaryResponse.setPickupPointCode(PICKUP_POINT_CODE);
    webInventoryResponseV2DTO.setPickupPointCode(PICKUP_POINT_CODE);
    webInventoryResponseV2DTO.setWebItemSku(ITEM_SKU);
    webInventoryResponseV2DTO.setOriginalStock(ORIGINAL_STOCK);
    webInventoryResponseV2DTO.setAvailableStock(AVALIABLE_STOCK);
    inventoryDetailInfoResponseV2DTO.setWebInventoryResponse(webInventoryResponseV2DTO);
    warehouseInventoryResponseDTO.setAvailableStock(AVALIABLE_STOCK);
    warehouseInventoryResponseDTO.setOriginalStock(ORIGINAL_STOCK);
    campaignPriceSkuResponse.setItemSku(ITEM_SKU);
    campaignPriceSkuResponse.setPickUpPointCode(PICKUP_POINT_CODE);
    campaignPriceResponse.setItemInfoToPriceResponse(Arrays.asList(campaignPriceSkuResponse));
    productSuspensionHistoryResponse.setProductSku(PRODUCT_SKU);
    productSuspensionHistoryResponse.setReason(TEXT);

    this.mandatoryRequestParam = MandatoryRequestParam
        .generateMandatoryRequestParam(STORE_ID, CHANNEL_ID, CLIENT_ID, REQUEST_ID, USERNAME, AUTHENTICATOR);
    MDC.put(GdnMandatoryRequestParameterUtil.STORE_ID_KEY_PARAMETER, STORE_ID);
    MDC.put(GdnMandatoryRequestParameterUtil.CHANNEL_ID_KEY_PARAMETER, CHANNEL_ID);
    MDC.put(GdnMandatoryRequestParameterUtil.CLIENT_ID_KEY_PARAMETER, CLIENT_ID);
    MDC.put(GdnMandatoryRequestParameterUtil.REQUEST_ID_KEY_PARAMETER, REQUEST_ID);
    MDC.put(GdnMandatoryRequestParameterUtil.USERNAME_KEY_PARAMETER, USERNAME);
    MDC.put(GdnMandatoryRequestParameterUtil.AUTHENTICATOR_KEY, AUTHENTICATOR);

    productBusinessPartner.setBusinessPartnerId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setProductId(PRODUCT_SKU);

    productItemBusinessPartner.setGdnProductItemSku(ITEM_SKU);
    productItemBusinessPartner.setPickupPointId(PICKUP_POINT_CODE);
    productItemBusinessPartner.setProductItemId(PRODUCT_SKU);
    productItemBusinessPartner.setPrice(100.0);
    productItemBusinessPartner.setSalePrice(90.0);
    productItemBusinessPartner.setPreOrderQuota(10);
    productItemBusinessPartner.setBuyable(true);
    productItemBusinessPartner.setDisplay(true);
    productItemBusinessPartner.setProductType(1);

    inventoryStockInfoDTO.setWarehouseTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebProductSku(PRODUCT_SKU);
    inventoryStockInfoDTO.setWebMerchantCode(MERCHANT_CODE);

    image = new Image();
    image.setMainImages(true);
    image.setLocationPath(DEFAULT_LOCATION_PATH);
    image.setSequence(1);

    preOrderDTO = PreOrderDTO.builder().isPreOrder(true).preOrderType(PREORDER_TYPE)
      .preOrderValue(PREORDER_VALUE).build();

    CategoryResponse categoryResponse1 =
      new CategoryResponse("C2", CATEGORY_CODE, 0, null, "".getBytes(), "".getBytes(), null,
        true, 100, true, false, true, new CatalogResponse(), null);
    categoryResponse1.setId("id1");

    CategoryResponse categoryResponse2 =
      new CategoryResponse("C1", null, 0, null, "".getBytes(), "".getBytes(), null, true, 100, true,
        false, true, new CatalogResponse(), null);
    categoryResponse2.setId("id2");

    categoriesData = new ArrayList<CategoryResponse>();
    categoriesData.add(categoryResponse1);
    categoriesData.add(categoryResponse2);

    productCollection.setProductCode(PRODUCT_CODE);
    productCollection.setBrand(BRAND_NAME);
    productCollection.setBrandCode(BRAND_CODE);
    productCollection.setCreatedBy(CREATED_BY);
    productCollection.setCreatedDate(new Date());
    productCollection.setUpdatedDate(new Date());
    productCollection.setUpdatedBy(CREATED_BY);

    productSummaryResponseV2.setProductName(PRODUCT_NAME);
    productSummaryResponseV2.setProductSku(PRODUCT_SKU);
    productSummaryResponseV2.setMaxNormalPrice(1000.0);
    productSummaryResponseV2.setMinNormalPrice(800.0);
    productSummaryResponseV2.setMaxSellingPrice(700.0);
    productSummaryResponseV2.setMinSellingPrice(500.0);

    newlyAddedL5Response.setPickupPointCode(PICKUP_POINT_CODE);
    newlyAddedL5Response.setItemSku(ITEM_SKU);

    priceResponse = new PriceResponse();
    priceResponse.setSalePrice(100.0);

    brandUpdateRequest.setNewBrandCode(DEFAULT_BRAND);
    brandUpdateRequest.setOldBrandCode(BRAND_CODE);

    productBrandUpdateResponse.setBrandCode(DEFAULT_BRAND);
    productBrandUpdateResponse.setProductCode(PRODUCT_CODE);
    productBrandUpdateResponse.setBrandName(BRAND_NAME);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditPickupPoints", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateProductDescriptiveFieldExclusionList", StringUtils.EMPTY);
    productRequest =
      new ProductRequest.Builder().productCode("MTA-" + UUID.randomUUID().toString())
        .name("Produk 1").length(1.0).width(1.0).height(1.0).weight(1.0).shippingWeight(1.0)
        .description("Deskripsi 1".getBytes()).longDescription("Deskripsi 1".getBytes())
        .brand("Brand 1").brandCode(BRAND_CODE).uniqueSellingPoint("Unique Selling Point").uom(null).storeId(null)
        .promoSKU(false).productCategories(new ArrayList<ProductCategoryRequest>())
        .productAttributes(new ArrayList<ProductAttributeRequest>())
        .productItems(new ArrayList<ProductItemRequest>()).storeId(DEFAULT_STORE_ID).build();
    CategoryDetailResponse categoryDetailResponse = new CategoryDetailResponse();
    CategoryAttributeResponse categoryAttributeResponse = new CategoryAttributeResponse();
    AttributeResponse attributeResponse = new AttributeResponse();
    attributeResponse.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_1);
    categoryAttributeResponse.setAttribute(attributeResponse);
    categoryDetailResponse.setCategoryAttributes(List.of(categoryAttributeResponse));
    Mockito.when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE))
        .thenReturn(categoryDetailResponse);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);
    calendar = Calendar.getInstance();
    currentDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameCharacterLimit", 150);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(false);
    ReflectionTestUtils.setField(productLevel3V2Service, "eanUpcValidLength",
        Arrays.asList(5, 8, 12, 13, 14, 15));
    productL3UpdateRequest.setCategoryCode(CATEGORY_CODE);
  }

  @AfterEach
  public void tearDown() throws Exception {
    verifyNoMoreInteractions(this.xProductOutbound);
    verifyNoMoreInteractions(this.campaignOutbound);
    verifyNoMoreInteractions(this.productLevel3InventoryService);
    verifyNoMoreInteractions(this.businessPartnerRepository);
    verifyNoMoreInteractions(this.productLevel3Helper);
    verifyNoMoreInteractions(this.productNotificationService);
    verifyNoMoreInteractions(this.updatedProductHistoryService);
    verifyNoMoreInteractions(this.categoryRepository);
    verifyNoMoreInteractions(this.pickupPointRepository);
    verifyNoMoreInteractions(this.productPricingOutbound);
    verifyNoMoreInteractions(this.wholesaleValidationUtil);
    verifyNoMoreInteractions(this.updateProductItemLevel3ModelConverter);
    verifyNoMoreInteractions(this.productSystemParameterService);
    verifyNoMoreInteractions(this.productOutbound);
    verifyNoMoreInteractions(this.inventoryOutbound);
    verifyNoMoreInteractions(this.applicationProperties);
    verifyNoMoreInteractions(this.productLevel3ServiceBean);
    verifyNoMoreInteractions(this.wareHouseOutBound);
    verifyNoMoreInteractions(this.agpQueryFeign);
    verifyNoMoreInteractions(this.productOutboundBean);
    verifyNoMoreInteractions(this.distributionInfoService);
    verifyNoMoreInteractions(this.redisProperties);
    verifyNoMoreInteractions(this.applicationContext);
  }

  @Test
  public void productQuickEditV2Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "mergeStockValueAndSyncStockUpdate", true);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    quickEditV2Request.setDeltaStock(7);
    quickEditV2Request.setUseWarehouseStock(Boolean.FALSE);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setProductSku(PRODUCT_SKU);
    inventory.setWebItemSku(quickEditV2Request.getItemSku());
    inventory.setWebPickupPointCode(quickEditV2Request.getPickupPointCode());
    inventory.setWebSyncStock(true);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    List<InventoryDetailInfoRequestDTO> inventoryDetailInfoRequestDTOS =
      CommonUtils.getInventoryDetailInfoRequestDTOList(
        productLevel3QuickEditV2Request.getQuickEditV2Requests(), BUSINESS_PARTNER_CODE);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndListOfGdnSku(
      BUSINESS_PARTNER_CODE, quickEditV2Requests.stream().map(QuickEditV2Request::getItemSku)
        .collect(Collectors.toList()))).thenReturn(Collections.singletonList(inventory));
    Mockito.when(productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOS
      )).thenReturn(Collections.singletonList(inventory));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(inventoryDetailInfoRequestDTOS);
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productLevel3InventoryService)
      .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2SyncStockFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "mergeStockValueAndSyncStockUpdate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    quickEditV2Request.setDeltaStock(7);
    quickEditV2Request.setUseWarehouseStock(Boolean.FALSE);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setProductSku(PRODUCT_SKU);
    inventory.setWebItemSku(quickEditV2Request.getItemSku());
    inventory.setWebSyncStock(false);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    List<InventoryDetailInfoRequestDTO> inventoryDetailInfoRequestDTOS =
      CommonUtils.getInventoryDetailInfoRequestDTOList(
        productLevel3QuickEditV2Request.getQuickEditV2Requests(), BUSINESS_PARTNER_CODE);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndListOfGdnSku(
      BUSINESS_PARTNER_CODE, quickEditV2Requests.stream().map(QuickEditV2Request::getItemSku)
        .collect(Collectors.toList()))).thenReturn(Collections.singletonList(inventory));
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(applicationProperties).getInventoryApiBatchSize();
    Mockito.verify(productLevel3InventoryService)
      .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2SyncStockTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "mergeStockValueAndSyncStockUpdate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    profileResponse.getCompany().setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    quickEditV2Request.setDeltaStock(7);
    quickEditV2Request.setUseWarehouseStock(Boolean.TRUE);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    ProductLevel3Inventory inventory = new ProductLevel3Inventory();
    inventory.setProductSku(PRODUCT_SKU);
    inventory.setWebItemSku(quickEditV2Request.getItemSku());
    inventory.setWebSyncStock(false);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.DISTRIBUTION_FLAG_KEY, true);
    pickupPointResponse.setFlags(flags);
    pickupPointResponse.setCode(PICKUP_POINT_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndListOfGdnSku(
      BUSINESS_PARTNER_CODE, quickEditV2Requests.stream().map(QuickEditV2Request::getItemSku)
        .collect(Collectors.toList()))).thenReturn(Collections.singletonList(inventory));
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productLevel3InventoryService)
      .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test()
  public void productQuickEditV2TestWithNullCampaign() throws Exception {
    Map<String, String> map = new HashMap<>();
    map.put(ITEM_SKU, "0");
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(map).build());
    try {
      productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
      verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }



  @Test
  public void productQuickEditV2_missingItemPickupPointTest() throws Exception {
    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(null)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_invalidStockUpdateForOmgPreOrder_returnsError() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    com.gdn.x.product.rest.web.model.response.BasicProductResponse basicProductResponse =
        new com.gdn.x.product.rest.web.model.response.BasicProductResponse();
    com.gdn.x.product.rest.web.model.dto.PreOrderDTO preOrderDTOFuture =
        com.gdn.x.product.rest.web.model.dto.PreOrderDTO.builder()
            .preOrderDate(new Date(System.currentTimeMillis() + 24 * 60 * 60 * 1000L))
            .build();
    basicProductResponse.setPreOrder(preOrderDTOFuture);
    Mockito.when(xProductOutbound.getBasicProductInfoV2(PRODUCT_SKU)).thenReturn(basicProductResponse);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.INVALID_STOCK_UPDATE_PREORDER_OMG, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound).getBasicProductInfoV2(PRODUCT_SKU);
  }

  @Test
  public void productQuickEditV2_omgPreOrderWithNullDate_noError_proceedsToMissingPickupPoint() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);
    com.gdn.x.product.rest.web.model.response.BasicProductResponse basicProductResponse =
        new com.gdn.x.product.rest.web.model.response.BasicProductResponse();
    com.gdn.x.product.rest.web.model.dto.PreOrderDTO preOrderDTONull =
        com.gdn.x.product.rest.web.model.dto.PreOrderDTO.builder().preOrderDate(null).build();
    basicProductResponse.setPreOrder(preOrderDTONull);
    Mockito.when(xProductOutbound.getBasicProductInfoV2(PRODUCT_SKU)).thenReturn(basicProductResponse);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound).getBasicProductInfoV2(PRODUCT_SKU);
  }

  @Test
  public void productQuickEditV2_poQuotaFeatureDisabled_skipsPreOrderCheck() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(false);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);
    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound, Mockito.never()).getBasicProductInfo(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_sellerNotOmg_skipsPreOrderCheck() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put("someOtherFlag", true);
    profileResponse.setFlags(flags);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound, Mockito.never()).getBasicProductInfo(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_deltaStockZero_skipsPreOrderCheck() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);

    quickEditV2Request.setDeltaStock(0);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound, Mockito.never()).getBasicProductInfo(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_deltaStockNull_skipsPreOrderCheck() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);

    quickEditV2Request.setDeltaStock(null);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound, Mockito.never()).getBasicProductInfo(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_basicProductInfoNull_skipsError() throws Exception {
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.BLIBLI_OMG, true);
    profileResponse.setFlags(flags);

    itemSummaryListResponse.setPickupPointCode(ITEM_SKU);

    com.gdn.x.product.rest.web.model.response.BasicProductResponse basicProductResponse =
        new com.gdn.x.product.rest.web.model.response.BasicProductResponse();
    basicProductResponse.setPreOrder(null);
    Mockito.when(xProductOutbound.getBasicProductInfoV2(PRODUCT_SKU)).thenReturn(basicProductResponse);

    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);

    Assertions.assertEquals(ApiErrorCode.MISSING_ITEM_PICKUP_POINT, response);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    verify(xProductOutbound).getBasicProductInfoV2(PRODUCT_SKU);
  }

  @Test
  public void productQuickEditV2_archivedProductTest() throws Exception {
    itemSummaryListResponse.setArchived(true);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(null)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED, response);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_archivedProductSanitizeSellerSkuTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "sanitizeProductNameAndSellerSku", true);
    itemSummaryListResponse.setArchived(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(new ArrayList<>());
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(Mockito.anyList(), eq(Constants.ALL)))
        .thenReturn(Collections.singletonList(itemSummaryListResponse));
    ApiErrorCode response =
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
    verify(xProductOutbound).getItemPickupPointSummary(anyList(), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED, response);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_archivedProductSanitizeSellerSkuListNonEmptyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "sanitizeProductNameAndSellerSku", true);
    itemSummaryListResponse.setArchived(true);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
            Mockito.anyList(), eq(Constants.ALL)))
        .thenReturn(Collections.singletonList(itemSummaryListResponse));
    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED, response);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_archivedProductSanitizeSellerSkuNonEmptyTest() throws Exception {
    quickEditV2Request.setSellerSku(PRODUCT_SKU);
    ReflectionTestUtils.setField(productLevel3V2Service, "sanitizeProductNameAndSellerSku", true);
    itemSummaryListResponse.setArchived(true);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
            Mockito.anyList(), eq(Constants.ALL)))
        .thenReturn(Collections.singletonList(itemSummaryListResponse));
    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED, response);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }
  @Test
  public void productQuickEditV2_archivedMultipleProductTest() throws Exception {
    itemSummaryListResponse.setArchived(true);
    ItemSummaryListResponse itemSummaryListResponse2 = new ItemSummaryListResponse();
    itemSummaryListResponse2.setArchived(false);
    itemSummaryListResponse2.setItemSku(ITEM_CODE);
    itemSummaryListResponse2.setPickupPointCode(PICKUP_POINT_CODE_1);
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(null)))
      .thenReturn(Arrays.asList(itemSummaryListResponse, itemSummaryListResponse2));
    ApiErrorCode response = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    Assertions.assertEquals(ApiErrorCode.PRODUCT_IS_ARCHIVED, response);
  }

  @Test
  public void productQuickEditV2_withNullWholesaleRespoonseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Map<String, String> map = new HashMap<>();
    map.put(ITEM_SKU.concat("-1"), "0");
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(map)
      .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(null));
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_nullWholesaleSkuResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_nullDeltaStockTest() throws Exception {
    quickEditV2Request.setDeltaStock(null);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_MaxDeltaStockTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setDeltaStock(MAXIMUM_STOCK_LIMIT_EXCEEDED);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    try {
      Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
          .thenReturn(pickupPointResponseList);
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound, times(1)).getItemPickupPointSummary(
          eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.categoryRepository, times(1)).findHierarchyByCategoryCode(CATEGORY_CODE);
      verify(this.productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
          itemSummaryListResponse, false);
      verify(this.productLevel3InventoryService,
          times(1)).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.pickupPointRepository, times(1)).findByPickupPointCode(PICKUP_POINT_CODE);
      verify(this.productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(
          Collections.singletonList(itemInfoDto));
      verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
    }
  }

  @Test
  public void productQuickEditV2_MaxDeltaStockTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setDeltaStock(1);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    try {
      Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
          .thenReturn(pickupPointResponseList);
      doThrow(new Exception()).when(productLevel3InventoryService)
          .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Assertions.assertThrows(Exception.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound, times(1)).getItemPickupPointSummary(
          eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.categoryRepository, times(1)).findHierarchyByCategoryCode(CATEGORY_CODE);
      verify(this.productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
          itemSummaryListResponse, false);
      verify(this.productLevel3InventoryService,
          times(1)).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.pickupPointRepository, times(1)).findByPickupPointCode(PICKUP_POINT_CODE);
      verify(this.productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(
          Collections.singletonList(itemInfoDto));
      verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
      Mockito.verify(productLevel3InventoryService)
          .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    }
  }

  @Test
  public void productQuickEditV2_deactivateWholesaleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    wholesalePriceSkuResponse.setSkuStatus(ACTIVE);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(productPricingOutbound).setWholesaleActivatedFlag(ITEM_SKU, PICKUP_POINT_CODE, Constants.INACTIVE_STATUS);
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_outdatedRequestTest() throws Exception {
    itemSummaryListResponse.setVersion(3L);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }

  @Test
  public void productQuickEditV2_updateOnFreeSample_online() throws Exception {
    itemSummaryListResponse.setVersion(null);
    itemSummaryListResponse.setFreeSample(true);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }

  @Test
  public void productQuickEditV2_updateOnFreeSample_off2OnFlag() throws Exception {
    itemSummaryListResponse.setFreeSample(true);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setVersion(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }

  @Test()
  public void productQuickEditV2_priceEditDisabled() throws Exception {
    doThrow(new ApplicationRuntimeException()).when(campaignOutbound)
      .validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    ApiErrorCode result = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Assertions.assertEquals(ApiErrorCode.PRICE_UPDATE_FAILED, result);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
  }

  @Test
  public void productQuickEditV2_priceEditDisabledTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    itemSummaryListResponse.setMerchantPromoDiscount(true);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    B2bFieldsRequest b2bFieldsVo = new B2bFieldsRequest();
    b2bFieldsVo.setManaged(true);
    b2bFieldsVo.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsVo);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }


  @Test()
  public void productQuickEditV2_isPriceEditNotAllowedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    itemSummaryListResponse.setMerchantPromoDiscount(true);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    B2bFieldsRequest b2bFieldsVo = new B2bFieldsRequest();
    b2bFieldsVo.setManaged(true);
    b2bFieldsVo.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsVo);
    quickEditV2Request.setPrice(productLevel3PriceRequest);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ApiErrorCode apiErrorCode = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
      .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_withO2OChangeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setProductName(ITEM_NAME);
    itemSummaryListResponse.setOff2OnChannelActive(false);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_withO2ONoChangeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setOff2OnActiveFlag(false);
    itemSummaryListResponse.setOff2OnChannelActive(false);
    itemSummaryListResponse.setProductName(ITEM_NAME);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_noDetailsChangedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, false)).thenReturn(false);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_teaserStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setStatus(ProductLevel3Status.TEASER);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    ProfileResponse businessPartner = new ProfileResponse();
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(MERCHANT_CODE))
        .thenReturn(businessPartner);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(productNotificationService)
      .sendNotificationForProductStatus(MERCHANT_CODE, ITEM_NAME,
        quickEditV2Request.getStatus().name());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_wholesalePriceActivatedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    quickEditV2Request.setWholeSaleActivated(true);
    Set<String> pickupPointSet = new HashSet<>();
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    quickEditV2Request.getB2bFieldsRequest().setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, true)).thenReturn(true);
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setFbbActivated(false);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        true);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
          itemPickupPointQuickEditRequestlistArgumentCaptor.capture());
    Assertions.assertTrue(itemPickupPointQuickEditRequestlistArgumentCaptor.getValue().get(0).isFbbActivated());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(wholesaleValidationUtil).validateWholesaleConfigOnUpdate(eq(CATEGORY_CODE),
      Mockito.anyList(), Mockito.any(ItemRequest.class),
      eq(MIN_PRICE), eq(ITEM_SKU), eq(true), eq(null));
    verify(this.productSystemParameterService, times(2))
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_minimumPriceTest() throws Exception {
    quickEditV2Request.getPrice().setPrice(0.0);
    quickEditV2Request.getPrice().setSalePrice(0.0);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.productSystemParameterService)
          .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.any());
    }
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
  }

  @Test
  public void productQuickEditV2_minimumPriceTrueTest() throws Exception {
    quickEditV2Request.getPrice().setPrice(0.0);
    quickEditV2Request.getPrice().setSalePrice(2.0);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.productSystemParameterService)
          .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }

  @Test
  public void productQuickEditV2_minimumPriceBasePriceTrueTest() throws Exception {
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setBasePrice(0.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    try {
      Mockito
          .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
          .thenReturn(getProfileResponse());
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound).getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }

  @Test
  public void productQuickEditV2_SalePriceGreaterThanPrice() throws Exception {
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setBasePrice(0.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    quickEditV2Request.getPrice().setPrice(1.0);
    quickEditV2Request.getPrice().setSalePrice(2.0);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound).getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(Mockito.anyString());
    }
  }
  @Test
  public void productQuickEditV2_wholesalePriceActivated_wholesaleStatusChangedTest()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setSkuStatus(INACTIVE);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    quickEditV2Request.setWholeSaleActivated(true);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, true)).thenReturn(true);
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        true);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(wholesaleValidationUtil).validateWholesaleConfigOnUpdate(eq(CATEGORY_CODE),
      Mockito.anyList(), Mockito.any(ItemRequest.class),
      eq(MIN_PRICE), eq(ITEM_SKU), eq(true), eq(null));
    verify(this.productSystemParameterService,times(2))
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(productPricingOutbound).setWholesaleActivatedFlag(ITEM_SKU, PICKUP_POINT_CODE, Constants.ACTIVE_STATUS);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_useWarehouseStockTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setUseWarehouseStock(true);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_useWarehouseStock_setFulfillmentTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    companyDTO.setInventoryFulfillment(GdnBaseLookup.INVENTORY_FULFILLMENT_BLIBLI);
    quickEditV2Request.setUseWarehouseStock(true);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productLevel3InventoryService)
        .updateSyncStockOrInsertStock(syncStockUpdateOrInsertVoArgumentCaptor.capture());
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void generateProductLevel3Test() {
    Mockito.when(productLevel3Helper.generateProductLevel3(productL3UpdateRequest))
      .thenReturn(productLevel3);
    productLevel3 = productLevel3V2Service.generateProductLevel3(productL3UpdateRequest);
    verify(productLevel3Helper).generateProductLevel3(productL3UpdateRequest);
    Assertions.assertTrue(Objects.nonNull(productLevel3));
  }

  @Test
  public void validateProductEditInfoWithUSPMoreThan400CharactersTestTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUniqueSellingPoint(RandomStringUtils.randomAlphanumeric(401));
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
        .contains(ErrorMessages.UNIQUE_SELLING_POINT_MUST_NOT_BE_MORE_THAN_400_CHARACTERS));
    }
  }

  @Test
  public void validateProductEditInfoWithEmptyBPNumberTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setBusinessPartnerCode(StringUtils.EMPTY);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.BUSINESS_PARTNER_CODE_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoBasePrice() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(3.0);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(6.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items));
    productSystemParameter.setValue("3");
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE))
        .thenReturn(productSystemParameter);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
  }

  @Test
  public void validateProductEditInfoBasePriceNull() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoBasePriceLessThanMinimumPrice() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(5.0);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(1.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items));
    productSystemParameter.setValue("6");
    Mockito.when(productSystemParameterService.findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE))
        .thenReturn(productSystemParameter);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
      });
    } finally {
      verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    }
  }

  @Test
  public void validateProductEditInfoDuplicateUpcCodes() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE");
    ProductVariantPriceStockAndImagesRequest items3 = new ProductVariantPriceStockAndImagesRequest();
    ProductVariantPriceStockAndImagesRequest items4 = new ProductVariantPriceStockAndImagesRequest();
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU, ITEM_CODE);
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(5.0);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items, items2, items3, items4));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoEmptyDeletedItems() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoEmptyDeletedItemsValidateEanUpcCodeFormatItemsEmptyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEanUpcCodeFormat", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(new ArrayList<>());
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    Assertions.assertNotNull(productL3UpdateRequest.getProductItems());
  }

  @Test
  public void validateProductEditInfoEmptyDeletedItemsValidateEanUpcCodeFormatUPCNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEanUpcCodeFormat", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode(null);
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode(null);
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
    Assertions.assertNull(productL3UpdateRequest.getProductItems().get(0).getUpcCode());
  }

  @Test
  public void validateProductEditInfoEmptyDeletedItemsValidateEanUpcCodeFormatUPCNotNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEanUpcCodeFormat", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("11111");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("22222");
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
    Assertions.assertNotNull(productL3UpdateRequest.getProductItems().get(0).getUpcCode());
  }


  @Test
  public void validateProductEditInfoEmptyDeletedItemsValidateEanUpcCodeFormatUPCNotNullInvalidTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEanUpcCodeFormat", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode(ITEM_CODE);
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode(ITEM_SKU);
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items, items2));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
    Assertions.assertNotNull(productL3UpdateRequest.getProductItems().get(0).getUpcCode());
  }

  @Test
  public void validateProductEditInfoEmptyDeletedItemsValidateEanUpcCodeDuplicateTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEanUpcCodeFormat", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("11111");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("11111");
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items, items2));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
    Assertions.assertNotNull(productL3UpdateRequest.getProductItems().get(0).getUpcCode());
  }



  @Test
  public void validateProductEditInfoWithDeletedProductItems() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setNewlyAddedItem(true);
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemUpcCodesSkuCodesRequest productItemUpcCodesSkuCodesRequest = new ProductItemUpcCodesSkuCodesRequest();
    productItemUpcCodesSkuCodesRequest.setUpcCodes(Arrays.asList("UPC-CODE"));
    productItemUpcCodesSkuCodesRequest.setSkuCodes(Arrays.asList("SKU-CODE"));
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList(ITEM_NAME));
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
      });
    }
    finally {
      Mockito.verify(productOutbound)
          .getItemCodesByUpcCodeAndProductCode(anyString(), any(ProductItemUpcCodesSkuCodesRequest.class));
    }
  }

  @Test
  public void validateProductEditInfoWithDeletedProductItemsContainsItemCodesFromPCB() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setNewlyAddedItem(true);
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemUpcCodesSkuCodesRequest productItemUpcCodesSkuCodesRequest = new ProductItemUpcCodesSkuCodesRequest();
    productItemUpcCodesSkuCodesRequest.setUpcCodes(Arrays.asList("UPC-CODE"));
    productItemUpcCodesSkuCodesRequest.setSkuCodes(Arrays.asList("SKU-CODE"));
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList("ITEM-CODE"));
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
      });
    } finally {
      Mockito.verify(productOutbound)
          .getItemCodesByUpcCodeAndProductCode(anyString(), any(ProductItemUpcCodesSkuCodesRequest.class));
    }
  }

  @Test
  public void validateProductEditInfoWithNewlyAddedItemFalse() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    productL3UpdateRequest.setProductBundleRecipe(
        Arrays.asList(new ProductBundleRecipeRequest(ITEM_SKU, Set.of(new ProductBundleRecipe(ITEM_SKU,5)))));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items, items2));
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Map<String, String> itemSkuAndItemCodeMapping = new HashMap<>(ImmutableMap.of(ITEM_SKU, ITEM_CODE));
    ProductL3Response productL3Response = new ProductL3Response();
    productL3Response.setItemSkuItemCodeMap(itemSkuAndItemCodeMapping);
    ItemBasicDetailV2Response itemBasicDetailV2Response = ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU).itemCode(ITEM_CODE).build();
    Mockito.when(wareHouseOutBound.createAndUpdateProductBundle(any())).thenReturn(new CreateUpdateBOMRecipeResponse());
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any()))
        .thenReturn(Arrays.asList("ITEM-CODE"));
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU), false))
        .thenReturn(Arrays.asList(itemBasicDetailV2Response));
    Mockito.when(productLevel3Helper.validateShareProductRecipe(Mockito.any(), Mockito.any()))
        .thenReturn(productL3UpdateRequest.getProductBundleRecipe());
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, productL3Response);
    });
  }

  @Test
  public void validateProductEditInfoDuplicateItemTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    productL3UpdateRequest.setProductBundleRecipe(
        Arrays.asList(new ProductBundleRecipeRequest(ITEM_SKU, Set.of(new ProductBundleRecipe(ITEM_SKU_2,5)))));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    ItemBasicDetailV2Response itemBasicDetailV2Response = ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU_2).itemCode(ITEM_CODE).build();
    Map<String, String> itemSkuAndItemCodeMapping = new HashMap<>(ImmutableMap.of(ITEM_SKU, ITEM_CODE));
    Mockito.when(productRepository.findProductDetailByProductCode(productL3UpdateRequest.getProductCode()))
        .thenReturn(productDetailResponse);
    Mockito.when(productItemBusinessPartnerService.getItemSkuAndItemCodeMappingUsingItemIds(Constants.DEFAULT_STORE_ID,
        ImmutableMap.of(ID, ITEM_CODE))).thenReturn(itemSkuAndItemCodeMapping);
    Mockito.when(wareHouseOutBound.createAndUpdateProductBundle(any())).thenReturn(new CreateUpdateBOMRecipeResponse());
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList("ITEM-CODE"));
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU, ITEM_SKU_2), false))
        .thenReturn(Arrays.asList(itemBasicDetailV2Response));
    Mockito.when(productLevel3Helper.validateShareProductRecipe(Mockito.any(), Mockito.any()))
        .thenReturn(productL3UpdateRequest.getProductBundleRecipe());
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoEmptyItemSkuResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU_2,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    productL3UpdateRequest.setProductBundleRecipe(
        Arrays.asList(new ProductBundleRecipeRequest(ITEM_SKU, Set.of(new ProductBundleRecipe(ITEM_SKU_2,5)))));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ItemBasicDetailV2Response itemBasicDetailV2Response =
        ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU_2).itemCode(ITEM_CODE).build();
    Mockito.when(productRepository.findProductDetailByProductCode(productL3UpdateRequest.getProductCode()))
        .thenReturn(null);
    Mockito.when(wareHouseOutBound.createAndUpdateProductBundle(any())).thenReturn(new CreateUpdateBOMRecipeResponse());
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList("ITEM-CODE"));
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU, ITEM_SKU_2), false))
        .thenReturn(Arrays.asList(itemBasicDetailV2Response));
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoItemSkuResponseExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    productL3UpdateRequest.setProductBundleRecipe(
        Arrays.asList(new ProductBundleRecipeRequest(ITEM_SKU, Set.of(new ProductBundleRecipe(ITEM_SKU_2,5)))));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemUpcCodesSkuCodesRequest productItemUpcCodesSkuCodesRequest = new ProductItemUpcCodesSkuCodesRequest();
    productItemUpcCodesSkuCodesRequest.setUpcCodes(Arrays.asList("UPC-CODE"));
    productItemUpcCodesSkuCodesRequest.setSkuCodes(Arrays.asList("SKU-CODE"));
    ItemSummaryListResponse itemSummaryListResponse = new ItemSummaryListResponse();
    itemSummaryListResponse.setItemSku(ITEM_SKU);
    itemSummaryListResponse.setItemCode(ITEM_CODE);
    ItemBasicDetailV2Response itemBasicDetailV2Response =
        ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU_2).itemCode(ITEM_CODE).build();
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU, ITEM_SKU_2), false))
        .thenReturn(Arrays.asList(itemBasicDetailV2Response));
    Mockito.when(productRepository.findProductDetailByProductCode(productL3UpdateRequest.getProductCode()))
        .thenThrow(new ApplicationRuntimeException());
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    });
  }

  @Test
  public void validateProductEditInfoWithemptyItemCodesFrompcb() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setNewlyAddedItem(true);
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEM-CODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemUpcCodesSkuCodesRequest productItemUpcCodesSkuCodesRequest = new ProductItemUpcCodesSkuCodesRequest();
    productItemUpcCodesSkuCodesRequest.setUpcCodes(Arrays.asList("UPC-CODE"));
    productItemUpcCodesSkuCodesRequest.setSkuCodes(Arrays.asList("SKU-CODE"));
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList(ITEM_NAME));
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
      });
    } finally {
      Mockito.verify(productOutbound)
          .getItemCodesByUpcCodeAndProductCode(anyString(), any(ProductItemUpcCodesSkuCodesRequest.class));
    }
  }

  @Test
  public void validateProductEditInfo() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "upcCodeValidate", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductCode("PRODUCT-CODE");
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    items.setNewlyAddedItem(true);
    items.setUpcCode("UPC-CODE1");
    items.setSkuCode("SKU-CODE1");
    ProductVariantPriceStockAndImagesRequest items2 = new ProductVariantPriceStockAndImagesRequest();
    items2.setUpcCode("UPC-CODE2");
    items2.setSkuCode("SKU-CODE2");
    DeletedProductItems deletedProductItems = new DeletedProductItems(ITEM_SKU,"ITEMCODE");
    productL3UpdateRequest.setDeletedProductItems(Arrays.asList(deletedProductItems));
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    B2BFields b2BFields = new B2BFields();
    b2BFields.setPrice(null);
    itemPickupPointRequest1.setB2bFields(b2BFields);
    itemPickupPointRequest1.setSalePrice(5.0);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items,items2));
    ProductItemUpcCodesSkuCodesRequest productItemUpcCodesSkuCodesRequest = new ProductItemUpcCodesSkuCodesRequest();
    productItemUpcCodesSkuCodesRequest.setUpcCodes(Arrays.asList("UPC-CODE"));
    productItemUpcCodesSkuCodesRequest.setSkuCodes(Arrays.asList("SKU-CODE"));
    Mockito.when(productOutbound.getItemCodesByUpcCodeAndProductCode(anyString(), any())).thenReturn(Arrays.asList(ITEM_NAME));
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
      });
    } finally {
      Mockito.verify(productOutbound)
          .getItemCodesByUpcCodeAndProductCode(anyString(), any(ProductItemUpcCodesSkuCodesRequest.class));
    }
  }

  @Test
  public void getUpcCodesForNewItemsTest(){
    ProductL3UpdateRequest request = new ProductL3UpdateRequest();
    List<String> upcCodesForNewItems =
      productLevel3V2Service.getUpcCodesForNewItems(request, new ArrayList<>());
    Assertions.assertTrue(CollectionUtils.isEmpty(upcCodesForNewItems));
  }

  @Test
  public void checkDuplicateUpcCodesTestwithEmptyProductItems(){
    ProductL3UpdateRequest request = new ProductL3UpdateRequest();
    productLevel3V2Service.checkDuplicateUpcCodes(request);
  }


  @Test
  public void validateProductEditInfoB2bFieldsNull() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantPriceStockAndImagesRequest items = new ProductVariantPriceStockAndImagesRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    itemPickupPointRequest1.setB2bFields(null);
    items.setModifiedItemPickupPoints(Arrays.asList(itemPickupPointRequest1));
    productL3UpdateRequest.setProductItems(Arrays.asList(items));
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
  }

  @Test
  public void validateProductEditInfoWithEmptyAttributesTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUniqueSellingPoint(null);
    productL3UpdateRequest.setAttributes(new ArrayList<>());
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.ATTRIBUTE_MUST_NOT_BE_EMPTY));
    }
  }

  @Test
  public void validateProductEditInfoWithEmptySpecificationTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setSpecificationDetail(StringUtils.EMPTY);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.SPECIFICATION_DETAIL_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithAttributeCodeNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.getAttributes().get(0).setAttributeCode(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.ATTRIBUTE_CODE_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithAttributeTypeNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.getAttributes().get(0).setAttributeType(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.ATTRIBUTE_TYPE_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithAttributeValueNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.getAttributes().get(0).getValues().clear();
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.ATTRIBUTE_VALUE_MUST_NOT_BE_EMPTY));
    }
  }

  @Test
  public void validateProductEditInfoWithAttributeSkuNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.getAttributes().get(0).setSkuValue(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.ATTRIBUTE_SKU_VALUE_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithProductNameNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductName(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.PRODUCT_NAME_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithLargeProductNameTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductName(LARGE_PRODUCT_NAME);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.PRODUCT_NAME_LTE_LIMIT));
    }
  }

  @Test
  public void validateProductEditInfoWithEmptyBrandTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setBrand(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.BRAND_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithEmptyDescriptionTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setDescription(null);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ErrorMessages.DESCRIPTION_MUST_NOT_BE_BLANK));
    }
  }

  @Test
  public void validateProductEditInfoWithDescriptionMoreThan5000CharactersTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setDescription(RandomStringUtils.randomAlphanumeric(5001));
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
          .contains(String.format(ErrorMessages.DESCRIPTION_MUST_NOT_BE_MORE_THAN_MAX_CHARACTERS, 5000)));
    }
  }

  @Test
  public void validateProductEditInfoWithDescriptionFormattingTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setDescription("<p>"+RandomStringUtils.randomAlphanumeric(188));
    ReflectionTestUtils.setField(productLevel3V2Service, "maximumCharactersWithoutFormattingDescription", 189);
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(
        String.format(ErrorMessages.CHARACTER_LIMIT_REACHED_PLEASE_REDUCE_FORMATTING, 189)));
    }
  }

  @Test
  public void validateProductEditInfoWithInvalidUrlTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    ReflectionTestUtils.setField(productLevel3V2Service,"youtubeRegex","(?<=watch\\?v=|/videos/|embed\\/|youtu"
        + ".be\\/|\\/v\\/|\\/e\\/|watch\\?v%3D|watch\\?feature=player_embedded&v=|%2Fvideos%2F"
        + "|embed%\u200C\u200B2F|youtu.be%2F|%2Fv%2F|shorts\\/)[^#\\&\\?\\n]*");
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(YOUTUBE_INVALID_URL);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, new ProductL3Response());
    Assertions.assertTrue(StringUtils.isBlank(productL3UpdateRequest.getUrl()));
  }

  @Test
  public void validateProductEditInfoWithEmptyUrlTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(StringUtils.EMPTY);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, new ProductL3Response());
    Assertions.assertTrue(StringUtils.isBlank(productL3UpdateRequest.getUrl()));
  }

  @Test
  public void validateProductEditInfoWithNoChangeUrlTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(YOUTUBE_URL);
    ProductL3Response productL3Response = new ProductL3Response();
    productL3Response.setUrl(YOUTUBE_URL);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, productL3Response);
    Assertions.assertTrue(StringUtils.equals(productL3UpdateRequest.getUrl(), YOUTUBE_URL));
  }

  @Test
  public void validateProductEditInfoWithNullResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(YOUTUBE_URL);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    Assertions.assertTrue(StringUtils.equals(productL3UpdateRequest.getUrl(), YOUTUBE_URL));
  }

  @Test
  public void validateProductEditInfoWithUrlFailedTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    ReflectionTestUtils.setField(productLevel3V2Service,"youtubeRegex","(?<=watch\\?v=|/videos/|embed\\/|youtu"
        + ".be\\/|\\/v\\/|\\/e\\/|watch\\?v%3D|watch\\?feature=player_embedded&v=|%2Fvideos%2F"
        + "|embed%\u200C\u200B2F|youtu.be%2F|%2Fv%2F|shorts\\/)[^#\\&\\?\\n]*");
    youtubeProductSystemParameter.setValue(String.valueOf(Boolean.TRUE));
    Mockito.when(productSystemParameterService
            .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(youtubeProductSystemParameter);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(YOUTUBE_URL);
    ProductL3Response productL3Response = new ProductL3Response();
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, productL3Response);
    Mockito.verify(productSystemParameterService)
            .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Assertions.assertTrue(StringUtils.isBlank(productL3UpdateRequest.getUrl()));
  }

  @Test
  public void testIsYouTubeUrlActive_ReturnsTrue() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    ReflectionTestUtils.setField(productLevel3V2Service,"youtubeRegex","(?<=watch\\?v=|/videos/|embed\\/|youtu"
        + ".be\\/|\\/v\\/|\\/e\\/|watch\\?v%3D|watch\\?feature=player_embedded&v=|%2Fvideos%2F"
        + "|embed%\u200C\u200B2F|youtu.be%2F|%2Fv%2F|shorts\\/)[^#\\&\\?\\n]*");
    youtubeProductSystemParameter.setValue(String.valueOf(Boolean.TRUE));
    Mockito.when(productSystemParameterService
            .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH))
        .thenReturn(youtubeProductSystemParameter);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setUrl(YOUTUBE_URL);
    ProductL3Response productL3Response = new ProductL3Response();
    YouTube.Videos videosMock = Mockito.mock(YouTube.Videos.class);
    YouTube.Videos.List listMock = Mockito.mock(YouTube.Videos.List.class);
    VideoListResponse videoListResponseMock = Mockito.mock(VideoListResponse.class);
    PageInfo pageInfoMock = Mockito.mock(PageInfo.class);
    Mockito.when(youTube.videos()).thenReturn(videosMock);
    Mockito.when(videosMock.list(Mockito.anyString())).thenReturn(listMock);
    Mockito.when(listMock.setId(Mockito.anyString())).thenReturn(listMock);
    Mockito.when(listMock.setKey(Mockito.anyString())).thenReturn(listMock);
    Mockito.when(listMock.execute()).thenReturn(videoListResponseMock);
    Mockito.when(videoListResponseMock.getPageInfo()).thenReturn(pageInfoMock);
    Mockito.when(pageInfoMock.getTotalResults()).thenReturn(1);
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, productL3Response);
    Mockito.verify(youTube).videos();
    Mockito.verify(videosMock).list(Mockito.anyString());
    Mockito.verify(listMock).execute();
    Mockito.verify(productSystemParameterService)
        .findByStoreIdAndVariable(DEFAULT_STORE_ID, Constants.YOUTUBE_URL_VALIDATION_SWITCH);
    Assertions.assertTrue(StringUtils.equals(productL3UpdateRequest.getUrl(), YOUTUBE_URL));
  }

  @Test
  public void validateProductEditTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
  }

  @Test
  public void validateProductEditInfoWithEmptyL5UpdateTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    try {
      productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null);
    } catch (Exception e) {
      Assertions.assertTrue(
        e.getMessage().contains(ErrorMessages.PRODUCT_VARIANT_UPDATE_REQUEST_MUST_NOT_BE_EMPTY));
    }
  }

  @Test
  public void updateLogisticsTest() throws Exception {
    ApiErrorCode apiErrorCode = null;
    Mockito.when(productLevel3Service.updateLogistics(productLevel3UpdateRequest, true, null, false, DEFAULT_SKU_VALUE, true))
      .thenReturn(null);
    apiErrorCode = productLevel3V2Service.updateLogistics(productLevel3UpdateRequest, false, false, false,
        DEFAULT_SKU_VALUE);
    Assertions.assertNull(apiErrorCode);
  }

  @Test
  public void updateLogisticsNeedCorrectionTest() throws Exception {
    ApiErrorCode apiErrorCode = null;
    Mockito.when(productLevel3Service.updateLogisticsForNeedRevision(productLevel3UpdateRequest))
      .thenReturn(null);
    apiErrorCode = productLevel3V2Service.updateLogistics(productLevel3UpdateRequest, false, true, false,
        DEFAULT_SKU_VALUE);
    Assertions.assertNull(apiErrorCode);
  }

  @Test
  public void updateLogistics_WithApiErrorCodeTest() throws Exception {
    ApiErrorCode apiErrorCode = null;
    Mockito.when(productLevel3Service
      .updateLogistics(Mockito.any(), anyBoolean(),
        Mockito.any(), anyBoolean(), anyBoolean(), anyBoolean()))
      .thenReturn(ApiErrorCode.INVALID_LOGISTICS_OPTION_SELECTED);
    apiErrorCode = productLevel3V2Service.updateLogistics(productLevel3UpdateRequest, false, false, false,
        DEFAULT_SKU_VALUE);
    Assertions.assertNotNull(apiErrorCode);
  }

  @Test
  public void updateProductItemImages() throws Exception {
    ProductL3UpdateRequest productL3UpdateRequest = generateProductL3UpdateRequest();
    ItemsPriceStockImagesUpdateResponse response = new ItemsPriceStockImagesUpdateResponse();
    response.setApiErrorCode(null);
    Mockito.when(productLevel3Service.updateProductItemImages(productL3UpdateRequest, null)).thenReturn(response);
    response = productLevel3V2Service.updateProductItemImages(productL3UpdateRequest, null);
    Assertions.assertNotNull(response);
  }

  @Test
  public void updateEditInfo() throws Exception {
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setApiErrorCode(null);
    editProductResponse.setReviewType("postLive");
    EditProductResponse result;
    Mockito.when(
            productLevel3Service.updateEditInfo(Mockito.any(ProductLevel3.class), anyBoolean(), anyBoolean(), anyBoolean(),
                Mockito.any(ProfileResponse.class), anyBoolean(), any(ProductL3Response.class),
              anyBoolean(), eq(null), any()))
        .thenReturn(editProductResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(productLevel3.getBusinessPartnerCode()))
        .thenReturn(profileResponse);
    result = productLevel3V2Service.updateEditInfo(productLevel3, true, false, false, profileResponse,
        generateProductL3Response(), false, null, productL3UpdateRequest);
    Assertions.assertEquals("postLive", result.getReviewType());
    Assertions.assertNull(result.getApiErrorCode());
  }

  @Test
  public void updateEditInfoNull() throws Exception {
    EditProductResponse result;
    Mockito.when(
            productLevel3Service.updateEditInfo(Mockito.any(ProductLevel3.class), anyBoolean(), anyBoolean(), anyBoolean(),
                Mockito.any(ProfileResponse.class), anyBoolean(), any(ProductL3Response.class),
                anyBoolean(), eq(null), any()))
        .thenReturn(null);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(productLevel3.getBusinessPartnerCode()))
        .thenReturn(profileResponse);
    result = productLevel3V2Service.updateEditInfo(productLevel3, true, false, false, profileResponse,
        generateProductL3Response(), false, null, productL3UpdateRequest);
    Assertions.assertNull(result);
  }

  @Test
  public void fetchL3DetailByProductSkuDataNeedRevisionTest() throws Exception {
    image.setCommonImage(true);
    productBusinessPartner.setState("IN_PROGRESS");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setPreOrderDTO(preOrderDTO);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner
      .setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productBusinessPartner.setBusinessPartnerId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setPreOrderValue(10);
    productBusinessPartner.setCategoryCode(CATEGORY_CODE);
    ProductDetailResponse productDetailResponse = generateProductDetailResponse();
    productDetailResponse.setDescription(DEFAULT_DESCRIPTION.getBytes());
    productDetailResponse.setLength(10.0);
    productDetailResponse.setProductAttributeResponses(new ArrayList<>());
    productDetailResponse.setImages(Arrays.asList(image));
    productDetailResponse.setProductAttributeResponses(new ArrayList<>());
    ProductAttributeResponse productAttributeResponse = new ProductAttributeResponse();
    productAttributeResponse.setProductAttributeValues(new ArrayList<>());
    AttributeResponse attributeResponse = new AttributeResponse();
    attributeResponse.setAttributeType(DEFAULT_ATTRIBUTE_TYPE);
    attributeResponse.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_1);
    attributeResponse.setName("Color");
    attributeResponse.setSkuValue(false);
    ProductAttributeValueResponse productAttributeValueResponse =
      new ProductAttributeValueResponse();
    PredefinedAllowedAttributeValueResponse predefinedAllowedAttributeValueResponse =
      new PredefinedAllowedAttributeValueResponse();
    predefinedAllowedAttributeValueResponse.setValue("Orange");
    productAttributeValueResponse
      .setPredefinedAllowedAttributeValue(predefinedAllowedAttributeValueResponse);
    productAttributeResponse.setAttribute(attributeResponse);
    productAttributeResponse.getProductAttributeValues().add(productAttributeValueResponse);
    productDetailResponse.getProductAttributeResponses().add(productAttributeResponse);

    ProductAttributeResponse productAttributeResponse1 = new ProductAttributeResponse();
    productAttributeResponse1.setProductAttributeValues(new ArrayList<>());
    AttributeResponse attributeResponse1 = new AttributeResponse();
    attributeResponse1.setAttributeType(DEFAULT_ATTRIBUTE_TYPE_2);
    attributeResponse1.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_2);
    attributeResponse1.setName("RAM");
    attributeResponse1.setSkuValue(false);
    ProductAttributeValueResponse productAttributeValueResponse1 =
      new ProductAttributeValueResponse();
    productAttributeValueResponse1.setDescriptiveAttributeValue("10GB");
    productAttributeResponse1.setAttribute(attributeResponse1);
    productAttributeResponse1.getProductAttributeValues().add(productAttributeValueResponse1);
    productDetailResponse.getProductAttributeResponses().add(productAttributeResponse1);

    ProductAttributeResponse productAttributeResponse2 = new ProductAttributeResponse();
    productAttributeResponse2.setProductAttributeValues(new ArrayList<>());
    AttributeResponse attributeResponse2 = new AttributeResponse();
    attributeResponse2.setAttributeType(DEFAULT_ATTRIBUTE_TYPE_3);
    attributeResponse2.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_3);
    attributeResponse2.setName("OS");
    attributeResponse2.setSkuValue(false);
    ProductAttributeValueResponse productAttributeValueResponse2 =
      new ProductAttributeValueResponse();
    AllowedAttributeValueResponse allowedAttributeValueResponse =
      new AllowedAttributeValueResponse();
    allowedAttributeValueResponse.setValue("Windows");
    productAttributeValueResponse2.setAllowedAttributeValue(allowedAttributeValueResponse);
    productAttributeResponse2.setAttribute(attributeResponse2);
    productAttributeResponse2.getProductAttributeValues().add(productAttributeValueResponse2);
    productDetailResponse.getProductAttributeResponses().add(productAttributeResponse2);

    ProductAttributeResponse productAttributeResponse3 = new ProductAttributeResponse();
    productAttributeResponse3.setProductAttributeValues(new ArrayList<>());
    AttributeResponse attributeResponse3 = new AttributeResponse();
    attributeResponse3.setAttributeType(DEFAULT_ATTRIBUTE_TYPE_3);
    attributeResponse3.setAttributeCode(DEFAULT_ATTRIBUTE_CODE_3);
    attributeResponse3.setName("OS");
    attributeResponse3.setSkuValue(false);
    ProductAttributeValueResponse productAttributeValueResponse3 =
      new ProductAttributeValueResponse();
    productAttributeResponse3.setAttribute(attributeResponse3);
    productAttributeResponse3.getProductAttributeValues().add(productAttributeValueResponse3);
    productDetailResponse.getProductAttributeResponses().add(productAttributeResponse3);
    DistributionInfoResponse distributionInfoResponse = new DistributionInfoResponse();
    distributionInfoResponse.setProductName(PRODUCT_NAME);
    distributionInfoResponse.setCategoryName(CATEGORY_NAME);
    productDetailResponse.setDistributionInfoResponse(distributionInfoResponse);

    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(getProfileResponse());
    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
      .thenReturn(PRODUCT_CODE);
    Mockito.when(productLevel3LogisticsService
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
      .thenReturn(new ArrayList<>());
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
      .thenReturn(productDetailResponse);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    Mockito.when(categoryRepository.findHierarchyByCategoryCode(CATEGORY_CODE))
      .thenReturn(categoriesData);
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(productCollectionRepository).getProductCodeByGdnSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(productOutbound).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
    Assertions.assertEquals(4, productL3DetailsResponse.getAttributes().size());
    Assertions.assertEquals(10.0, productL3DetailsResponse.getLength(), 0.0);
  }

  @Test
  public void getL3DetailByProductSkuNeedRevisionTest() throws Exception {
    image.setCommonImage(true);
    productBusinessPartner.setState("NEED_CORRECTION");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setPreOrderDTO(preOrderDTO);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner
      .setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productBusinessPartner.setBusinessPartnerId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setPreOrderValue(10);
    image.setCommonImage(false);
    ProductDetailResponse productDetailResponse = generateProductDetailResponse();
    productDetailResponse.setImages(Arrays.asList(image));
    productDetailResponse.setDescription(DEFAULT_DESCRIPTION.getBytes());
    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(getProfileResponse());
    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
      .thenReturn(PRODUCT_CODE);
    Mockito.when(productLevel3LogisticsService
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
      .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
      .thenReturn(productDetailResponse);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(productCollectionRepository).getProductCodeByGdnSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.any());
    verify(productOutbound).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }

  @Test
  public void getL3DetailByProductSkuNeedRevisionDescriptionTest() throws Exception {
    image.setCommonImage(true);
    productBusinessPartner.setState("NEED_CORRECTION");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setPreOrderDTO(preOrderDTO);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner
        .setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productBusinessPartner.setBusinessPartnerId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setPreOrderValue(10);
    image.setCommonImage(false);
    ProductDetailResponse productDetailResponse = generateProductDetailResponse();
    productDetailResponse.setImages(Arrays.asList(image));
    productDetailResponse.setDescription(null);
    Mockito
        .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
        .thenReturn(getProfileResponse());
    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productLevel3LogisticsService
            .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
        .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(this.productCollectionRepository
            .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
        .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(productCollectionRepository).getProductCodeByGdnSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
        .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
        .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.any());
    verify(productOutbound).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productCollectionRepository)
        .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }

  @Test
  public void getL3DetailByProductSkuNeedRevisionNullProductCollectionTest() throws Exception {
    image.setCommonImage(true);
    productBusinessPartner.setState("NEED_CORRECTION");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setPreOrderDTO(preOrderDTO);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner
        .setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productBusinessPartner.setBusinessPartnerId(DEFAULT_BUSINESS_PARTNER_CODE);
    productBusinessPartner.setPreOrderValue(10);
    image.setCommonImage(false);
    ProductDetailResponse productDetailResponse = generateProductDetailResponse();
    productDetailResponse.setImages(Arrays.asList(image));
    productDetailResponse.setDescription(DEFAULT_DESCRIPTION.getBytes());
    Mockito
        .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
        .thenReturn(getProfileResponse());
    Mockito.when(productCollectionRepository.getProductCodeByGdnSku(PRODUCT_SKU))
        .thenReturn(PRODUCT_CODE);
    Mockito.when(productLevel3LogisticsService
            .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
        .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(productOutbound.getProductDetailByProductCode(PRODUCT_CODE, true, false))
        .thenReturn(productDetailResponse);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    Mockito.when(this.productCollectionRepository
            .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(null);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
        .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(productCollectionRepository).getProductCodeByGdnSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
        .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
        .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.any());
    verify(productOutbound).getProductDetailByProductCode(PRODUCT_CODE, true, false);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productCollectionRepository)
        .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }
  @Test
  public void fetchL3DetailByProductSkuTest() throws Exception {
    productBusinessPartner.setState("ACTIVE");
    inventoryStockInfoDTO.setWarehouseTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebProductSku(PRODUCT_SKU);
    inventoryStockInfoDTO.setWebMerchantCode(MERCHANT_CODE);
    ProductL3Response savedProductData = generateProductL3Response();
    ProductSummaryRequestV2 productSummaryRequestV2 = new ProductSummaryRequestV2();
    productSummaryRequestV2.setMerchantCode(MERCHANT_CODE);
    productSummaryRequestV2.setProductSkuList(Arrays.asList(PRODUCT_SKU));
    savedProductData.getMasterDataProduct()
      .setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    savedProductData.getMasterDataProduct().getMasterDataProductImages()
      .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0, true));
    savedProductData.setPreOrderDTO(preOrderDTO);
    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(getProfileResponse());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(productLevel3LogisticsService
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
      .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
      new GdnRestListResponse<>(Arrays.asList(productSummaryResponseV2), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
      .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    verify(applicationProperties).getInventoryApiBatchSize();
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }


  @Test
  public void fetchL3DetailByProductSkuProductCollectionNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productBusinessPartner.setState("ACTIVE");
    inventoryStockInfoDTO.setWarehouseTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebProductSku(PRODUCT_SKU);
    inventoryStockInfoDTO.setWebMerchantCode(MERCHANT_CODE);
    ProductL3Response savedProductData = generateProductL3Response();
    ProductSummaryRequestV2 productSummaryRequestV2 = new ProductSummaryRequestV2();
    productSummaryRequestV2.setMerchantCode(MERCHANT_CODE);
    productSummaryRequestV2.setProductSkuList(Arrays.asList(PRODUCT_SKU));
    savedProductData.getMasterDataProduct().setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    savedProductData.getMasterDataProduct().getMasterDataProductImages()
        .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0, true));
    savedProductData.setPreOrderDTO(preOrderDTO);
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
        .thenReturn(getProfileResponse());
    savedProductData.setDistributionInfoDTO(new DistributionInfoDTO());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(productLevel3LogisticsService.findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
        .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
            Mockito.any(ProductSummaryRequestV2.class)))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(productSummaryResponseV2), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(this.productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(null);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse =
        productLevel3V2Service.fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService).findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
        Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository).findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    verify(applicationProperties).getInventoryApiBatchSize();
    Assertions.assertNull(((ProductLevel3DetailsV2Response) productL3DetailsResponse).getState());
  }

  @Test
  public void fetchL3DetailByProductSkuNotFoundInSolrTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productBusinessPartner.setState("ACTIVE");
    inventoryStockInfoDTO.setWarehouseTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebProductSku(PRODUCT_SKU);
    inventoryStockInfoDTO.setWebMerchantCode(MERCHANT_CODE);
    ProductL3Response savedProductData = generateProductL3Response();
    ProductSummaryRequestV2 productSummaryRequestV2 = new ProductSummaryRequestV2();
    productSummaryRequestV2.setMerchantCode(MERCHANT_CODE);
    productSummaryRequestV2.setProductSkuList(Arrays.asList(PRODUCT_SKU));
    savedProductData.getMasterDataProduct()
        .setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    savedProductData.getMasterDataProduct().getMasterDataProductImages()
        .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0, true));
    savedProductData.setPreOrderDTO(preOrderDTO);
    Mockito
        .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
        .thenReturn(getProfileResponse());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(productLevel3LogisticsService
            .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
        .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
        Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
        new GdnRestListResponse<>(new ArrayList<>(), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(this.productCollectionRepository
            .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
        .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
        .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
        .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
        Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository)
        .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    verify(applicationProperties).getInventoryApiBatchSize();
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }

  @Test
  public void fetchL3DetailByProductSkuSkipInvTest() throws Exception {
    productBusinessPartner.setState("ACTIVE");
    inventoryStockInfoDTO.setWarehouseTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebTotalAvailableStock(10);
    inventoryStockInfoDTO.setWebProductSku(PRODUCT_SKU);
    inventoryStockInfoDTO.setWebMerchantCode(MERCHANT_CODE);
    ProductL3Response savedProductData = generateProductL3Response();
    ProductSummaryRequestV2 productSummaryRequestV2 = new ProductSummaryRequestV2();
    productSummaryRequestV2.setMerchantCode(MERCHANT_CODE);
    productSummaryRequestV2.setProductSkuList(Arrays.asList(PRODUCT_SKU));
    savedProductData.getMasterDataProduct()
        .setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    savedProductData.getMasterDataProduct().getMasterDataProductImages()
        .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0, true));
    savedProductData.setPreOrderDTO(preOrderDTO);
    Mockito
        .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
        .thenReturn(getProfileResponse());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(productLevel3LogisticsService
            .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
        .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
        Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
        new GdnRestListResponse<>(new ArrayList<>(), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(this.productCollectionRepository
            .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
        .fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, false);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
        .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
        .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
        Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository)
        .findByStoreIdAndProductCode(DEFAULT_STORE_ID, PRODUCT_CODE);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }

  @Test
  public void getL3DetailByProductSkuDifferentAttributeTest() throws Exception {
    productBusinessPartner.setState("ACTIVE");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.getProductSpecialAttributes().get(0)
      .setAttributeCode(PRODUCT_SKU);
    savedProductData.getMasterDataProduct()
      .setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    savedProductData.getMasterDataProduct().getMasterDataProductImages()
      .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0, false));
    savedProductData.setPreOrderDTO(preOrderDTO);
    when(productOutbound.getAttributeDetailByAttributeCode(PRODUCT_SKU))
      .thenReturn(attribute);
    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(getProfileResponse());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(productLevel3LogisticsService
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP))
      .thenReturn(Arrays.asList(new ProductLevel3Logistics()));
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString()))
      .thenReturn(productCollection);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
      .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
      new GdnRestListResponse<>(Arrays.asList(productSummaryResponseV2), pageMetaData, REQUEST_ID));
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(productLevel3LogisticsService)
      .findLogisticsByItemSku(ITEM_SKU, DEFAULT_BUSINESS_PARTNER_CODE, PICKUP);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    verify(productOutbound).getAttributeDetailByAttributeCode(PRODUCT_SKU);
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
    Assertions.assertEquals(PREORDER_VALUE, productL3DetailsResponse.getPreOrder().getPreOrderValue());
  }

  @Test
  public void getL3DetailByProductSku_suspendedProductEmptyCategorieTest() throws Exception {
    productBusinessPartner.setState("ACTIVE");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setMarkForDelete(true);
    savedProductData.setMasterDataProduct(null);
    savedProductData.setDefiningAttributes(null);
    savedProductData.setDescriptiveAttributes(null);
    savedProductData.setProductSpecialAttributes(null);
    savedProductData.setProductScore(null);
    savedProductData.setSuspended(true);
    ProfileResponse profileResponse = getProfileResponse();
    profileResponse.getCompany().setMerchantDeliveryType(null);
    Mockito.when(categoryRepository.findHierarchyByCategoryCode(CATEGORY_CODE))
      .thenReturn(new ArrayList<>());
    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(profileResponse);
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString()))
      .thenReturn(productCollection);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
      .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
      new GdnRestListResponse<>(Arrays.asList(productSummaryResponseV2), pageMetaData, REQUEST_ID));
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class));
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(applicationProperties).getInventoryApiBatchSize();
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
  }

  @Test
  public void getL3DetailByProductSku_withNullMerchantDeliverTypeTest() throws Exception {
    productBusinessPartner.setState("ACTIVE");
    ProductL3Response savedProductData = generateProductL3Response();
    savedProductData.setMarkForDelete(true);
    savedProductData.setMasterDataProduct(null);
    savedProductData.setDefiningAttributes(null);
    savedProductData.setDescriptiveAttributes(null);
    savedProductData.setProductSpecialAttributes(null);
    savedProductData.setProductScore(null);
    ProfileResponse profileResponse = getProfileResponse();
    profileResponse.getCompany().setMerchantDeliveryType(null);
    Mockito
      .when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(Mockito.anyString()))
      .thenReturn(profileResponse);
    Mockito.when(this.productCollectionRepository
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString()))
      .thenReturn(productCollection);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
      .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData, CLIENT_ID));
    Mockito.when(xProductOutbound.getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class))).thenReturn(
      new GdnRestListResponse<>(Arrays.asList(productSummaryResponseV2), pageMetaData, REQUEST_ID));
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    ProductL3DetailsResponse productL3DetailsResponse = productLevel3V2Service
      .fetchL3ProductDetailsByProductSku(STORE_ID, PRODUCT_SKU, false, true);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(this.businessPartnerRepository)
      .filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    verify(categoryRepository).findHierarchyByCategoryCode(Mockito.anyString());
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
    verify(xProductOutbound).getProductSummary(Mockito.anyInt(), Mockito.anyInt(),
      Mockito.any(ProductSummaryRequestV2.class));
    verify(productCollectionRepository)
      .findByStoreIdAndProductCode(Mockito.anyString(), Mockito.anyString());
    Assertions.assertEquals(PRODUCT_SKU, productL3DetailsResponse.getProductSku());
  }

  private ProductL3UpdateRequest generateProductL3UpdateRequest() {
    ProductL3UpdateRequest productL3UpdateRequest = new ProductL3UpdateRequest();
    ProductLevel3AttributeRequest attribute =
      new ProductLevel3AttributeRequest(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_BRAND,
        new ArrayList<String>(), DEFAULT_SKU_VALUE);
    String value = "value";
    attribute.setAttributeName(PRODUCT_NAME);
    attribute.getValues().add(value);
    productL3UpdateRequest.setProductName(DEFAULT_PRODUCT_NAME);
    productL3UpdateRequest.setBrand(DEFAULT_BRAND);
    productL3UpdateRequest.setUrl(YOUTUBE_URL);
    productL3UpdateRequest.setProductCode(PRODUCT_CODE);
    productL3UpdateRequest.setAttributes(new ArrayList<>());
    productL3UpdateRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    productL3UpdateRequest.setDescription(DEFAULT_DESCRIPTION);
    productL3UpdateRequest.setUniqueSellingPoint(DEFAULT_USP);
    productL3UpdateRequest.setSpecificationDetail(DEFAULT_SPECIFICATION);
    productL3UpdateRequest.setDescription(DEFAULT_DESCRIPTION);
    productL3UpdateRequest.getAttributes().add(attribute);
    productL3UpdateRequest.setCategoryCode(CATEGORY_CODE);
    return productL3UpdateRequest;
  }

  @Test
  public void getProductL3ListTest() throws Exception {
    productSystemParameter.setValue("true");
    productL3SummaryResponse.setVariantCount(0);
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(new InventoryDetailInfoResponseV2DTO()), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(campaignPriceResponse);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.SHOW_L3_STOCK);
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
  }

  @Test
  public void getProductL3List_forFailureFromCampaign_Test() throws Exception {
    productSystemParameter.setValue("true");
    productL3SummaryResponse.setVariantCount(0);
    CampaignPriceSkuRequest campaignRequest =
      CampaignPriceSkuRequest.builder().itemSku(ITEM_SKU).pickUpPointCode(PICKUP_POINT_CODE)
        .build();
    CampaignPriceRequest campaignL5Request = CampaignPriceRequest.builder()
      .campaignPriceSkuRequestList(Collections.singletonList(campaignRequest)).build();
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
      eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
      Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
      .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
      .thenReturn(new GdnRestListResponse(Arrays.asList(new InventoryDetailInfoResponseV2DTO()), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(campaignL5Request)).thenReturn(null);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.SHOW_L3_STOCK);
    verify(applicationProperties).getInventoryApiBatchSize();
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(inventoryOutbound).findDetailByWebProductSkus(any(), any());
  }

  @Test
  public void getProductL3ListSuspendedListTest() throws Exception {
    productSystemParameter.setValue("true");
    productL3ListingRequest.setSuspended(true);
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(new InventoryDetailInfoResponseV2DTO()), pageMetaData, REQUEST_ID));
    Mockito.when(productLevel3Service.getProductSuspensionHistoryByProductSkus(anyString(), any()))
        .thenReturn(Arrays.asList(productSuspensionHistoryResponse));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(campaignPriceResponse);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(productLevel3Service).getProductSuspensionHistoryByProductSkus(anyString(), any());
  }

  @Test
  public void getProductL3List1Test() throws Exception {
    productSystemParameter.setValue("false");
    productL3SummaryResponse.setVariantCount(Constants.NO_VARIANTS_COUNT);
    productL3SummaryResponse.setItemL4SummaryResponse(itemL4SummaryResponse);
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(new InventoryDetailInfoResponseV2DTO()), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(new CampaignPriceResponse());
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.SHOW_L3_STOCK);
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(inventoryOutbound).findDetailByWebMerchantCodeAndWebItemSku(any(), any());
    verify(campaignOutbound).getCampaignPriceInfoV2(any());
  }

  @Test
  public void getProductL3List2Test() throws Exception {
    productSystemParameter.setValue("false");
    productL3SummaryResponse.setVariantCount(Constants.NO_VARIANTS_COUNT);
    productL3SummaryResponse.setItemL4SummaryResponse(itemL4SummaryResponse);
    priceDTO.setListOfDiscountPrices(Arrays.asList(discountPriceDTO));
    itemL4SummaryResponse.setPrice(new HashSet<>(Arrays.asList(priceDTO)));
    itemL4SummaryResponse.setMasterDataItemImages(Arrays.asList(new MasterDataItemImageDTO()));
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(inventoryDetailInfoResponseV2DTO), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(campaignPriceResponse);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.SHOW_L3_STOCK);
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(inventoryOutbound).findDetailByWebMerchantCodeAndWebItemSku(any(), any());
    verify(campaignOutbound).getCampaignPriceInfoV2(any());
  }

  @Test
  public void getProductL3List4Test() throws Exception {
    productSystemParameter.setValue("false");
    productL3SummaryResponse.setVariantCount(Constants.NO_VARIANTS_COUNT);
    productL3SummaryResponse.setItemL4SummaryResponse(itemL4SummaryResponse);
    productL3SummaryResponse.setProductScore(new ProductScoreResponse());
    priceDTO.setListOfDiscountPrices(Arrays.asList(discountPriceDTO));
    itemL4SummaryResponse.setPrice(new HashSet<>(Arrays.asList(priceDTO)));
    itemL4SummaryResponse.setMasterDataItemImages(Arrays.asList(new MasterDataItemImageDTO()));
    itemL4SummaryResponse.setActivePromoBundlings(new HashSet<>(Arrays.asList(TEXT)));
    inventoryDetailInfoResponseV2DTO.setWarehouseInventoryResponseList(Arrays.asList(warehouseInventoryResponseDTO));
    campaignPriceSkuResponse.setLockPriceUpdate(true);
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(Arrays.asList(productL3SummaryResponse), pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(inventoryDetailInfoResponseV2DTO), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(campaignPriceResponse);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
    verify(productOutbound).fetchCategoryNamesResponse(any(), eq(0) ,eq(50));
    verify(productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.SHOW_L3_STOCK);
    verify(applicationProperties).getProductDetailPageUrlPrefix();
    verify(inventoryOutbound).findDetailByWebMerchantCodeAndWebItemSku(any(), any());
    verify(campaignOutbound).getCampaignPriceInfoV2(any());
  }

  @Test
  public void getProductL3List5Test() throws Exception {
    productSystemParameter.setValue("true");
    when(xProductOutbound.filterSummaryL3(eq(PAGE),
        eq(SIZE), any())).thenReturn(new GdnRestListResponse(null, pageMetaData, REQUEST_ID));
    when(productOutbound.fetchCategoryNamesResponse(any(), eq(0) ,eq(50))).thenReturn(categoryNamesResponse);
    Mockito.when(this.productSystemParameterService.findByStoreIdAndVariable(STORE_ID,
        Constants.SHOW_L3_STOCK)).thenReturn(productSystemParameter);
    Mockito.when(applicationProperties.getInventoryApiBatchSize()).thenReturn(SIZE);
    Mockito.when(inventoryOutbound.findDetailByWebProductSkus(any(), any()))
        .thenReturn(new GdnRestListResponse<>(Arrays.asList(inventoryStockInfoDTO), pageMetaData, REQUEST_ID));
    Mockito.when(inventoryOutbound.findDetailByWebMerchantCodeAndWebItemSku(any(), any()))
        .thenReturn(new GdnRestListResponse(Arrays.asList(new InventoryDetailInfoResponseV2DTO()), pageMetaData, REQUEST_ID));
    Mockito.when(campaignOutbound.getCampaignPriceInfoV2(any())).thenReturn(campaignPriceResponse);
    productLevel3V2Service.getProductL3List(STORE_ID, productL3ListingRequest, PAGE, SIZE);
    verify(xProductOutbound).filterSummaryL3(eq(PAGE), eq(SIZE), any());
  }

  private ProductL3Response generateProductL3Response() throws Exception {
    ProductL3Response productData = new ProductL3Response();
    productData.setVersion(10L);
    productData.setItemSkus(Arrays.asList(ITEM_SKU));
    productData.setProductEditable(true);
    productData.setProductSku(PRODUCT_SKU);
    productData.setProductCode(PRODUCT_CODE);
    productData.setProductType(ProductType.REGULAR);
    productData.setSettlementType(SETTLEMENT_TYPE);
    productData.setMerchantCode(DEFAULT_BUSINESS_PARTNER_CODE);
    productData.setSynchronized(true);
    productData.setDefaultItemSku(ITEM_SKU);
    productData.setMasterCatalog(new MasterCatalogDTO());
    productData.getMasterCatalog().setCategory(new CategoryDTO());
    productData.getMasterCatalog().getCategory().setCategoryCode(CATEGORY_CODE);
    productData.setMasterDataProduct(new MasterDataProductDTO());
    productData.getMasterDataProduct().setDescription(DEFAULT_DESCRIPTION);
    productData.getMasterDataProduct().setProductName(DEFAULT_PRODUCT_NAME);
    productData.getMasterDataProduct().setUniqueSellingPoint(DEFAULT_USP);
    productData.getMasterDataProduct().setBrand(DEFAULT_BRAND);
    productData.getMasterDataProduct()
      .setMasterDataProductAttributes(new ArrayList<MasterDataProductAttributeDTO>());
    productData.getMasterDataProduct().getMasterDataProductAttributes()
      .add(new MasterDataProductAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes()
      .add(new MasterDataProductAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes()
      .add(new MasterDataProductAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes()
      .add(new MasterDataProductAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .setMasterDataAttribute(new MasterDataAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setAttributeType(MasterDataAttributeType.DESCRIPTIVE_ATTRIBUTE);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setVariantCreation(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setAttributeCode(DEFAULT_ATTRIBUTE_CODE_1);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setBasicView(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setMandatory(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataAttribute().setSkuValue(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .setMasterDataProductAttributeValues(new ArrayList<MasterDataProductAttributeValueDTO>());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(0)
      .getMasterDataProductAttributeValues().add(new MasterDataProductAttributeValueDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .setMasterDataAttribute(new MasterDataAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setAttributeType(MasterDataAttributeType.DESCRIPTIVE_ATTRIBUTE);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setAttributeCode(DEFAULT_ATTRIBUTE_CODE_4);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setBasicView(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setMandatory(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setSkuValue(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .setMasterDataProductAttributeValues(new ArrayList<MasterDataProductAttributeValueDTO>());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(1)
      .getMasterDataAttribute().setSkuValue(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .setMasterDataAttribute(new MasterDataAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataAttribute().setAttributeType(MasterDataAttributeType.PREDEFINED_ATTRIBUTE);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataAttribute().setAttributeCode(DEFAULT_ATTRIBUTE_CODE_2);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataAttribute().setBasicView(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataAttribute().setMandatory(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataAttribute().setSkuValue(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .setMasterDataProductAttributeValues(new ArrayList<MasterDataProductAttributeValueDTO>());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(2)
      .getMasterDataProductAttributeValues().add(new MasterDataProductAttributeValueDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .setMasterDataAttribute(new MasterDataAttributeDTO());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataAttribute().setAttributeType(MasterDataAttributeType.DEFINING_ATTRIBUTE);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataAttribute().setAttributeCode(DEFAULT_ATTRIBUTE_CODE_3);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataAttribute().setBasicView(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataAttribute().setMandatory(true);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataAttribute().setSkuValue(false);
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .setMasterDataProductAttributeValues(new ArrayList<MasterDataProductAttributeValueDTO>());
    productData.getMasterDataProduct().getMasterDataProductAttributes().get(3)
      .getMasterDataProductAttributeValues().add(new MasterDataProductAttributeValueDTO());
    productData.setProductSpecialAttributes(new ArrayList<ProductSpecialAttributeDTO>());
    productData.getProductSpecialAttributes().add(new ProductSpecialAttributeDTO());
    productData.getProductSpecialAttributes().get(0).setAttributeCode(DEFAULT_ATTRIBUTE_CODE_4);
    productData.setDescriptiveAttributes(new ArrayList<ProductAttributeDetailDTO>());
    productData.getDescriptiveAttributes().add(new ProductAttributeDetailDTO());
    productData.getDescriptiveAttributes().add(new ProductAttributeDetailDTO());
    productData.getDescriptiveAttributes().get(0).setAttributeCode(DEFAULT_ATTRIBUTE_CODE_1);
    productData.getDescriptiveAttributes().get(1).setAttributeCode(DEFAULT_ATTRIBUTE_CODE_2);
    productData.setDefiningAttributes(new ArrayList<ProductAttributeDTO>());
    productData.getDefiningAttributes().add(new ProductAttributeDTO());
    productData.getDefiningAttributes().get(0)
      .setProductAttributeDetails(new ArrayList<ProductAttributeDetailDTO>());
    productData.getDefiningAttributes().get(0).getProductAttributeDetails()
      .add(new ProductAttributeDetailDTO());
    productData.getDefiningAttributes().get(0).getProductAttributeDetails().get(0)
      .setAttributeCode(DEFAULT_ATTRIBUTE_CODE_3);
    productData.getMasterDataProduct()
      .setMasterDataProductImages(new ArrayList<MasterDataProductImageDTO>());
    productData.getMasterDataProduct().getMasterDataProductImages()
      .add(new MasterDataProductImageDTO(true, null, PRODUCT_CODE, 0));
    productData.setForceReview(true);
    productData
      .setProductScore(new ProductScoreResponse(10, 10, 10, 10, 10, 10, 10, 10, 10, 1, 90));
    productData.setPickupPointCodes(Arrays.asList(PICKUP_POINT_CODE, PICKUP_POINT_CODE_1));
    return productData;
  }

  private ProductDetailResponse generateProductDetailResponse() {
    ProductDetailResponse product = new ProductDetailResponse();
    product.setId(UUID.randomUUID().toString());
    product.setProductCode(PRODUCT_CODE);
    product.setProductItemResponses(new HashSet<ProductItemResponse>());
    product.setStoreId(STORE_ID);
    ProductItemResponse productItem = new ProductItemResponse();
    productItem.setId(UUID.randomUUID().toString());
    productItem.setSkuCode(PRODUCT_SKU);
    ProductItemResponse productItem2 = new ProductItemResponse();
    productItem2.setId(UUID.randomUUID().toString());
    productItem2.setSkuCode(PRODUCT_SKU_2);
    ProductItemResponse productItem3 = new ProductItemResponse();
    productItem3.setId(UUID.randomUUID().toString());
    productItem3.setSkuCode(PRODUCT_SKU_3);
    product.getProductItemResponses().add(productItem);
    product.getProductItemResponses().add(productItem2);
    product.getProductItemResponses().add(productItem3);
    return product;
  }

  private ProfileResponse getProfileResponse() {
    ProfileResponse businessPartner = new ProfileResponse();
    PickupPointDTO pickupPointDTO = new PickupPointDTO();
    pickupPointDTO.setCode(PICKUP_POINT_CODE);
    pickupPointDTO.setOriginId(STORE_ID);
    businessPartner.setPickupPoints(Arrays.asList(pickupPointDTO));
    CompanyDTO dto = new CompanyDTO();
    dto.setInternationalFlag(Boolean.TRUE);
    businessPartner.setCompany(dto);
    businessPartner.getCompany().setInternationalFlag(true);
    businessPartner.getCompany().setMerchantDeliveryType(PICKUP);
    businessPartner.getCompany().setInventoryFulfillment(INVENTORY_FULFILLMENT_BLIBLI);
    return businessPartner;
  }

  @Test
  public void takeDownProductTest() throws Exception {
    ProductL3Response productL3Response = new ProductL3Response();
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(productL3Response,CLIENT_ID));
    productLevel3V2Service.takeDownProduct(STORE_ID, PRODUCT_SKU, DEFAULT_PRODUCT_NAME);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3Service)
      .takeDownOrReactivateProduct(Mockito.anyString(), Mockito.anyString(), anyBoolean(),
        Mockito.anyString(), Mockito.any(ProductL3Response.class));
  }

  @Test
  public void toProductVariantUpdateRequest_AllEmptyTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "overrideOnlineWithB2CFlag", false);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductVariantUpdateRequest request =
      productLevel3V2Service.toProductVariantUpdateRequest(productL3UpdateRequest, new EditProductResponse());
    Assertions.assertEquals(request.getBusinessPartnerCode(),DEFAULT_BUSINESS_PARTNER_CODE);
  }

  @Test
  public void toProductVariantUpdateRequestTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "overrideOnlineWithB2CFlag", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest
      .setProductItems(Arrays.asList(new ProductVariantPriceStockAndImagesRequest()));
    productL3UpdateRequest.getProductItems().get(0).setModifiedItemPickupPoints(
      Arrays.asList(new com.gda.mta.product.dto.ItemPickupPointRequest()));
    productL3UpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setPrice(1000D);
    productL3UpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setBuyable(true);
    productL3UpdateRequest.getProductItems().get(0).getModifiedItemPickupPoints().get(0)
      .setItemSku(ITEM_SKU);
    productL3UpdateRequest
      .setCommonImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productL3UpdateRequest
      .setAddPickupPoints(Arrays.asList(new com.gda.mta.product.dto.ItemPickupPointRequest()));
    productL3UpdateRequest.setDeletePickupPoints(Arrays.asList(new PickupPointDeleteRequest()));
    productL3UpdateRequest.setB2cActivated(false);
    ProductVariantUpdateRequest request =
      productLevel3V2Service.toProductVariantUpdateRequest(productL3UpdateRequest, new EditProductResponse());
    Double price = request.getProductItems().get(0).getModifiedItemPickupPoints().get(0).getPrice();
    boolean buyableFlag =
      request.getProductItems().get(0).getModifiedItemPickupPoints().get(0).isBuyable();
    Assertions.assertEquals(request.getBusinessPartnerCode(), DEFAULT_BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(buyableFlag, true);
  }

  @Test
  public void editPriceStockVariantsInfoTest() throws Exception {
    ItemsPriceStockImagesUpdateResponse response = new ItemsPriceStockImagesUpdateResponse();
    ProductLevel3 productLevel3 = new ProductLevel3();
    productLevel3.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.when(productService
        .editPriceStockVariantsInfo(STORE_ID, productLevel3, new ProductVariantUpdateRequest(),
          editResponse, true))
        .thenReturn(response);
    productLevel3V2Service
        .editPriceStockVariantsInfo(STORE_ID, productLevel3, new ProductVariantUpdateRequest(), editResponse);
    Mockito.verify(productService)
        .editPriceStockVariantsInfo(STORE_ID, productLevel3, new ProductVariantUpdateRequest(),
          editResponse, true);
  }

  @Test
  public void quickEditPatchingTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    System.out.println(quickEditV2Request.getPickupPointCode());
  }

  @Test
  public void patchQuickEditV2ApiErrorCodeTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    quickEditV2Request.setItemSku(ITEM_SKU + "1");
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    itemPickupPointRequest.setItemSku(ITEM_SKU + "1");
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    ProductL3Response savedProductData1 = generateProductL3Response();
    quickEditV2Request.setVersion(11L);
    savedProductData1.setMarkForDelete(true);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData1, REQUEST_ID));
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.INVALID_DATA_INPUT, response.getApiErrorCode());
  }

  @Test
  public void patchQuickEditV2ApiFreeSampleAndOfflineStatus() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
        DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
            .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setFreeSample(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
        CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
            UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
                .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
        CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
            .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
        .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    try {
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ApiErrorCode.FREE_SAMPLE_CANNOT_BE_SET.getDesc()));
    }
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void patchQuickEditV2ApiFreeSampleAndOfflineStatusAndNotInstore() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
        DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
            .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(false);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setFreeSample(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
        CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
            UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
                .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
        CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
            .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
        .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    try {
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ApiErrorCode.FREE_SAMPLE_CANNOT_BE_SET.getDesc()));
    }
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void patchQuickEditV2ApiFreeSampleAndOfflineStatusAndNotInstoreAndCncOffline() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
        DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
            .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(false);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setFreeSample(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
        CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
            UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
                .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
        CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
            .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
        .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    Mockito.verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void patchQuickEditV2RejectedProductApiErrorCodeTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    quickEditV2Request.setItemSku(ITEM_SKU);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    productCollection.setState(WorkflowStates.DELETED.getValue());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(
            productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    ProductL3Response savedProductData1 = generateProductL3Response();
    quickEditV2Request.setVersion(11L);
    savedProductData1.setMarkForDelete(false);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData1, REQUEST_ID));
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.ITEM_IS_REJECTED, response.getApiErrorCode());
  }


  @Test
  public void patchQuickEditV2RejectedProductNeedCorrectionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);

    ProductL3Response productL3Response = generateProductL3Response();
    quickEditV2Request.setItemSku(ITEM_SKU);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    productCollection.setState(WorkflowStates.NEED_CORRECTION.getValue());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    ProductL3Response savedProductData1 = generateProductL3Response();
    quickEditV2Request.setVersion(11L);
    savedProductData1.setMarkForDelete(false);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData1, REQUEST_ID));
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.ITEM_IS_IN_NEED_CORRECTION, response.getApiErrorCode());
  }

  @Test
  public void patchQuickEditV2_ArchivedProductApiErrorCodeTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    quickEditV2Request.setItemSku(ITEM_SKU);
    productL3Response.setArchived(true);
    productL3Response.setTakenDown(false);
    productL3Response.setSuspended(false);
    productL3Response.setMarkForDelete(true);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    productCollection.setState(WorkflowStates.NEED_CORRECTION.getValue());
    Mockito.when(
            productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    ProductL3Response savedProductData1 = generateProductL3Response();
    quickEditV2Request.setVersion(11L);
    savedProductData1.setMarkForDelete(true);
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.PRODUCT_DELETED_STATE, response.getApiErrorCode());
  }

  @Test
  public void patchQuickEditV2_ArchivedItemApiErrorCodeTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    quickEditV2Request.setItemSku(ITEM_SKU);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    l3Response.getValue().setArchived(true);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    ProductL3Response savedProductData1 = generateProductL3Response();
    quickEditV2Request.setVersion(11L);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductIdAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.ITEM_IS_ARCHIVED, response.getApiErrorCode());
  }

  @Test
  public void patchQuickEditV2_missingItemPickupPointTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(true);
    productL3Response.setArchived(true);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(true);
    savedProductData1.setMarkForDelete(false);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(new GdnRestSingleResponse<>(savedProductData1, REQUEST_ID));
    Mockito.when(
            productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound)
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Assertions.assertEquals(ApiErrorCode.ITEM_IS_SUSPENDED.getCode(),
      response.getApiErrorCode().getCode());
  }

  @Test
  public void patchQuickEditV2Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    ItemPriceStockQuickUpdateResponse response =
      this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(Collections.singletonMap(PRODUCT_SKU, true));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        itemPickupPointQuickEditRequestlistArgumentCaptor.capture());
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
      .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3))
      .findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(productLevel3SummaryArgumentCaptor.capture());;
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
  }

  @Test
  public void patchQuickEditV2VersionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProducts() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setMissingFields(Set.of(Constants.DIMENSIONS_MISSING));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct5() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct6() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(Constants.ALL)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(null)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct7() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setProductType(null);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(Constants.ALL)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(
        Mockito.anyList(), eq(null)))
      .thenReturn(Collections.singletonList(itemSummaryListResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(1.0);
    productDetailResponse.setHeight(1.0);
    productDetailResponse.setWidth(1.0);
    productDetailResponse.setLength(1.0);
    productDetailResponse.setShippingWeight(1.0);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("test".getBytes());
    productDetailResponse.setWeight(1.0);
    productDetailResponse.setHeight(1.0);
    productDetailResponse.setWidth(1.0);
    productDetailResponse.setLength(1.0);
    productDetailResponse.setShippingWeight(1.0);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct3() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("test".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(1.0);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProduct4() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("test".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(1.0);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void patchQuickEditV2VersionTestForInstoreProductWithSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "instore2FlowSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    itemSummaryListResponse.setVersion(null);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setDeltaStock(3);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setVersion(-2L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setVersion(Long.MAX_VALUE);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    ProductItemResponse productItemResponse = new ProductItemResponse();
    productItemResponse.setId(ID);
    productItemResponse.setSkuCode(ITEM_CODE);
    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("test".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(1.0);
    productDetailResponse.setProductItemResponses(ImmutableSet.of(productItemResponse));
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                productLevel3QuickEditV2Request);
      });
    }
    finally {
      verify(xProductOutbound)
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_offlineCncStatusTestForInstoreProduct() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    quickEditV2Request.setOff2OnActiveFlag(true);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);

    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      this.productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    }
    finally {
      verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
      verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
          Mockito.anyList());
      verify(xProductOutbound)
        .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
      verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
      verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          false);
      verify(this.updatedProductHistoryService)
        .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
          UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
          String.valueOf(true), false, Constants.HYPHEN);
      verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      verify(this.pickupPointRepository, times(2))
        .findByPickupPointCode(PICKUP_POINT_CODE);
      verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
      verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));;
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    }
  }
  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_offlineCncStatusTestForInstoreProduct1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    quickEditV2Request.setOff2OnActiveFlag(true);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMissingFields(Set.of(Constants.DESCRIPTION_MISSING));
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);

    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        this.productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    }
    finally {
      verify(xProductOutbound, times(1))
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
      verify(xProductOutbound, times(1))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    }
  }
  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_offlineCncStatusTestForInstoreSwitchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service,"instore2FlowSwitch", false);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    quickEditV2Request.setOff2OnActiveFlag(true);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
      .build());
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
      .thenReturn(pickupPointResponseList);

    ProductDetailResponse productDetailResponse = new ProductDetailResponse();
    productDetailResponse.setDescription("".getBytes());
    productDetailResponse.setWeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setHeight(Constants.DOUBLE_ZERO);
    productDetailResponse.setWidth(Constants.DOUBLE_ZERO);
    productDetailResponse.setLength(Constants.DOUBLE_ZERO);
    productDetailResponse.setShippingWeight(Constants.DOUBLE_ZERO);
    Mockito.when(productRepository.findProductDetailByProductCode(PRODUCT_CODE))
      .thenReturn(productDetailResponse);
    Mockito.when(
        productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
      .thenReturn(productCollection);
    try {
      this.productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    }
    finally {
      verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
      verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
      verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
          Mockito.anyList());
      verify(xProductOutbound)
        .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
      verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
      verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          false);
      verify(this.updatedProductHistoryService)
        .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
          UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
          String.valueOf(true), false, Constants.HYPHEN);
      verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      verify(this.pickupPointRepository, times(2))
        .findByPickupPointCode(PICKUP_POINT_CODE);
      verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
      verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));;
    }
  }
  @Test
  public void patchQuickEditV2_missingItemPickupPointDeleteTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    productL3Response.setSuspended(true);
    productL3Response.setMarkForDelete(true);
    productL3Response.setVersion(1L);
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setVersion(3L);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(new GdnRestSingleResponse<>(productL3Response, REQUEST_ID));
    Mockito.when(
            productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    ItemPriceStockQuickUpdateResponse response =
        this.productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
    verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
  }

  @Test
  public void patchQuickEditV2_VersionMismatchTest() throws Exception {
    itemSummaryListResponse.setVersion(3L);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    }
  }

  @Test
  public void quickEditPatching_updateOnFreeSample_online() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setItemSkus(Collections.singletonList(ITEM_SKU));
    quickEditV2Request.setItemSku(ITEM_SKU);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    itemSummaryListResponse.setVersion(null);
    itemSummaryListResponse.setFreeSample(true);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    }
  }

  @Test
  public void quickEditPatching_updateOnFreeSampleTest() throws Exception {
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setItemSkus(Collections.singletonList(ITEM_SKU));
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    itemSummaryListResponse.setVersion(null);
    itemSummaryListResponse.setFreeSample(false);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    }
  }

  @Test
  public void quickEditPatching_updateOnFreeSample_off2OnFlag() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    itemSummaryListResponse.setFreeSample(true);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.TRUE);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.B2B);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(productLevel3InventoryService)
          .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2))
        .findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));;
    }
  }


  @Test
  public void quickEditPatchingInvalidStatusUpdateRequestForBopis() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCategoryRestrictionEnabled", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.TRUE);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    itemSummaryListResponse.setDimensionsMissing(true);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
          .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
              Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
          .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
              newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
          .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
      ;
    }
  }

  @Test
  public void quickEditPatchingInvalidStatusUpdateRequestForBopisDimensionMissingTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCategoryRestrictionEnabled", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.TRUE);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    itemSummaryListResponse.setDimensionsMissing(true);
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
          .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
              Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
          .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
              newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
          .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    }
  }

  @Test
  public void quickEditPatchingInvalidCncUpdateRequestForBopis() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.TRUE);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setCncActive(true);
    itemSummaryListResponse.setDimensionsMissing(true);
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
          .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
              Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
          .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
              newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
          .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
      ;
    }
  }

  @Test
  public void quickEditPatchingInvalidCncUpdateRequestForBopis_cncSwitchOn() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.TRUE);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setCncStatus(ProductLevel3Status.ONLINE);
    itemSummaryListResponse.setDimensionsMissing(true);
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
          .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
              Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
          .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
              newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
          .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    }
  }

  @Test
  public void quickEditPatching_updateOnline() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    itemSummaryListResponse.setFreeSample(true);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setVersion(null);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
      });
    } finally {
      Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      Mockito.verify(productLevel3InventoryService)
          .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2))
        .findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    }
  }

  @Test()
  public void UpdateStockAndPickupPointForL5ErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    ItemPriceStockQuickUpdateResponse response = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(null);
    priceRequestUpdate.setPrice(null);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemSummaryListResponse.setFreeSample(false);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.doThrow(new Exception(INVENTORY_UPDATE_FAILED)).when(productLevel3InventoryService)
      .updateStockForItemPickupPoint(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyInt(), Mockito.anyInt(), Mockito.anyBoolean());
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    try {
      response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    } finally {
      Mockito.verify(productLevel3InventoryService)
          .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
      Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
      Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          false);
      Mockito.verify(xProductOutbound)
        .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
      Mockito.verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
          Mockito.anyList());
      Mockito.verify(this.updatedProductHistoryService)
        .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
          UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
          String.valueOf(true), false, Constants.HYPHEN);
      Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
      Mockito.verify(this.pickupPointRepository, times(3))
        .findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
      Assertions.assertNotNull(response);
      verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    }
  }

  @Test()
  public void quickEditPatching_PriceUpdateErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    ItemPriceStockQuickUpdateResponse response = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setOff2OnActiveFlag(Boolean.FALSE);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
      Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
      new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Assertions.assertNotNull(response);
    Assertions.assertEquals(PRICE_UPDATE_FAILED,
      response.getVariantsErrorList().get(0).getErrorMessage());
  }

  @Test()
  public void quickEditPatching_Off2OnFlagErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    ItemPriceStockQuickUpdateResponse response = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.doThrow(new RuntimeException(OFF2_ON_FLAG_UPDATE_ERROR))
      .when(updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, StringUtils.EMPTY);
    response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Assertions.assertNotNull(response);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void quickEditPatching_wholeSaleActivatedErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    ItemPriceStockQuickUpdateResponse response = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.doThrow(new RuntimeException("WholeUpdate Error ")).when(productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, null)).thenReturn(true);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Assertions.assertNotNull(response);
    Assertions.assertTrue(StringUtils.contains(response.getVariantsErrorList().get(0).getErrorMessage(),
      "WholeUpdate Error"));
  }

  @Test
  public void quickEditPatching_updateL5ErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ItemPriceStockQuickUpdateResponse response = null;
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    Mockito.doThrow(new RuntimeException()).when(productNotificationService)
      .sendNotificationForProductStatus(Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE_1).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.productLevel3InventoryService,times(3)).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
      Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Assertions.assertNotNull(response);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void patchQuickEditV2_teaserStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    quickEditV2Request.setStatus(ProductLevel3Status.TEASER);
    ItemPriceStockQuickUpdateResponse response = null;
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setPrice(NEW_NORMAL_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(productNotificationService)
      .sendNotificationForProductStatus(MERCHANT_CODE, ITEM_NAME,
        quickEditV2Request.getStatus().name());
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.productLevel3InventoryService, times(3)).findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void patchQuickEditV2_partialInventoryUpdateTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request quickEditV2InventoryRequest = new QuickEditV2Request();
    quickEditV2InventoryRequest.setDeltaStock(2);
    quickEditV2InventoryRequest.setItemSku(ITEM_SKU);
    quickEditV2InventoryRequest.setPickupPointCode(PICKUP_POINT_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    v2Request.setQuickEditV2Requests(Collections.singletonList(quickEditV2InventoryRequest));
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID,
      PRODUCT_CODE)).thenReturn(productCollection);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setPrice(2.0);
    productLevel3PriceRequest1.setSalePrice(4.0);
    v2Request.getQuickEditV2Requests().get(0).setPrice(productLevel3PriceRequest1);
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound).getItemPickupPointSummary(
      Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID
      , PRODUCT_CODE);
      }


  @Test
  public void patchQuickEditV2_EmptyL5ReponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request quickEditV2InventoryRequest = new QuickEditV2Request();
    quickEditV2InventoryRequest.setDeltaStock(2);
    quickEditV2InventoryRequest.setItemSku(ITEM_SKU);
    quickEditV2InventoryRequest.setPickupPointCode(PICKUP_POINT_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    v2Request.setQuickEditV2Requests(Collections.singletonList(quickEditV2InventoryRequest));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    when(xProductOutbound.getItemPickupPointSummary(
      Collections.singletonList(itemPickupPointRequest), Constants.ALL)).thenReturn(Collections.emptyList());
    Mockito.when(
      productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID,
      PRODUCT_CODE)).thenReturn(productCollection);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setPrice(2.0);
    productLevel3PriceRequest1.setSalePrice(4.0);
    v2Request.getQuickEditV2Requests().get(0).setPrice(productLevel3PriceRequest1);
    try {
      Assertions.assertThrows(ApiIncorrectInputDataException.class, () -> {
        ItemPriceStockQuickUpdateResponse response =
            productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
      });
    }
    finally {
      verify(xProductOutbound).getItemPickupPointSummary(
        Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    }
  }


  @Test
  public void patchQuickEditV2_partialWholeSale() throws Exception {
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request quickEditV2InventoryRequest = new QuickEditV2Request();
    Map<Integer, Double> map = new HashMap();
    map.put(100, 10.0);
    wholesalePriceSkuResponse = new WholesalePriceSkuResponse();
    wholesalePriceSkuResponse.setItemSku(ITEM_SKU);
    wholesalePriceSkuResponse.setWholesaleRules(map);
    quickEditV2InventoryRequest.setWholeSaleActivated(true);
    quickEditV2InventoryRequest.setItemSku(ITEM_SKU);
    quickEditV2InventoryRequest.setPrice(null);
    quickEditV2InventoryRequest.setPickupPointCode(PICKUP_POINT_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setVersion(null);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    v2Request.setQuickEditV2Requests(Collections.singletonList(quickEditV2InventoryRequest));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
        Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(wholesalePriceSkuResponse));
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(xProductOutbound, times(2)).getItemPickupPointSummary(
      Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2InventoryRequest, itemSummaryListResponse,
        true);
    verify(wholesaleValidationUtil).validateWholesaleConfigOnUpdate(eq(CATEGORY_CODE),
      Mockito.anyList(), Mockito.any(ItemRequest.class),
      eq(MIN_PRICE), eq(ITEM_SKU), eq(true), eq(null));
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Assertions.assertTrue(CollectionUtils.isEmpty(response.getVariantsErrorList()));
  }

  @Test
  public void patchQuickEditV2_partialStatusChangeTest() throws Exception {
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request editV2Request = new QuickEditV2Request();
    editV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    editV2Request.setItemSku(ITEM_SKU);
    editV2Request.setStatus(ProductLevel3Status.ONLINE);
    ProductLevel3PriceRequest priceRequest = new ProductLevel3PriceRequest();
    priceRequest.setPrice(NEW_SALE_PRICE);
    priceRequest.setSalePrice(2000.0);
    priceRequest.setChannelId(DEFAULT_CHANNEL);
    editV2Request.setPrice(priceRequest);
    itemSummaryListResponse.setItemSku(ITEM_SKU);
    itemSummaryListResponse.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setProductSku(PRODUCT_SKU);
    itemSummaryListResponse.setVersion(0L);
    itemSummaryListResponse.setFreeSample(false);
    itemSummaryListResponse.setMerchantCode(MERCHANT_CODE);
    itemSummaryListResponse.setMasterCategoryCode(CATEGORY_CODE);
    itemSummaryListResponse.setProductType(ProductType.BIG_PRODUCT);
    itemSummaryListResponse.setItemName(ITEM_NAME);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemViewConfigDTO.setBuyable(true);
    itemViewConfigDTO.setDiscoverable(true);
    itemViewConfigDTO.setChannel(DEFAULT_CHANNEL);
    itemSummaryListResponse.setItemViewConfigs(Collections.singleton(itemViewConfigDTO));
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    v2Request.setQuickEditV2Requests(Collections.singletonList(editV2Request));
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(editV2Request,
        itemSummaryListResponse, null)).thenReturn(true);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductIdAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    ItemPriceStockQuickUpdateResponse response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound)
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCodeAndMarkForDeleteFalse(STORE_ID, PRODUCT_CODE);
    }

  @Test
  public void patchQuickEditV2_partialPriceUpdateTest() throws Exception {
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request editV2Request = new QuickEditV2Request();
    editV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    editV2Request.setItemSku(ITEM_SKU);
    editV2Request.setStatus(ProductLevel3Status.ONLINE);
    ProductLevel3PriceRequest priceRequest = new ProductLevel3PriceRequest();
    priceRequest.setPrice(NEW_NORMAL_PRICE);
    priceRequest.setSalePrice(NEW_SALE_PRICE);
    priceRequest.setChannelId(DEFAULT_CHANNEL);
    editV2Request.setPrice(priceRequest);
    itemSummaryListResponse.setItemSku(ITEM_SKU);
    itemSummaryListResponse.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setProductSku(PRODUCT_SKU);
    itemSummaryListResponse.setVersion(0L);
    itemSummaryListResponse.setFreeSample(false);
    itemSummaryListResponse.setMerchantCode(MERCHANT_CODE);
    itemSummaryListResponse.setMasterCategoryCode(CATEGORY_CODE);
    itemSummaryListResponse.setProductType(ProductType.BIG_PRODUCT);
    itemSummaryListResponse.setItemName(ITEM_NAME);
    itemSummaryListResponse.setWholesalePriceActivated(false);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceRequest.setSalePrice(null);
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    itemViewConfigDTO.setBuyable(true);
    itemViewConfigDTO.setDiscoverable(true);
    itemViewConfigDTO.setChannel(DEFAULT_CHANNEL);
    itemSummaryListResponse.setItemViewConfigs(Collections.singleton(itemViewConfigDTO));
    v2Request.setQuickEditV2Requests(Collections.singletonList(editV2Request));
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setWholesalePriceActivated(true);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(editV2Request,
      itemSummaryListResponse,false)).thenReturn(true);
    ItemPriceStockQuickUpdateResponse response =  productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(editV2Request, itemSummaryListResponse, false);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Assertions.assertEquals(null,response.getApiErrorCode());
  }

  @Test
  public void productQuickEditV2_NullItemResponseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductLevel3QuickEditV2Request v2Request = new ProductLevel3QuickEditV2Request();
    QuickEditV2Request quickEditV2InventoryRequest = new QuickEditV2Request();
    quickEditV2InventoryRequest.setDeltaStock(2);
    quickEditV2InventoryRequest.setItemSku(ITEM_SKU);
    quickEditV2InventoryRequest.setPickupPointCode(PICKUP_POINT_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.setVersion(null);
    this.itemSummaryListResponse = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    v2Request.setQuickEditV2Requests(Collections.singletonList(quickEditV2InventoryRequest));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, v2Request);
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2))
      .findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test
  public void quickEditPatchingWithNoStatusChange() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setStatus(null);
    productL3Response.setVersion(null);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    priceRequestUpdate.setPrice(NEW_SALE_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU)
          .pickUpPointCode(PICKUP_POINT_CODE).sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(Collections.EMPTY_MAP)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound, times(3))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    Mockito.verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    Assertions.assertTrue(CollectionUtils.isEmpty(response.getVariantsErrorList()));
    Assertions.assertEquals(null,response.getApiErrorCode());
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabled() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
      , true);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(null);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
      Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
      new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null);
    Mockito.verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabledForInstoreProduct() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
      , true);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(null);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
      Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
      new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    ItemPriceStockQuickUpdateResponse response =
      productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null);
    Mockito.verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test
  public void patchQuickEditV2_syncStock_with_faasActivated() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
            , true);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
            new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(true);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
            Collections.singletonList(quickEditV2Request));
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, true);
    profileResponse.setFlags(flags);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
            .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
            Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
            new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    try {
      ItemPriceStockQuickUpdateResponse response =
              productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
                      productLevel3QuickEditV2Request);
    } catch(ApplicationRuntimeException e) {
      Assertions.assertEquals(e.getErrorMessage(), ErrorCategory.VALIDATION.getMessage() + ApiErrorCode.FAAS_SELLER_SYNC_STOCK_CHANGE_ERROR.getDesc());
      Assertions.assertEquals(ErrorCategory.VALIDATION, e.getErrorCodes());
    } finally {
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(xProductOutbound, times(3))
              .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      Mockito.verify(this.productLevel3InventoryService, times(3))
              .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
                      Mockito.anyList());
      Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
      verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          null);
      Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    }
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabledInvalidBopisStatusUpdate() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
        , true);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(null);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
        Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
        new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    ItemPriceStockQuickUpdateResponse response =
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            null);
    Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabledValidOldBuyableScheduleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
        , true);
    ItemSummaryListResponse itemSummaryListResponse1 = new ItemSummaryListResponse();
    BeanUtils.copyProperties(itemSummaryListResponse, itemSummaryListResponse1);
    ItemBuyableScheduleDTO itemBuyableScheduleDTO = new ItemBuyableScheduleDTO();
    itemBuyableScheduleDTO.setStartDateTime(new Date());
    itemBuyableScheduleDTO.setEndDateTime(new Date());
    itemViewConfigDTO.setItemBuyableSchedules(itemBuyableScheduleDTO);
    ItemDiscoverableScheduleDTO itemDiscoverableScheduleDTO = new ItemDiscoverableScheduleDTO();
    itemDiscoverableScheduleDTO.setStartDateTime(new Date());
    itemDiscoverableScheduleDTO.setEndDateTime(new Date());
    itemViewConfigDTO.setItemDiscoverableSchedules(itemDiscoverableScheduleDTO);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(null);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
        Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
        new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    ItemViewConfigDTO next = new ItemViewConfigDTO();
    next = itemSummaryListResponse1.getItemViewConfigs().iterator().next();
    next.setItemBuyableSchedules(null);
    itemSummaryListResponse1.setItemViewConfigs(Set.of(next));
    itemSummaryListResponse.setItemViewConfigs(Set.of(itemViewConfigDTO));
    Mockito.when(this.xProductOutbound.getItemPickupPointSummary(Mockito.anyList(), eq(Constants.ALL)))
        .thenReturn(Collections.singletonList(itemSummaryListResponse))
        .thenReturn(Collections.singletonList(itemSummaryListResponse1));
    ItemPriceStockQuickUpdateResponse response =
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            null);
    Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabledScheduleSwitchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
        , true);
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
    productLevel3PriceRequest1.setSalePrice(OLD_SALE_PRICE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setItemSku(ITEM_SKU);
    quickEditV2Request.setVersion(11L);
    quickEditV2Request.setOff2OnActiveFlag(false);
    quickEditV2Request.setDeltaStock(null);
    quickEditV2Request.setUseWarehouseStock(null);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setPrice(productLevel3PriceRequest1);
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
        Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
        new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    ItemPriceStockQuickUpdateResponse response =
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            null);
    Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test()
  public void patchQuickEditV2_priceEditDisabledTest() throws Exception {
      ProductL3Response productL3Response = generateProductL3Response();
      GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
      ProductLevel3PriceRequest productLevel3PriceRequest1 = new ProductLevel3PriceRequest();
      productLevel3PriceRequest1.setSalePrice(NEW_SALE_PRICE);
    Map<String, String> campaignMap = new HashMap<>();
    campaignMap.put(ITEM_SKU, ITEM_SKU);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU).pickUpPointCode(PICKUP_POINT_CODE)
          .sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(campaignMap)
        .itemInfoStatus(Collections.emptyList()).build();
      quickEditV2Request.setCncActive(false);
      quickEditV2Request.setItemSku(ITEM_SKU);
      quickEditV2Request.setVersion(11L);
      quickEditV2Request.setOff2OnActiveFlag(false);
      quickEditV2Request.setDeltaStock(null);
      quickEditV2Request.setUseWarehouseStock(null);
      quickEditV2Request.setWholeSaleActivated(null);
      quickEditV2Request.setPrice(productLevel3PriceRequest1);
      productLevel3QuickEditV2Request.setQuickEditV2Requests(
        Collections.singletonList(quickEditV2Request));
      Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
      Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
        Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
        new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
      ItemPriceStockQuickUpdateResponse response =
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request);
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
      Mockito.verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
      Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      Mockito.verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          null);
      Mockito.verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      Mockito.verify(categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(campaignOutbound).validateDiscountPrice(true, campaignUpdateDiscountRequest);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest);

  }

  @Test()
  public void patchQuickEditV2_priceEditNotAllowed() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "returnImmediatelyIfPriceEditNotAllowed"
      , true);
    ReflectionTestUtils.setField(productLevel3V2Service,"fetchL3DetailForPLPAndPDPEdit", false);
    ProductL3Response productL3Response = generateProductL3Response();
    InventoryDetailInfoRequestDTO inventoryDetailInfoRequestDTO =
      new InventoryDetailInfoRequestDTO();
    inventoryDetailInfoRequestDTO.setPickupPointCode(PICKUP_POINT_CODE);
    inventoryDetailInfoRequestDTO.setWebMerchantCode(BUSINESS_PARTNER_CODE);
    inventoryDetailInfoRequestDTO.setInventoryBaseRequest(InventoryBaseRequest.builder().build());
    productL3Response.setTakenDown(false);
    productL3Response.setArchived(false);
    ProductLevel3Summary productLevel3Summary = new ProductLevel3Summary();
    productLevel3Summary.setItemSku(ITEM_SKU);
    productLevel3Summary.setSkuCode(ITEM_NAME);
    productLevel3Summary.setMerchantCode(BUSINESS_PARTNER_CODE);
    productLevel3Summary.setItemSku(ITEM_NAME);
    productLevel3Summary.setCategoryCode(CATEGORY_CODE);
    productLevel3Summary.setCategoryName(CATEGORY_NAME);
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(NEW_SALE_PRICE);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    PriceDTO oldPrice = priceDTO;
    oldPrice.setOfferPrice(OLD_SALE_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    itemSummaryListResponse.setItemCode(ITEM_NAME);
    itemSummaryListResponse.setProductCode(PRODUCT_CODE);
    itemSummaryListResponse.setMerchantPromoDiscount(true);
    itemSummaryListResponse.setPrice(Collections.singleton(oldPrice));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    ProductL3Response savedProductData1 = generateProductL3Response();
    savedProductData1.setSuspended(false);
    savedProductData1.setMarkForDelete(false);
    l3Response.getValue().setMerchantPromoDiscount(true);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(xProductOutbound.getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), null)).thenReturn(List.of(itemSummaryListResponse));
    Mockito.when(this.campaignOutbound.validateAndUpdateDiscountPrice(eq(true),
      Mockito.any(CampaignUpdateDiscountRequest.class))).thenReturn(
      new CampaignUpdateDiscountResponse(Collections.singletonMap(ITEM_SKU, ITEM_SKU), null));
    try {
      ItemPriceStockQuickUpdateResponse response =
        productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request);
    }
    finally {
      verify(xProductOutbound, times(2)).getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest),
          Constants.ALL);
      Mockito.verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
          Mockito.anyList());
      Mockito.verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList());
      verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
          false);
      verify(this.updatedProductHistoryService, times(1))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
          newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
      verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
      Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      Mockito.verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
      Mockito.verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
      Mockito.verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));

    }
  }

  @Test
  public void quickEditPatchingMultipleErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ProductL3Response productL3Response = generateProductL3Response();
    ItemPriceStockQuickUpdateResponse response = null;
    GdnRestSingleResponse<ProductL3Response> l3Response =
      new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setPickupPointCode(PICKUP_POINT_CODE);
    Map<String, String> campaignMap = new HashMap<>();
    campaignMap.put(ITEM_SKU, ITEM_SKU);
    ProductLevel3PriceRequest priceRequestUpdate = new ProductLevel3PriceRequest();
    priceRequestUpdate.setSalePrice(NEW_SALE_PRICE);
    priceRequestUpdate.setPrice(NEW_NORMAL_PRICE);
    PriceDTO priceDTO = new PriceDTO();
    priceDTO.setOfferPrice(OLD_SALE_PRICE);
    priceDTO.setMerchantPromoDiscountPrice(
      DiscountPriceDTO.builder().discountPrice(DISCOUNT_PRICE).endDateTime(new Date())
        .startDateTime(new Date()).build());
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).getPrice()
      .setSalePrice(NEW_SALE_PRICE);
    this.productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setVersion(11L);
    priceDTO.setListPrice(OLD_NORMAL_PRICE);
    quickEditV2Request.setPrice(priceRequestUpdate);
    quickEditV2Request.setOff2OnActiveFlag(true);
    itemSummaryListResponse.setMerchantPromoDiscount(false);
    itemSummaryListResponse.setPrice(Collections.singleton(priceDTO));
    productLevel3QuickEditV2Request.setQuickEditV2Requests(
      Collections.singletonList(quickEditV2Request));
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
      .thenReturn(l3Response);
    Mockito.when(pickupPointRepository.findByPickupPointCode(eq(PICKUP_POINT_CODE))).thenReturn(pickupPointResponse);
    CampaignUpdateDiscountRequest campaignUpdateDiscountRequest =
      CampaignUpdateDiscountRequest.builder().discountDTOList(Collections.singletonList(
        UpdateDiscountDTO.builder().categoryCode(CATEGORY_CODE).itemSku(ITEM_SKU).pickUpPointCode(PICKUP_POINT_CODE)
          .sellingPrice(NEW_SALE_PRICE).build())).build();
    CampaignUpdateDiscountResponse campaignUpdateDiscountResponse =
      CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(campaignMap)
        .itemInfoStatus(Collections.emptyList()).build();
    Mockito.when(
        this.campaignOutbound.validateAndUpdateDiscountPrice(true, campaignUpdateDiscountRequest))
      .thenReturn(campaignUpdateDiscountResponse);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.doThrow(new RuntimeException("WholeUpdate Error ")).when(productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Mockito.anyList());
    Mockito.doThrow(new RuntimeException(OFF2_ON_FLAG_UPDATE_ERROR))
      .when(updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.doThrow(new Exception(INVENTORY_UPDATE_FAILED)).when(productLevel3InventoryService)
      .updateStockForItemPickupPoint(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyInt(), Mockito.anyInt(), Mockito.anyBoolean());
    Mockito.doThrow(new RuntimeException("campaign")).when(campaignOutbound)
      .validateAndUpdateDiscountPrice(true, new CampaignUpdateDiscountRequest());
    Mockito.when(
      this.productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, null)).thenReturn(true);
    response = productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(xProductOutbound,times(3))
      .getItemPickupPointSummary(Collections.singletonList(itemPickupPointRequest), Constants.ALL);
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(xProductOutbound)
      .updateOff2OnActiveFlagByProductSku(eq(Collections.singletonMap(PRODUCT_SKU, true)));
    Mockito.verify(this.updatedProductHistoryService)
      .createProductL3AuditLog(MERCHANT_CODE, Constants.DEFAULT, PRODUCT_SKU, null,
        UpdateProductActivity.OFFLINE_TO_ONLINE.getDesc(), String.valueOf(false),
        String.valueOf(true), false, Constants.HYPHEN);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(campaignOutbound).validateDiscountPrice(true, campaignUpdateDiscountRequest);
    Assertions.assertNotNull(response);
    Assertions.assertEquals(1, response.getVariantsErrorList().size());
    System.out.println(response.getVariantsErrorList().get(0).getErrorMessage());
    Mockito.verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    Mockito.verify(this.productLevel3InventoryService, times(3))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null);
    verify(this.updatedProductHistoryService, times(2))
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(updateProductItemLevel3ModelConverter, times(4))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test
  public void getItemSummaryL4ResponseTest() throws Exception {
    String json = "[{\"itemSku\":\"itemSku\",\"quantity\":1}]";
    productItemBusinessPartner.setBundleRecipe(json);
    productBusinessPartner.setBundleProduct(true);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ItemSkuToItemIdMapping itemSkuToItemIdMapping = new ItemSkuToItemIdMapping();
    BeanUtils.copyProperties(productItemBusinessPartner, itemSkuToItemIdMapping);
    Mockito.when(productBusinessPartnerRepository.findItemSkuToItemIdMappingByProductBusinessPartnerId(STORE_ID,
            productBusinessPartner.getId(), PageRequest.of(0, 1)))
        .thenReturn(new PageImpl<>(Arrays.asList(), PageRequest.of(0, 1), 1));
    Mockito.when(productRepository.findDetailById(productBusinessPartner.getProductId()))
        .thenReturn(generateProductDetailResponse());
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU), true)).thenReturn(
        Arrays.asList(ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU).build(),
            ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU).permanentDelete(true).build()));
    Mockito.when(objectMapper.readValue(eq(json),  typeReferenceArgumentCaptor.capture())).thenReturn(Arrays.asList(new ProductBundleRecipe(ITEM_SKU, 1)));
    Page<ItemSummaryL4Response> itemSummaryL4ResponsePage =
        productLevel3V2Service.getItemSummaryL4Response(STORE_ID, PRODUCT_SKU, 0, 1);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productBusinessPartnerRepository).findItemSkuToItemIdMappingByProductBusinessPartnerId(STORE_ID,
        productBusinessPartner.getId(), PageRequest.of(0, 1));
    Mockito.verify(xProductOutbound).getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU), true);
    Mockito.verify(objectMapper).readValue(json, typeReferenceArgumentCaptor.getValue());
    com.gdn.x.productcategorybase.dto.response.ProductDetailResponse productDetailResponse = generateProductDetailResponse();
    Assertions.assertEquals(3,productDetailResponse.getProductItemResponses().size());
  }

  @Test
  public void getItemSummaryL4ResponseTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL4BasedOnMfdInNrFlow", true);
    String json = "[{\"itemSku\":\"itemSku\",\"quantity\":1}]";
    productItemBusinessPartner.setBundleRecipe(json);
    productBusinessPartner.setBundleProduct(true);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ItemSkuToItemIdMapping itemSkuToItemIdMapping = new ItemSkuToItemIdMapping();
    BeanUtils.copyProperties(productItemBusinessPartner, itemSkuToItemIdMapping);
    Mockito.when(
            productBusinessPartnerRepository.findItemSkuToItemIdMappingByProductBusinessPartnerIdAndMarkForDeleteFalse(
                STORE_ID, productBusinessPartner.getId(), PageRequest.of(0, 1)))
        .thenReturn(new PageImpl<>(Arrays.asList(), PageRequest.of(0, 1), 1));
    Mockito.when(productRepository.findDetailById(productBusinessPartner.getProductId()))
        .thenReturn(generateProductDetailResponse());
    Mockito.when(xProductOutbound.getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU), true)).thenReturn(
        Arrays.asList(ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU).build(),
            ItemBasicDetailV2Response.builder().itemSku(ITEM_SKU).permanentDelete(true).build()));
    Mockito.when(objectMapper.readValue(eq(json), typeReferenceArgumentCaptor.capture()))
        .thenReturn(Arrays.asList(new ProductBundleRecipe(ITEM_SKU, 1)));
    Page<ItemSummaryL4Response> itemSummaryL4ResponsePage =
        productLevel3V2Service.getItemSummaryL4Response(STORE_ID, PRODUCT_SKU, 0, 1);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    verify(productBusinessPartnerRepository).findItemSkuToItemIdMappingByProductBusinessPartnerIdAndMarkForDeleteFalse(STORE_ID,
        productBusinessPartner.getId(), PageRequest.of(0, 1));
    Mockito.verify(xProductOutbound).getItemBasicDetailV2Response(Arrays.asList(ITEM_SKU), true);
    Mockito.verify(objectMapper).readValue(json, typeReferenceArgumentCaptor.getValue());
    com.gdn.x.productcategorybase.dto.response.ProductDetailResponse productDetailResponse =
        generateProductDetailResponse();
    Assertions.assertEquals(3, productDetailResponse.getProductItemResponses().size());
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
      .thenReturn(productBusinessPartner);
      ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
      productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
        itemL5ListingRequest, true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductBusinessNullTest() throws Exception {
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1)).thenReturn(null);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    Page<ItemPickupPointListingL3Response> itemPickupPointListingL3ResponsePage =
        productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1, itemL5ListingRequest,
            true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
    Assertions.assertEquals(Page.empty(), itemPickupPointListingL3ResponsePage);
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductItemSkuTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
        .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    itemL5ListingRequest.setItemSku(ITEM_SKU_1);
    productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
        itemL5ListingRequest, true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductInvalidProductSkuTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(ITEM_NAME);
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
          itemL5ListingRequest, true);
    });
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductInvalidProductSkuNullTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(StringUtils.EMPTY);
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
          itemL5ListingRequest, true);
    });
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductInvalidItemSkuTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU);
    itemL5ListingRequest.setItemSku(ITEM_SKU_1);
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
          itemL5ListingRequest, true);
    });
  }

  @Test
  public void getItemPickupPointL3ListingActiveProductMfdTrueTest() throws Exception {
    productBusinessPartner.setState(ACTIVE);
    productBusinessPartner.setMarkForDelete(true);
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
        .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
        itemL5ListingRequest, true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
  }

  @Test
  public void getItemPickupPointL3ListingNeedCorrectionProductTest() throws Exception {
    productBusinessPartner.setState("NEED_CORRECTION");
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
      .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
      itemL5ListingRequest, true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
  }

  @Test
  public void fetchL3ProductDetailsByDeletedProductSku() throws Exception {
    productBusinessPartner.setState("DELETED");
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
      .thenReturn(productBusinessPartner);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        ProductL3DetailsResponse productL3DetailsResponse =
            productLevel3V2Service.fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
      });
    } finally {
      verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    }
  }

  @Test
  public void fetchL3ProductDetailsByNullProductSku() throws Exception {
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.fetchL3ProductDetailsByProductSku(DEFAULT_STORE_ID, PRODUCT_SKU, false, true);
      });
    } finally {
      verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU);
    }
  }

  @Test
  public void getItemPickupPointL3ListingInProgressProductTest() throws Exception {
    productBusinessPartner.setState("IN_PROGRESS");
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
      .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    productLevel3V2Service.getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1,
      itemL5ListingRequest, true);
    verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
  }

  @Test
  public void getItemPickupPointL3ListingDeletedProductTest() throws Exception {
    productBusinessPartner.setState("DELETED");
    Mockito.when(productBusinessPartnerRepository.findFirstByGdnProductSku(PRODUCT_SKU_1))
      .thenReturn(productBusinessPartner);
    ItemL5ListingRequest itemL5ListingRequest = new ItemL5ListingRequest();
    itemL5ListingRequest.setProductSku(PRODUCT_SKU_1);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service
            .getItemPickupPointL3Listing(STORE_ID, USERNAME, REQUEST_ID, 0, 1, itemL5ListingRequest, true);
      });
    }
    finally {
      verify(productBusinessPartnerRepository).findFirstByGdnProductSku(PRODUCT_SKU_1);
    }
  }

  @Test
  public void insertInventoryForNewlyAddedL5DuringNeedRevisionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "mppForWhEnabled", false);
    ProfileResponse profileResponse = new ProfileResponse();
    profileResponse.setCompany(new CompanyDTO());
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productLevel3V2Service.insertInventoryForNewlyAddedL5DuringNeedRevision(productBusinessPartner,
        Arrays.asList(newlyAddedL5Response), profileResponse);
    verify(productLevel3InventoryService).insertInventory(productLevel3InventoriesCaptor.capture());
    verify(updatedProductHistoryService).createProductL3AuditLog(any(), any(), any(), any(), any(), any(), any(), eq(true), any());
    Assertions.assertEquals(10,
        productLevel3InventoriesCaptor.getValue().get(0).getInitialPreOrderQuota());
  }

  @Test
  public void insertInventoryForNewlyAddedL5DuringNeedRevisionTestWithFbbActivatedSwitchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "mppForWhEnabled", false);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    productItemBusinessPartner.setFbbActive(true);
    ProfileResponse profileResponse = new ProfileResponse();
    profileResponse.setCompany(new CompanyDTO());
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productLevel3V2Service.insertInventoryForNewlyAddedL5DuringNeedRevision(productBusinessPartner,
      Arrays.asList(newlyAddedL5Response), profileResponse);
    verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService).createProductL3AuditLog(any(), any(), any(), any(), any(), any(), any(), eq(true), any());

  }

  @Test
  public void insertInventoryForNewlyAddedL5DuringNeedRevisionTestWithFbbActivatedSwitchON() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "mppForWhEnabled", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    productItemBusinessPartner.setFbbActive(true);
    ProfileResponse profileResponse = new ProfileResponse();
    profileResponse.setCompany(new CompanyDTO());
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productLevel3V2Service.insertInventoryForNewlyAddedL5DuringNeedRevision(productBusinessPartner,
      Arrays.asList(newlyAddedL5Response), profileResponse);
    verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService).createProductL3AuditLog(any(), any(), any(), any(), any(), any(), any(), eq(true), any());
  }

  @Test
  public void insertInventoryForNewlyAddedL5DuringNeedRevisionWarehouseMerchantCodeTest() throws Exception {
    ProfileResponse profileResponse = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setPurchaseTerm(GdnBaseLookup.PURCHASE_TERM_PURCHASE_ORDER);
    profileResponse.setCompany(companyDTO);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productLevel3V2Service.insertInventoryForNewlyAddedL5DuringNeedRevision(productBusinessPartner,
        Arrays.asList(newlyAddedL5Response), profileResponse);
    verify(productLevel3InventoryService).insertInventory(anyList());
    verify(updatedProductHistoryService).createProductL3AuditLog(any(), any(), any(), any(), any(), any(), any(), eq(true), any());
  }

  @Test
  public void insertInventoryForNewlyAddedL5DuringNullNewlyAddedL5ResponseTest() throws Exception {
    ProfileResponse profileResponse = new ProfileResponse();
    CompanyDTO companyDTO = new CompanyDTO();
    companyDTO.setPurchaseTerm(GdnBaseLookup.PURCHASE_TERM_PURCHASE_ORDER);
    profileResponse.setCompany(companyDTO);
    productBusinessPartner.setProductItemBusinessPartners(Arrays.asList(productItemBusinessPartner));
    productLevel3V2Service.insertInventoryForNewlyAddedL5DuringNeedRevision(productBusinessPartner,
        null, profileResponse);
    Assertions.assertEquals(PICKUP_POINT_CODE,
        productBusinessPartner.getProductItemBusinessPartners().get(0).getPickupPointId());
  }

  @Test
  public void saveL3NeedRevisionHistoryTest() throws Exception {
    productBusinessPartner.setOnline(false);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    ProductVariantUpdateRequest request = ProductVariantUpdateRequest.builder().productSku(PRODUCT_SKU).productName(PRODUCT_NAME).online(true).build();
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
    verify(kafkaProducer).send(eq(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY),eq(PRODUCT_SKU), Mockito.any(
        AuditTrailListRequest.class));

    request.setOnline(false);
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);

    request.setOnline(null);
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
  }

  @Test
  public void saveL3NeedRevisionHistoryBFBTest() throws Exception {
    productBusinessPartner.setOnline(false);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner.setB2bActivated(false);
    productBusinessPartner.setB2cActivated(false);
    AuditTrailListRequest auditTrailListRequest = getAuditTrailListRequest();
    ProductVariantUpdateRequest request =
        ProductVariantUpdateRequest.builder().productSku(PRODUCT_SKU).productName(PRODUCT_NAME).online(true).build();

    request.setOnline(false);
    request.setB2bActivated(true);
    request.setB2cActivated(true);

    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
    verify(kafkaProducer).send(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY ,PRODUCT_SKU,
      auditTrailListRequest);
  }

  private static AuditTrailListRequest getAuditTrailListRequest() {
    AuditTrailDto auditTrailDto = new AuditTrailDto();
    auditTrailDto.setBusinessPartnerCode("BLI-00001");
    auditTrailDto.setActionKey(B_2_C_ACTIVATED);
    auditTrailDto.setGdnSku(DEFAULT);
    auditTrailDto.setNewValue("true");
    auditTrailDto.setOldValue("false");
    auditTrailDto.setOnlineStatus(true);
    auditTrailDto.setAttributeName(NEED_REVISION);
    auditTrailDto.setProductSku(PRODUCT_SKU);
    auditTrailDto.setName(PRODUCT_NAME);
    auditTrailDto.
      setPickupPointCode("-");
    AuditTrailListRequest auditTrailListRequest = new AuditTrailListRequest();
    auditTrailListRequest.setUpdateDirectly(true);
    auditTrailListRequest.setAccessChannel(ACCESS_CHANNEL);
    auditTrailListRequest.setAuditTrailResponseList(Collections.singletonList(auditTrailDto));
    return auditTrailListRequest;
  }

  @Test
  public void saveL3NeedRevisionHistoryB2BFalseTest() throws Exception {
    productBusinessPartner.setOnline(false);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner.setB2bActivated(false);
    productBusinessPartner.setB2cActivated(false);
    AuditTrailListRequest auditTrailListRequest = getAuditTrailListRequest();
    auditTrailListRequest.getAuditTrailResponseList().get(0).setActionKey(B_2_B_ACTIVATED);
    ProductVariantUpdateRequest request =
        ProductVariantUpdateRequest.builder().productSku(PRODUCT_SKU).productName(PRODUCT_NAME).online(true).build();

    request.setOnline(false);
    request.setB2bActivated(true);
    request.setB2cActivated(false);
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
    verify(kafkaProducer).send(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY ,PRODUCT_SKU,
      auditTrailListRequest);
  }

  @Test
  public void saveL3NeedRevisionHistoryB2cFalseTest() throws Exception {
    productBusinessPartner.setOnline(false);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner.setB2bActivated(false);
    productBusinessPartner.setB2cActivated(false);
    AuditTrailListRequest auditTrailListRequest = getAuditTrailListRequest();

    ProductVariantUpdateRequest request =
        ProductVariantUpdateRequest.builder().productSku(PRODUCT_SKU).productName(PRODUCT_NAME).online(true).build();

    request.setOnline(false);
    request.setB2bActivated(false);
    request.setB2cActivated(true);
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
    verify(kafkaProducer).send(ProductDomainEventName.PRODUCT_SKU_UPDATE_HISTORY ,PRODUCT_SKU,
      auditTrailListRequest);
  }

  @Test
  public void saveL3NeedRevisionHistoryBFBFlagNotChangedTest() throws Exception {
    productBusinessPartner.setOnline(false);
    productBusinessPartner.setGdnProductSku(PRODUCT_SKU);
    productBusinessPartner.setB2bActivated(true);
    productBusinessPartner.setB2cActivated(true);
    ProductVariantUpdateRequest request =
        ProductVariantUpdateRequest.builder().productSku(PRODUCT_SKU).productName(PRODUCT_NAME).online(true).build();
    AuditTrailListRequest auditTrailListRequest = getAuditTrailListRequest();

    request.setOnline(false);
    request.setB2bActivated(true);
    request.setB2cActivated(true);
    productLevel3V2Service.saveL3NeedRevisionHistory(DEFAULT_BUSINESS_PARTNER_CODE, request, productBusinessPartner);
   verifyNoMoreInteractions(kafkaProducer);
  }

  @Test
  public void productQuickEditV2_EditPpCodeFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditPickupPoints", false);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Map<String, String> map = new HashMap<>();
    map.put(ITEM_SKU.concat("-1"), "0");
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(map)
      .build());
    Mockito.when(this.productPricingOutbound.getWholesalePriceByItemSkuAndPickupPointCode(
      Collections.singletonList(itemInfoDto)))
      .thenReturn(Collections.singletonList(null));
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
      productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(xProductOutbound, times(2))
      .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
      .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
      .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        false);
    verify(xProductOutbound)
      .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
        Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
      .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
      .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
        newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
      .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
      .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
      any(CampaignUpdateDiscountRequest.class));
  }

  @Test
  public void createDefaultFbbPickupPointTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Mockito.verify(xProductOutbound).createFbbPickupPoint(Mockito.any());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(Mockito.anyList());
    Assertions.assertEquals(null, fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void createDefaultFbbPickupDistributionPointTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.DISTRIBUTION_FLAG_KEY, true);
    pickupPointResponse.setFlags(flags);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Assertions.assertTrue(StringUtils.isNotBlank(fbbCreatePickupPointResponse.getReason()));
  }

  @Test
  public void createFbbPickupPointTest() throws Exception {
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    fbbCreatePickupPointRequest.setPpCode(PICKUP_POINT_CODE);
    CreateFbbPickupPointRequest createFbbPickupPointRequest = new CreateFbbPickupPointRequest();
    createFbbPickupPointRequest.setPickupPointCode(PICKUP_POINT_CODE);
    createFbbPickupPointRequest.setItemSku(ITEM_SKU);
    createFbbPickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    createFbbPickupPointResponse.setPickupPointCode(PICKUP_POINT_CODE);
    createFbbPickupPointResponse.setProductCode(PRODUCT_CODE);
    createFbbPickupPointResponse.setProductSku(PRODUCT_SKU);
    createFbbPickupPointResponse.setItemSku(ITEM_SKU);
    createFbbPickupPointResponse.setItemCode(ITEM_CODE);
    Mockito.when(xProductOutbound.createFbbPickupPoint(createFbbPickupPointRequest))
        .thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(xProductOutbound).createFbbPickupPoint(createFbbPickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(Mockito.anyList());
    Assertions.assertNull(fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void createDefaultFbbPickupPointInsertStockFailedTest() throws Exception {
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    profileResponse.getCompany().setPurchaseTerm(GdnBaseLookup.PURCHASE_TERM_PURCHASE_ORDER);
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.doThrow(Exception.class).when(productLevel3InventoryService).insertInventory(Mockito.anyList());
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Mockito.verify(xProductOutbound).createFbbPickupPoint(Mockito.any());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3InventoryService).insertInventory(Mockito.anyList());
    Assertions.assertEquals(ApiErrorCode.FAILED_TO_ADD_STOCK_FOR_DEFAULT_FBB_PICKUP_POINT.getDesc(),
        fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void createDefaultFbbPickupPointXproductFailTest() throws Exception {
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setDefaultWarehouse(true);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    createFbbPickupPointResponse.setReason(PRICE_UPDATE_FAILED);
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Mockito.verify(xProductOutbound).createFbbPickupPoint(Mockito.any());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(PRICE_UPDATE_FAILED, fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void createDefaultFbbPickupPointFAASErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setDefaultWarehouse(true);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    createFbbPickupPointResponse.setReason(PRICE_UPDATE_FAILED);
    profileResponse.setFlags(Map.of(Constants.FAAS_ACTIVATED, true));
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(ApiErrorCode.FAAS_SELLER_SYNC_STOCK_CHANGE_ERROR.getDesc(), fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void createDefaultFbbPickupPointDefaultPPFetchFailTest() throws Exception {
    FbbCreatePickupPointRequest fbbCreatePickupPointRequest = new FbbCreatePickupPointRequest();
    fbbCreatePickupPointRequest.setBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    fbbCreatePickupPointRequest.setItemSku(ITEM_SKU);
    CreateFbbPickupPointResponse createFbbPickupPointResponse = new CreateFbbPickupPointResponse();
    Mockito.when(businessPartnerRepository.filterPickupPointsByPickupPointRequest(Mockito.any()))
        .thenThrow(new ApplicationRuntimeException());
    Mockito.when(xProductOutbound.createFbbPickupPoint(Mockito.any())).thenReturn(createFbbPickupPointResponse);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    FbbCreatePickupPointResponse fbbCreatePickupPointResponse =
        productLevel3V2Service.createDefaultFbbPickupPoint(fbbCreatePickupPointRequest);
    Mockito.verify(businessPartnerRepository).filterPickupPointsByPickupPointRequest(Mockito.any());
    Assertions.assertEquals(ApiErrorCode.FAILED_TO_FETCH_DEFAULT_FBB_PICKUP_POINT.getDesc(),
        fbbCreatePickupPointResponse.getReason());
  }

  @Test
  public void getItemPickupPointL3ListingTest() throws Exception {

    ViewConfigResponse viewConfigResponse = new ViewConfigResponse();
    itemSkuPpCodeRequest.setItemSku(ITEM_SKU);
    itemSkuPpCodeRequest.setPickupPointCode(PICKUP_POINT_CODE);

    productL5DetailResponse.setItemSku(ITEM_SKU);
    productL5DetailResponse.setPickupPointCode(PICKUP_POINT_CODE);
    productL5DetailResponse.setCategoryCode(CATEGORY_CODE);
    productL5DetailResponse.setPrices(Collections.singletonList(priceResponse));
    productL5DetailResponse.setViewConfigs(Collections.singletonList(viewConfigResponse));

    Mockito.when(this.xProductOutbound.findProductAndItemByItemSkuAndPickupPointCode(
        Mockito.anyList()))
      .thenReturn(Collections.singletonList(productL5DetailResponse));
    Mockito.when(
        this.productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
          Mockito.anyList()))
      .thenReturn(Collections.singletonList(productLevel3Inventory));
    Mockito.when(
        this.campaignOutbound.getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class)))
      .thenReturn(campaignPriceResponse);

    productLevel3V2Service.getProductDetailsByItemSkuAndPickupPointCode(STORE_ID,
      Collections.singletonList(itemSkuPpCodeRequest), true);

    Mockito.verify(this.xProductOutbound).findProductAndItemByItemSkuAndPickupPointCode(
      Mockito.anyList());
    Mockito.verify(this.productLevel3InventoryService)
      .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.campaignOutbound)
      .getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class));

  }

  @Test
  public void getItemPickupPointL3ListingSkipInvTest() throws Exception {

    ViewConfigResponse viewConfigResponse = new ViewConfigResponse();
    itemSkuPpCodeRequest.setItemSku(ITEM_SKU);
    itemSkuPpCodeRequest.setPickupPointCode(PICKUP_POINT_CODE);

    productL5DetailResponse.setItemSku(ITEM_SKU);
    productL5DetailResponse.setPickupPointCode(PICKUP_POINT_CODE);
    productL5DetailResponse.setCategoryCode(CATEGORY_CODE);
    productL5DetailResponse.setPrices(Collections.singletonList(priceResponse));
    productL5DetailResponse.setViewConfigs(Collections.singletonList(viewConfigResponse));

    Mockito.when(this.xProductOutbound.findProductAndItemByItemSkuAndPickupPointCode(
            Mockito.anyList()))
        .thenReturn(Collections.singletonList(productL5DetailResponse));
    Mockito.when(
            this.campaignOutbound.getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class)))
        .thenReturn(campaignPriceResponse);

    productLevel3V2Service.getProductDetailsByItemSkuAndPickupPointCode(STORE_ID,
        Collections.singletonList(itemSkuPpCodeRequest), false);

    Mockito.verify(this.xProductOutbound).findProductAndItemByItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.campaignOutbound)
        .getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class));

  }

  @Test
  public void getItemPickupPointL3ListingCampNullTest() throws Exception {
    ViewConfigResponse viewConfigResponse = new ViewConfigResponse();
    itemSkuPpCodeRequest.setItemSku(ITEM_SKU);
    itemSkuPpCodeRequest.setPickupPointCode(PICKUP_POINT_CODE);
    productL5DetailResponse.setItemSku(ITEM_SKU);
    productL5DetailResponse.setPickupPointCode(PICKUP_POINT_CODE);
    productL5DetailResponse.setCategoryCode(CATEGORY_CODE);
    productL5DetailResponse.setPrices(Collections.singletonList(priceResponse));
    productL5DetailResponse.setViewConfigs(Collections.singletonList(viewConfigResponse));
    Mockito.when(this.xProductOutbound.findProductAndItemByItemSkuAndPickupPointCode(
            Mockito.anyList()))
        .thenReturn(Collections.singletonList(productL5DetailResponse));
    Mockito.when(
            this.productLevel3InventoryService.findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
                Mockito.anyList()))
        .thenReturn(Collections.singletonList(productLevel3Inventory));
    Mockito.when(
            this.campaignOutbound.getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class)))
        .thenReturn(null);
    productLevel3V2Service.getProductDetailsByItemSkuAndPickupPointCode(STORE_ID,
        Collections.singletonList(itemSkuPpCodeRequest), true);
    Mockito.verify(this.xProductOutbound).findProductAndItemByItemSkuAndPickupPointCode(
        Mockito.anyList());
    Mockito.verify(this.productLevel3InventoryService)
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.campaignOutbound)
        .getCampaignPriceInfoV2(Mockito.any(CampaignPriceRequest.class));
  }

  @Test
  public void validateShippingAndDimensionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
      100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    updateRequest.setProductType(1);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }
  @Test
  public void validateShippingAndDimensionTestRelaxShipingWeightTrue() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
        100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(null);
    updateRequest.setProductType(1);
    ApiErrorCode apiErrorCode = productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, true);
    Assertions.assertNull(apiErrorCode);
  }
  @Test
  public void validateShippingAndDimensionTestRelaxShipingWeightTrue1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
        100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(0.0);
    updateRequest.setShippingWeight(null);
    updateRequest.setProductType(1);
    ApiErrorCode apiErrorCode = productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, true);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO, apiErrorCode);
  }
  @Test
  public void validateShippingAndDimensionForEdit_RelaxShippingWeightValidationFalse_ProductType3_ShippingWeightNull() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(2);
    updateRequest.setLength(10.0);
    updateRequest.setWidth(10.0);
    updateRequest.setHeight(10.0);
    updateRequest.setWeight(1000.0);
    updateRequest.setShippingWeight(null);
    ApiErrorCode apiErrorCode = productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO, apiErrorCode);
  }
  @Test
  public void validateShippingAndDimension_SwitchOffButRelaxTrue_ProductType3_NoShippingWeight() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(3);
    updateRequest.setLength(10.0);
    updateRequest.setWidth(10.0);
    updateRequest.setHeight(10.0);
    updateRequest.setWeight(1000.0);
    updateRequest.setShippingWeight(null);
    ApiErrorCode apiErrorCode = productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, true);
    Assertions.assertNull(apiErrorCode);
  }
  @Test
  public void validateShippingAndDimensionTestForInstoreProduct() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
      100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    updateRequest.setProductType(1);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }


  @Test
  public void validateShippingAndDimensionTestForInstoreProductWithSwitchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
      100000);
    ReflectionTestUtils.setField(productLevel3V2Service,"instore2FlowSwitch", false);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    updateRequest.setProductType(1);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionTest_SwitchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionTestForNullProductType() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    updateRequest.setProductType(null);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionTestForNullProductType_switchOff() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(null);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimension_ShippingTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(-1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);
  }

  @Test
  public void validateShippingAndDimension_ShippingTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(2);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(-1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);  }

  @Test
  public void validateShippingAndDimension_ShippingTest_forBOPIS() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(3);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(-1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertNull(apiErrorCode);  }


  @Test
  public void validateShippingAndDimension_ShippingDecimalTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.000087);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);  }

  @Test
  public void validateShippingAndDimension_WightDecimalTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.009);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimension_withMaxShippingTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.009);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimension_weightTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"maxProductDimensionLimit", 10000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(2);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(90000000.0);
    updateRequest.setWeight(9.0);
    updateRequest.setLength(1.0);
    updateRequest.setHeight(1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertNull(apiErrorCode);  }

  @Test
  public void validateShippingAndDimension_weightNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(2);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(null);
    updateRequest.setLength(1.0);
    updateRequest.setHeight(1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);  }
  @Test()
  public void validateShippingAndDimension_HeightTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(9.0);
    updateRequest.setHeight(-1.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);
  }

  @Test
  public void validateShippingAndDimension_widthTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(2);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(9.0);
    updateRequest.setHeight(1.0);
    updateRequest.setWidth(-90.0);
    updateRequest.setLength(9.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);
  }

  @Test
  public void validateShippingAndDimension_widthTest1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(9.0);
    updateRequest.setHeight(1.0);
    updateRequest.setWidth(-90.0);
    updateRequest.setLength(9.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_LESS_THAN_ZERO,apiErrorCode);  }

  @Test
  public void validateShippingAndDimension_exceededTest1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit", 100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(9.0);
    updateRequest.setHeight(1000000.0);
    updateRequest.setWidth(90.0);
    updateRequest.setLength(9.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD,apiErrorCode);  }

  @Test
  public void validateShippingAndDimension_exceededLengthTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxProductDimensionLimit",
      100000);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setProductType(1);
    updateRequest.setShippingWeight(9.0);
    updateRequest.setWeight(9.0);
    updateRequest.setHeight(100000.0);
    updateRequest.setWidth(10000000.0);
    updateRequest.setLength(10000000.0);
    ApiErrorCode apiErrorCode =
      productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
    Assertions.assertEquals(ApiErrorCode.DIMENSION_EXCEEDED_THRESHOLD,apiErrorCode);  }

  @Test
  public void toProductVariantUpdateRequestOverrideOnlineWithB2CTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "overrideOnlineWithB2CFlag", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setB2cActivated(false);
    ProductVariantUpdateRequest request =
      productLevel3V2Service.toProductVariantUpdateRequest(productL3UpdateRequest, new EditProductResponse());
    Assertions.assertEquals(DEFAULT_BUSINESS_PARTNER_CODE, request.getBusinessPartnerCode());
    Assertions.assertEquals(false, request.getOnline());
  }

  @Test
  public void toProductVariantUpdateRequestOverrideOnlineWithB2CTrueTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "overrideOnlineWithB2CFlag", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setB2cActivated(true);
    ProductVariantUpdateRequest request =
      productLevel3V2Service.toProductVariantUpdateRequest(productL3UpdateRequest, new EditProductResponse());
    Assertions.assertEquals(DEFAULT_BUSINESS_PARTNER_CODE, request.getBusinessPartnerCode());
    Assertions.assertNull(request.getOnline());
  }

  @Test
  public void validateL5UpdateRequestTest() throws Exception {
    productLevel3V2Service.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
      profileResponse);
    Mockito.verify(productLevel3Service).validateL5UpdateRequest(new ProductVariantUpdateRequest(),
      profileResponse);
  }

  @Test
  public void validationsForEditTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
      profileResponse);

  }

  @Test
  public void validationsForEditL5ValidationEditResponseTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    PreOrderRequest preOrderRequest = new PreOrderRequest();
    preOrderRequest.setIsPreOrder(true);
    preOrderRequest.setIsPreOrder(true);
    preOrderRequest.setPreOrderValue(-1);
    preOrderRequest.setPreOrderType("WRONG");
    productL3UpdateRequest.setPreOrder(preOrderRequest);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = new ItemsPriceStockImagesUpdateResponse();
    itemsPriceStockImagesUpdateResponse.setApiErrorCode(ApiErrorCode.ALL_VARIANTS_ERROR);
    Mockito.when(productLevel3V2Service.validateL5UpdateRequest(new ProductVariantUpdateRequest(), profileResponse))
        .thenReturn(itemsPriceStockImagesUpdateResponse);
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
      profileResponse);

  }

  @Test
  public void validationsForEditPreOrderFalseTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    PreOrderRequest preOrderRequest = new PreOrderRequest();
    preOrderRequest.setIsPreOrder(false);
    preOrderRequest.setPreOrderValue(-1);
    preOrderRequest.setPreOrderType("WRONG");
    productL3UpdateRequest.setPreOrder(preOrderRequest);
    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = new ItemsPriceStockImagesUpdateResponse();
    itemsPriceStockImagesUpdateResponse.setApiErrorCode(ApiErrorCode.ALL_VARIANTS_ERROR);
    Mockito.when(productLevel3V2Service.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
        profileResponse))
        .thenReturn(itemsPriceStockImagesUpdateResponse);
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
      profileResponse);

  }

  @Test
  public void validationsForEditShippingAndDimensionEditTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "preOrderMaximumWeek", 1);
    PreOrderRequest preOrderRequest = new PreOrderRequest();
    preOrderRequest.setIsPreOrder(true);
    Date currentDate = new Date();
    Calendar cal = Calendar.getInstance();
    cal.setTime(currentDate);
    cal.add(Calendar.DATE, 90);
    preOrderRequest.setPreOrderDate(cal.getTime());
    preOrderRequest.setPreOrderType(PREORDER_WEEK_TYPE);
    preOrderRequest.setPreOrderValue(1);
    productL3UpdateRequest.setPreOrder(preOrderRequest);

    ItemsPriceStockImagesUpdateResponse itemsPriceStockImagesUpdateResponse = new ItemsPriceStockImagesUpdateResponse();
    itemsPriceStockImagesUpdateResponse.setApiErrorCode(ApiErrorCode.ALL_VARIANTS_ERROR);
    Mockito.when(productLevel3V2Service.validateL5UpdateRequest(new ProductVariantUpdateRequest(),
        profileResponse))
        .thenReturn(itemsPriceStockImagesUpdateResponse);
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
      profileResponse);
  }

  @Test
  public void validationsForEditNoErrorsTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
      profileResponse);

  }

  @Test
  public void validationsForCommomImagesLocationPathTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setDistributionAndUOMRequest(
        Collections.singletonList(new ProductItemDistributionInfoRequest()));
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);
    Mockito.verify(distributionInfoService).validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList());
    Assertions.assertNotNull(productEditValidationDTO);
  }

  @Test
  public void validationsForCommomImagesLocationPath2Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductItemDistributionInfoRequest productItemDistributionInfoRequest = new ProductItemDistributionInfoRequest();
    DistributionItemRequest distributionItemRequest = new DistributionItemRequest();
    distributionItemRequest.setOmniChannelSku(SKU_CODE);
    productItemDistributionInfoRequest.setDistributionItemInfoRequest(distributionItemRequest);
    productL3UpdateRequest.setDistributionAndUOMRequest(
        Collections.singletonList(productItemDistributionInfoRequest));
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);
Mockito.verify(distributionInfoService).validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList());
    Assertions.assertNotNull(productEditValidationDTO);
  }

  @Test
  public void validationsForCommomImagesLocationPath3Test() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    ProductItemDistributionInfoRequest productItemDistributionInfoRequest = new ProductItemDistributionInfoRequest();
    DistributionItemRequest distributionItemRequest = new DistributionItemRequest();
    productItemDistributionInfoRequest.setDistributionItemInfoRequest(distributionItemRequest);
    productL3UpdateRequest.setDistributionAndUOMRequest(
        Collections.singletonList(productItemDistributionInfoRequest));
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
            profileResponse);
    Mockito.verify(distributionInfoService).validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList());
    Assertions.assertNotNull(productEditValidationDTO);
  }

  @Test
  public void validationsForVarientImagesLocationPathTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductVariantPriceStockAndImagesRequest> productVariantPriceStockAndImagesRequestsList = new ArrayList<>();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest.setLocationPath(null);
    productVariantPriceStockAndImagesRequest.setImages(
        Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantPriceStockAndImagesRequestsList.add(productVariantPriceStockAndImagesRequest);
    productL3UpdateRequest.setProductItems(productVariantPriceStockAndImagesRequestsList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);

  }

  @Test
  public void validationForProductL3ResponseCheckBpBopisEligibilityTest() throws Exception {
    Mockito.when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean()))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void validationForProductL3ResponseisNeedCorrectionTest() throws Exception {
    productL3UpdateRequest.setCategoryCode(CATEGORY_CODE);
    productLevel3.setNeedCorrection(true);
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), productL3UpdateRequest, productCollection)).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse,
        profileResponse, false, null, new ArrayList<>(), productL3UpdateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productLevel3ServiceBean).saveNeedCorrectionChangesInPCB(Mockito.any(ProductLevel3.class),
        Mockito.eq(new ArrayList<>()), Mockito.eq(false), Mockito.eq(null), Mockito.eq(productL3UpdateRequest),
        Mockito.eq(null));
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void validateProductEditInfo_Empty_Category_Code_Test() {
    productL3UpdateRequest.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    productL3UpdateRequest.setCategoryCode(null);
    Assertions.assertThrows(ApplicationRuntimeException.class,
        () -> productLevel3V2Service.validateProductEditInfo(productL3UpdateRequest, null));
  }

  @Test
  public void validationForProductL3ResponseCheckProductStatusTest() throws Exception {
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku()))
        .thenReturn(gdnRestSingleResponse);
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response()))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(Mockito.anyString());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void validationsForCommomImagesLocationPathNotNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);

    Assertions.assertEquals(null, productEditValidationDTO.getEditProductResponse().getApiErrorCode());
  }

  @Test
  public void validationsForCommomImagesLocationPathReviewTypeNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);
  }

  @Test
  public void validationForRestrictedVariantValuesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    Map<String, String> distributionInfoRequest = new HashMap<>();
    distributionInfoRequest.put(PREORDER_TYPE, PREORDER_TYPE);
    productL3UpdateRequest.setDistributionInfoRequest(distributionInfoRequest);
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequests =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequests.setMerchantSku(MERCHANT_CODE);
    productVariantPriceStockAndImagesRequests.setSkuCode(SKU_CODE);
    productVariantPriceStockAndImagesRequests.setNewlyAddedItem(true);
    TreeMap<String, String> mp = new TreeMap<>();
    mp.put("key", "null");
    productL3UpdateRequest.setProductItems(
        List.of(productVariantPriceStockAndImagesRequests, productVariantPriceStockAndImagesRequests));
    productVariantPriceStockAndImagesRequests.setAttributesMap(mp);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);

    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValuesFlag", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValues", Collections.singletonList("null"));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
            profileResponse);
Mockito.verify(distributionInfoService).validateUomInfo(Mockito.anyString(), Mockito.any(), Mockito.anyList());
    Assertions.assertEquals("ERR-PBP100112", productEditValidationDTO.getEditProductResponse().getApiErrorCode().getCode());
  }

  @Test
  public void validationForRestrictedVariantValuesNewlyaddedTrueButNoRestrictedValueTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequests =new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequests.setNewlyAddedItem(true);
    TreeMap<String,String> mp = new TreeMap<>();
    mp.put("key","null1");
    productL3UpdateRequest.setProductItems(Collections.singletonList(productVariantPriceStockAndImagesRequests));
    productVariantPriceStockAndImagesRequests.setAttributesMap(mp);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);

    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValuesFlag", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValues", Collections.singletonList("null"));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
            profileResponse);

    Assertions.assertNull(productEditValidationDTO.getEditProductResponse().getApiErrorCode());
  }

  @Test
  public void validationForRestrictedVariantValuesNewlyAddedFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "ranchIntegrationEnabled", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequests =new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequests.setNewlyAddedItem(false);
    TreeMap<String,String> mp = new TreeMap<>();
    mp.put("key","null");
    productL3UpdateRequest.setProductItems(Collections.singletonList(productVariantPriceStockAndImagesRequests));
    productVariantPriceStockAndImagesRequests.setAttributesMap(mp);
    productL3UpdateRequest.setCommonImages(productLevel3SummaryDetailsImageRequestList);

    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValuesFlag", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "variantRestrictedValues", Collections.singletonList("null"));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
            profileResponse);

  }

  @Test
  public void validationsForVarientImagesLocationPathNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductVariantPriceStockAndImagesRequest> productVariantPriceStockAndImagesRequestsList = new ArrayList<>();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(LOCATION_PATH);
    productVariantPriceStockAndImagesRequest.setImages(
        Collections.singletonList(productLevel3SummaryDetailsImageRequest));
    productVariantPriceStockAndImagesRequestsList.add(productVariantPriceStockAndImagesRequest);
    productL3UpdateRequest.setProductItems(productVariantPriceStockAndImagesRequestsList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);

  }

  @Test
  public void validationsForVarientImagesLocationPathReviewTypeNullTest() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductVariantPriceStockAndImagesRequest> productVariantPriceStockAndImagesRequestsList = new ArrayList<>();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest.setReviewType(null);
    productLevel3SummaryDetailsImageRequest.setLocationPath(null);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(null);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(null);
    List<ProductLevel3SummaryDetailsImageRequest> pp = new ArrayList<>();
    pp.add(null);
    pp.add(productLevel3SummaryDetailsImageRequest);
    productVariantPriceStockAndImagesRequest.setImages(pp);
    productVariantPriceStockAndImagesRequestsList.add(productVariantPriceStockAndImagesRequest);
    productL3UpdateRequest.setProductItems(productVariantPriceStockAndImagesRequestsList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);

  }

  @Test
  public void validationsForVarientImagesLocationPathTest1() throws Exception {
    productL3UpdateRequest = generateProductL3UpdateRequest();
    List<ProductVariantPriceStockAndImagesRequest> productVariantPriceStockAndImagesRequestsList = new ArrayList<>();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    List<ProductLevel3SummaryDetailsImageRequest> productLevel3SummaryDetailsImageRequestList = new ArrayList<>();
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest1 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest1.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest1.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest1);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest2 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest2.setReviewType(null);
    productLevel3SummaryDetailsImageRequest2.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest2);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest3 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest3.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest3.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest3);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest4 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest4.setReviewType(null);
    productLevel3SummaryDetailsImageRequest4.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest4);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest5 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest5.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest5.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest5);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest6 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest6.setReviewType(null);
    productLevel3SummaryDetailsImageRequest6.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest6);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest7 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest7.setReviewType(REVIEW);
    productLevel3SummaryDetailsImageRequest7.setLocationPath(null);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest7);
    productLevel3SummaryDetailsImageRequestList.add(null);
    ProductLevel3SummaryDetailsImageRequest productLevel3SummaryDetailsImageRequest9 =
        new ProductLevel3SummaryDetailsImageRequest();
    productLevel3SummaryDetailsImageRequest9.setReviewType(null);
    productLevel3SummaryDetailsImageRequest9.setLocationPath(LOCATION_PATH);
    productLevel3SummaryDetailsImageRequestList.add(productLevel3SummaryDetailsImageRequest9);
    productVariantPriceStockAndImagesRequest.setImages(productLevel3SummaryDetailsImageRequestList);
    productVariantPriceStockAndImagesRequestsList.add(productVariantPriceStockAndImagesRequest);
    productL3UpdateRequest.setProductItems(productVariantPriceStockAndImagesRequestsList);
    ReflectionTestUtils.setField(productLevel3V2Service, "combineL3AndL5Validation", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null,
          profileResponse);

  }
  @Test
  public void validationForProductL3ResponseCheckProductStatusProductL3ResponseNonNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateYoutubeUrlNewFlow", false);
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response()))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
        generateProductL3Response(), new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void validationForProductL3ResponseCheckProductVersionTest() throws Exception {
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku()))
        .thenReturn(gdnRestSingleResponse);
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    Mockito.when(productLevel3ServiceBean.checkProductVersion(productLevel3, generateProductL3Response()))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(Mockito.anyString());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }


  @Test
  public void validationForProductL3ResponseValidateShippingWeightTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setSynchronize(false);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku()))
        .thenReturn(gdnRestSingleResponse);
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    Mockito.when(productLevel3ServiceBean.checkProductVersion(productLevel3, generateProductL3Response()))
        .thenReturn(null);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    Mockito.when(productLevel3ServiceBean.validateShippingType(Mockito.any(ProductLevel3UpdateRequest.class)))
        .thenReturn(ApiErrorCode.INVALID_DATA_INPUT);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, true, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    verify(xProductOutbound).getProductDetailsByProductSku(Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void validationForProductL3ResponseValidateShippingWeightExceptionNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setSynchronize(false);
    productLevel3.setProductSku(PRODUCT_SKU);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku()))
        .thenReturn(gdnRestSingleResponse);
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    Mockito.when(productLevel3ServiceBean.checkProductVersion(productLevel3, generateProductL3Response()))
        .thenReturn(null);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    Mockito.when(productLevel3ServiceBean.validateShippingType(productLevel3UpdateRequest)).thenReturn(null);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, true, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    verify(xProductOutbound).getProductDetailsByProductSku(Mockito.any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseValidateShippingWeightExceptionNullPreorderTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    Mockito.when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse))
        .thenReturn(null);
    productLevel3.setSynchronize(false);
    productLevel3.setProductSku(PRODUCT_SKU);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(generateProductL3Response());
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku()))
        .thenReturn(gdnRestSingleResponse);
    Mockito.when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    Mockito.when(productLevel3ServiceBean.checkProductVersion(productLevel3, generateProductL3Response()))
        .thenReturn(null);
    Mockito.when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    Mockito.when(productLevel3ServiceBean.validateShippingType(productLevel3UpdateRequest)).thenReturn(null);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, true, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(productLevel3ServiceBean).checkProductStatus(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    Mockito.verify(productLevel3ServiceBean).validateShippingType(Mockito.any());
    verify(xProductOutbound).getProductDetailsByProductSku(Mockito.any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }


  @Test
  public void validationForL3ResponseForEditAndSaveDetailsInPCBInNeedCorrectionAddDeleteVarientErrorTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "valueTypeAdditionForDefiningAttributes", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);
    List<ProductItemLevel3> newlyAddedItems = new ArrayList<>();
    ProductItemLevel3 productItemLevel3 = new ProductItemLevel3();
    newlyAddedItems.add(productItemLevel3);
    productLevel3.setNewlyAddedItems(newlyAddedItems);
    productLevel3.setProductName(PRODUCT_NAME);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.getDefiningAttributes().get(0).setProductAttributeDetails(null);
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, productLevel3.getProductCode()))
        .thenReturn(productCollection);
    when(productRepository.findOne(productCollection.getProductId())).thenReturn(new Product());
    productLevel3.setBrandUpdated(false);
    productLevel3.setProductName("PRODUCT-NAME");
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
    verify(productCollectionRepository,times(1)).findByStoreIdAndProductCode(DEFAULT_STORE_ID, productLevel3.getProductCode());
    verify(productRepository).findOne(productCollection.getProductId());

  }

  @Test
  public void validationForProductL3ResponseAddDeleteVarientErrorNullTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ProductL3Response productL3Response = generateProductL3Response();
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(true);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
      new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setProductItems(Collections.singletonList(stockAndImagesRequest));
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, true);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
      gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
      new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
      updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerPreorderOmgTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(true);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL5.setStock(10);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setProductItems(Collections.singletonList(stockAndImagesRequest));
    updateRequest.setSellerOmg(true);
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    PreOrderRequest preOrderRequest = PreOrderRequest.builder()
        .isPreOrder(true)
        .preOrderType("DATE")
        .preOrderValue(null)
        .preOrderDate(calendar.getTime())
        .build();
    updateRequest.setPreOrder(preOrderRequest);
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, false);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
        updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerPreorderOmgNoItemsTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(true);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL5.setStock(10);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setAddPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setProductItems(new ArrayList<>());
    updateRequest.setSellerOmg(true);
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    PreOrderRequest preOrderRequest = PreOrderRequest.builder()
        .isPreOrder(true)
        .preOrderType("DATE")
        .preOrderValue(null)
        .preOrderDate(calendar.getTime())
        .build();
    updateRequest.setPreOrder(preOrderRequest);
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, true);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
        updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerPreorderOmgMultiPickupPointsTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(false);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL5.setStock(0);
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL52 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL52.setSynchronizeStock(false);
    modifiedL52.setItemSku(ITEM_SKU_2);
    modifiedL52.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL52.setStock(10);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest2 =
        new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    stockAndImagesRequest2.setModifiedItemPickupPoints(Collections.singletonList(modifiedL52));
    updateRequest.setProductItems(Arrays.asList(stockAndImagesRequest, stockAndImagesRequest2));
    updateRequest.setSellerOmg(true);
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    PreOrderRequest preOrderRequest = PreOrderRequest.builder()
        .isPreOrder(true)
        .preOrderType("DATE")
        .preOrderValue(null)
        .preOrderDate(calendar.getTime())
        .build();
    updateRequest.setPreOrder(preOrderRequest);
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, false);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
        updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerPreorderOmgAddPickupPointsTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(true);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL5.setStock(10);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setProductItems(Collections.singletonList(stockAndImagesRequest));
    updateRequest.setSellerOmg(true);
    updateRequest.setAddPickupPoints(Collections.singletonList(modifiedL5));
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    PreOrderRequest preOrderRequest = PreOrderRequest.builder()
        .isPreOrder(true)
        .preOrderType("DATE")
        .preOrderValue(null)
        .preOrderDate(calendar.getTime())
        .build();
    updateRequest.setPreOrder(preOrderRequest);
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, false);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
        updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseForFaasSellerPreorderOmgFbbTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    Mockito.when(preOrderConfig.isPoQuotaFeatureSwitch()).thenReturn(true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductL3UpdateRequest updateRequest = new ProductL3UpdateRequest();
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 = new com.gda.mta.product.dto.ItemPickupPointRequest();
    modifiedL5.setSynchronizeStock(true);
    modifiedL5.setItemSku(ITEM_SKU);
    modifiedL5.setPickupPointId(PICKUP_POINT_CODE);
    modifiedL5.setStock(10);
    ProductVariantPriceStockAndImagesRequest stockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    stockAndImagesRequest.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    updateRequest.setProductItems(Collections.singletonList(stockAndImagesRequest));
    updateRequest.setSellerOmg(true);
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    PreOrderRequest preOrderRequest = PreOrderRequest.builder()
        .isPreOrder(false)
        .preOrderType("DATE")
        .preOrderValue(null)
        .preOrderDate(calendar.getTime())
        .build();
    updateRequest.setPreOrder(preOrderRequest);
    Map<String, Object> flags = new HashMap<>();
    flags.put(FAAS_ACTIVATED, true);
    profileResponse.setFlags(flags);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(),
        updateRequest, false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidationTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(false);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(5);
    agpSimpleQueryResponse.setHits(hitsResponse);
    ProductL3Response productL3Response = generateProductL3Response();
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    ProductEditValidationDTO response =
        productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
            null, new ArrayList<>(), new ProductL3UpdateRequest(), false,false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString());
    Assertions.assertEquals(ApiErrorCode.NAME_EDIT_NOT_ALLOWED, response.getEditProductResponse().getApiErrorCode());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidation_AgpNullResponseTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(false);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    agpSimpleQueryResponse.setHits(null);
    ProductL3Response productL3Response = generateProductL3Response();
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    ProductEditValidationDTO response =
        productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
            null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidation_AgpExceptionTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(false);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(5);
    agpSimpleQueryResponse.setHits(hitsResponse);
    ProductL3Response productL3Response = generateProductL3Response();
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    Mockito.when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenThrow(ApplicationRuntimeException.class);
    try {
      ProductEditValidationDTO response =
          productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
              null, new ArrayList<>(), new ProductL3UpdateRequest(), false,false);
    } catch (Exception e) {
    } finally {
      verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
      verify(xProductOutbound).getProductDetailsByProductSku(anyString());
      verify(productLevel3ServiceBean).checkProductStatus(any());
      verify(productLevel3ServiceBean).checkProductVersion(any(), any());
      verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
          Mockito.anyString());
      verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
      verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
      verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
    }
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidation_WrongOrderTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(false);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(0);
    agpSimpleQueryResponse.setHits(hitsResponse);
    ProductL3Response productL3Response = generateProductL3Response();
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    ProductEditValidationDTO response =
        productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
            null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidation_NullAgpResponseTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "syncProductDataOnMasterDataUpdate", true);
    profileResponse.setOfficial(false);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    ProductL3Response productL3Response = generateProductL3Response();
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(null);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    ProductEditValidationDTO response =
        productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false,
            null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidationFalseTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(true);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(5);
    agpSimpleQueryResponse.setHits(hitsResponse);
    ProductL3Response productL3Response = generateProductL3Response();
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(),false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void validationForProductL3ResponseAddDeleteVariantSwitchOffNameEditValidation_NoNameEditTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
        productLevel3.getProductCode())).thenReturn(productCollection);
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(true);
    productLevel3.setCategoryCode(CATEGORY_CODE);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(5);
    agpSimpleQueryResponse.setHits(hitsResponse);
    ProductL3Response productL3Response = generateProductL3Response();
    productL3Response.getMasterDataProduct().setProductName("New Product");
    productLevel3.setProductName("New Product");
    when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    when(productService.checkBpBopisEligibility(productLevel3.getProductType(), profileResponse)).thenReturn(null);
    productLevel3.setProductSku(PRODUCT_SKU);
    GdnRestSingleResponse<ProductL3Response> gdnRestSingleResponse = new GdnRestSingleResponse<>();
    gdnRestSingleResponse.setValue(productL3Response);
    when(xProductOutbound.getProductDetailsByProductSku(productLevel3.getProductSku())).thenReturn(
        gdnRestSingleResponse);
    when(productLevel3ServiceBean.checkProductStatus(generateProductL3Response())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(productLevel3, productL3Response)).thenReturn(null);
    when(productLevel3ServiceBean.saveNeedCorrectionChangesInPCB(productLevel3, new ArrayList<>(), false,
        new ProductL3Response(), null, new ProductCollection())).thenReturn(editResponse);
    productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(productLevel3, editResponse, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(),false, false);
    verify(productService).checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean());
    verify(xProductOutbound).getProductDetailsByProductSku(anyString());
    verify(productLevel3ServiceBean).checkProductStatus(any());
    verify(productLevel3ServiceBean).checkProductVersion(any(), any());
    verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    verify(productLevel3ServiceBean).brandChangeCheck(Mockito.any(), Mockito.any());
    verify(productOutboundBean).getCategoryDetailByCategoryCode(CATEGORY_CODE);
  }

  @Test
  public void getAttributeCodeAndIdMapTest() throws Exception {
    Mockito.when(productOutbound.getAttributeDetailByAttributeCodes(eq(true), any()))
        .thenReturn(Arrays.asList(attribute));
    productLevel3V2Service.getAttributeCodeAndIdMap(true, new AttributeCodesRequest());
    Mockito.verify(productOutbound).getAttributeDetailByAttributeCodes(eq(true), any());
  }

  @Test
  public void getAttributeCodeAndIdMapNewValueTest() throws Exception {
    attribute2.setId(PRODUCT_CODE);
    Mockito.when(productOutbound.getAttributeDetailByAttributeCodes(eq(true), any()))
        .thenReturn(Arrays.asList(attribute, attribute2));
    productLevel3V2Service.getAttributeCodeAndIdMap(true, new AttributeCodesRequest());
    Mockito.verify(productOutbound).getAttributeDetailByAttributeCodes(eq(true), any());
  }

  @Test
  public void performProductDetailEditTest() throws Exception {
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID,
      productLevel3.getProductCode())).thenReturn(productCollection);
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ItemResponse itemResponse = new ItemResponse();
    itemResponse.setItemSku(ITEM_SKU);
    itemResponse.setProductSku(PRODUCT_SKU);
    itemResponse.setItemCode(ITEM_CODE);
    productAndItemsResponse.setItems(Collections.singletonList(itemResponse));
    Mockito.when(productLevel3Repository.findDetailByGdnSku(anyString())).thenReturn(productAndItemsResponse);
    EditProductResponse editProductResponse = new EditProductResponse();
    ProductL3Response productL3Response = generateProductL3Response();
    ProductEditValidationDTO productEditValidationDTO = new ProductEditValidationDTO();
    productEditValidationDTO.setProductLevel3(productLevel3);
    productEditValidationDTO.setProductL3Response(productL3Response);
    Mockito.when(productLevel3ServiceBean.generateProductLevel3(productAndItemsResponse, null,
        pickupPointResponse, null, null, null, new HashMap<>(), new ArrayList<>(), false))
      .thenReturn(productLevel3);
    Mockito.when(productLevel3ServiceBean.generateProductLevel3Detail(productL3Response,
      new ArrayList<>(), new ArrayList<>(), null)).thenReturn(new ProductL3DetailsResponse());
    ProductEditValidationDTO actualProductEditValidationDTO = productLevel3V2Service.performProductDetailEdit(
      true, true, true, editProductResponse,
      productEditValidationDTO, profileResponse);
    Mockito.verify(productLevel3ServiceBean).generateProductLevel3(productAndItemsResponse, null,
      pickupPointResponse, null, null, null, new HashMap<>(), new ArrayList<>(), false);
    Mockito.verify(productLevel3ServiceBean).generateProductLevel3Detail(productL3Response,
      new ArrayList<>(), new ArrayList<>(), null);

  }

  @Test
  public void performProductDetailEditWithAddDeleteVariantSwitchTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "addDeleteVariantsValidationSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "productNameEditValidationSwitch", true);
    profileResponse.setOfficial(false);
    AgpSimpleQueryResponse agpSimpleQueryResponse = new AgpSimpleQueryResponse();
    HitsResponse hitsResponse = new HitsResponse();
    hitsResponse.setTotal(10);
    agpSimpleQueryResponse.setHits(hitsResponse);
    Mockito.when(agpQueryFeign.findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(),
        Mockito.anyString())).thenReturn(agpSimpleQueryResponse);
    Mockito.when(
            productCollectionRepository.findByStoreIdAndProductCode(DEFAULT_STORE_ID, productLevel3.getProductCode()))
        .thenReturn(productCollection);
    ProductAndItemsResponse productAndItemsResponse = new ProductAndItemsResponse();
    ItemResponse itemResponse = new ItemResponse();
    itemResponse.setItemSku(ITEM_SKU);
    itemResponse.setProductSku(PRODUCT_SKU);
    itemResponse.setItemCode(ITEM_CODE);
    productAndItemsResponse.setItems(Collections.singletonList(itemResponse));
    Mockito.when(productLevel3Repository.findDetailByGdnSku(anyString())).thenReturn(productAndItemsResponse);
    EditProductResponse editProductResponse = new EditProductResponse();
    ProductL3Response productL3Response = generateProductL3Response();
    ProductEditValidationDTO productEditValidationDTO = new ProductEditValidationDTO();
    productEditValidationDTO.setProductLevel3(productLevel3);
    productEditValidationDTO.setProductL3Response(productL3Response);
    Mockito.when(productLevel3ServiceBean.generateProductLevel3(productAndItemsResponse, null,
        pickupPointResponse, null, null, null, new HashMap<>(), new ArrayList<>(), false))
      .thenReturn(productLevel3);
    Mockito.when(productLevel3ServiceBean.generateProductLevel3Detail(productL3Response,
      new ArrayList<>(), new ArrayList<>(), null)).thenReturn(new ProductL3DetailsResponse());
    ProductEditValidationDTO actualProductEditValidationDTO = productLevel3V2Service.performProductDetailEdit(
      true, true, true, editProductResponse,
      productEditValidationDTO, profileResponse);
    Mockito.verify(productLevel3ServiceBean).generateProductLevel3(productAndItemsResponse, null,
      pickupPointResponse, null, null, null, new HashMap<>(), new ArrayList<>(), false);
    Mockito.verify(productLevel3ServiceBean).generateProductLevel3Detail(productL3Response,
      new ArrayList<>(), new ArrayList<>(), null);
  }

  @Test
  public void updateBrandDataOfProductTest() throws Exception {
    productCollection.setReviewPending(true);
    productCollection.setProductId(PRODUCT_SKU);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.anyString(), Mockito.eq(PRODUCT_CODE)))
        .thenReturn(productCollection);
    Mockito.when(
            productBusinessPartnerRepository.findFirstByStoreIdAndProductId(Mockito.anyString(), Mockito.anyString()))
        .thenReturn(productBusinessPartner);
    Mockito.when(productRepository.updateProductBrandData(Mockito.any())).thenReturn(productBrandUpdateResponse);
    productLevel3V2Service.updateBrandDataOfProduct(PRODUCT_CODE, brandUpdateRequest);
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE);
    Mockito.verify(productBusinessPartnerRepository)
        .findFirstByStoreIdAndProductId(STORE_ID, productCollection.getProductId());
    Mockito.verify(productRepository).updateProductBrandData(Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productDistributionTaskRepository).updateProductBrand(Mockito.any());
    Mockito.verify(productCollectionRepository).save(productCollection);
    Mockito.verify(productBusinessPartnerRepository).save(productBusinessPartner);
    Mockito.verify(productLevel1HistoryService).saveProductHistory(Mockito.eq(PRODUCT_CODE), Mockito.any(),
        Mockito.eq(ProductWorkflowLookup.STATE_EDIT_DESCRIPTION), Mockito.anyString());
  }

  @Test
  public void updateBrandDataOfProductReviewPendingFalseTest() throws Exception {
    productCollection.setProductId(PRODUCT_SKU);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.anyString(), Mockito.eq(PRODUCT_CODE)))
        .thenReturn(productCollection);
    Mockito.when(
            productBusinessPartnerRepository.findFirstByStoreIdAndProductId(Mockito.anyString(), Mockito.anyString()))
        .thenReturn(productBusinessPartner);
    Mockito.when(productRepository.updateProductBrandData(Mockito.any())).thenReturn(productBrandUpdateResponse);
    productLevel3V2Service.updateBrandDataOfProduct(PRODUCT_CODE, brandUpdateRequest);
    Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE);
    Mockito.verify(productBusinessPartnerRepository)
        .findFirstByStoreIdAndProductId(STORE_ID, productCollection.getProductId());
    Mockito.verify(productRepository).updateProductBrandData(Mockito.any());
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(null, PRODUCT_CODE, false);
    Mockito.verify(productCollectionRepository).save(productCollection);
    Mockito.verify(productBusinessPartnerRepository).save(productBusinessPartner);
    Mockito.verify(productLevel1HistoryService).saveProductHistory(Mockito.eq(PRODUCT_CODE), Mockito.any(),
        Mockito.eq(ProductWorkflowLookup.STATE_EDIT_DESCRIPTION), Mockito.anyString());
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit_AutoApprovalTypeCONTENT_AND_IMAGE_InternalProductHistoryEventModelNotNull_Success()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
      new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerRepository)
      .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
          eq(StringUtils.EMPTY));
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditTest()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productDetailEditDTO.setProductSku(PRODUCT_SKU);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
      new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
      Mockito.doThrow(ApplicationRuntimeException.class).when(xProductOutbound)
        .updateEditedProductAndItemPickupPoint(anyString(), anyBoolean(), any());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
            productDetailEditDTO, editProductResponse);
      });
    }
    finally {
      Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(),anyBoolean(),
        any());
    }
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditAutoRejectFalseTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
        new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(),anyBoolean(),any());
    verify(productLevel3ServiceBean).updateProductCollectionAndSolrAndPublishHistoryEvent(any(),
      any(), anyList(),any(), eq(StringUtils.EMPTY));
    verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditWithNoAutoApprovalFalseTest()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(null);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    ProductLevel3AttributeResponse productLevel3AttributeResponse =
      new ProductLevel3AttributeResponse();
    productLevel3AttributeResponse.setVariantCreation(false);
    productLevel3AttributeResponse.setAttributeName("NonWarna");
    productLevel3DetailResponse.setAttributes(Collections.singletonList(productLevel3AttributeResponse));
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
      new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(),anyBoolean(),any());
    verify(productLevel3ServiceBean).updateProductCollectionAndSolrAndPublishHistoryEvent(any(),
      any(), anyList(),any(), eq(StringUtils.EMPTY));
    verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditWithWarnaTest()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(null);
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    ProductLevel3AttributeResponse productLevel3AttributeResponse =
      new ProductLevel3AttributeResponse();
    productLevel3AttributeResponse.setVariantCreation(true);
    productLevel3AttributeResponse.setAttributeName("NonWarna");
    productLevel3DetailResponse.setAttributes(Collections.singletonList(productLevel3AttributeResponse));
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
      new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(),anyBoolean(),any());
    verify(productLevel3ServiceBean).updateProductCollectionAndSolrAndPublishHistoryEvent(any(),
      any(), anyList(),any(), eq(StringUtils.EMPTY));
    verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditAutoRejectTrueEditableFalseTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    ProductLevel3AttributeResponse productLevel3AttributeResponse =
      new ProductLevel3AttributeResponse();
    productLevel3AttributeResponse.setVariantCreation(true);
    productLevel3AttributeResponse.setAttributeName("NonWarna");
    productLevel3DetailResponse.setAttributes(Collections.singletonList(productLevel3AttributeResponse));
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
        new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductEditable(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryTakeDownFalseTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    productDetailEditDTO.setReviewTypeList(null);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
        new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setTakeDownProduct(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(eq(StringUtils.EMPTY),
        eq(productCollection), eq(null), eq(productDetailEditDTO), eq(StringUtils.EMPTY));
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEditBusinessPartnerNullTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
        new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    productDetailEditDTO.setProductBusinessPartner(null);
    productDetailEditDTO.setProductTypeChanged(false);
    productDetailEditDTO.setDimensionUpdated(true);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
        .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
            eq(StringUtils.EMPTY));
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryhandleVendorPublishEventNotEligibleTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(3);
    editProductResponse.setProfileResponse(ProfileResponse.builder().trustedSeller(true).build());
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setContentType("IMAGE");
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
        new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setTakeDownProduct(false);
    editProductResponse.setAction(2);
    editProductResponse.getProfileResponse().setTrustedSeller(false);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
        .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
            eq(StringUtils.EMPTY));
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryProductHistoryFalseTest()
      throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductSku(PRODUCT_SKU);
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(1);
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setCategoryResponse(new CategoryResponse());
    ProductCollection productCollection =
        ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel = null;
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    when(xProductOutbound.generateProductScoreByProductSkuOrProductCode(PRODUCT_SKU, null,
      true)).thenReturn(L3VersionResponse.builder().l3Version(3L).build());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    productDetailEditDTO.setProductHistory(new ProductHistory());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productDetailEditDTO.setProductHistory(null);
    productDetailEditDTO.setProductDetailEditRequestForXProduct(null);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
        productDetailEditDTO, editProductResponse);
    Mockito.verify(productBusinessPartnerRepository)
        .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
        .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
            eq(StringUtils.EMPTY));
    Mockito.verify(xProductOutbound).generateProductScoreByProductSkuOrProductCode(PRODUCT_SKU,
      null, true);
  }

  @Test
  public void updateAllCollectionsDownstreamAndUpdateUpcCodeTest()
    throws Exception {
    ProductLevel3DetailResponse productLevel3DetailResponse = new ProductLevel3DetailResponse();
    ProductLevel3AttributeResponse productLevel3AttributeResponse =
      new ProductLevel3AttributeResponse();
    productLevel3AttributeResponse.setVariantCreation(true);
    productLevel3AttributeResponse.setAttributeName("Warna");
    productLevel3DetailResponse.setAttributes(Collections.singletonList(productLevel3AttributeResponse));
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductItemUpcCodeUpdateRequests(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(1);
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setProductLevel3DetailResponse(productLevel3DetailResponse);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setAllModifiedFields(Collections.singletonList(CATEGORY_CODE));
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel = null;
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    productDetailEditDTO.setProductHistory(new ProductHistory());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    editProductDetailRequest.setProductItemUpcCodeUpdateRequestList(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    productDetailEditDTO.setProductHistory(null);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
        List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(any(), any(), anyBoolean(), anyBoolean(),
        anyBoolean(), any(), any(), any(), any(), any())).thenReturn(pair);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerRepository)
      .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
          eq(StringUtils.EMPTY));
    verify(productLevel3Service).copyProductLevel3ToProductAndUpdateToPCB(any(), any(), anyBoolean(), anyBoolean(),
        anyBoolean(), any(), any(), any(), any(), any());
  }

  @Test
  public void updateAllCollectionsDownstreamAndUpdateUpcCodeAndNOModifiesFieldsTest()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    productDetailEditDTO.setProductItemUpcCodeUpdateRequests(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(1);
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    productDetailEditDTO.setAllModifiedFields(Collections.emptyList());
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel = null;
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    productDetailEditDTO.setProductHistory(new ProductHistory());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    editProductDetailRequest.setProductItemUpcCodeUpdateRequestList(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    productDetailEditDTO.setProductHistory(null);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
        List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(any(), any(), anyBoolean(), anyBoolean(),
        anyBoolean(), any(), any(), any(), any(), any())).thenReturn(pair);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerRepository)
      .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
          eq(StringUtils.EMPTY));
    verify(productLevel3Service).copyProductLevel3ToProductAndUpdateToPCB(any(), any(), anyBoolean(), anyBoolean(),
        anyBoolean(), any(), any(), any(), any(), any());
  }


  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit_InternalProductHistoryEventModelNotNull_Success()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    productDetailEditDTO.setProductTypeChanged(true);
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.NOT_ELIGIBLE);
    InternalProductHistoryEventModel internalProductHistoryEventModel =
      new InternalProductHistoryEventModel();
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, new EditProductResponse());
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerRepository)
      .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
          eq(StringUtils.EMPTY));
  }

  @Test
  public void updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit_SaveHistoryNotNull_Success()
    throws Exception {
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForAutoReject(true);
    EditProductResponse editProductResponse = new EditProductResponse();
    editProductResponse.setAction(1);
    ProductCollectionDTO productCollectionDTO = new ProductCollectionDTO();
    productCollectionDTO.setProductCode(PRODUCT_CODE);
    productCollectionDTO.setEdited(true);
    ProductCollection productCollection =
      ConverterUtil.convertDtoToProductCollection(productCollectionDTO);
    productDetailEditDTO.setProductCollectionDTO(productDetailEditDTO.getProductCollectionDTO());
    productDetailEditDTO.setTakeDownProduct(true);
    ProductDetailPageEditRequest productDetailPageEditRequest = new ProductDetailPageEditRequest();
    productDetailPageEditRequest.setEditChangeType(EditChangeType.CONTENT);
    ProductEditRequest productEditRequest = new ProductEditRequest();
    productEditRequest.setProductSku(PRODUCT_SKU);
    productDetailPageEditRequest.setProductEditRequest(productEditRequest);
    productDetailEditDTO.setProductBusinessPartner(productBusinessPartner);
    productDetailEditDTO.setProductEditable(true);
    editProductDetailRequest.setProductRequest(productRequest);
    productCollectionDTO.setBrandApprovalStatus(BrandApprovalStatus.REJECTED);
    productDetailEditDTO.setProductCollectionDTO(productCollectionDTO);
    productDetailEditDTO.setAutoApprovalType(AutoApprovalType.CONTENT_AND_IMAGE);
    InternalProductHistoryEventModel internalProductHistoryEventModel = null;
    when(xProductOutbound.updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any())).thenReturn(new CombinedEditItemResponse());
    productDetailEditDTO.setProductDetailEditRequestForXProduct(productDetailPageEditRequest);
    productDetailEditDTO.setInternalProductHistoryEventModel(internalProductHistoryEventModel);
    productDetailEditDTO.setProductHistory(new ProductHistory());
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    editProductDetailRequest.setResetExtractedAttributeValue(true);
    productLevel3V2Service.updateAllCollectionsDownstreamAndProcessHistoryForPDPEdit(
      productDetailEditDTO, editProductResponse);
    Mockito.verify(xProductOutbound).updateEditedProductAndItemPickupPoint(any(), anyBoolean(), any());
    Mockito.verify(productBusinessPartnerRepository)
      .save(productDetailEditDTO.getProductBusinessPartner());
    Mockito.verify(productLevel3ServiceBean).createAuditLogsForEdit(any(), any(), anyBoolean());
    Mockito.verify(productService).saveProductHistory(anyString(),any());
    Mockito.verify(productLevel3ServiceBean)
      .updateProductCollectionAndSolrAndPublishHistoryEvent(any(), any(), anyList(), any(),
          eq(StringUtils.EMPTY));
  }


  @Test
  public void updateBrandDataOfProductProductNotFoundTest() throws Exception {
    productCollection.setProductId(PRODUCT_SKU);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(Mockito.anyString(), Mockito.eq(PRODUCT_CODE)))
        .thenReturn(null);
    try {
      Assertions.assertThrows(ApiIncorrectInputDataException.class, () -> {
        productLevel3V2Service.updateBrandDataOfProduct(PRODUCT_CODE, brandUpdateRequest);
      });
    } finally {
      Mockito.verify(productCollectionRepository).findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE);
    }
  }

  @Test
  public void testPerformPCBUpdateForPDPEditRequest() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection(); // Set up your ProductCollection object
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productDetailEditDTO.setProductLevel3(productLevel3);
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    Assertions.assertNull(response.getNewlySavedItemResponses());
  }

  @Test
  public void testPerformPCBUpdateForPDPEditRequestSwitchOnHeal() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "processVariantImageNewlyAddedItems", true);
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection();
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of(productRequest,null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productDetailEditDTO.setProductLevel3(productLevel3);
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    Assertions.assertNull(response.getNewlySavedItemResponses());
  }

  @Test
  public void testPerformPCBUpdateForPDPEditRequestHistoryForUPC() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection();
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest, List<NewlySavedItemResponse>> pair =
        Pair.of(new ProductRequest(), null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productDetailEditDTO.setProductLevel3(productLevel3);
    productDetailEditDTO.setHistoryForUPC(Arrays.asList(new HashMap<>()));
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any())).thenReturn(
        EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any())).thenReturn(
        new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection, productLevel3, false, false,
        false, categoryResponse, new EditProductResponse(), productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response =
        productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    Assertions.assertNull(response.getNewlySavedItemResponses());
  }

  @Test
  public void testPerformPCBUpdateForPDPEditRequestWithProductRequest() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection();
    productDetailEditDTO.setProductRequestForPCB(productRequest);
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productDetailEditDTO.setProductLevel3(productLevel3);
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    verify(productRepository, times(1)).updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any());
    Assertions.assertNull(response.getNewlySavedItemResponses());

  }


  @Test
  public void testPerformPCBUpdateForPDPEditRequestWithNullProductRequest() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection();
    productDetailEditDTO.setEligibleForPCBUpdate(true);
    productDetailEditDTO.setProductItemUpcCodeUpdateRequests(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productDetailEditDTO.setProductLevel3(productLevel3);
    productDetailEditDTO.setProductRequestForPCB(null);
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    verify(productRepository, times(1)).updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any());
    Assertions.assertNull(response.getNewlySavedItemResponses());

  }


  @Test
  public void testPerformPCBUpdateForPDPEditWithUpcUpdateRequest() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setEligibleForPCBUpdate(true);
    productDetailEditDTO.setProductItemUpcCodeUpdateRequests(Collections.singletonList(new ProductItemUpcCodeUpdateRequest()));
    productDetailEditDTO.setAllModifiedFields(Collections.singletonList(PRODUCT_NAME));
    ProductCollection productCollection = new ProductCollection();
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    productDetailEditDTO.setCategoryResponse(categoryResponse);
    productLevel3.setProductName(null);
    productDetailEditDTO.setProductLevel3(productLevel3);
    productCollection.setProductCode(PRODUCT_CODE);
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    verify(productRepository, times(1)).updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any());
    verify(productService, times(1)).publishAddEditedProductToPDTEvent(any(), any(), any(), any());
  }

  @Test
  public void testPerformPCBUpdateForPDPEditWithUpcUpdateRequestWithEmptyUpc() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    productDetailEditDTO.setProductImageEditRequests(Collections.singletonList(new ProductImageEditRequest()));
    productLevel3.setProductName(null);
    productDetailEditDTO.setProductLevel3(productLevel3);
    ProductCollection productCollection = new ProductCollection();
    productCollection.setProductCode(PRODUCT_CODE);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of(productRequest,null);
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    when(productRepository.updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any()))
      .thenReturn(EditProductItemAndImageResponse.builder().build());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(any(),
      any(), anyBoolean(), anyBoolean(), anyBoolean(),any(), any(),
      any(), any(), eq(null))).thenReturn(pair);
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    EditProductItemAndImageResponse response = productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO, productCollection);
    verify(productRepository, times(1)).updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any());
  }

  @Test
  public void basicAPIValidationEditAndSaveDetailsInPCBInNeedCorrection_BrandCategoryEditEnabled_WipBrandFlowAndNoOrders() throws Exception {
    // Avoid xProduct outbound interaction checked in class tearDown
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    // Enable brand/category edit flow for external
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);

    // Arrange product and edit response with brand change
    ProductLevel3 product = new ProductLevel3();
    product.setProductSku(PRODUCT_SKU);
    product.setCategoryCode(CATEGORY_CODE);
    product.setBrand("Requested Brand");
    product.setBrandCode("NEW-BRAND-CODE");
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);

    EditProductResponse editResp = new EditProductResponse();
    ProductCollection pc = new ProductCollection();
    pc.setProductCode(PRODUCT_CODE);
    pc.setBrand("Old Brand");
    pc.setBrandCode("OLD-BRAND-CODE");
    editResp.setProductCollection(pc);

    // X-Product details
    ProductL3Response saved = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> savedResp = new GdnRestSingleResponse<>();
    savedResp.setValue(saved);
    when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(savedResp);

    // Pass earlier validations
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductStatus(any())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(any(), any())).thenReturn(null);

    // Category detail
    when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE)).thenReturn(new CategoryDetailResponse());

    // PCB brand filter returns null to trigger WIP flow
    when(mandatoryParameterHelper.getStoreId()).thenReturn("store");
    when(mandatoryParameterHelper.getChannelId()).thenReturn("channel");
    when(mandatoryParameterHelper.getClientId()).thenReturn("client");
    when(mandatoryParameterHelper.getRequestId()).thenReturn("req");
    when(mandatoryParameterHelper.getUsername()).thenReturn("user");
    when(pcbFeign.filterByBrandName(any(), any(), any(), any(), any(), anyString(), anyBoolean(), anyBoolean()))
        .thenReturn(null);
    BrandWipResponse wip = new BrandWipResponse();
    wip.setBrandName("WIP-Brand");
    when(this.createProductWorkflowWorkerBean.getBrandWipResponseAndValidateBrandStatus(anyString(), anyString(), anyString()))
        .thenReturn(wip);

    // AGP returns null or hits null => no error
    when(agpQueryFeign.findNumberOfOrder(anyString(), anyString(), anyString(), anyString()))
        .thenReturn(new AgpSimpleQueryResponse());
    product.setProductCode(PRODUCT_CODE);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);
    ProductEditValidationDTO result = productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(
        product, editResp, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);

    // Assert brand updated on product and collection; no api error
    Assertions.assertNull(result.getEditProductResponse().getApiErrorCode());
    Assertions.assertTrue(product.isBrandUpdated());

    // Verify interactions
    verify(pcbFeign).filterByBrandName(anyString(), anyString(), anyString(), anyString(), anyString(), anyString(), anyBoolean(), anyBoolean());
    verify(this.createProductWorkflowWorkerBean).getBrandWipResponseAndValidateBrandStatus(anyString(), anyString(), anyString());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(productLevel3ServiceBean).checkProductStatus(any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    // migrate unsynced product must be called at the end
    Mockito.verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    // AGP should be queried once (brand updated path checks orders)
    Mockito.verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString());
    Mockito.verifyNoMoreInteractions(productLevel3ServiceBean);
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(agpQueryFeign);
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void basicAPIValidationEditAndSaveDetailsInPCBInNeedCorrectionNonNullTest() throws Exception {
    // Avoid xProduct outbound interaction checked in class tearDown
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    // Enable brand/category edit flow for external
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);

    // Arrange product and edit response with brand change
    ProductLevel3 product = new ProductLevel3();
    product.setProductSku(PRODUCT_SKU);
    product.setCategoryCode(CATEGORY_CODE);
    product.setBrand("Requested Brand");
    product.setBrandCode("NEW-BRAND-CODE");
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);

    EditProductResponse editResp = new EditProductResponse();
    ProductCollection pc = new ProductCollection();
    pc.setProductCode(PRODUCT_CODE);
    pc.setBrand("Old Brand");
    pc.setBrandCode("OLD-BRAND-CODE");
    editResp.setProductCollection(pc);

    // X-Product details
    ProductL3Response saved = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> savedResp = new GdnRestSingleResponse<>();
    savedResp.setValue(saved);
    when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(savedResp);

    // Pass earlier validations
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductStatus(any())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(any(), any())).thenReturn(null);

    // Category detail
    when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE)).thenReturn(new CategoryDetailResponse());

    // PCB brand filter returns null to trigger WIP flow
    when(mandatoryParameterHelper.getStoreId()).thenReturn("store");
    when(mandatoryParameterHelper.getChannelId()).thenReturn("channel");
    when(mandatoryParameterHelper.getClientId()).thenReturn("client");
    when(mandatoryParameterHelper.getRequestId()).thenReturn("req");
    when(mandatoryParameterHelper.getUsername()).thenReturn("user");
    when(pcbFeign.filterByBrandName(any(), any(), any(), any(), any(), anyString(), anyBoolean(), anyBoolean()))
        .thenReturn(new GdnRestSingleResponse<>());
    BrandWipResponse wip = new BrandWipResponse();
    wip.setBrandName("WIP-Brand");
    when(this.createProductWorkflowWorkerBean.getBrandWipResponseAndValidateBrandStatus(anyString(), anyString(), anyString()))
        .thenReturn(wip);

    // AGP returns null or hits null => no error
    when(agpQueryFeign.findNumberOfOrder(anyString(), anyString(), anyString(), anyString()))
        .thenReturn(new AgpSimpleQueryResponse());
    product.setProductCode(PRODUCT_CODE);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);
    ProductEditValidationDTO result = productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(
        product, editResp, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);

    // Assert brand updated on product and collection; no api error
    Assertions.assertNull(result.getEditProductResponse().getApiErrorCode());
    Assertions.assertTrue(product.isBrandUpdated());

    // Verify interactions
    verify(pcbFeign).filterByBrandName(anyString(), anyString(), anyString(), anyString(), anyString(), anyString(), anyBoolean(), anyBoolean());
    verify(this.createProductWorkflowWorkerBean).getBrandWipResponseAndValidateBrandStatus(anyString(), anyString(), anyString());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(productLevel3ServiceBean).checkProductStatus(any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    // migrate unsynced product must be called at the end
    Mockito.verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    // AGP should be queried once (brand updated path checks orders)
    Mockito.verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString());
    Mockito.verifyNoMoreInteractions(productLevel3ServiceBean);
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(agpQueryFeign);
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void basicAPIValidationEditAndSaveDetailsInPCBInNeedCorrectionNonNullTest1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);
    ProductLevel3 product = new ProductLevel3();
    product.setProductSku(PRODUCT_SKU);
    product.setCategoryCode(CATEGORY_CODE);
    product.setBrand("Requested Brand");
    product.setBrandCode("NEW-BRAND-CODE");
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    EditProductResponse editResp = new EditProductResponse();
    ProductCollection pc = new ProductCollection();
    pc.setProductCode(PRODUCT_CODE);
    pc.setBrand("Old Brand");
    pc.setBrandCode("OLD-BRAND-CODE");
    editResp.setProductCollection(pc);
    ProductL3Response saved = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> savedResp = new GdnRestSingleResponse<>();
    savedResp.setValue(saved);
    when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(savedResp);
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductStatus(any())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(any(), any())).thenReturn(null);
    when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE)).thenReturn(new CategoryDetailResponse());

    when(mandatoryParameterHelper.getStoreId()).thenReturn("store");
    when(mandatoryParameterHelper.getChannelId()).thenReturn("channel");
    when(mandatoryParameterHelper.getClientId()).thenReturn("client");
    when(mandatoryParameterHelper.getRequestId()).thenReturn("req");
    when(mandatoryParameterHelper.getUsername()).thenReturn("user");
    GdnRestSingleResponse gdnRestSingleResponse = new GdnRestSingleResponse();
    BrandResponse brandResponse = new BrandResponse();
    brandResponse.setBrandCode("NEW-BRAND-CODE");
    gdnRestSingleResponse.setValue(brandResponse);
    when(pcbFeign.filterByBrandName(any(), any(), any(), any(), any(), anyString(), anyBoolean(), anyBoolean()))
        .thenReturn(gdnRestSingleResponse);
    BrandWipResponse wip = new BrandWipResponse();
    wip.setBrandName("WIP-Brand");
    when(this.createProductWorkflowWorkerBean.getBrandWipResponseAndValidateBrandStatus(anyString(), anyString(), anyString()))
        .thenReturn(wip);
    when(agpQueryFeign.findNumberOfOrder(anyString(), anyString(), anyString(), anyString()))
        .thenReturn(new AgpSimpleQueryResponse());
    product.setProductCode(PRODUCT_CODE);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);

    ProductEditValidationDTO result = productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(
        product, editResp, profileResponse, false, null, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    Assertions.assertNull(result.getEditProductResponse().getApiErrorCode());
    Assertions.assertEquals("NEW-BRAND-CODE", result.getEditProductResponse().getProductCollection().getBrandCode());
    verify(pcbFeign).filterByBrandName(anyString(), anyString(), anyString(), anyString(), anyString(), anyString(), anyBoolean(), anyBoolean());
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    verify(productLevel3ServiceBean).checkProductStatus(any());
    Mockito.verify(productLevel3ServiceBean).checkProductVersion(Mockito.any(), Mockito.any());
    Mockito.verify(productLevel3ServiceBean).migrateUnsyncProductForEdit(Mockito.any(), Mockito.anyBoolean());
    Mockito.verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString());
    Mockito.verifyNoMoreInteractions(productLevel3ServiceBean);
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(agpQueryFeign);
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void basicAPIValidationEditAndSaveDetailsInPCBInNeedCorrection_BrandCategoryEditEnabled_ApprovedBrandAndOrdersPresent() throws Exception {
    // Avoid xProduct outbound interaction checked in class tearDown
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    // Enable brand/category edit flow for external
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);

    // Arrange product and edit response with brand change
    ProductLevel3 product = new ProductLevel3();
    product.setProductSku(PRODUCT_SKU);
    product.setCategoryCode(CATEGORY_CODE);
    product.setBrand("Requested Brand");
    product.setBrandCode("NEW-BRAND-CODE");
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);

    EditProductResponse editResp = new EditProductResponse();
    ProductCollection pc = new ProductCollection();
    pc.setProductCode(PRODUCT_CODE);
    pc.setBrand("Old Brand");
    pc.setBrandCode("OLD-BRAND-CODE");
    editResp.setProductCollection(pc);

    // X-Product details
    ProductL3Response saved = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> savedResp = new GdnRestSingleResponse<>();
    savedResp.setValue(saved);
    when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(savedResp);

    // Pass earlier validations
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductStatus(any())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(any(), any())).thenReturn(null);
    when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE)).thenReturn(new CategoryDetailResponse());

    // PCB brand filter returns approved brand
    when(mandatoryParameterHelper.getStoreId()).thenReturn("store");
    when(mandatoryParameterHelper.getChannelId()).thenReturn("channel");
    when(mandatoryParameterHelper.getClientId()).thenReturn("client");
    when(mandatoryParameterHelper.getRequestId()).thenReturn("req");
    when(mandatoryParameterHelper.getUsername()).thenReturn("user");
    com.gdn.x.productcategorybase.dto.brand.BrandResponse brandResponse = new com.gdn.x.productcategorybase.dto.brand.BrandResponse();
    GdnRestSingleResponse<com.gdn.x.productcategorybase.dto.brand.BrandResponse> brandResp = new GdnRestSingleResponse<>();
    brandResp.setValue(brandResponse);
    when(pcbFeign.filterByBrandName(any(), any(), any(), any(), any(), anyString(), anyBoolean(), anyBoolean()))
        .thenReturn(brandResp);


    // AGP shows orders exist
    AgpSimpleQueryResponse agp = new AgpSimpleQueryResponse();
    HitsResponse hits = new HitsResponse();
    hits.setTotal(1);
    agp.setHits(hits);
    when(agpQueryFeign.findNumberOfOrder(anyString(), anyString(), anyString(), anyString())).thenReturn(agp);
    product.setProductCode(PRODUCT_CODE);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE)).thenReturn(productCollection);

    product.setProductName("PRODUCT-NAME");
    product.setBrandUpdated(true);
    ProductL3Response productL3Response = generateProductL3Response();

    ProductEditValidationDTO result = productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(
        product, editResp, profileResponse, false, productL3Response, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);

    Assertions.assertEquals(ApiErrorCode.BRAND_EDIT_NOT_ALLOWED_SINCE_ORDER_IS_PRESENT,
        result.getEditProductResponse().getApiErrorCode());

    Mockito.verify(agpQueryFeign).findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString());
    Mockito.verifyNoMoreInteractions(productLevel3ServiceBean);
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(agpQueryFeign);
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void basicAPIValidationEditAndSaveDetailsInPCBInNeedCorrection_BrandCategoryEditEnabled_Category_Changed_AndOrdersPresent()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "fetchL3DetailForPLPAndPDPEdit", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "brandCategoryEditEnabledForExternal", true);
    ProductLevel3 product = new ProductLevel3();
    product.setProductSku(PRODUCT_SKU);
    product.setCategoryCode(CATEGORY_CODE + "NEW");
    product.setBrand(BRAND_NAME);
    product.setBrandCode(BRAND_CODE);
    product.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    EditProductResponse editResp = new EditProductResponse();
    ProductCollection pc = new ProductCollection();
    pc.setProductCode(PRODUCT_CODE);
    pc.setBrand(BRAND_NAME);
    pc.setBrandCode(BRAND_CODE);
    pc.setCategoryCode(CATEGORY_CODE);
    editResp.setProductCollection(pc);
    ProductL3Response saved = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> savedResp = new GdnRestSingleResponse<>();
    savedResp.setValue(saved);
    when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(savedResp);
    when(productService.checkBpBopisEligibility(any(), any(), any(), any(), anyBoolean())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductStatus(any())).thenReturn(null);
    when(productLevel3ServiceBean.checkProductVersion(any(), any())).thenReturn(null);
    CategoryDetailResponse categoryDetailResponse= new CategoryDetailResponse();
    categoryDetailResponse.setCategoryCode(CATEGORY_CODE);
    categoryDetailResponse.setName(CATEGORY_NAME);
    when(productOutboundBean.getCategoryDetailByCategoryCode(CATEGORY_CODE + "NEW")).thenReturn(categoryDetailResponse);
    when(mandatoryParameterHelper.getStoreId()).thenReturn("store");
    when(mandatoryParameterHelper.getChannelId()).thenReturn("channel");
    when(mandatoryParameterHelper.getClientId()).thenReturn("client");
    when(mandatoryParameterHelper.getRequestId()).thenReturn("req");
    when(mandatoryParameterHelper.getUsername()).thenReturn("user");
    com.gdn.x.productcategorybase.dto.brand.BrandResponse brandResponse =
        new com.gdn.x.productcategorybase.dto.brand.BrandResponse();
    GdnRestSingleResponse<com.gdn.x.productcategorybase.dto.brand.BrandResponse> brandResp =
        new GdnRestSingleResponse<>();
    brandResp.setValue(brandResponse);
    when(pcbFeign.filterByBrandName(any(), any(), any(), any(), any(), anyString(), anyBoolean(),
        anyBoolean())).thenReturn(brandResp);
    AgpSimpleQueryResponse agp = new AgpSimpleQueryResponse();
    HitsResponse hits = new HitsResponse();
    hits.setTotal(1);
    agp.setHits(hits);
    when(agpQueryFeign.findNumberOfOrder(anyString(), anyString(), anyString(), anyString())).thenReturn(agp);
    product.setProductCode(PRODUCT_CODE);
    productCollection.setCategoryCode(CATEGORY_CODE);
    productCollection.setCategoryName(CATEGORY_NAME);
    Mockito.when(productCollectionRepository.findByStoreIdAndProductCode(STORE_ID, PRODUCT_CODE))
        .thenReturn(productCollection);
    product.setProductName("PRODUCT-NAME");
    ProductL3Response productL3Response = generateProductL3Response();
    ProductEditValidationDTO result =
        productLevel3V2Service.validationForProductL3ResponseAndNeedRevisionUpdate(product, editResp, profileResponse,
            false, productL3Response, new ArrayList<>(), new ProductL3UpdateRequest(), false, false);
    Assertions.assertEquals(ApiErrorCode.CATEGORY_EDIT_NOT_ALLOWED_SINCE_ORDER_IS_PRESENT,
        result.getEditProductResponse().getApiErrorCode());
    Mockito.verify(agpQueryFeign)
        .findNumberOfOrder(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString());
    Mockito.verifyNoMoreInteractions(productLevel3ServiceBean);
    Mockito.verifyNoMoreInteractions(xProductOutbound);
    Mockito.verifyNoMoreInteractions(agpQueryFeign);
    verify(productOutboundBean).getCategoryDetailByCategoryCode(Mockito.any());
  }

  @Test
  public void testPerformPCBUpdateForPDPEditWithUpcUpdateRequestExceptionTest() throws Exception {
    ProductDetailEditDTO productDetailEditDTO = new ProductDetailEditDTO();
    ProductCollection productCollection = new ProductCollection();
    productCollection.setProductCode(PRODUCT_CODE);
    Pair<com.gdn.x.productcategorybase.dto.request.ProductRequest,
      List<NewlySavedItemResponse>> pair = Pair.of( new ProductRequest(),null);
    productDetailEditDTO.setProductRequestForPCB(new ProductRequest());
    EditProductDetailRequest editProductDetailRequest = new EditProductDetailRequest();
    Mockito.doThrow(Exception.class).when(productRepository)
      .updateProductMasterDataAndImagesAndUpcCode(anyString(), anyBoolean(), any());
    when(productService.publishAddEditedProductToPDTEvent(any(), any(), any(), any()))
      .thenReturn(new AddEditedProductToPDTEvent());
    when(productLevel3Service.copyProductLevel3ToProductAndUpdateToPCB(productCollection,
      productLevel3, false, false, false,categoryResponse, new EditProductResponse(),
      productDetailEditDTO, new ProductL3Response(), null)).thenReturn(pair);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        EditProductItemAndImageResponse response =
            productLevel3V2Service.performPCBUpdateForPDPEditRequest(productDetailEditDTO,
                productCollection);
      });
    }
    finally {
      verify(productRepository, times(1)).updateProductMasterDataAndImagesAndUpcCode(any(), anyBoolean(), any());
    }
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItems() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    Image image1 = new Image(false, LOCATION_PATH.concat("1"), 0);
    image1.setCommonImage(false);
    image1.setActive(true);
    Image image2 =  new Image(true, LOCATION_PATH.concat("2"), 1);
    Image image3 = new Image(false, LOCATION_PATH.concat("3"), 0);
    image3.setActive(true);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image4.setCommonImage(true);
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemRequest productItemRequest2 = new ProductItemRequest();
    productItemRequest2.setGeneratedItemName("Item2");
    List<Image> existingImages2 = Arrays.asList(image1, image2);
    productItemRequest2.setImages(existingImages2);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(
      new ProductLevel3Image(false, 1, LOCATION_PATH.concat("6")),
      new ProductLevel3Image(true, 0, LOCATION_PATH.concat("4"))
    );
    item1.setImages(images1);
    ProductItemLevel3 item2 = new ProductItemLevel3();
    item2.setItemName("Item2");
    List<ProductLevel3Image> images2 = Arrays.asList(
      new ProductLevel3Image(false, 1, "newImage2"),
      new ProductLevel3Image(true, 0, "commonImage2")
    );
    item2.setImages(images2);
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1, item2);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1,productItemRequest2));
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      new ArrayList<>());
    Assertions.assertEquals(3, productItemRequest1.getImages().size());
    Assertions.assertEquals(3, productItemRequest2.getImages().size());
    Assertions.assertEquals(3, productItemRequest2.getImages().size());
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsWithMainImageInNewVariant() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");

    Image image3 = new Image(false, LOCATION_PATH.concat("3"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(false, 0, "commonImage1");
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "newImage1");
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(productLevel3Image1, productLevel3Image);
    item1.setImages(images1);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog");
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1);
    productRequest.setNewlyAddedProductItems(Collections.singletonList(productItemRequest1));
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest, new ArrayList<>());
    Assertions.assertEquals(new ArrayList<>(), productRequest.getImages());
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsNoMainImageInNewVariant() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    List<ProductImageEditRequest> productImageEditRequests = new ArrayList<>();
    ProductImageEditRequest productImageEditRequest = new ProductImageEditRequest();
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setMarkForDelete(false);
    productImageEditRequest.setImagePath("commonImage1");
    productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
    productImageEditRequests.add(productImageEditRequest);
    Image image3 = new Image(false, LOCATION_PATH.concat("3").concat("catalog-image"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image3.setActive(true);
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1/catalog-image");
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "newImage1");
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(productLevel3Image1, productLevel3Image);
    item1.setImages(images1);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1));
    productRequest.setImages(Collections.singletonList(new Image(true, "commonImage1",0 )));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog");
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1);
    productRequest.setNewlyAddedProductItems(Collections.singletonList(productItemRequest1));
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      productImageEditRequests);
    verify(fileStorageService).getImagePathPrefix();
  }


  @Test
  public void testSetVariantImagesForNewlyAddedItemsNoMainImageInNewVariantNullRequest() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    List<ProductImageEditRequest> productImageEditRequests = new ArrayList<>();
    ProductImageEditRequest productImageEditRequest = new ProductImageEditRequest();
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setMarkForDelete(false);
    productImageEditRequest.setImagePath("commonImage1");
    productImageEditRequest.setCopyToAllVariantImages(copyImageEditRequest);
    productImageEditRequests.add(null);
    Image image3 = new Image(false, LOCATION_PATH.concat("3").concat("catalog-image"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image3.setActive(true);
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1/catalog-image");
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "newImage1");
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(productLevel3Image1, productLevel3Image);
    item1.setImages(images1);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1));
    productRequest.setImages(Collections.singletonList(new Image(true, "commonImage1",0 )));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog");
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1);
    productRequest.setNewlyAddedProductItems(Collections.singletonList(productItemRequest1));
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      productImageEditRequests);
    verify(fileStorageService).getImagePathPrefix();
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsNoMainImageInNewVariantException() {
    doThrow(new RuntimeException()).when(fileStorageService).getImagePathPrefix();
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");

    List<ProductImageEditRequest> productImageEditRequests = Collections.singletonList(null);
    Image image3 = new Image(false, LOCATION_PATH.concat("3").concat("catalog-image"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image3.setActive(true);
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1/catalog-image");
    ProductLevel3Image productLevel3Image1 = new ProductLevel3Image(false, 1, "newImage1");
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(productLevel3Image1, productLevel3Image);
    item1.setImages(images1);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Collections.singletonList(productItemRequest1));
    productRequest.setImages(Collections.singletonList(new Image(true, "commonImage1", 0)));

      productLevel3V2Service.setVariantImagesForNewlyAddedItems(Collections.singletonList(item1),
        productRequest, productImageEditRequests);
    verify(fileStorageService).getImagePathPrefix();
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsNoMainImageInNewCopyAllVariantNull() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    List<ProductImageEditRequest> productImageEditRequests = new ArrayList<>();
    ProductImageEditRequest productImageEditRequest = new ProductImageEditRequest();
    CopyImageEditRequest copyImageEditRequest = new CopyImageEditRequest();
    copyImageEditRequest.setMarkForDelete(false);
    productImageEditRequest.setImagePath("commonImage1");
    productImageEditRequest.setCopyToAllVariantImages(null);
    productImageEditRequests.add(productImageEditRequest);
    Image image3 = new Image(false, LOCATION_PATH.concat("3").concat("catalog-image"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image3.setActive(true);
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1/catalog-image");
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "newImage1");
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(productLevel3Image1, productLevel3Image);
    item1.setImages(images1);
    productItemRequest1.getImages().get(0).setLocationPath("commonImage1");
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1));
    productRequest.setImages(Collections.singletonList(new Image(true, "commonImage1",0 )));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog");
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1);
    productRequest.setNewlyAddedProductItems(Collections.singletonList(productItemRequest1));
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      productImageEditRequests);
    verify(fileStorageService).getImagePathPrefix();
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsNoMainImageInNewVariantWithDuplicatePath() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1/catalog-image");
    productLevel3Image.setMainImage(true);
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "newImage1");
    Image image3 = new Image(false, LOCATION_PATH.concat("3").concat("catalog-image"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemRequest productItemRequest2 = new ProductItemRequest();
    productItemRequest2.setGeneratedItemName("Item1");
    List<Image> existingImages2 =
      Arrays.asList(new Image(false, "location3/catalog-image", 0) ,new Image(true,
          "location", 1),
        new Image(false, "duplicateLocationPath", 0), new Image(true, "duplicateLocationPath", 1));
    existingImages2.forEach(image1 -> image1.setCommonImage(true));
    productItemRequest2.setImages(existingImages2);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(
      new ProductLevel3Image(false, 1, "newImage1/catalog-image"),
      new ProductLevel3Image(true, 0, "commonImage1"),
      new ProductLevel3Image(true, 0, "commonImage1")
    );
    item1.setImages(images1);
    ProductItemLevel3 item2 = new ProductItemLevel3();
    item2.setItemName("Item1");
    List<ProductLevel3Image> images2 = Arrays.asList(
      new ProductLevel3Image(false, 1, "newImage2"),
      new ProductLevel3Image(true, 0, "commonImage2")
    );
    item2.setImages(images2);
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1, item2);
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1, productItemRequest2));
    productRequest.setImages(Collections.singletonList(new Image(true, "commonImage1",0 )));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog");
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      new ArrayList<>());
    Assertions.assertEquals("commonImage1", productRequest.getImages().get(0).getLocationPath());
  }

  @Test
  public void testSetVariantImagesForNewlyAddedItemsWithDuplicateImages() {
    ProductRequest productRequest = new ProductRequest();
    ProductItemRequest productItemRequest1 = new ProductItemRequest();
    productItemRequest1.setGeneratedItemName("Item1");
    ProductLevel3Image productLevel3Image = new ProductLevel3Image(true, 0, "commonImage1");
    productLevel3Image.setMainImage(true);
    ProductLevel3Image productLevel3Image1 =  new ProductLevel3Image(false, 1, "catalog-image"
      + "/newImage1");
    Image image3 = new Image(false, LOCATION_PATH.concat("3"), 0);
    Image image4 = new Image(true, LOCATION_PATH.concat("4"), 1);
    image3.setActive(true);
    List<Image> existingImages1 = Arrays.asList(image3, image4);
    productItemRequest1.setImages(existingImages1);
    ProductItemRequest productItemRequest2 = new ProductItemRequest();
    productItemRequest2.setGeneratedItemName("Item2");
    productItemRequest2.setActivated(true);
    List<Image> existingImages2 =
      Arrays.asList(new Image(false, "location3", 0) ,new Image(true,
      "location", 1),
        new Image(false, "duplicateLocationPath", 0), new Image(true, "duplicateLocationPath", 1));
    existingImages2.forEach(image1 -> image1.setCommonImage(true));
    existingImages2.forEach(image1 -> image1.setActive(true));
    productItemRequest2.setImages(existingImages2);
    ProductItemLevel3 item1 = new ProductItemLevel3();
    item1.setItemName("Item1");
    List<ProductLevel3Image> images1 = Arrays.asList(
      new ProductLevel3Image(false, 1, "catalog-image/newImage1"),
      new ProductLevel3Image(true, 0, "commonImage1"),
      new ProductLevel3Image(true, 0, "commonImage1")
    );
    item1.setImages(images1);
    ProductItemLevel3 item2 = new ProductItemLevel3();
    item2.setItemName("Item2");
    List<ProductLevel3Image> images2 = Arrays.asList(
      new ProductLevel3Image(false, 1, "newImage2"),
      new ProductLevel3Image(true, 0, "commonImage2")
    );
    item2.setImages(images2);
    List<ProductItemLevel3> newlyAddedItems = Arrays.asList(item1, item2);
    productRequest.setNewlyAddedProductItems(Arrays.asList(productItemRequest1, productItemRequest2));
    Mockito.when(fileStorageService.getImagePathPrefix()).thenReturn("catalog-image");
    productLevel3V2Service.setVariantImagesForNewlyAddedItems(newlyAddedItems, productRequest,
      new ArrayList<>());
    Assertions.assertEquals(2, productRequest.getNewlyAddedProductItems().size());
    verify(fileStorageService, times(2)).getImagePathPrefix();
  }

  @Test
  public void getProductCountTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "stringRedisTemplate", stringRedisTemplate);
    ReflectionTestUtils.setField(productLevel3V2Service, "redisProperties", redisProperties);
    Mockito.when(stringRedisTemplate.opsForValue()).thenReturn(valueOperations);
    Mockito.when(valueOperations.get(Mockito.anyString())).thenReturn("");
    Mockito.when(redisProperties.getProductLimitsTtl()).thenReturn(60L);
    Mockito.doNothing().when(valueOperations).set(Mockito.anyString(), Mockito.anyString(), Mockito.any());
    Map<ProductLevel3SummaryCriteria, Long> map = new HashMap<>();
    map.put(ProductLevel3SummaryCriteria.NEED_CORRECTION, 2L);
    map.put(ProductLevel3SummaryCriteria.IN_PROGRESS, 2L);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3WipService
        .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY))
        .thenReturn(new ProductLevel3CountResponse(map, 4L));
    Mockito.when(xProductOutbound.getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(new ProductCountResponse(2L, 2L, null, null));

    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, true);
    Assertions.assertEquals(8L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3WipService)
        .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY);
    Mockito.verify(xProductOutbound).getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(redisProperties).getProductLimitsTtl();
  }

  @Test
  public void getProductCountNonProductLimitTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "stringRedisTemplate", stringRedisTemplate);
    Mockito.when(stringRedisTemplate.opsForValue()).thenReturn(valueOperations);
    Mockito.when(valueOperations.get(Mockito.anyString())).thenReturn("5");
    Mockito.when(valueOperations.increment(Mockito.anyString())).thenReturn(6L);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", false);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, true);
    Assertions.assertEquals(0L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
  }

  @Test
  public void getProductCountRedisHitAndIncrementTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "stringRedisTemplate", stringRedisTemplate);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(stringRedisTemplate.opsForValue()).thenReturn(valueOperations);
    Mockito.when(valueOperations.get(Mockito.anyString())).thenReturn("10");
    Mockito.when(valueOperations.increment(Mockito.anyString())).thenReturn(11L);
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, true);
    Assertions.assertEquals(11L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(stringRedisTemplate, times(2)).opsForValue();
    Mockito.verify(valueOperations).get(Mockito.anyString());
    Mockito.verify(valueOperations).get(Mockito.anyString());
  }

  @Test
  public void getProductCountFeatureDisabledFallsBackToCacheableTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", false);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(stringRedisTemplate.opsForValue()).thenReturn(valueOperations);
    Mockito.when(valueOperations.get(Mockito.anyString())).thenReturn("7");
    Mockito.when(redisProperties.getProductLimitsTtl()).thenReturn(7L);
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, true);
    Assertions.assertEquals(7L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(stringRedisTemplate).opsForValue();
    Mockito.verify(valueOperations).get(Mockito.anyString());
  }

  @Test
  public void getProductCountRedisExceptionFallbackTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "stringRedisTemplate", stringRedisTemplate);
    Map<ProductLevel3SummaryCriteria, Long> map = new HashMap<>();
    map.put(ProductLevel3SummaryCriteria.NEED_CORRECTION, 2L);
    map.put(ProductLevel3SummaryCriteria.IN_PROGRESS, 2L);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
      .thenReturn(profileResponse);
    Mockito.when(productLevel3WipService
      .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY))
      .thenReturn(new ProductLevel3CountResponse(map, 4L));
    Mockito.when(xProductOutbound.getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE))
      .thenReturn(new ProductCountResponse(2L, 2L, null, null));
    Mockito.when(stringRedisTemplate.opsForValue()).thenThrow(new RuntimeException("redis down"));
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, true);
    Assertions.assertEquals(8L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3WipService)
      .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY);
    Mockito.verify(xProductOutbound).getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE);
  }

  @Test
  public void getProductCountSwitchOnButIncrementFalseTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "stringRedisTemplate", stringRedisTemplate);
    Map<ProductLevel3SummaryCriteria, Long> map = new HashMap<>();
    map.put(ProductLevel3SummaryCriteria.NEED_CORRECTION, 2L);
    map.put(ProductLevel3SummaryCriteria.IN_PROGRESS, 2L);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3WipService
            .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY))
        .thenReturn(new ProductLevel3CountResponse(map, 4L));
    Mockito.when(xProductOutbound.getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(new ProductCountResponse(2L, 2L, null, null));
    Mockito.when(stringRedisTemplate.opsForValue()).thenReturn(valueOperations);
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, false);
    Assertions.assertEquals(8L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3WipService)
        .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY);
    Mockito.verify(xProductOutbound).getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(redisProperties).getProductLimitsTtl();
  }

  @Test
  public void getProductCountSwitchOffTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisEnabled", false);
    Map<ProductLevel3SummaryCriteria, Long> map = new HashMap<>();
    map.put(ProductLevel3SummaryCriteria.NEED_CORRECTION, 2L);
    map.put(ProductLevel3SummaryCriteria.IN_PROGRESS, 2L);
    Map<String, Object> flags = new HashMap<>();
    flags.put("productLimit", true);
    profileResponse.setFlags(flags);
    Mockito.when(businessPartnerRepository.filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(profileResponse);
    Mockito.when(productLevel3WipService
            .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY))
        .thenReturn(new ProductLevel3CountResponse(map, 4L));
    Mockito.when(xProductOutbound.getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(new ProductCountResponse(2L, 2L, null, null));
    Mockito.when(applicationContext.getBean(ProductLevel3V2ServiceImpl.class)).thenReturn(productLevel3V2Service);
    Long result = productLevel3V2Service.getProductCount(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE, false);
    Assertions.assertEquals(8L, result);
    Mockito.verify(businessPartnerRepository).filterDetailByBusinessPartnerCode(DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(productLevel3WipService)
        .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY);
    Mockito.verify(xProductOutbound).getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE);
    Mockito.verify(applicationContext).getBean(ProductLevel3V2ServiceImpl.class);
  }

  @Test
  public void getProductCountCacheableTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisIncrementEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "productLimitRedisEnabled", false);
    Map<ProductLevel3SummaryCriteria, Long> map = new HashMap<>();
    map.put(ProductLevel3SummaryCriteria.NEED_CORRECTION, 2L);
    map.put(ProductLevel3SummaryCriteria.IN_PROGRESS, 2L);
    Mockito.when(productLevel3WipService
            .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY))
        .thenReturn(new ProductLevel3CountResponse(map, 4L));
    Mockito.when(xProductOutbound.getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE))
        .thenReturn(new ProductCountResponse(2L, 2L, null, null));
    Mockito.when(applicationContext.getBean(ProductLevel3V2ServiceImpl.class)).thenReturn(productLevel3V2Service);
    Long result = productLevel3V2Service.getProductCountCacheable(DEFAULT_STORE_ID, DEFAULT_BUSINESS_PARTNER_CODE);
    Assertions.assertEquals(8L, result);
    Mockito.verify(productLevel3WipService)
        .countSummaryByFilterType(DEFAULT_BUSINESS_PARTNER_CODE, DEFAULT_STORE_ID, Constants.PRIMARY);
    Mockito.verify(xProductOutbound).getSecondaryCounts(Constants.ACTIVE, DEFAULT_BUSINESS_PARTNER_CODE);
  }

  @Test
  public void validationsForEditNewProductItemTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(
        Arrays.asList(com.gda.mta.product.dto.ItemPickupPointRequest.builder().build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest3.setNewlyAddedItem(true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(
        Arrays.asList(productVariantPriceStockAndImagesRequest1, productVariantPriceStockAndImagesRequest2,
            productVariantPriceStockAndImagesRequest3));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);
  }

  @Test
  public void validationsForEditNewProductItemScheulesFreeSampleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(
      Arrays.asList(com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest3.setNewlyAddedItem(true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setOnline(false);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productL3UpdateRequest.setProductItems(
      Arrays.asList(productVariantPriceStockAndImagesRequest1, productVariantPriceStockAndImagesRequest2,
        productVariantPriceStockAndImagesRequest3));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);
  }

  @Test
  public void validationsForEditNewProductItemSchedulesFreeSampleWithNullScheduleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(Arrays.asList(
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_CODE).buyableSchedule(
          BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).build())
        .build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest3.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest3.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest2.setItemSku(ITEM_SKU);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(
      Arrays.asList(productVariantPriceStockAndImagesRequest2));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemSchedulesFreeSampleWithScheduleRemovalTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(Arrays.asList(
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().scheduleRemoval(true)
        .build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest3.setNewlyAddedItem(true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(
      Arrays.asList(productVariantPriceStockAndImagesRequest2));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);


  }

  @Test
  public void validationsForEditNewProductItemSchedulesFreeSampleWithNullSchedulesTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(Arrays.asList(
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().scheduleRemoval(false)
        .build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
      new ProductVariantPriceStockAndImagesRequest();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    productVariantPriceStockAndImagesRequest3.setItemSku(ITEM_SKU);
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    productVariantPriceStockAndImagesRequest3.setNewlyAddedItem(true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(
      Arrays.asList(productVariantPriceStockAndImagesRequest2));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);


  }


  @Test
  public void validationsForEditNewProductItemSchedulesFreeSampleTrueTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest2 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest2.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest2.setModifiedItemPickupPoints(Arrays.asList(
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().scheduleRemoval(false)
        .discoverableSchedule(
          DiscoverableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate)
            .build()).pickupPointId(PICKUP_POINT_CODE).build()));
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest3 =
      new ProductVariantPriceStockAndImagesRequest();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(
      Arrays.asList(productVariantPriceStockAndImagesRequest2));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(
      Collections.singletonList(
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_CODE)
          .build()));

  }

  @Test
  public void validationsForEditEmptyNewProductItemTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemL5Request", true);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, null, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemNoCommonMainImageTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ProductL3Response productL3Response = new ProductL3Response();
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest.setImages(new ArrayList<>());
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
        productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemHasCommonMainImageTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ProductL3Response productL3Response = new ProductL3Response();
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(true);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest.setImages(new ArrayList<>());
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
        productL3Response, profileResponse);

  }


  @Test
  public void validationsForEditNewProductItemHasCommonImageInRequestTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ProductL3Response productL3Response = new ProductL3Response();
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest.setImages(new ArrayList<>());
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productL3UpdateRequest.setCommonImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
        productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemHasVariantInRequestTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ProductL3Response productL3Response = new ProductL3Response();
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
        productL3Response, profileResponse);
  }

  @Test
  public void validationsForEditNewProductItemHasNotNewItemRequestTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateNewProductItemImageRequest", true);
    ProductL3Response productL3Response = new ProductL3Response();
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest.setNewlyAddedItem(false);
    productVariantPriceStockAndImagesRequest.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
        productL3Response, profileResponse);
  }

  @Test
  public void validateProductNamesSwitchOffTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "removeAllExtraSpaceBeforeNameEditValidation", false);
    Assertions.assertFalse(productLevel3V2Service.validateProductNames(EXISTING_NAME, REQUESTED_NAME));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForNullBuyableSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(true)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForNullSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .cncDisplay(true)
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest1 =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .cncDisplay(true)
            .cncBuyable(true)
            .build();
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest1));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItem_nullViewConfig_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(false)
            .cncBuyable(true)
            .buyable(true)
            .display(false)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItem_falseViewConfig_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(false)
            .cncBuyable(false)
            .buyable(true)
            .display(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItem_InvalidCncFlag_cncSwitchOnTest() throws Exception {
    try {
      ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
          false);
      ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
      ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
      ProductL3Response productL3Response = generateProductL3Response();
      ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
          new ProductVariantPriceStockAndImagesRequest();
      productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
      MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
      MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
      MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
      masterDataProductImageDTO2.setCommonImage(true);
      masterDataProductImageDTO2.setMainImage(false);
      ItemPickupPointBasicResponse itemPickupPointBasicResponse =
          ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
      ItemPickupPointRequest itemPickupPointRequest =
          ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
      Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
              Collections.singletonList(itemPickupPointRequest)))
          .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
      masterDataProductDTO.setMasterDataProductImages(
          Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
      productL3Response.setMasterDataProduct(masterDataProductDTO);
      productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
      productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
      com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
          com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
              .itemSku(ITEM_SKU)
              .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
              .cncDisplay(true)
              .cncBuyable(true)
              .buyable(true)
              .build();
      productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
      productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
      productL3UpdateRequest = generateProductL3UpdateRequest();
      productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
      productL3UpdateRequest.setCommonImages(new ArrayList<>());
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
          editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ApiErrorCode.INVALID_DELIVERY_CNC_VIEW_CONFIG_STATES.getDesc()));
    }
  }

  @Test
  public void validationsForEditNewProductItem_InvalidCncFlagBuyable_cncSwitchOnTest() throws Exception {
    try {
      ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
          false);
      ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
      ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
      ProductL3Response productL3Response = generateProductL3Response();
      ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
          new ProductVariantPriceStockAndImagesRequest();
      productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
      MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
      MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
      MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
      masterDataProductImageDTO2.setCommonImage(true);
      masterDataProductImageDTO2.setMainImage(false);
      ItemPickupPointBasicResponse itemPickupPointBasicResponse =
          ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
      ItemPickupPointRequest itemPickupPointRequest =
          ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
      Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
              Collections.singletonList(itemPickupPointRequest)))
          .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
      masterDataProductDTO.setMasterDataProductImages(
          Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
      productL3Response.setMasterDataProduct(masterDataProductDTO);
      productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
      productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
      com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
          com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
              .itemSku(ITEM_SKU)
              .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
              .cncDisplay(true)
              .cncBuyable(false)
              .buyable(true)
              .display(true)
              .build();
      productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
      productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
      productL3UpdateRequest = generateProductL3UpdateRequest();
      productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
      productL3UpdateRequest.setCommonImages(new ArrayList<>());
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
          editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage().contains(ApiErrorCode.INVALID_DELIVERY_CNC_VIEW_CONFIG_STATES.getDesc()));
    }
  }

  @Test
  public void validationsForEditNewProductItemForNullDiscoverableSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
            .cncDisplay(true)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForPureInstoreProductTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .cncDisplay(false)
        .cncBuyable(false)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForInstoreSwitchOffProductTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"instore2FlowSwitch", false);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .cncDisplay(false)
        .cncBuyable(false)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(DESCRIPTION);
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsEmptyDescriptionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "instore2FlowSwitch", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build()).cncDisplay(false).cncBuyable(false)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
          productL3Response, profileResponse);
    });
  }

  @Test
  public void validationsForEditNewProductItemForPureInstoreDescriptionProductTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .cncDisplay(false)
        .cncBuyable(false)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription("Test description");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validateShippingAndDimensionForPureInstoreProductTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(true);
    updateRequest.setB2cActivated(false);
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    updateRequest.setPureInstoreProduct(true);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionForPureInstoreNonZeroProductTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(true);
    updateRequest.setB2cActivated(false);
    updateRequest.setProductType(1);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    updateRequest.setPureInstoreProduct(true);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionForNonPureInstoreProductTest1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(false);
    updateRequest.setB2cActivated(false);
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }

  @Test
  public void validateShippingAndDimensionForNonPureInstoreProductTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(false);
    updateRequest.setB2cActivated(true);
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    updateRequest.setPureInstoreProduct(false);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }
  @Test
  public void validateShippingAndDimensionForNonPureInstoreProductTest3() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(true);
    updateRequest.setB2cActivated(true);
    updateRequest.setProductType(1);
    updateRequest.setWeight(0.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(0.08);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }
  @Test
  public void validateShippingAndDimensionForNonPureInstoreProductTest4() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", true);
    ProductL3UpdateRequest updateRequest = generateProductL3UpdateRequest();
    updateRequest.setOff2OnChannelActive(true);
    updateRequest.setB2cActivated(false);
    updateRequest.setProductType(1);
    updateRequest.setWeight(1.0);
    updateRequest.setHeight(1.0);
    updateRequest.setLength(1.0);
    updateRequest.setWidth(1.0);
    updateRequest.setShippingWeight(1.0);
    productLevel3V2Service.validateShippingAndDimensionForEdit(updateRequest, false);
  }
  @Test
  public void validationsForEditNewProductItemForPureInstoreProductWithL5OnlineTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .buyable(false)
        .display(true)
        .cncDisplay(true)
        .cncBuyable(false)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    try {
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
        .contains(ErrorMessages.STATUS_CAN_NOT_BE_OTHER_THAN_OFFLINE_FOR_PURE_INSTORE_PRODUCT));
    }
  }
  @Test
  public void validationsForEditNewProductItemForPureInstoreProductWithL5OnlineTest2() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .buyable(true)
        .display(false)
        .cncDisplay(false)
        .cncBuyable(true)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    try {
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
        .contains(ErrorMessages.STATUS_CAN_NOT_BE_OTHER_THAN_OFFLINE_FOR_PURE_INSTORE_PRODUCT));
    }
  }
  @Test
  public void validationsForEditNewProductItemForPureInstoreProductWithL5OnlineTest3() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .buyable(true)
        .display(false)
        .cncDisplay(false)
        .cncBuyable(false)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    try {
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
        .contains(ErrorMessages.STATUS_CAN_NOT_BE_OTHER_THAN_OFFLINE_FOR_PURE_INSTORE_PRODUCT));
    }
  }
  @Test
  public void validationsForEditNewProductItemForPureInstoreProductWithL5OnlineTest1() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
        .buyable(false)
        .display(false)
        .cncDisplay(false)
        .cncBuyable(true)
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setDescription(" ");
    productL3UpdateRequest.setOff2OnChannelActive(true);
    productL3UpdateRequest.setB2cActivated(false);
    try {
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
        .contains(ErrorMessages.STATUS_CAN_NOT_BE_OTHER_THAN_OFFLINE_FOR_PURE_INSTORE_PRODUCT));
    }
  }
  @Test
  public void validationsForEditNewProductItemForSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(true)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditModifiedProductItemForInvalidSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    ItemViewConfigDTO cncItemViewConfigDTO = new ItemViewConfigDTO();
    cncItemViewConfigDTO.setChannel(Constants.CNC_CHANNEL);
    cncItemViewConfigDTO.setBuyable(true);
    itemPickupPointBasicResponse.setAllItemViewConfigDTO(Collections.singletonList(cncItemViewConfigDTO));
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(false)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForInvalidSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    ItemViewConfigDTO cncItemViewConfigDTO = new ItemViewConfigDTO();
    cncItemViewConfigDTO.setChannel(Constants.CNC_CHANNEL);
    cncItemViewConfigDTO.setBuyable(true);
    itemPickupPointBasicResponse.setAllItemViewConfigDTO(Collections.singletonList(cncItemViewConfigDTO));
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .buyable(true)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(false)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditAddProductItemForSchedules_cncSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .buyableSchedule(BuyableScheduleRequest.builder().buyable(true).build())
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .cncDisplay(true)
            .cncBuyable(true)
            .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForAddPickupPointSchedules_cncOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service,"cncForWarehouseFeatureSwitch", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU)
            .cncBuyable(true)
            .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithOfflineRequestTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).buyable(true).display(true)
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).buyable(false).display(false)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
        .build();
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));

  }

  @Test
  public void validationsForEditNewProductItemForAddPickupPointSchedulesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).build())
        .build();
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));

    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesAndInValidTimeTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    Date pastEndDate = calendar.getTime();
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(pastEndDate)
            .endDateTime(pastEndDate).build()).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));

  }
  @Test
  public void validationsForEditNewProductItemForSchedulesWithStartAndEndDateValidTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    Date currentDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithStartAndEndDateValidAddRequestTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productL3Response.setFreeSample(true);
    productL3Response.setOnline(true);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setOnline(Boolean.FALSE);
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);


  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithStartAndEndDateFreeSampleTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productL3Response.setFreeSample(true);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesFreeSampleWithNullScheduleTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productL3Response.setFreeSample(true);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder()
        .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).build()).pickupPointId(PICKUP_POINT_ID).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesFreeSampleWithScheduleRemovalTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productL3Response.setFreeSample(true);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest modifiedL5 =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder()
        .scheduleRemoval(false).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(modifiedL5));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

  }



  @Test
  public void validationsForEditNewProductItemForSchedulesWithStartAndEndDateOfflineTest() throws Exception {
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date startDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productL3Response.setFreeSample(false);
    productL3Response.setOnline(true);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setFreeSample(true);
    productL3UpdateRequest.setOnline(true);
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(pickupPointRequest));
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithStartAndEndDateInValidTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    Calendar calendar = Calendar.getInstance();
    Date currentDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, 1);
    Date endDate = calendar.getTime();
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    Date startDate = calendar.getTime();
    ReflectionTestUtils.setField(productLevel3V2Service,"schedulesAddEditEnabled", true);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU)
        .discoverableSchedule(DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .build();
    productL3Response.setOnline(false);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithValidStartAndEndDate()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "sizeChartAdditionForProduct", true);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).channelId(DEFAULT_CHANNEL).buyable(false).display(false)
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).buyable(true).display(true)
        .itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
        .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setSizeChartCode(SIZE_CHART_CODE);

    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithValidStartAndEndDate2()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ReflectionTestUtils.setField(productLevel3V2Service, "sizeChartAdditionForProduct", true);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).buyable(true).channelId(DEFAULT_CHANNEL)
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).buyable(true).display(true)
        .itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(false).build())
        .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setSizeChartCode(SIZE_CHART_CODE);

    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithIncompleteSchedule()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();

    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).build()).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithNoEndDateBuyableSchedule()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
      new com.gda.mta.product.dto.ItemPickupPointRequest();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(
          BuyableScheduleRequest.builder().buyable(true).startDateTime(startDate).build()).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));


  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithNoStartDateBuyableSchedule()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
      new com.gda.mta.product.dto.ItemPickupPointRequest();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(itemPickupPointRequest1));
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).buyableSchedule(
          BuyableScheduleRequest.builder().buyable(true).endDateTime(startDate).build()).discoverableSchedule(new DiscoverableScheduleRequest()).build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setSizeChartCode(SIZE_CHART_CODE);
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));

  }

  @Test
  public void updateProductHistoryForBuyableAndDiscoverableScheduleChangeTest() throws Exception {
    ItemBuyableScheduleDTO itemBuyableScheduleDTO = new ItemBuyableScheduleDTO();
    itemBuyableScheduleDTO.setStartDateTime(new Date());
    itemBuyableScheduleDTO.setEndDateTime(new Date());
    itemViewConfigDTO.setItemBuyableSchedules(itemBuyableScheduleDTO);
    ItemDiscoverableScheduleDTO itemDiscoverableScheduleDTO = new ItemDiscoverableScheduleDTO();
    itemDiscoverableScheduleDTO.setStartDateTime(new Date());
    itemDiscoverableScheduleDTO.setEndDateTime(new Date());
    itemViewConfigDTO.setItemDiscoverableSchedules(itemDiscoverableScheduleDTO);
    productLevel3V2Service.updateProductHistoryForBuyableAndDiscoverableScheduleChange(itemSummaryListResponse,
        new ItemSummaryListResponse());
    Mockito.verify(updatedProductHistoryService, times(2))
        .createProductL3AuditLog(any(), any(), any(), any(), any(), any(), any(), anyBoolean(), any());
    Assertions.assertNotNull(itemSummaryListResponse.getItemViewConfigs().iterator().next().getItemBuyableSchedules());
  }

  @Test
  public void validateProductNamesTest() {
    ReflectionTestUtils.setField(productLevel3V2Service, "removeAllExtraSpaceBeforeNameEditValidation", true);
    Assertions.assertTrue(productLevel3V2Service.validateProductNames(EXISTING_NAME, REQUESTED_NAME));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithEndDateBeforeStartDate()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);

    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    Date pastEndDate = calendar.getTime();

    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(pastEndDate).build()).build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());

    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);


    Assertions.assertEquals(ApiErrorCode.INVALID_SCHEDULE_DATE_TIME,
      productEditValidationDTO.getEditProductResponse().getApiErrorCode());
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesWithEndDateBeforeStartDateBuyableSchedule()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);

    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();

    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().discoverableScheduleResponse(
            DiscoverableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).channelId(DEFAULT_CHANNEL).buyable(false).display(false)
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    Date pastEndDate = calendar.getTime();

    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).display(false).buyable(false)
        .itemSku(ITEM_SKU).buyableSchedule(
          BuyableScheduleRequest.builder().buyable(false).startDateTime(startDate).endDateTime(pastEndDate).build()).build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());

    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);


    Assertions.assertEquals(ApiErrorCode.INVALID_SCHEDULE_DATE_TIME,
      productEditValidationDTO.getEditProductResponse().getApiErrorCode());
    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));

  }

  @Test
  public void validationsForEditNewProductItemForNoSchedule()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    endDate = currentDate;
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    Date pastEndDate = calendar.getTime();

    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).buyable(false).display(false)
        .itemSku(ITEM_SKU).buyableSchedule(
          BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).build())
        .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setOnline(false);

    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);


    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
    Assertions.assertEquals(ApiErrorCode.SCHEDULE_INVALID_FOR_OFFLINE_PRODUCT,
      productEditValidationDTO.getEditProductResponse().getApiErrorCode());
  }

  @Test
  public void validationsForEditNewProductItemForNoScheduleSwitchOff()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", false);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);
    endDate = currentDate;
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    ProductL3Response productL3Response = null;
    try {
      productL3Response = generateProductL3Response();
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    calendar.add(Calendar.DAY_OF_MONTH, -2);
    Date pastEndDate = calendar.getTime();

    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
        .itemSku(ITEM_SKU).buyableSchedule(
          BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).build())
        .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setOnline(false);

    ProductEditValidationDTO productEditValidationDTO = productLevel3V2Service.validationsForEdit(
      REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForNotOffineTest1()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(B2B_CHANNEL).display(true).buyable(true).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse1 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(true).buyable(false).channelId(DEFAULT_CHANNEL).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().build().builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse2 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(true).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse3 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(true).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Arrays.asList(itemPickupPointBasicResponse,itemPickupPointBasicResponse1,itemPickupPointBasicResponse2,itemPickupPointBasicResponse3));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU).discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build()).buyable(true).display(false)
            .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).discoverableSchedule(new DiscoverableScheduleRequest())
            .buyableSchedule(new BuyableScheduleRequest()).display(false).buyable(false).build()));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForOffineFromRequestTest()
    throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
      false);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
      new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
      ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
        .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(true).buyableScheduleResponse(
            BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
          .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
      ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
        Collections.singletonList(itemPickupPointRequest)))
      .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
      Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).buyable(false).display(false).itemSku(ITEM_SKU).discoverableSchedule(
          DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
        .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
        .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
      com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).discoverableSchedule(new DiscoverableScheduleRequest())
        .buyableSchedule(new BuyableScheduleRequest()).display(false).buyable(false).build()));

    ProductEditValidationDTO productEditValidationDTO =
      productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
        editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForNotOffineTest()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);

    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(true).buyable(true).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse1 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse2 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(true).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointBasicResponse itemPickupPointBasicResponse3 =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(true).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Arrays.asList(itemPickupPointBasicResponse,itemPickupPointBasicResponse1,itemPickupPointBasicResponse2,itemPickupPointBasicResponse3));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU).discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
            .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id").discoverableSchedule(new DiscoverableScheduleRequest())
            .buyableSchedule(new BuyableScheduleRequest()).display(true).buyable(true).build()));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForNotOfflineTest()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
        ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Arrays.asList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU).discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
            .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id").discoverableSchedule(new DiscoverableScheduleRequest())
            .buyableSchedule(new BuyableScheduleRequest()).display(true).buyable(false).build()));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForNotOfflineTest3()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Arrays.asList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU).discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
            .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id").discoverableSchedule(new DiscoverableScheduleRequest())
            .buyableSchedule(new BuyableScheduleRequest()).display(false).buyable(true).build()));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);
  }

  @Test
  public void validationsForEditNewProductItemForSchedulesForNotOfflineAddedPickUpPointsTest()
      throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions",
        false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID)
            .viewConfigResponse(ViewConfigResponse.builder().channelId(DEFAULT_CHANNEL).display(false).buyable(false).buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build())
                .build()).build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Arrays.asList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);

    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID)
            .itemSku(ITEM_SKU).discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate).build())
            .buyableSchedule(BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();

    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(Collections.singletonList(pickupPointRequest));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id").discoverableSchedule(null)
            .buyableSchedule(null).display(true).buyable(false).build()));

    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3,
            editResponse, productL3Response, profileResponse);

    Mockito.verify(xProductOutbound).fetchBasicDetailsByItemSkuAndPickupPointCodeList(Collections.singletonList(itemPickupPointRequest));
  }

  @Test
  public void validationsForWholeSaleDiscountMoreThan100PercentageTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    List<com.gda.mta.product.dto.ItemPickupPointRequest> modifiedItemPickupPoints = new ArrayList<>();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(120);
    itemPickupPointRequest1.setProductItemWholesalePriceRequests(
        Collections.singletonList(productItemWholesalePriceRequest));
    modifiedItemPickupPoints.add(itemPickupPointRequest1);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate)
                    .build()).buyableSchedule(
                BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(itemPickupPointRequest1));
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id")
            .discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(new BuyableScheduleRequest())
            .display(true)
            .productItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest))
            .buyable(false).build()));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
            productL3Response, profileResponse);
  }

  @Test
  public void validationsForWholeSaleDiscountMoreThan100PercentageForAddedPickUpPointCodesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    List<com.gda.mta.product.dto.ItemPickupPointRequest> modifiedItemPickupPoints = new ArrayList<>();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(100);
    itemPickupPointRequest1.setProductItemWholesalePriceRequests(
        Collections.singletonList(productItemWholesalePriceRequest));
    modifiedItemPickupPoints.add(itemPickupPointRequest1);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate)
                    .build()).buyableSchedule(
                BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(itemPickupPointRequest1));
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(100);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id")
            .discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(new BuyableScheduleRequest())
            .display(true)
            .productItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest1))
            .buyable(false).build()));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
            productL3Response, profileResponse);
  }

  @Test
  public void validationsForWholeSaleDiscountMoreThan100PercentageForModifiedPickUpPointCodesFalseAddedPPCodesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    List<com.gda.mta.product.dto.ItemPickupPointRequest> modifiedItemPickupPoints = new ArrayList<>();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(90);
    itemPickupPointRequest1.setProductItemWholesalePriceRequests(
        Collections.singletonList(productItemWholesalePriceRequest));
    modifiedItemPickupPoints.add(itemPickupPointRequest1);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate)
                    .build()).buyableSchedule(
                BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(itemPickupPointRequest1));
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest1.setWholesaleDiscount(910);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id")
            .discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(new BuyableScheduleRequest())
            .display(true)
            .productItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest1))
            .buyable(false).build()));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
            productL3Response, profileResponse);
  }

  @Test
  public void validationsForWholeSaleDiscountLessThanZeroPercentageForModifiedPickUpPointCodesFalseAddedPPCodesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    List<com.gda.mta.product.dto.ItemPickupPointRequest> modifiedItemPickupPoints = new ArrayList<>();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(-1);
    itemPickupPointRequest1.setProductItemWholesalePriceRequests(
        Collections.singletonList(productItemWholesalePriceRequest));
    modifiedItemPickupPoints.add(itemPickupPointRequest1);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate)
                    .build()).buyableSchedule(
                BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(itemPickupPointRequest1));
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest1.setWholesaleDiscount(-1);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id")
            .discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(new BuyableScheduleRequest())
            .display(true)
            .productItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest1))
            .buyable(false).build()));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
            productL3Response, profileResponse);

  }

  @Test
  public void validationsForWholeSaleDiscountLessThanZeroPercentageForAddPickUpPointCodesFalseAddedPPCodesTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "schedulesAddEditEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "validateEditShippingAndDimensions", false);
    ProductL3Response productL3Response = generateProductL3Response();
    ProductVariantPriceStockAndImagesRequest productVariantPriceStockAndImagesRequest1 =
        new ProductVariantPriceStockAndImagesRequest();
    List<com.gda.mta.product.dto.ItemPickupPointRequest> modifiedItemPickupPoints = new ArrayList<>();
    com.gda.mta.product.dto.ItemPickupPointRequest itemPickupPointRequest1 =
        new com.gda.mta.product.dto.ItemPickupPointRequest();
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest.setWholesaleDiscount(100);
    itemPickupPointRequest1.setProductItemWholesalePriceRequests(
        Collections.singletonList(productItemWholesalePriceRequest));
    modifiedItemPickupPoints.add(itemPickupPointRequest1);
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(modifiedItemPickupPoints);
    productVariantPriceStockAndImagesRequest1.setProductCode(PRODUCT_CODE);
    productVariantPriceStockAndImagesRequest1.setItemSku(ITEM_SKU);
    ItemPickupPointBasicResponse itemPickupPointBasicResponse =
        ItemPickupPointBasicResponse.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).viewConfigResponse(
                ViewConfigResponse.builder().buyableScheduleResponse(
                    BuyableScheduleResponse.builder().startDateTime(startDate).endDateTime(endDate).build()).build())
            .build();
    ItemPickupPointRequest itemPickupPointRequest =
        ItemPickupPointRequest.builder().itemSku(ITEM_SKU).pickupPointCode(PICKUP_POINT_ID).build();
    Mockito.when(xProductOutbound.fetchBasicDetailsByItemSkuAndPickupPointCodeList(
            Collections.singletonList(itemPickupPointRequest)))
        .thenReturn(Collections.singletonList(itemPickupPointBasicResponse));
    MasterDataProductDTO masterDataProductDTO = new MasterDataProductDTO();
    MasterDataProductImageDTO masterDataProductImageDTO1 = new MasterDataProductImageDTO();
    MasterDataProductImageDTO masterDataProductImageDTO2 = new MasterDataProductImageDTO();
    masterDataProductImageDTO2.setCommonImage(true);
    masterDataProductImageDTO2.setMainImage(false);
    masterDataProductDTO.setMasterDataProductImages(
        Arrays.asList(masterDataProductImageDTO1, masterDataProductImageDTO2));
    productL3Response.setMasterDataProduct(masterDataProductDTO);
    productVariantPriceStockAndImagesRequest1.setNewlyAddedItem(true);
    productVariantPriceStockAndImagesRequest1.setImages(Arrays.asList(new ProductLevel3SummaryDetailsImageRequest()));
    com.gda.mta.product.dto.ItemPickupPointRequest pickupPointRequest =
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId(PICKUP_POINT_ID).itemSku(ITEM_SKU)
            .discoverableSchedule(
                DiscoverableScheduleRequest.builder().discoverable(true).startDateTime(startDate).endDateTime(endDate)
                    .build()).buyableSchedule(
                BuyableScheduleRequest.builder().startDateTime(startDate).endDateTime(endDate).buyable(true).build())
            .build();
    productVariantPriceStockAndImagesRequest1.setModifiedItemPickupPoints(
        Collections.singletonList(itemPickupPointRequest1));
    ProductItemWholesalePriceRequest productItemWholesalePriceRequest1 = new ProductItemWholesalePriceRequest();
    productItemWholesalePriceRequest1.setWholesaleDiscount(-1);
    productL3UpdateRequest = generateProductL3UpdateRequest();
    productL3UpdateRequest.setProductItems(Arrays.asList(productVariantPriceStockAndImagesRequest1));
    productL3UpdateRequest.setCommonImages(new ArrayList<>());
    productL3UpdateRequest.setAddPickupPoints(Collections.singletonList(
        com.gda.mta.product.dto.ItemPickupPointRequest.builder().pickupPointId("id")
            .discoverableSchedule(new DiscoverableScheduleRequest()).buyableSchedule(new BuyableScheduleRequest())
            .display(true)
            .productItemWholesalePriceRequests(Collections.singletonList(productItemWholesalePriceRequest1))
            .buyable(false).build()));
    ProductEditValidationDTO productEditValidationDTO =
        productLevel3V2Service.validationsForEdit(REQUEST_ID, productL3UpdateRequest, productLevel3, editResponse,
            productL3Response, profileResponse);

  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOnTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_offlineCncStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_FreeSampleCncStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    itemSummaryListResponse.setFreeSample(true);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.ONLINE);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    try {
      productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request, false);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
          .contains(ApiErrorCode.FREE_SAMPLE_CANNOT_BE_SET.getDesc()));
    }
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_FreeSampleNotInstoreTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    itemSummaryListResponse.setFreeSample(true);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setOff2OnActiveFlag(false);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncStatus(null);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    try {
      productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request, false);
    } catch (Exception e) {
      Assertions.assertTrue(e.getMessage()
          .contains(ApiErrorCode.FREE_SAMPLE_CANNOT_BE_SET.getDesc()));
    }
    verify(xProductOutbound)
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_FreeSampleCncFalse() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    itemSummaryListResponse.setFreeSample(true);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    quickEditV2Request.setStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setOff2OnActiveFlag(false);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    productLevel3QuickEditV2Request.getQuickEditV2Requests().get(0).setCncActive(true);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
      productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
          productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_bothStatusNonOfflineTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.ONLINE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_deliveryStatusNonOfflineTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2_cncWarehouseSwitchOn_statusIncompatibleTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.TEASER);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>())
        .build());
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound).getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.productPricingOutbound).getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
      verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
          any(CampaignUpdateDiscountRequest.class));
      verify(this.productLevel3InventoryService)
          .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
              Mockito.anyList());
      verify(this.categoryRepository).findHierarchyByCategoryCode(CATEGORY_CODE);
      verify(this.pickupPointRepository).findByPickupPointCode(PICKUP_POINT_CODE);
    }
  }

  @Test
  public void productQuickEditV2_StockIncrementSellerPenaltyExpectionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "sellerPenaltyEnabledPhase2", true);
    B2bFieldsRequest b2bFieldsRequest = new B2bFieldsRequest();
    b2bFieldsRequest.setStatus(ProductLevel3Status.OFFLINE);
    b2bFieldsRequest.setBasePrice(200.0);
    quickEditV2Request.setB2bFieldsRequest(b2bFieldsRequest);
    ItemViewConfigDTO itemViewConfigDTO1 = new ItemViewConfigDTO();
    itemViewConfigDTO1.setBuyable(true);
    itemViewConfigDTO1.setDiscoverable(true);
    itemViewConfigDTO1.setChannel(Constants.B2B_CHANNEL);
    itemSummaryListResponse.getItemViewConfigs().add(itemViewConfigDTO1);
    B2bFieldsDTO b2bFieldsDTO = new B2bFieldsDTO();
    b2bFieldsDTO.setBasePrice(100.0);
    itemSummaryListResponse.setB2bFields(b2bFieldsDTO);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.TEASER);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    Mockito.when(campaignOutbound.validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemSkuStatusMap(new HashMap<>()).build());
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(
        updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(
            pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    ApiErrorCode apiErrorCode = productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    verify(xProductOutbound).getItemPickupPointSummary(
        eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.productSystemParameterService).findByStoreIdAndVariable(STORE_ID,
        Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Assertions.assertEquals(ApiErrorCode.SELLER_PENALTY_RESTRICTION.getCode(),
        apiErrorCode.getCode());
  }

  @Test
  public void productQuickEditV2_cncTeaserStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    quickEditV2Request.setCncStatus(ProductLevel3Status.TEASER);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Requests.add(quickEditV2Request);
    ProfileResponse businessPartner = new ProfileResponse();
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(MERCHANT_CODE))
        .thenReturn(businessPartner);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
        productLevel3QuickEditV2Request, false);
    Mockito.verify(productLevel3InventoryService)
        .updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    verify(productNotificationService)
        .sendNotificationForProductStatus(MERCHANT_CODE, ITEM_NAME,
            quickEditV2Request.getCncStatus().name());
    verify(xProductOutbound, times(2))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    verify(this.campaignOutbound)
        .validateAndUpdateDiscountPrice(eq(true), Mockito.any(CampaignUpdateDiscountRequest.class));
    verify(this.categoryRepository, times(2)).findHierarchyByCategoryCode(CATEGORY_CODE);
    verify(this.productLevel3Helper)
        .isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
            false);
    verify(xProductOutbound)
        .updateItemPickupPointListing(eq(PRODUCT_SKU), eq(ProductType.BIG_PRODUCT),
            Mockito.anyList());
    verify(updateProductItemLevel3ModelConverter, times(2))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
    verify(this.updatedProductHistoryService)
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    verify(this.productLevel3InventoryService, times(2))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(this.pickupPointRepository, times(2)).findByPickupPointCode(PICKUP_POINT_CODE);
    verify(this.productPricingOutbound)
        .getWholesalePriceByItemSkuAndPickupPointCode(Collections.singletonList(itemInfoDto));
    verify(this.productSystemParameterService)
        .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    verify(pickupPointOutbound).getByPickupPointCodes(REQUEST_ID,Arrays.asList(PICKUP_POINT_CODE));
  }

  @Test
  public void productQuickEditV2FaasSellerTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "faasFeatureSwitch", true);
    quickEditV2Request.setCncStatus(ProductLevel3Status.TEASER);
    Set<String> pickupPointSet = new HashSet<>();
    quickEditV2Request.setItemPickupPointId(PICKUP_POINT_ID);
    pickupPointSet.add(quickEditV2Request.getPickupPointCode());
    List<QuickEditV2Request> quickEditV2Requests = new ArrayList<>();
    List<PickupPointResponse> pickupPointResponseList = new ArrayList<>();
    pickupPointResponse.setArchived(false);
    pickupPointResponse.setBusinessPartnerCode(BUSINESS_PARTNER_CODE);
    pickupPointResponseList.add(pickupPointResponse);
    quickEditV2Request.setUseWarehouseStock(true);
    quickEditV2Requests.add(quickEditV2Request);
    ProfileResponse businessPartner = new ProfileResponse();
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    businessPartner.setBusinessPartnerCode(MERCHANT_CODE);
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.FAAS_ACTIVATED, true);
    businessPartner.setFlags(flags);
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(MERCHANT_CODE))
        .thenReturn(businessPartner);
    Mockito.when(
        productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(REQUEST_ID, Arrays.asList(PICKUP_POINT_CODE)))
        .thenReturn(pickupPointResponseList);
    try {
      Assertions.assertThrows(ApplicationRuntimeException.class, () -> {
        productLevel3V2Service.productQuickEditV2(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request, false);
      });
    } finally {
      verify(xProductOutbound)
          .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
      verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
      verify(this.productSystemParameterService)
          .findByStoreIdAndVariable(STORE_ID, Constants.MINIMUM_PRICE);
      verify(campaignOutbound).validateDiscountPrice(anyBoolean(),
          any(CampaignUpdateDiscountRequest.class));
    }
  }

  @Test
  public void quickEditPatchingCncOnline_cncSwitchOn_backwardCompatibiltyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncActive(true);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }
  @Test
  public void quickEditPatchingCncOffline_cncSwitchOn_backwardCompatibiltyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncActive(false);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }
  @Test
  public void quickEditPatchingCncAbsent_cncSwitchOn_backwardCompatibiltyTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test
  public void quickEditPatching_StockIncrementSellerPenaltyExceptionTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "sellerPenaltyEnabledPhase2", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response =
        new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU))
        .thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setWholeSaleActivated(null);
    quickEditV2Request.setDeltaStock(1);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(
        updateOrInsertStockVoArgumentCaptor.capture())).thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    ProfileResponse bpWithPenalty = new ProfileResponse();
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.PRODUCT_CONSEQUENCE_LIMITATION, true);
    bpWithPenalty.setFlags(flags);
    Mockito.when(this.businessPartnerRepository.filterDetailByBusinessPartnerCode(MERCHANT_CODE))
        .thenReturn(bpWithPenalty);
    ApplicationRuntimeException ex = Assertions.assertThrows(ApplicationRuntimeException.class,
        () -> productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU,
            productLevel3QuickEditV2Request));
    verify(xProductOutbound).getItemPickupPointSummary(
        eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    Assertions.assertEquals(
        "Can not process invalid input data :" + ApiErrorCode.SELLER_PENALTY_RESTRICTION.getDesc(),
        ex.getMessage());
  }

  @Test
  public void quickEditPatchingInvalidCncUpdateRequestForBopis_cncSwitchOn_onlineTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.OFFLINE);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.BOPIS);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }
  @Test
  public void quickEditPatchingInvalidCncUpdateRequestForBopis_cncSwitchOn_teaserTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.TEASER);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>())
            .itemSkuStatusMap(new HashMap<>()).build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }
  @Test
  public void quickEditPatchingInvalidCncUpdateRequestForBopis_cncSwitchOn_sameStatusTest() throws Exception {
    ReflectionTestUtils.setField(productLevel3V2Service, "maxStockLimit", MAXIMUM_STOCK_LIMIT);
    ReflectionTestUtils.setField(productLevel3V2Service, "bopisCNCRestrictionEnabled", true);
    ReflectionTestUtils.setField(productLevel3V2Service, "cncForWarehouseFeatureSwitch", true);
    companyDTO.setMerchantType(MerchantType.CC.name());
    ProductL3Response productL3Response = generateProductL3Response();
    GdnRestSingleResponse<ProductL3Response> l3Response = new GdnRestSingleResponse<>(productL3Response, REQUEST_ID);
    Mockito.when(xProductOutbound.getProductDetailsByProductSku(PRODUCT_SKU)).thenReturn(l3Response);
    quickEditV2Request.setVersion(null);
    quickEditV2Request.setStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setCncStatus(ProductLevel3Status.ONLINE);
    quickEditV2Request.setWholeSaleActivated(null);
    itemSummaryListResponse.setProductType(ProductType.REGULAR);
    Mockito.when(productLevel3InventoryService.updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture()))
        .thenReturn(null);
    when(productLevel3Helper.isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request, itemSummaryListResponse,
        null)).thenReturn(false);
    when(campaignOutbound.validateAndUpdateDiscountPrice(anyBoolean(),
        any(CampaignUpdateDiscountRequest.class))).thenReturn(
        CampaignUpdateDiscountResponse.builder().itemInfoStatus(new ArrayList<>()).itemSkuStatusMap(new HashMap<>())
            .build());
    productLevel3V2Service.quickEditPatching(STORE_ID, PRODUCT_SKU, productLevel3QuickEditV2Request);
    verify(productLevel3Helper).isProductItemDetailChangedForL5ListingUpdate(quickEditV2Request,
        itemSummaryListResponse, null);
    verify(campaignOutbound).validateAndUpdateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(xProductOutbound, times(3))
        .getItemPickupPointSummary(eq(Collections.singletonList(itemPickupPointRequest)), eq(Constants.ALL));
    Mockito.verify(xProductOutbound).getProductDetailsByProductSku(PRODUCT_SKU);
    Mockito.verify(productLevel3InventoryService).updateOrInsertStock(updateOrInsertStockVoArgumentCaptor.capture());
    Mockito.verify(this.businessPartnerRepository).filterDetailByBusinessPartnerCode(MERCHANT_CODE);
    verify(campaignOutbound).validateDiscountPrice(anyBoolean(), any(CampaignUpdateDiscountRequest.class));
    Mockito.verify(this.productLevel3InventoryService, times(3))
        .findInventoryByBusinessPartnerCodeAndItemSkuAndPickupPointCode(
            Mockito.anyList());
    Mockito.verify(this.updatedProductHistoryService, times(2))
        .saveUpdateProductLevel3Audit(MERCHANT_CODE, ITEM_SKU, oldUpdateProductItemLevel3Model,
            newUpdateProductItemLevel3Model, Constants.DEFAULT, PRODUCT_SKU, ITEM_NAME, false, StringUtils.EMPTY);
    Mockito.verify(this.categoryRepository, times(3)).findHierarchyByCategoryCode(CATEGORY_CODE);
    Mockito.verify(this.pickupPointRepository, times(3)).findByPickupPointCode(PICKUP_POINT_CODE);
    Mockito.verify(updateProductItemLevel3ModelConverter, times(4))
        .convertFromProductLevel3Summary(Mockito.any(ProductLevel3Summary.class));
  }

  @Test
  public void testEligibilityForNeedRevisionDeletion_WithEmptyRequestList()
      throws ApplicationException {
    ReflectionTestUtils.setField(productLevel3V2Service, "needRevisionDeletionThreshold", 7);
    List<NeedRevisionEligibilityRequest> needRevisionEligibilityRequestList = new ArrayList<>();
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest1 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest1.setProductCode("MTA-1111");
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest2 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest2.setProductCode("MTA-2222");
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest3 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest3.setProductCode("MTA-3333");
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest4 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest4.setProductCode("MTA-4444");
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest5 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest5.setProductCode("MTA-5555");
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest1);
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest2);
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest3);
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest4);
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest5);
    List<ProductSkuBusinessPartnerDTO> productSkuBusinessPartnerDTOList = new ArrayList<>();
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO1 =
        new ProductSkuBusinessPartnerDTO("MTA-1111", PRODUCT_SKU_1, BUSINESS_PARTNER_CODE,
            new Date(), "productname");
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO2 =
        new ProductSkuBusinessPartnerDTO("MTA-2222", PRODUCT_SKU_2, "businessPartner2", new Date(),
            "productname");
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO3 =
        new ProductSkuBusinessPartnerDTO("MTA-3333", PRODUCT_SKU_3, "businessPartner3",
            new Date(System.currentTimeMillis() - TimeUnit.DAYS.toMillis(10)), "productname");
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO4 =
        new ProductSkuBusinessPartnerDTO("MTA-4444", PRODUCT_SKU_4, "businessPartner3", null,
            "productname");
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO5 =
        new ProductSkuBusinessPartnerDTO("MTA-4444", PRODUCT_SKU_4, "businessPartner3", null,
            "productname");
    ProductSkuBusinessPartnerDTO productSkuBusinessPartnerDTO6 =
        new ProductSkuBusinessPartnerDTO("MTA-5555", PRODUCT_SKU_5, "businessPartner3", null,
            "productname");
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO1);
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO2);
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO3);
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO4);
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO5);
    productSkuBusinessPartnerDTOList.add(productSkuBusinessPartnerDTO6);
    Mockito.when(productBusinessPartnerServiceBean.getGdnSkuListByProductCodes(
            Arrays.asList("MTA-1111", "MTA-2222", "MTA-3333", "MTA-4444", "MTA-5555")))
        .thenReturn(productSkuBusinessPartnerDTOList);
    Map<String, Boolean> campaignEligibility = new HashMap<>();
    campaignEligibility.put(PRODUCT_SKU_1, false);
    campaignEligibility.put(PRODUCT_SKU_2, true);
    campaignEligibility.put(PRODUCT_SKU_3, false);
    campaignEligibility.put(PRODUCT_SKU_4, false);
    campaignEligibility.put(PRODUCT_SKU_5, false);
    Map<String, Boolean> orderEligibilityMap = new HashMap<>();
    orderEligibilityMap.put(PRODUCT_SKU_1, false);
    orderEligibilityMap.put(PRODUCT_SKU_2, true);
    orderEligibilityMap.put(PRODUCT_SKU_3, false);
    orderEligibilityMap.put(PRODUCT_SKU_4, false);
    orderEligibilityMap.put(PRODUCT_SKU_5, true);
    when(productLevel3Repository.campaignEligibilityForProductSku(any())).thenReturn(
        campaignEligibility);
    when(agpQueryOutboundBean.findNumberOfOrderByProductSkuList(any())).thenReturn(
        orderEligibilityMap);
    List<NeedRevisionEligibilityResponse> result =
        productLevel3V2Service.eligibilityForNeedRevisionDeletion("storeId",
            needRevisionEligibilityRequestList, true);
    Mockito.verify(productBusinessPartnerServiceBean, Mockito.times(1)).getGdnSkuListByProductCodes(
        Arrays.asList("MTA-1111", "MTA-2222", "MTA-3333", "MTA-4444", "MTA-5555"));
    Mockito.verify(productLevel3Repository, Mockito.times(1))
        .campaignEligibilityForProductSku(any(PromoEligibilityRequest.class));
    Assertions.assertFalse(result.get(0).getEligibleForDeletion());
    Assertions.assertTrue(result.get(2).getEligibleForDeletion());
  }

  @Test
  public void testEligibilityForNeedRevisionDeletion_WithSingleRequestAndFalseCondition() throws ApplicationException {
    List<NeedRevisionEligibilityRequest> needRevisionEligibilityRequestList = new ArrayList<>();
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest1 =
        new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest1.setProductCode("MTA-1111");
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest1);
    List<ProductSkuBusinessPartnerDTO> productSkuBusinessPartnerDTOList = Arrays.asList(
        new ProductSkuBusinessPartnerDTO("MTA-1111", PRODUCT_SKU_1, "businessPartner1", new Date(), "productname")
    );
    when(productBusinessPartnerServiceBean.getGdnSkuListByProductCodes(Collections.singletonList("MTA-1111")))
        .thenReturn(productSkuBusinessPartnerDTOList);
    Map<String, Boolean> campaignEligibility = new HashMap<>();
    campaignEligibility.put(PRODUCT_SKU_1, true);
    Map<String, Boolean> orderEligibilityMap = new HashMap<>();
    orderEligibilityMap.put(PRODUCT_SKU_1, false);
    when(productLevel3Repository.campaignEligibilityForProductSku(any()))
        .thenReturn(campaignEligibility);
    when(agpQueryOutboundBean.findNumberOfOrderByProductSkuList(any()))
        .thenReturn(orderEligibilityMap);
    List<NeedRevisionEligibilityResponse> result = productLevel3V2Service.eligibilityForNeedRevisionDeletion(
        "storeId", needRevisionEligibilityRequestList, true);
    verify(productBusinessPartnerServiceBean, times(1))
        .getGdnSkuListByProductCodes(Collections.singletonList("MTA-1111"));
    verify(productLevel3Repository, times(1))
        .campaignEligibilityForProductSku(any(PromoEligibilityRequest.class));
    Assertions.assertNull(result.get(0).getEligibleForDeletion());
  }

  @Test
  public void testEligibilityForNeedRevisionDeletion_ProcessBulkFlowFalse() throws ApplicationException {
    List<NeedRevisionEligibilityRequest> needRevisionEligibilityRequestList = new ArrayList<>();
    NeedRevisionEligibilityRequest needRevisionEligibilityRequest1 = new NeedRevisionEligibilityRequest();
    needRevisionEligibilityRequest1.setProductCode("MTA-1111");
    needRevisionEligibilityRequestList.add(needRevisionEligibilityRequest1);
    List<ProductSkuBusinessPartnerDTO> productSkuBusinessPartnerDTOList = Arrays.asList(
        new ProductSkuBusinessPartnerDTO("MTA-1111", PRODUCT_SKU_1, "businessPartner1", new Date(), "productname"));
    when(productBusinessPartnerServiceBean.getGdnSkuListByProductCodes(
        Collections.singletonList("MTA-1111"))).thenReturn(productSkuBusinessPartnerDTOList);
    Map<String, Boolean> campaignEligibility = new HashMap<>();
    campaignEligibility.put(PRODUCT_SKU_1, false);
    Map<String, Boolean> orderEligibilityMap = new HashMap<>();
    orderEligibilityMap.put(PRODUCT_SKU_1, false);
    when(productLevel3Repository.campaignEligibilityForProductSku(any())).thenReturn(campaignEligibility);
    when(agpQueryOutboundBean.findNumberOfOrderByProductSkuList(any())).thenReturn(orderEligibilityMap);
    List<NeedRevisionEligibilityResponse> result =
        productLevel3V2Service.eligibilityForNeedRevisionDeletion("storeId", needRevisionEligibilityRequestList, false);
    verify(productBusinessPartnerServiceBean, times(1)).getGdnSkuListByProductCodes(
        Collections.singletonList("MTA-1111"));
    verify(productLevel3Repository, times(1)).campaignEligibilityForProductSku(any(PromoEligibilityRequest.class));
    Assertions.assertTrue(result.get(0).getEligibleForDeletion());
  }


  @Test
  public void getProductL3BasicResponseTest() {
    productBusinessPartner.setState(Constants.IN_PROGRESS_STATE);
    productBusinessPartner.setOff2OnChannelActive(true);
    productBusinessPartner.setB2cActivated(true);
    Mockito.when(productBusinessPartnerServiceBean.findByProductCode(PRODUCT_CODE))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    ProductL3BasicResponse productL3BasicResponse =
        productLevel3V2Service.getProductL3BasicResponse(STORE_ID, PRODUCT_CODE);
    Mockito.verify(productBusinessPartnerServiceBean).findByProductCode(PRODUCT_CODE);
    Assertions.assertTrue(productL3BasicResponse.isB2cActivated());
    Assertions.assertTrue(productL3BasicResponse.isOff2OnChannelActive());
    Assertions.assertFalse(productL3BasicResponse.isPureInStoreProduct());
  }

  @Test
  public void getProductL3BasicResponseInProgressPureInStoreTest() {
    productBusinessPartner.setState(Constants.IN_PROGRESS_STATE);
    productBusinessPartner.setOff2OnChannelActive(true);
    productBusinessPartner.setB2cActivated(false);
    Mockito.when(productBusinessPartnerServiceBean.findByProductCode(PRODUCT_CODE))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    ProductL3BasicResponse productL3BasicResponse =
        productLevel3V2Service.getProductL3BasicResponse(STORE_ID, PRODUCT_CODE);
    Mockito.verify(productBusinessPartnerServiceBean).findByProductCode(PRODUCT_CODE);
    Assertions.assertFalse(productL3BasicResponse.isB2cActivated());
    Assertions.assertTrue(productL3BasicResponse.isOff2OnChannelActive());
    Assertions.assertTrue(productL3BasicResponse.isPureInStoreProduct());
  }

  @Test
  public void getProductL3BasicResponseActivePureInStoreTest() {
    BasicProductResponse basicProductResponse = new BasicProductResponse();
    basicProductResponse.setOff2OnChannelActive(true);
    basicProductResponse.setB2cActivated(false);
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerServiceBean.findByProductCode(PRODUCT_CODE))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    Mockito.when(xProductOutbound.getBasicProductInfoV2(productBusinessPartner.getGdnProductSku()))
        .thenReturn(basicProductResponse);
    ProductL3BasicResponse productL3BasicResponse =
        productLevel3V2Service.getProductL3BasicResponse(STORE_ID, PRODUCT_CODE);
    Mockito.verify(xProductOutbound).getBasicProductInfoV2(productBusinessPartner.getGdnProductSku());
    Mockito.verify(productBusinessPartnerServiceBean).findByProductCode(PRODUCT_CODE);
    Assertions.assertFalse(productL3BasicResponse.isB2cActivated());
    Assertions.assertTrue(productL3BasicResponse.isOff2OnChannelActive());
    Assertions.assertTrue(productL3BasicResponse.isPureInStoreProduct());
  }

  @Test
  public void getProductL3BasicResponseActivePureITest() {
    BasicProductResponse basicProductResponse = new BasicProductResponse();
    basicProductResponse.setOff2OnChannelActive(true);
    basicProductResponse.setB2cActivated(true);
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerServiceBean.findByProductCode(PRODUCT_CODE))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    Mockito.when(xProductOutbound.getBasicProductInfoV2(productBusinessPartner.getGdnProductSku()))
        .thenReturn(basicProductResponse);
    ProductL3BasicResponse productL3BasicResponse =
        productLevel3V2Service.getProductL3BasicResponse(STORE_ID, PRODUCT_CODE);
    Mockito.verify(xProductOutbound).getBasicProductInfoV2(productBusinessPartner.getGdnProductSku());
    Mockito.verify(productBusinessPartnerServiceBean).findByProductCode(PRODUCT_CODE);
    Assertions.assertTrue(productL3BasicResponse.isB2cActivated());
    Assertions.assertTrue(productL3BasicResponse.isOff2OnChannelActive());
    Assertions.assertFalse(productL3BasicResponse.isPureInStoreProduct());
  }

  @Test
  public void getProductL3BasicResponseActivePureTest() {
    BasicProductResponse basicProductResponse = new BasicProductResponse();
    basicProductResponse.setOff2OnChannelActive(false);
    basicProductResponse.setB2cActivated(true);
    productBusinessPartner.setState(ACTIVE);
    Mockito.when(productBusinessPartnerServiceBean.findByProductCode(PRODUCT_CODE))
        .thenReturn(Collections.singletonList(productBusinessPartner));
    Mockito.when(xProductOutbound.getBasicProductInfoV2(productBusinessPartner.getGdnProductSku()))
        .thenReturn(basicProductResponse);
    ProductL3BasicResponse productL3BasicResponse =
        productLevel3V2Service.getProductL3BasicResponse(STORE_ID, PRODUCT_CODE);
    Mockito.verify(xProductOutbound).getBasicProductInfoV2(productBusinessPartner.getGdnProductSku());
    Mockito.verify(productBusinessPartnerServiceBean).findByProductCode(PRODUCT_CODE);
    Assertions.assertTrue(productL3BasicResponse.isB2cActivated());
    Assertions.assertFalse(productL3BasicResponse.isOff2OnChannelActive());
    Assertions.assertFalse(productL3BasicResponse.isPureInStoreProduct());
  }

  @Test
  void validateExistingOrderOnProductNameEdit_nameEditNotAllowed() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    AgpSimpleQueryResponse agpResponse = new AgpSimpleQueryResponse();
    HitsResponse hits = new HitsResponse();
    hits.setTotal(7);
    agpResponse.setHits(hits);

    when(agpQueryFeign.findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS)).thenReturn(agpResponse);

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertEquals(ApiErrorCode.NAME_EDIT_NOT_ALLOWED, result);
    verify(agpQueryFeign, times(1)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  void validateExistingOrderOnProductNameEdit_nameEditAllowed_noOrders() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    AgpSimpleQueryResponse agpResponse = new AgpSimpleQueryResponse();
    HitsResponse hits = new HitsResponse();
    hits.setTotal(0);
    agpResponse.setHits(hits);

    when(agpQueryFeign.findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS)).thenReturn(agpResponse);

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertNull(result);
    verify(agpQueryFeign, times(1)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  void validateExistingOrderOnProductNameEdit_nameEditAllowed_officialSeller() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(true);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertNull(result);
    verify(agpQueryFeign, times(0)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  void validateExistingOrderOnProductNameEdit_nameEditAllowed_noProductNameUpdateChangeType() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.SIZE_CHART_UPDATE));
    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);
    Assertions.assertNull(result);
    verify(agpQueryFeign, times(0)).findNumberOfOrder(anyString(), anyString(), anyString(), anyString());
  }

  @Test
  void validateExistingOrderOnProductNameEdit_agpResponseNull() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    when(agpQueryFeign.findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS)).thenReturn(null);

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertNull(result);
    verify(agpQueryFeign, times(1)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  void validateExistingOrderOnProductNameEdit_agpResponseHitsNull() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    AgpSimpleQueryResponse agpResponse = new AgpSimpleQueryResponse();
    agpResponse.setHits(null);

    when(agpQueryFeign.findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS)).thenReturn(agpResponse);

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertNull(result);
    verify(agpQueryFeign, times(1)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  void validateExistingOrderOnProductNameEdit_exceptionDuringAgpCall() throws Exception {
    ProductMasterDataEditRequest request = new ProductMasterDataEditRequest();
    request.setProductSku(PRODUCT_SKU);
    request.setOfficialStoreSeller(false);
    request.setMasterDataEditChangeTypes(Collections.singleton(L3InfoUpdateChangeType.PRODUCT_NAME_UPDATE));

    doThrow(new ApplicationRuntimeException(ErrorCategory.VALIDATION)).when(agpQueryFeign).findNumberOfOrder(PRODUCT_SKU,
      Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);

    ApiErrorCode result = productLevel3V2Service.validateExistingOrderOnProductNameEdit(request);

    Assertions.assertNull(result);
    verify(agpQueryFeign, times(1)).findNumberOfOrder(PRODUCT_SKU, Constants.ZERO.toString(),
      Constants.ZERO.toString(), Constants.AGP_ITEM_STATUS);
  }

  @Test
  public void checkIfSellerSkuExistsTest() {
    productLevel3V2Service.checkIfOmniChannelSkuExists(STORE_ID, new OmniChannelSkuRequest());
    Mockito.verify(productOutbound).getOmniChannelSkuToItemCode(new OmniChannelSkuRequest().getSellerCode(),
        new OmniChannelSkuRequest().getOmniChannelSkus());
    Assertions.assertNotNull(STORE_ID);
  }

  @Test
  public void testUpdateCogsValue_Success() throws Exception {
    CogsUpdateDtoRequest dtoRequest = new CogsUpdateDtoRequest();
    dtoRequest.setItemSku(ITEM_SKU);
    dtoRequest.setPickupPointCode(PICKUP_POINT_CODE);
    dtoRequest.setInsuredAmount(100.0);

    CogsUpdateRequests request = new CogsUpdateRequests();
    request.setListRequest(Arrays.asList(dtoRequest));
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.DISTRIBUTION_FLAG_KEY, Boolean.TRUE);
    pickupPointResponse.setFlags(flags);
    Mockito.doNothing().when(xProductOutbound).updateCogsValue(eq(PRODUCT_SKU), any());
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(Constants.DEFAULT_USERNAME,
            request.getListRequest().stream().map(CogsUpdateDtoRequest::getPickupPointCode).distinct().toList()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    productLevel3V2Service.updateCogsValue(PRODUCT_SKU, request);

    Mockito.verify(xProductOutbound).updateCogsValue(eq(PRODUCT_SKU), any());
    Mockito.verify(pickupPointOutbound).getByPickupPointCodes(Constants.DEFAULT_USERNAME,
        request.getListRequest().stream().map(CogsUpdateDtoRequest::getPickupPointCode).distinct().toList());
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void testUpdateCogsValueNull() throws Exception {
    productLevel3V2Service.updateCogsValue(PRODUCT_SKU, null);
    productLevel3V2Service.updateCogsValue(PRODUCT_SKU, new CogsUpdateRequests());
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void testUpdateCogsValue_Exception() throws Exception {
    CogsUpdateDtoRequest dtoRequest = new CogsUpdateDtoRequest();
    dtoRequest.setItemSku(ITEM_SKU);
    dtoRequest.setPickupPointCode(PICKUP_POINT_CODE);
    dtoRequest.setInsuredAmount(100.0);

    CogsUpdateRequests request = new CogsUpdateRequests();
    request.setListRequest(Arrays.asList(dtoRequest));
    Map<String, Object> flags = new HashMap<>();
    flags.put(Constants.DISTRIBUTION_FLAG_KEY, Boolean.TRUE);
    pickupPointResponse.setFlags(flags);
    Mockito.doNothing().when(xProductOutbound).updateCogsValue(eq(PRODUCT_SKU), any());
    Mockito.when(pickupPointOutbound.getByPickupPointCodes(Constants.DEFAULT_USERNAME,
            request.getListRequest().stream().map(CogsUpdateDtoRequest::getPickupPointCode).distinct().toList()))
        .thenReturn(Collections.singletonList(pickupPointResponse));
    Mockito.doThrow(new RuntimeException("Error message")).when(xProductOutbound).updateCogsValue(eq(PRODUCT_SKU), any());

    Assertions.assertThrows(RuntimeException.class, () -> {
      productLevel3V2Service.updateCogsValue(PRODUCT_SKU, request);
    });

    Mockito.verify(xProductOutbound).updateCogsValue(eq(PRODUCT_SKU), any());
    Mockito.verify(pickupPointOutbound).getByPickupPointCodes(Constants.DEFAULT_USERNAME,
        request.getListRequest().stream().map(CogsUpdateDtoRequest::getPickupPointCode).distinct().toList());
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void testUpdateCogsValueNonDistributionException() throws Exception {
    CogsUpdateDtoRequest dtoRequest = new CogsUpdateDtoRequest();
    dtoRequest.setItemSku(ITEM_SKU);
    dtoRequest.setPickupPointCode(PICKUP_POINT_CODE);
    dtoRequest.setInsuredAmount(100.0);

    CogsUpdateRequests request = new CogsUpdateRequests();
    request.setListRequest(Arrays.asList(dtoRequest));

    Assertions.assertThrows(RuntimeException.class, () -> {
      productLevel3V2Service.updateCogsValue(PRODUCT_SKU, request);
    });

    Mockito.verify(pickupPointOutbound).getByPickupPointCodes(Constants.DEFAULT_USERNAME,
        request.getListRequest().stream().map(CogsUpdateDtoRequest::getPickupPointCode).distinct().toList());
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void testGetCogsData_Success() throws Exception {
    CogsResponse cogsResponse = new CogsResponse();
    cogsResponse.setItemSku(ITEM_SKU);
    cogsResponse.setPickupPointCode(PICKUP_POINT_CODE);
    cogsResponse.setInsuredAmount(100.0);

    List<CogsResponse> cogsResponses = Arrays.asList(cogsResponse);
    Mockito.when(xProductOutbound.getCogsData(PRODUCT_SKU, 0, 20)).thenReturn(cogsResponses);

    List<CogsDataResponse> result = productLevel3V2Service.getCogsData(PRODUCT_SKU, 0, 20);

    Assertions.assertNotNull(result);
    Assertions.assertEquals(1, result.size());
    Assertions.assertEquals(ITEM_SKU, result.get(0).getItemSku());
    Assertions.assertEquals(PICKUP_POINT_CODE, result.get(0).getPickupPointCode());
    Assertions.assertEquals(100.0, result.get(0).getInsuredAmount());

    Mockito.verify(xProductOutbound).getCogsData(PRODUCT_SKU, 0, 20);
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void testGetCogsData_Exception() throws Exception {
    Mockito.when(xProductOutbound.getCogsData(PRODUCT_SKU, 0, 20)).thenThrow(new RuntimeException("Error message"));

    Assertions.assertThrows(RuntimeException.class, () -> {
      productLevel3V2Service.getCogsData(PRODUCT_SKU, 0, 20);
    });

    Mockito.verify(xProductOutbound).getCogsData(PRODUCT_SKU, 0, 20);
    Assertions.assertNotNull(PRODUCT_REQUEST);
  }

  @Test
  public void publishProductLevelHistoryToPcbForDistributionUpdateTest() {
    productLevel3V2Service.publishProductLevelHistoryToPcbForDistributionUpdate(PRODUCT_CODE, BUSINESS_PARTNER_CODE,
        new ArrayList<>());
    Mockito.verify(distributionInfoService)
        .publishProductLevelHistoryToPcbForDistributionUpdate(PRODUCT_CODE, BUSINESS_PARTNER_CODE, new ArrayList<>(),
            Constants.MESSAGE_IDENTIFIER_KEY);
  }
}
